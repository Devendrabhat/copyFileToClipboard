/* module-key = 'com.atlassian.auiplugin:aui-dropdown2', location = 'js/dropdown2.js' */
(function(G){var E=G(document);var C=null;function H(L){L.preventDefault()}var B=(function(){var N=false;function L(P){if(!N&&P.which===1){N=true;E.bind("mouseup mouseleave",M);G(this).trigger("aui-button-invoke")}}function M(){E.unbind("mouseup mouseleave",M);setTimeout(function(){N=false},0)}function O(){if(!N){G(this).trigger("aui-button-invoke")}}if(typeof document.addEventListener==="undefined"){return{click:O,"click selectstart":H,mousedown:function(R){var S=this;var Q=document.activeElement;function P(T){switch(T.toElement){case null:case S:case document.body:case document.documentElement:T.returnValue=false}}L.call(this,R);if(Q!==null){Q.attachEvent("onbeforedeactivate",P);setTimeout(function(){Q.detachEvent("onbeforedeactivate",P)},0)}}}}return{click:O,"click mousedown":H,mousedown:L}})();var A={"aui-button-invoke":function(h,R){R=G.extend({selectFirst:true},R);var O=J(this);var N=G(this).addClass("active aui-dropdown2-active");var r=N.hasClass("aui-dropdown2-sub-trigger");var m=O.parent()[0];var p=O.next()[0];var d=G(this).attr("data-dropdown2-hide-location");if(d){var Z=document.getElementById(d);if(Z){m=G(Z);p=undefined}else{throw new Error("The specified data-dropdown2-hide-location id doesn't exist")}}var T=R.$menu||N.closest(".aui-dropdown2-trigger-group");if(r){var e=N.closest(".aui-dropdown2");O.addClass(e.attr("class")).addClass("aui-dropdown2-sub-menu")}var S={click:function(t){var s=G(this);if(!P(s)){return }if(!s.hasClass("interactive")&&!s.hasClass("aui-dropdown2-interactive")){l()}if(V(s)){f(s,{selectFirst:false});H(t)}},mousemove:function(){var t=G(this);var s=U(t);if(s){f(t,{selectFirst:false})}}};var n={"click focusin mousedown":function(s){var t=s.target;if(document===t&&s.type==="focusin"){return }if(!D(t,O[0])&&!D(t,N[0])){l()}},keydown:function(u){var t;if(u.shiftKey&&u.keyCode==9){j(-1)}else{switch(u.keyCode){case 13:t=Y();if(V(t)){f(t)}else{K(t[0])}break;case 27:a();break;case 37:t=Y();if(V(t)){var s=J(t);if(s.is(":visible")){O.trigger("aui-dropdown2-step-out");return }}if(r){a()}else{q(-1)}break;case 38:j(-1);break;case 39:t=Y();if(V(t)){f(t)}else{q(1)}break;case 40:j(1);break;case 9:j(1);break;default:return }}H(u)}};function c(s,t){s.each(function(){var u=G(this);u.attr("role",t);if(u.hasClass("checked")||u.hasClass("aui-dropdown2-checked")){u.attr("aria-checked","true");if(t=="radio"){u.closest("ul").attr("role","radiogroup")}}else{u.attr("aria-checked","false")}})}N.attr("aria-controls",N.attr("aria-owns"));O.find(".disabled,.aui-dropdown2-disabled").attr("aria-disabled","true");O.find("li.hidden > a,li.aui-dropdown2-hidden > a").addClass("disabled aui-dropdown2-disabled").attr("aria-disabled","true");c(O.find(".aui-dropdown2-checkbox"),"checkbox");c(O.find(".aui-dropdown2-radio"),"radio");function Q(){var AB=N.offset();var AF=N.outerWidth();O.css({left:0,top:0});var AE=O.outerWidth();var AA=G("body").outerWidth(true);var t=Math.max(parseInt(O.css("min-width"),10),AF);var u=N.data("container")||false;var AD="left";var v;if(!r){O.css("min-width",t+"px")}var w=AB.left,AC=AB.top+N.outerHeight();if(r){var y=3;w=AB.left+e.outerWidth()-y;AC=AB.top}if(AA<w+AE&&AE<=w+AF){w=AB.left+AF-AE;if(r){w=AB.left-AE}AD="right"}if(u){var s=N.closest(u),z=N.offset().left+N.outerWidth(),x=z+AE;if(t>=AE){AE=t}if(x>z){w=z-AE;AD="right"}}O.attr({"data-dropdown2-alignment":AD,"aria-hidden":"false"}).css({display:"block",left:w+"px",top:AC+"px"});O.appendTo(document.body)}Q();if(N.hasClass("toolbar-trigger")){O.addClass("aui-dropdown2-in-toolbar")}if(N.parent().hasClass("aui-buttons")){O.addClass("aui-dropdown2-in-buttons")}if(N.parents().hasClass("aui-header")){O.addClass("aui-dropdown2-in-header")}O.trigger("aui-dropdown2-show",R);if(R.selectFirst){M()}i("on");function a(){L();i("off");setTimeout(function(){O.css("display","none").css("min-width","").insertAfter(N).attr("aria-hidden","true");if(!r){N.removeClass("active aui-dropdown2-active")}Y().removeClass("active aui-dropdown2-active");O.removeClass("aui-dropdown2-in-toolbar");O.removeClass("aui-dropdown2-in-buttons");if(p){O.insertBefore(p)}else{O.appendTo(m)}O.trigger("aui-dropdown2-hide")},0)}function l(){a();if(r){e.trigger("aui-dropdown2-hide-all")}}function g(s){if(r&&s.target===e[0]){a()}}function P(s){return !s.is(".disabled, .aui-dropdown2-disabled, [aria-disabled=true]")}function V(s){return s.hasClass("aui-dropdown2-sub-trigger")}function f(s,t){if(!V(s)){return }t=G.extend({},t,{$menu:T});var u=J(s);if(u.is(":visible")){u.trigger("aui-dropdown2-select-first")}else{s.trigger("aui-button-invoke",t)}}function Y(){return O.find("a.active,a.aui-dropdown2-active")}var W=null;function U(s){if(W&&W[0]===s[0]){return false}W=s;Y().removeClass("active aui-dropdown2-active");if(P(s)){s.addClass("active aui-dropdown2-active")}O.trigger("aui-dropdown2-item-selected");X();return true}function M(){U(O.find("a:not(.disabled):not(.aui-dropdown2-disabled)").first())}function j(t){var s=O.find("> ul > li > a, > .aui-dropdown2-section > ul > li > a").not(".disabled,.aui-dropdown2-disabled");U(k(s,t,true))}function b(s){if(s.length>0){l();s.trigger("aui-button-invoke")}}function q(s){b(k(T.find(".aui-dropdown2-trigger").not(".disabled, .aui-dropdown2-disabled, [aria-disabled=true], .aui-dropdown2-sub-trigger"),s,false))}function k(u,v,t){var s=u.index(u.filter(".active,.aui-dropdown2-active"));s+=(s<0&&v<0)?1:0;s+=v;if(t){s%=u.length}else{if(s<0){s=u.length}}return u.eq(s)}function o(){b(G(this))}function L(){if(C===n){E.unbind(n);C=null}}function X(){if(C===n){return }E.unbind(C);E.bind(n);C=n}function i(t){var u="bind";var s="delegate";if(t!=="on"){u="unbind";s="undelegate"}if(!r){T[s](".aui-dropdown2-trigger:not(.active):not(.aui-dropdown2-active)","mousemove",o);N[u]("aui-button-invoke",a)}else{e[u]("aui-dropdown2-hide aui-dropdown2-item-selected aui-dropdown2-step-out",g)}O[u]("aui-dropdown2-hide-all",l);O[s]("a",S);O[u]("aui-dropdown2-hide",X);O[u]("aui-dropdown2-select-first",M)}},mousedown:function(L){if(L.which===1){G(this).bind(F)}}};var F={mouseleave:function(){E.bind(I)},"mouseup mouseleave":function(){G(this).unbind(F)}};var I={mouseup:function(L){var M=G(L.target).closest(".aui-dropdown2 a, .aui-dropdown2-trigger")[0];if(M){setTimeout(function(){K(M)},0)}},"mouseup mouseleave":function(){G(this).unbind(I)}};function K(L){if(L.click){L.click()}else{var M=document.createEvent("MouseEvents");M.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);L.dispatchEvent(M)}}function D(M,L){return(M===L)||G.contains(L,M)}function J(N){if(!(N instanceof AJS.$)){N=G(N)}var O=N.attr("aria-owns"),L=N.attr("aria-haspopup"),M=document.getElementById(O);if(M){return G(M)}else{if(!O){throw new Error("Dropdown 2 trigger required attribute not set: aria-owns")}if(!L){throw new Error("Dropdown 2 trigger required attribute not set: aria-haspopup")}if(!M){throw new Error("Dropdown 2 trigger aria-owns attr set to nonexistent id: "+O)}throw new Error("Dropdown 2 trigger unknown error. I don't know what you did, but there's smoke everywhere. Consult the documentation.")}}E.delegate(".aui-dropdown2-trigger",B);E.delegate(".aui-dropdown2-trigger:not(.active):not(.aui-dropdown2-active):not([aria-disabled=true]),.aui-dropdown2-sub-trigger:not([aria-disabled=true])",A);E.delegate(".aui-dropdown2-checkbox:not(.disabled):not(.aui-dropdown2-disabled)","click",function(){var L=G(this);if(L.hasClass("checked")||L.hasClass("aui-dropdown2-checked")){L.removeClass("checked aui-dropdown2-checked").attr("aria-checked","false");L.trigger("aui-dropdown2-item-uncheck")}else{L.addClass("checked aui-dropdown2-checked").attr("aria-checked","true");L.trigger("aui-dropdown2-item-check")}});E.delegate(".aui-dropdown2-radio:not(.checked):not(.aui-dropdown2-checked):not(.disabled):not(.aui-dropdown2-disabled)","click",function(){var L=G(this);var M=L.closest("ul").find(".checked,.aui-dropdown2-checked");M.removeClass("checked aui-dropdown2-checked").attr("aria-checked","false").trigger("aui-dropdown2-item-uncheck");L.addClass("checked aui-dropdown2-checked").attr("aria-checked","true").trigger("aui-dropdown2-item-check")});E.delegate(".aui-dropdown2 a.disabled,.aui-dropdown2 a.aui-dropdown2-disabled","click",function(L){H(L)})})(AJS.$);
