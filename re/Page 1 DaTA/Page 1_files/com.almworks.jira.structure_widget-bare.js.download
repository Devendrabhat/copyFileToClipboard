/* module-key = 'com.almworks.jira.structure:widget-bare', location = 'js/structure/structure.js' */
ï»¿/*
 ** StructureWidget, Copyright ALM Works 2011-2013 **
*/var STRUCTURE_BETAMODE=true,STRUCTURE_DEBUG=false;(function(U){function C(q){var M=e[q];if(M===true||M===false)return M;M= ! !(U&&U.location&&RegExp("^.*#(.*/)?"+q+"(/.*)?$").exec(""+U.location.href));return e[q]=M}var h=namespace("almworks.structure"),k=namespace("almworks.util");h.$=namespace("almworks.$",false)||k.requireGlobal("jQuery");h.JSON=k.requireGlobal("JSON");h.mouseTracker=k.mouseMoveTracker();var e={};h.getUrlHashParam=C;var B=STRUCTURE_DEBUG||C("debug");k.assertionsEnabled(B);k.logDebug(B);h.modes={STRUCTURE_BETAMODE:STRUCTURE_BETAMODE,STRUCTURE_DEBUG:B,DEVMODE:C("devmode"),BLOCK_AJAX:false,getStructurePageId:function(){if(this.ISSUE_PAGE)return "issue";if(this.PCV_PAGE)return this.PCV_PAGE;if(this.GADGET)return "gadget";if(this.GH_TAB)return "greenhopper";if(this.ISSUE_DETAILS)return "structure-with-details";return "structure"}};h.MAX_GET_PARAMETERS_LENGTH=400;h.MIN_COLUMN_WIDTH=16;h.MAX_COLUMN_WIDTH=1E4;h.pf=6E4;h.nY=1E4;k.isDebugging()&&k.debug("debugging enabled");(function(){var q=h.$("").jquery;typeof q!=="string"&&k.error("no jQuery version");q.indexOf("1.8")!==0&&k.warn("jQuery version "+q)})();if(U.AJS&&U.AJS.$)U.jQuery=U.$=U.AJS.$;U.jscoverage_report&&
h.$(function(){h.$('<a id="open_jscoverage" onclick="window.open(\'/jscoverage.html\'); return false;">JSCoverage</a>').prependTo(h.$("body"))});(function(q){if(q.mozilla&&U.navigator.userAgent.indexOf("Trident/")>=0){delete q.mozilla;q.msie=true}})(h.$.browser)})(window);(function(U){function C(){c(this).addClass("hover")}function h(){c(this).removeClass("hover")}function k(){c(this).addClass("pressed")}function e(){c(this).removeClass("pressed")}function B(y){if(!y)return false;var K=c(y.target);if(K.is(".s-disabled"))return false;var N=P(K,"action");if(!N)return true;K=P(K,"eventBus");if(!K)return true;K.fireEvent(w.ACTION,N,y);return y&&y.consumed?false:true}function q(y,K){J.assert(! !K);y.off("click.button");y.on("click.button",B);u(y,"action",K)}function M(y,K){var N=J.tail(y,K);if(N===null)return null;if(N==="")return true;if(N.substring(0,1)!=="=")return null;return N.substring(1)}function u(y,K,N){y&&c(y).data(K,N).addClass("app-"+K)}function P(y,K){if(!y)return null;return c(y).closest(".app-"+K).data(K)}function G(y){if(!y)return 0;if(typeof y==="number")return y;if(typeof y==="string"){var K=J.toIntSafe(y,-1);if(K=== -1){J.warn("invalid issue ["+y+"]");K=0}return K}
J.warn("invalid issue ["+y+"]");return 0}function Q(){return l.JSON.stringify({x:[1]})!=='{"x":[1]}'}function T(y){if(Array.prototype.toJSON&&Array.prototype.toJSON!==n){n=Array.prototype.toJSON;if(m=Q()){J.warn("Bug detected: Array.prototype contains toJSON() method (do you use old GreenHopper?), disabling");Array.prototype.toJSON=U;Q()&&J.warn("toJSON bug is still there! Things might get broken.")}}return l.JSON.stringify(y)}function A(y){this[y]=true}function t(y,K,N){K=K||[];if(!y)return K;for(var S=0,Y=y.length,Z,la=0;S<Y;){Z=y.indexOf("+",S);if(Z<0)Z=Y;S=J.toIntSafe(y.substring(S,Z),0);if(S!==0){la+=S;N?N.call(K,la):K.push(la)}S=Z+1}return K}function d(y){return function(K,N){var S=y[N];if(typeof K==="object"||typeof S==="object"){if(typeof K==="string")K=[K];if(typeof S==="string")S=[S];return J.arrayEquals(K,S)}return K===S}}function a(y){return function(K,N){return y.hasOwnProperty(N)}}function s(y,K){var N=y.currentStructure.id;if(N){N=N+"|"+(new Date).getTime()+"|"+K;J.defaultCookies.setCookie(g,N,1,D.cookiePath())}}function z(y){if(!y)return null;if((y=(y=F.exec(y))&&y[1])&&typeof y.toUpperCase==="function")y=y.toUpperCase();return y}function I(y,K,N){var S=
K._superclass;S&&I(y,S,N);(K=K.prototype.init)&&K.call(y,N)}function R(y){this.options=y;var K=this._class;K&&I(this,K,y)}function b(y,K,N){if(y&&typeof y!=="function")throw Error("it is possible to subclass a function only");if(typeof K!=="function")throw Error("subclass must be a function");if(K.prototype._init||N&&N._init)throw Error("prototype must not contain _init");var S={};y&&J.extend(S,y.prototype);J.extend(S,K.prototype);N&&J.extend(S,N);S._init=R;S._class=K;J.extend(K.prototype,S);if(y)K._superclass=y;return K}function i(y){if(!ha.exec(y))throw Error("invalid function name ["+y+"]");return eval("(function(){function "+y+"(options){this._init(options);} return "+y+";})()")}function r(){return function(y){this._init(y)}}var l=namespace("almworks.structure"),j=namespace("almworks.structure.apputil"),w=namespace("almworks.structure.appevents"),D=namespace("almworks.structure.ajsbridge"),J=namespace("almworks.util"),c=namespace("almworks.structure.$"),p=namespace("almworks.structure.api");j.structuresCookie="structures-04";j.defaultStructureId=1;var g="structure.navigation.hint",n=null,m=false;T({});var F=/\/browse\/([^\-#\?]+\-\d+)([#\?].*)?$/i,x=null,H=null;J.extend(j,{
initializeButton:function(y,K){y.off(".button");y.on({"mouseenter.button":C,"mouseleave.button":h,"mousedown.button":k,"mouseup.button":e,"mousemove.button":e});K&&q(y,K)},actionFormattedShortcut:function(y,K){var N=l.keymap();if(N.formattedShortcuts){var S=N.formattedShortcuts[y];if(S)return S}S=J.keyOf(N,y);if(!S&&K)S=J.keyOf(N,K);if(S)return J.formatShortcut(S);return null},installEventBus:function(y,K){J.assert(! !K);u(y,"eventBus",K)},installAction:q,registerBooleanActions:function(y,K,N,S,Y,Z,la){if(Z===U)Z=true;if(la===U)la=false;N&&y.register(N,function(){K.setValue(Z)});S&&y.register(S,function(){K.value()===Z&&K.setValue(la)});Y&&y.register(Y,function(){K.setValue(K.value()===Z?la:Z)})},gV:function(y,K,N,S){var Y=S.length,Z=new J.Cell(K,function(la){return S[(J.indexOf(S,la)+1)%Y]});y.register(N,function(){K.setValue(Z.value())});return Z},pipeToggled:function(y,K,N){y.pipe(function(S){(N?N(S):S)?K.addClass("toggled"):K.removeClass("toggled")})},jm:function(y,K,N){y.pipe(function(S){(N?N(S):S)?K.addClass("s-disabled"):K.removeClass("s-disabled")})},pipeText:function(y,K,N){y.pipe(function(S){(S=N?N(S):S)&&K.text(S)})},getUXFlag:function(y){var K=
J.defaultCookies.getCookie("structure-ux");if(!K)return false;K=K.split("|");for(var N=0,S=K[0];S;S=K[++N]){S=M(S,y);if(S!==null)return S}return false},setUXFlag:function(y,K){if(K===U)K=true;var N=J.defaultCookies.getCookie("structure-ux");N=N?N.split("|"):[];for(var S=0,Y=N[0];Y;Y=N[++S]){Y=M(Y,y);if(Y===K)return;if(Y!==null)break}if(K===false){if(S===N.length)return;N.splice(S,1)}else{Y=K===true?y:y+"="+K;if(S===N.length)N.push(Y);else N[S]=Y}N=N.join("|");J.defaultCookies.setCookie("structure-ux",N,3650,D.cookiePath())},setDominator:u,getDominator:P,getCurrentStructureId:function(){var y=J.getCookie(j.structuresCookie);if(!y)return j.defaultStructureId;var K=y.length;if(y.substring(0,1)==='"'&&y.substring(K-1,K)==='"')y=y.substring(1,K-1);K=y.indexOf("|");if(K>=0)y=y.substring(0,K);return J.toIntSafe(y,j.defaultStructureId)},bU:function(y,K,N,S,Y){K.stop(true,true);if(y!=K.is(":visible")){var Z=N.config.height==="window"||l.modes.GH_TAB?N.div$:null;Z&&Z.height(Z.height());var la;if(Y){if(y){K.css("opacity",0).show();la=S(K.height());K.height(0)}else{la=K.height();K.css("opacity",1)}S={duration:500,easing:"swing",complete:function(){K.css({display:y?"block":"none",height:"",
opacity:""});Z&&Z.css("height","");N.eventBus.fireEvent(w.av)}};S.step=function(da){da=Math.round(Math.min(1,da*(y?4:2.5))*la);var O=K.height();if(da!=O){K.height(da);if(Z){da=O==0&&da>0?K.outerHeight(true):O>0&&da==0? -(O+K.outerHeight(true)):da-O;N.aw.bZ(da)}}};K.animate({opacity:y?1:0},S)}else{K.css("display",y?"block":"none");la=S(K.height());if(Z)N.aw.bZ(y?la: -la);Z&&Z.css("height","");N.eventBus.fireEvent(w.av)}}},getIssueIdFromEvent:function(y){if(!y)return null;if(y.isDefaultPrevented())return null;return l.getIssueIdFromParentTR(y.target)},fJ:G,fC:function(y,K){var N=[],S=y&&y.length;if(S)for(var Y=0;Y<S;Y++){var Z=G(y[Y]);Z!==0&&N.push(Z)}if(!N.length&&K)N=null;return N},eW:function(y){var K={};if(y)for(var N in y)if(y.hasOwnProperty(N)&&G(N)!==0)K[N]=y[N];return K},ct:T,cl:t,kf:function(y){return t(y,{},A)},ht:function(y){var K={},N={};if(!y|| !y.length)return K;y.find(":input").add(y.filter(":input")).each(function(){var Y=c(this),Z=Y.attr("name");if(Z)if(K[Z]!==U&& !K.hasOwnProperty(Z))J.warn('Skipped input with name "'+Z+'"');else{N[Z]=true;if(!(Y.is("input[type=checkbox],input[type=radio]")&&Y.is(":not(:checked)")))if(K[Z]){var la=K[Z];Y=Y.val();J.isArray(la)||(la=
[la]);J.isArray(Y)?J.addAll(la,Y):la.push(Y);K[Z]=la}else K[Z]=Y.val()}});for(var S in N)if(N.hasOwnProperty(S)&& !(S in K))K[S]=[];return K},hl:function(y,K){K&&K.length&&K.find(":input").add(K.filter(":input")).each(function(){var N=c(this),S=N.attr("name");if(S in y){var Y=y[S];if(N.is("input[type=checkbox],input[type=radio]")){S=N.is(":checked");var Z=N.val();if((Y=Z===Y||typeof Y==="object"&&J.indexOf(Y,Z)>=0)&& !S)N.attr("checked","checked");else!Y&&S&&N.removeAttr("checked")}else N.val(Y)}})},jc:function(y,K){if(!y)return!K;return J.eachValue(y,d(K),true)!==false&&J.eachValue(K,a(y),true)!==false},jJ:s,lh:function(y,K){if(K&&y.currentStructure.id){K=K.closest("a[href]");var N;try{var S=K[0];N=S&&S.href}catch(Y){return}if(N){if(!x){x=D.localURL("/browse/");try{x=c('<a href="'+x+'"></a>')[0].href}catch(Z){J.warn("cannot figure out absolute link prefix, navigation hint will likely not work",Z)}}if(J.tail(N,x))(N=z(N))&&s(y,N)}}},ld:function(){var y=J.getCookie(g);y&&J.defaultCookies.setCookie(g,null,0,D.cookiePath());return y},lm:function(y){y&&J.defaultCookies.setCookie(g,y,1,D.cookiePath())},getIssueKeyFromUrl:z,openWindow:function(y,K,N,S){function Y(la,da){return da+2+
encodeURIComponent(la).length+encodeURIComponent(this[la]).length}S||(S=J.eachOwn(K,Y,0)>l.MAX_GET_PARAMETERS_LENGTH?"POST":"GET");K=J.renderTemplate('<form action="{url}" method="{method}" target="{target}" style="display: none;">{params:html}</form>',{url:D.localURL(y),method:S,target:N,params:J.eachOwn(K,function(la,da){return da+J.renderTemplate('<input type="hidden" name="{name}" value="{value}">',{name:la,value:this[la]})},"")});K=c(K);H&&J.onPage(H)?H.replaceWith(K):K.appendTo(c("body"));H=K;try{K.submit()}catch(Z){J.debug("Caught while submitting "+y,Z)}},getScrollBarSize:function(){var y=c("<div></div>").css({width:"100%",height:"100%"}),K=c("<div></div>").css({width:"100px",height:"100px",position:"absolute",top:"0",left:"0",visibility:"hidden",overflow:"hidden"});c(document.body).append(K.append(y));var N=y.width(),S=y.height();K.css("overflow","scroll");var Y=y.width();y=y.height();if(N===Y&&K[0].clientWidth)Y=K[0].clientWidth;if(S===y&&K[0].clientHeight)y=K[0].clientHeight;K.remove();return{width:N-Y,height:S-y}}});p.isSubClass=function(y,K){if(!y)return true;if(y===K)return true;for(var N=K._superclass;N;N=N._superclass){if(N===y)return true;if(N===K)break}
return false};p.isInstance=function(y,K){if(!K)return false;return p.isSubClass(y,K._class)};var ha=/^[a-z_]+$/i;p.baseClass=function(y,K){var N,S;if(typeof y==="string"){N=i(y);S=K||null}else{N=r();S=y||null}if(S&&typeof S!=="object")throw Error("bad prototype "+S);return b(p.Base,N,S)};p.subClass=function(y,K,N){var S;if(typeof y==="string"){S=i(y);y=K;K=N||null}else{S=r();K=K||null}if(K&&typeof K!=="object")throw Error("bad prototype "+K);if(typeof y!=="function")throw Error("bad superclass "+y);return b(y,S,K)};p.Base=b(null,i("Base"),{isInstanceOf:function(y){return p.isInstance(y,this)}})})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.structure.api"),h=namespace("almworks.util"),k=U.$;namespace("almworks.structure.apputil").MenuList=C.baseClass({init:function(){this.container$=this.options.container$;this.selector=this.options.selector||"li";this.handler=this.options.handler;if(!this.container$)throw Error("no container");this.cV=new h.Cell(null);this.initClicks();this.initMouse();this.initKeyboard();this.initHover()},initHover:function(){this.cV.pipeChanges(function(e,B){B&&B.removeClass("s-hover");e&&e.addClass("s-hover")})},initClicks:function(
){var e=this;this.container$.on("click","a",function(B){var q=k(B.target).closest(e.selector);if(q.length)if(k.contains(e.container$[0],q[0]))if(e.chooseItem(q)){B.preventDefault();B.stopPropagation();return false}})},initMouse:function(){var e=this;this.container$.on("mouseenter",e.selector,function(){e.cV.setValue(k(this))})},initKeyboard:function(){var e=this;this.container$.keydown(function(B){if(B&&B.target)if(!k(B.target).is(".s-menulist-keyboard-ignore")){var q=B.keyCode;if(q===27||q===9)e.cancel();else if(q===38)e.selectPrevious(B);else if(q===40)e.selectNextOrFirst(B);else if(q===13){if(!e.cV.value())return;e.chooseItem()}else return;B.preventDefault();B.stopPropagation()}})},selectPrevious:function(){var e=this.cV.value();if(e){var B=this.container$.find(this.selector);e=B.index(e);if(!(e<0)){B=B.slice(0,e);B=B.filter(":visible").last();B!=null&&B.length&&this.selectItem(B)}}},selectNextOrFirst:function(){var e=this.cV.value(),B=this.container$.find(this.selector);if(e){e=B.index(e);if(e>=0)B=B.slice(e+1)}B=B.filter(":visible").first();B!=null&&B.length&&this.selectItem(B)},chooseItem:function(e){e&&this.selectItem(e);e=this.cV.value();var B=this.handler;if(!e|| !B)
return false;return h.safeCall(B.onMenuItemChosen,B,e)||false},cancel:function(){var e=this.handler;e&&h.safeCall(e.onMenuCancelled,e)},selectItem:function(e){this.cV.setValue(e);this.lc()},lc:function(){var e=this.options.viewPort$;if(e){var B=this.cV.value();if(B&&B.length){var q=Math.round(B.position().top);B=Math.round(B.height());var M=Math.round(e.height());if(q<0)e.scrollTop(e.scrollTop()+q);else q+B>M&&e.scrollTop(e.scrollTop()+q+B-M)}}},getSelectedItem:function(){return this.cV.value()},selectFirst:function(){var e=this.container$.find(this.selector+":visible:first");e.length&&this.selectItem(e)},jo:function(){this.selectItem(null)}})})(window);(function(){function U(q){var M=null;try{if(window[q]&&window[q].setItem)M=window[q]}catch(u){}finally{M||C.warn(q+" is not supported")}return M}var C=namespace("almworks.util"),h=namespace("almworks.structure"),k=U("localStorage"),e=U("sessionStorage"),B={};C.extend(h,{isStorageSupported:function(){return! !(e||k)},setStored:function(q,M,u){if(typeof q!=="string"||typeof M!=="string")C.assert(false,"bad value ("+q+", "+M+")");else{var P=null;if(u)u=e||B;else{u=e||k||B;P=e&&k}var G="almworks.structure."+q;try{u[G]=M}catch(Q){
C.debug("cannot store "+q,Q)}if(P)try{P[G]=M}catch(T){C.debug("cannot store to localStorage "+q,T)}}},getStored:function(q){var M,u="almworks.structure."+q;try{M=e&&e[u];if(!M)(M=k&&k[u])||(M=B[u])}catch(P){C.debug("cannot retrieve "+q,P)}return M||""}})})();(function(){function U(){return "_e"+ ++h}var C=namespace("almworks.structure.appevents"),h=0;C.POLL_FINISHED=U();C.UPLOAD_FINISHED=U();C.STRUCTURE_CHANGED=U();C.kl=U();C.cQ=U();C.aX=U();C.bf=U();C.cF=U();C.bY=U();C.kE=U();C.aA=U();C.dz=U();C.aN=U();C.EDIT_UPLOAD_FINISHED=U();C.bC=U();C.au=U();C.ko=U();C.mh=U();C.aE=U();C.bu=U();C.eu=U();C.av=U();C.dr=U();C.ar=U();C.cX=U();C.cj=U();C.bX=U();C.cK=U();C.dF=U();C.cR=U();C.be=U();C.mg=U();C.cr=U();C.aq=U();C.dP=U();C.am=U();C.nl=U();C.dc=U();C.ACTION=U();C.mt=U();C.ly=U();C.cd=U();C.ej=U();C.cq=U();C.gJ=U();C.jx=U();C.mx=U();C.kD=U();C.jH=U();C.md=U();C.cv=U();C.bM=U();C.gS=U();C.ISSUE_DETAILS_EDIT_STARTED=U();C.ISSUE_DETAILS_EDIT_STOPPED=U();C.STRUCTURE_PAGE_CHANGED=U();C.BEFORE_CLICK=U()})();(function(U,C){function h(b){if(typeof t==="function")try{return t(b)}catch(i){}return null}function k(b){var i=U.contextPath;if(typeof i!=="string")i=a;if(typeof i!=="string")i="/";if(
i.length===0||i.substring(i.length-1)!=="/")i+="/";if(!b)return i;if(b.substring(0,1)==="/")b=b.substring(1);return i+b}function e(b,i){G.addSuper(G.CellPresenter,this)(b);this.setView(i)}function B(b){G.addSuper(G.CellPresenter,this)(b)}function q(){var b=namespace("AJS.InlineLayer.OptionsDescriptor.prototype",false);if(b)if(b._inIFrame)b._inIFrame=function(){var i=U;try{for(;i.parent.window!==i.window;){if(i.parent.document===i.document)break;i=i.parent;if(i.AJS)return true}}catch(r){}return false}}var M=namespace("almworks.structure"),u=namespace("almworks.structure.ajsbridge"),P=namespace("almworks.structure.$"),G=namespace("almworks.util"),Q=namespace("almworks.structure.appevents"),T=U.AJS,A=U.JIRA,t=U.require,d=false,a="/";if(typeof U.contextPath==="string")a=U.contextPath;else{G.warn("no contextPath in context");a="/"}var s=null,z="";P(function(){var b=U;if(b.top)b=b.top;else if(b.parent)b=b.parent;z=P(b.document).find("meta#atlassian-token").attr("content");u.TOKEN=z});var I=false;G.extend(e.prototype,G.CellPresenter.prototype,{updateView:function(b){try{b?this.view.enable():this.view.disable()}catch(i){G.warn("cannot enable/disable SingleSelect",i)}}});G.extend(
B.prototype,G.CellPresenter.prototype,{updateView:function(b){var i=this.view.model;if(i)(b=i.getDescriptor(b))&&this.view.setSelection(b)},isValidViewValue:function(b){var i=this.view.model;if(!i)return true;return! !i.getDescriptor(b)},getViewValue:function(){var b=T.$(this.view.options.element).val();if(b&&typeof b==="object")b=b.length?b[0]:"";return b||"0"},subscribeToViewEvents:function(){T.$(this.view.options.element).change(G.withThis(this,this.viewChanged))},getFirstNonEmptyValue:function(){var b=this.view&&this.view.model;if(!b)return "0";try{var i=b.getAllDescriptors(),r=i&&i[0],l=r&&r.items(),j=l&&l[0];return j&&j.value()||"0"}catch(w){G.warn("cannot extract value for the first element in SingleSelect model: "+w)}}});var R=function(){try{var b=T.$;return U.Class.extend({init:function(r){var l=this;this.$project=r.project;this.backgroundImages=this.removeBackgroundImages(r.issueTypeSelect);this.$refIssueTypeSelect=b(r.issueTypeSelect).clone(true,true);this.$issueTypeSelect=r.issueTypeSelect;this.$projectIssueTypesSchemes=r.projectIssueTypesSchemes;this.$issueTypeSchemeIssueDefaults=r.issueTypeSchemeIssueDefaults;this.projectIssueTypeSchemes=
this.getProjectIssueTypeSchemesFromDom();this.issueTypesSchemeDefaults=this.getIssueTypeSchemeIssueDefaults();if(l.$project.length>0){r=l.$project.val();l.setIssueTypeScheme(l.getIssueTypeSchemeForProject(r));this.$project.is("select")&&this.$project.change(function(){var j=l.$project.val();l.lastIssueType=l.$issueTypeSelect.find(":selected:first").val();l.$refIssueTypeSelect.val("");l.setIssueTypeScheme(l.getIssueTypeSchemeForProject(j));l.$issueTypeSelect.trigger("reset")})}},getIssueTypeSchemeForProject:function(r){return this.projectIssueTypeSchemes[r]},getDefaultIssueTypeForScheme:function(r){return this.issueTypesSchemeDefaults[r]},removeBackgroundImages:function(r){var l={};b(r).find("option[style]").each(function(){l[b(this).attr("id")]=b(this).css("background-image");b(this).attr("style","");b(this).removeAttr("style")});return l},addBackgroundImages:function(){var r=this;this.$issueTypeSelect.find("option").each(function(){b(this).css("background-image",r.backgroundImages[b(this).attr("id")])})},setIssueTypeScheme:function(r){var l,j=this,w,D=b("<span class='hidden' />");l=this.$refIssueTypeSelect.find("optgroup");D.insertAfter(this.$issueTypeSelect);
this.$issueTypeSelect.detach().empty();l.length?l.each(function(){var J=b(this);if(J.is("[data-scheme-id='"+r+"']")){j.$issueTypeSelect.append(J.clone(true).children());return false}}):this.$issueTypeSelect.append(this.$refIssueTypeSelect.children());l=this.$issueTypeSelect.find("option[data-selected]").val()||"";if(j.lastIssueType)w=this.$issueTypeSelect.find("option[value='"+j.lastIssueType+"']");else if(l)w=this.$issueTypeSelect.find("option[value='"+l+"']");if(w&&w.length!==0){w.attr("selected","selected");this.$issueTypeSelect.val(w.val())}else this.setDefaultIssueType(r);this.$issueTypeSelect.insertAfter(D);this.addBackgroundImages();this.$issueTypeSelect.attr("data-project",this.$project.val());D.remove()},setDefaultIssueType:function(r){r=this.getDefaultIssueTypeForScheme(r);r!==""?this.$issueTypeSelect.find("option[value='"+r+"']").attr("selected","selected"):this.$issueTypeSelect.find("option").each(function(l,j){if(this.value&&this.value!==""){b(j).attr("selected","selected");return false}})},getProjectIssueTypeSchemesFromDom:function(){var r={};this.$projectIssueTypesSchemes.find("input").each(function(l,j){var w=b(j),D=w.attr("title");w=w.val();r[D]=w});return r},
getIssueTypeSchemeIssueDefaults:function(){var r={};this.$issueTypeSchemeIssueDefaults.find("input").each(function(l,j){var w=b(j),D=w.attr("title");w=w.val();r[D]=w});return r}})}catch(i){G.warn("cannot instantiate IssueTypePicker class");return null}}();P(function(){P.browser.msie&&P.browser.version<9&&q();var b=U.JIRA;if(b&& !b.InlineLayer)b.InlineLayer={}});(function(){function b(j){if(j&&typeof j.getDefaultAjaxOptions==="function")return j}function i(j){j.getDefaultAjaxOptions=function(w){return function(){var D=w.apply(this,arguments);try{if(D&&D.data&&D.data.inline!=="true"&&this.$activeTrigger&&this.$activeTrigger.is("[class*=issueaction-]"))D.data.inline="true"}catch(J){G.warn("Error patching result of JIRA.Dialogs.getDefaultAjaxOptions()",J)}return D}}(j.getDefaultAjaxOptions)}var r=b(h("jira/dialog/dialog-util")),l=b(A&&A.Dialogs);if(r&&l)if(l.getDefaultAjaxOptions===r.getDefaultAjaxOptions){i(r);l.getDefaultAjaxOptions=r.getDefaultAjaxOptions}else{i(r);i(l)}else if(r)i(r);else l?i(l):G.warn("Cannot find the JIRA module with getDefaultAjaxOptions()")})();G.extend(u,{AJSBridge:function(b){function i(){return namespace("jira.app",false)||namespace("JIRA",false)||{}}
function r(){var S=i();return S.issue||S.Issue||{}}function l(){var S=i();return S.issuenavigator||S.IssueNavigator||{}}function j(){return namespace("JIRA.DIALOGS",false)||namespace("JIRA.Dialogs")||{}}function w(){if(!K){K=true;var S=l();S.isNavigator=G.returnTrue;S.Shortcuts=G.extendOwn(S.Shortcuts||{},{isNavigator:G.returnTrue})}}function D(S){var Y=r(),Z=l();if(S>0){if(!y){H.getIssueId=Y.getIssueId;H.getIssueKey=Y.getIssueKey;ha.isRowSelected=Z.isRowSelected;ha.getSelectedIssueKey=Z.getSelectedIssueKey;ha.getSelectedIssueId=Z.getSelectedIssueId;ha.get$focusedRow=Z.get$focusedRow;y=true}Y.getIssueId=function(){return S};var la=m.getIssueKey(S);Y.getIssueKey=function(){la||(la=m.getIssueKey(S));return la};Z.isNavigator=G.returnTrue;Z.isRowSelected=G.returnTrue;Z.getSelectedIssueKey=Y.getIssueKey;Z.getSelectedIssueId=Y.getIssueId;Z.get$focusedRow=function(){if(!S)return T.$();var da=F.rowByIssueId(S);if(!da.length)return T.$();return T.$(da[0])};N.unbind("click.structure-blocker");d&&G.debug("JIRA.Issue <- "+S)}else{if(y){Y.getIssueId=H.getIssueId;Y.getIssueKey=H.getIssueKey;Z.isRowSelected=ha.isRowSelected;Z.getSelectedIssueKey=ha.getSelectedIssueKey;Z.getSelectedIssueId=
ha.getSelectedIssueId;Z.get$focusedRow=ha.get$focusedRow;y=false}N.bind("click.structure-blocker",G.returnFalse);d&&G.debug("JIRA.Issue <- none")}}function J(){if(T){var S=U.JIRA;S&&T.$(g[0]).delegate("a.aui-dd-link","click",function(){if(!T.$.data(this,"AJS_dropDown_initialised")){var Y=T.DropDown.create({trigger:T.$(this),ajaxOptions:{dataType:"json",cache:false,formatSuccess:namespace("jira.app.fragments.issueActionsFragment",false)||S.FRAGMENTS.issueActionsFragment}})[0];if(Y){if(Y.layerController&&Y.layerController.contentChange){Y.layerController.contentChange(function(Z){Z.$layer.data("previousFocus",document.activeElement).find("a:visible:first").focus()});Y.layerController.onhide(function(Z){var la=Z.$layer.data("previousFocus");if(la){Z.$layer.data("previousFocus",null);if(la!==U)try{var da=T.$(la);da.is(":visible")&&da.focus()}catch(O){}}})}Y.show()}T.$.data(this,"AJS_dropDown_initialised",true);return false}})}}function c(){function S(da){if(da&&typeof da.reloadViaWindowLocation==="function")return da}function Y(da){var O=da.reloadViaWindowLocation,W=function(){if(arguments.length!=0){da.reloadViaWindowLocation=O;try{return O.apply(this,arguments)}catch(ia){G.debug(
"original reloadViaWindowLocation failed: "+ia);return true}finally{da.reloadViaWindowLocation=W}}if(A&&A.Dialog&&A.Dialog.current&&typeof A.Dialog.current.hide==="function"){try{A.Dialog.current.hide()}catch(ja){}try{b.bD().fireEvent(Q.kD)}catch(pa){}}return true};da.reloadViaWindowLocation=W}var Z=S(h("jira/util/browser")),la=S(T);if(Z){Y(Z);if(la)la.reloadViaWindowLocation=Z.reloadViaWindowLocation}else la?Y(la):G.warn("Cannot find the JIRA module with reloadViaWindowLocation()")}function p(){var S=namespace("JIRA.Dialogs.editLabels",false),Y;if(S){Y=S.labelsProvider;if(typeof Y==="function")S.labelsProvider=function(){return Y.apply(this,arguments)||P()}}}var g=b.panel$,n=b.bD(),m=b.widget.az,F=b.aQ(),x=G.delayed(100,function(S,Y){var Z=j(),la=Y&&Y.attr("id"),da=null,O,W;if(!(!la|| !G.tail(la,"workflow-transition-")|| !Z[la])){try{da=T.$("#"+la)}catch(ia){}if(da&&da.length&& !da.is(":visible")){if(O=Z[la].options&&Z[la].options.trigger){W=T.$(document);if(typeof O==="string")W.undelegate(O,"click");else G.isArray(O)&&O.length>0&&T.$.each(O,function(pa,na){typeof na==="string"&&W.undelegate(na,"click")})}try{Z[la].destroy()}catch(ja){}da.remove();Z[la]=C}}});T.$(document).bind(
"hideAllLayers",function(){x.apply(this,arguments);n.fireEvent(Q.gJ)});var H={},ha={},y=false,K=false;!M.modes.ISSUE_PAGE&& !M.modes.GH_TAB&&setTimeout(w,800);var N=T.$("#s-issueaction-links .issueaction-assign-issue");J();if(!M.modes.ISSUE_PAGE&& !M.modes.GH_TAB){this[Q.eu]=D;n.addListener(new G.Life,this)}if(!M.modes.ISSUE_PAGE){c();p()}P.browser.mozilla&&P("#assign-to-me").attr("id","assign-to-me-compatible-with-structure");M.modes.ISSUE_PAGE&&function(){var S=U.JIRA;S&&S.trigger&&S.Events&&S.Events.ISSUE_REFRESHED&&T.$(T).bind(S.Events.ISSUE_REFRESHED,function(){try{b.bD().fireEvent(Q.kD)}catch(Y){}})}();G.extend(this,{jiraApp:i(),jiraDialogs:j(),js:function(S){if(S=S&&S[0]){var Y=T.$(S);Y.find("form").submit(G.returnFalse);try{T.$(U.document).trigger("dialogContentReady",{get$popupContent:function(){return Y},options:{}})}catch(Z){G.warn("problem calling dialogContentReady: "+Z)}try{var la=(namespace("jira.app.issueoperations",false)||namespace("JIRA.Issue",false)||{}).wireAssignToMeLink;typeof la==="function"&&la(Y)}catch(da){G.debug("problem calling wireAssignToMeLink: "+da)}}},ob:J})},localURL:k,currentURL:function(){var b=U.location,i=b.pathname,r=k();if(i.indexOf(r)==0)i=
i.substr(r.length);return i+b.search+b.hash},issueURL:function(b){if(!b)return null;return k("/browse/"+b)},cookiePath:function(){if(!s){var b=k("");b||(b="/");var i=b.indexOf("://");if(i>=0){i=b.indexOf("/",i+3);b=i<0?"/":b.substring(i)}else if(b.substring(0,1)!=="/")b="/"+b;i=b.length;if(i>1&&b.substring(i-1)==="/")b=b.substring(0,i-1);s=b}return s},hW:function(b,i,r){if(!T|| !T.$|| !T.$.fancybox)return false;b=T.$(b[0]);if(b.data("fancyboxInitialized"))return false;b.data("fancyboxInitialized",true);var l=function(){if(I){I=false;r.keyboardManager.setEnabled(true);if(typeof T.enableKeyboardShortcuts=="function")T.enableKeyboardShortcuts();else if(T.popup)T.popup.current=null;typeof T.enableKeyboardScrolling==="function"&&T.enableKeyboardScrolling()}},j={type:"image",imageScale:true,cyclic:true,centerOnScroll:true,autoDimensions:true,overlayShadow: !(T.$.os.linux&&T.$.browser.mozilla),titleShow:false,hideOnContentClick:true,changeSpeed:150,changeFade:0,speedIn:300,speedOut:300,onStart:function(){if(!I){I=true;r.keyboardManager.setEnabled(false);if(typeof T.disableKeyboardShortcuts==="function")T.disableKeyboardShortcuts();else if(T.popup)T.popup.current=true;
typeof T.disableKeyboardScrolling==="function"&&T.disableKeyboardScrolling()}},onCancel:l,onClosed:l,transitionIn:"fade",transitionOut:"fade"};if(T.$.browser.msie){j.transitionIn="none";j.transitionOut="none";j.onCancel=j.onClosed=G.delayed(50,l)}b.find("a").fancybox(j);i&&T.$(i).trigger("click");return true},SingleSelectEnabler:e,SingleSelectPresenter:B,kg:function(b,i,r,l){if(!R)return null;return new R({project:T.$(b[0]),issueTypeSelect:T.$(i[0]),projectIssueTypesSchemes:T.$(r[0]),issueTypeSchemeIssueDefaults:T.$(l[0])})},mc:function(b,i){if(!b|| !i)return false;if(!b.suggestionsVisible)return false;var r=b.listController;if(!r)return false;var l=r.keys&&r.keys.Return;if(!l)return false;try{l.call(r,i)}catch(j){return false}return true},createAjsSingleSelect:function(b){if(!T|| !T.$|| !T.SingleSelect||M.modes.GADGET==="remote"){b.on("ajs:expand",function(){b.focus()});return null}var i=new T.SingleSelect({element:b[0],revertOnInvalid:true,removeOnUnSelect:false});i.dropdownController.$layer.addClass("s-aui-dd").css({"max-height":"188px","overflow-y":"auto","overflow-x":"hidden","font-size":"12px"});i.submitForm=function(){this.suggestionsVisible||b.trigger("ajs:submitForm")};
T.$(b[0]).on("selected",function(){b.trigger("change")});b.on("ajs:update",function(r,l){var j=l||b.val();j=G.isArray(j)?j[0]:j;j=i.model.getDescriptor(j);i.model.setSelected(j);i.setSelection(j)}).on("ajs:expand",function(){i.suggestionsVisible||i.$dropDownIcon.click()});return i},jiraRequire:h,setDebug:function(b){d=b}})})(window);(function(){var U=namespace("almworks.structure"),C=namespace("almworks.structure.ajax"),h=namespace("almworks.structure.ajsbridge"),k=namespace("almworks.util"),e=U.$;C.doAjax=function(B){return e.ajax(B)};C.UPLOAD=2;C.DOWNLOAD=1;C.RESOURCES=new function(){k.extend(this,{STRUCTURE_LIST:"/rest/structure/1.0/structure/list",structure:function(B){return "/rest/structure/1.0/structure/"+B},forest:function(B){return this.structure(B)+"/forest"},versions:function(B,q){var M=this.structure(B)+"/versions",u,P="?";if(q)for(u in q)if(q.hasOwnProperty(u)){M+=P+encodeURIComponent(u)+"="+encodeURIComponent(q[u]);P="&"}return M},version:function(B,q){return this.structure(B)+"/version/"+q},RENDER:"/rest/structure/1.0/data",ISSUE:"/rest/structure/1.0/issue",issueUpdate:function(B){return this.ISSUE+"/"+B+"/update"},ISSUE_CREATE:"/rest/structure/1.0/issue/create",
CONFIG_WIDGET:"/rest/structure/1.0/config/widget",CONFIG_UI_SETTINGS:"/rest/structure/1.0/config/ui",UPDATE_FIELDS:"/rest/structure/1.0/config/fields/forUpdate",CREATE_FIELDS:"/rest/structure/1.0/config/fields/forCreate",SEARCH:"/rest/structure/1.0/issues",SEARCH_RESOLVED:"/rest/structure/1.0/issues/resolved",POLL:"/rest/structure/1.0/poll",GADGET:{STRUCTURES:"/rest/structure/1.0/gadget/structures",VALIDATE:"/rest/structure/1.0/gadget/validate",META:"/rest/structure/1.0/gadget/meta",VIEWS:"/rest/structure/1.0/gadget/views",WEBRESOURCES:"/rest/structure/1.0/gadget/webresources"},CONFIG_PROJECTS:"/rest/structure/1.0/config/projects",CONFIG_ROLES:"/rest/structure/1.0/config/roles",CONFIG_GROUPS:"/rest/structure/1.0/config/groups",CONFIG_TIMEZONE:"/rest/structure/1.0/config/timezone",VIEW:"/rest/structure/1.0/view",STATISTICS:"/rest/structure/1.0/statistics",PERSPECTIVE:"/rest/structure/1.0/perspective"})};C.AJAX=function(){function B(){P=null;if(!(u||M.length===0))if(!U.modes.BLOCK_AJAX){M.sort(G);(u=M.splice(0,1)[0])&&u.runAjax()}}function q(Q){Q&&M.push(Q);P&&clearTimeout(P);P=setTimeout(B,50)}var M=[],u=null,P=null,G=function(Q,T){return T.priority-Q.priority};k.extend(this,{Task:
function(){function Q(T,A,t,d){this.url=h.localURL(T);this.priority=A;this.callback=t;this.errorCallback=d;this.context=this}k.extend(Q.prototype,{timeout:6E4,contentType:"application/json; charset=UTF-8",type:"GET",dataType:"json",error:function(T,A,t){if(A==="notmodified")this.success(null,A);else if(this.shouldRetry(T,A,t)){this.priority--;q(this)}else if(typeof this.errorCallback==="function")try{this.errorCallback(T,A,t)}catch(d){k.error(d)}},success:function(T,A,t){if(!t||A!=="success")A=false;else{A=null;var d=0;try{A=t.statusText}catch(a){}try{d=t.status}catch(s){}A=d===0&& !A&& !T}if(A)this.error(t,"connection",null);else if(typeof this.callback==="function")try{this.callback(T)}catch(z){k.error(z)}},complete:function(){k.assert(this===u);if(this===u)u=null;B()},chainComplete:function(T){if(T){k.assert(typeof T==="function",T);var A=this.complete;this.complete=function(){T.apply(this,arguments);A&&A.apply(this,arguments)}}},preCheck:k.returnTrue,shouldRetry:k.returnFalse,runAjax:function(){k.assert(this===u);if(this.preCheck()){if(U.modes.GADGET==="remote")this.headers={Accept:"application/json, text/javascript, */*; q=0.01","Content-Type":this.contentType||
"application/json; charset=UTF-8"};C.doAjax(this)}else this.complete()}});return Q}(),addTask:q,gH:q})}})();(function(U){function C(A){function t(a){var s=T,z,I;T=[];for(z=0;z<s.length;z++){I=s[z][a];typeof I==="function"&&I.call(null)}}if(!P)if(G)setTimeout(C,200);else{G=true;var d={url:M.localURL("/secure/StructureSearchData.jspa"),cache:false,dataType:"text",success:function(a){function s(R){var b=e(R,I).text();if(b)try{return B.parse(b)}catch(i){h.warn("cannot parse "+R+" "+b,i)}return[]}P={};var z=e(a),I=z.filter("#searchData");if(!I.length){h.warn("bad reply...");I=z}P.jqlFieldNames=s("#jqlFieldz");P.jqlFunctionNames=s("#jqlFunctionNamez");P.jqlReservedWords=s("#jqlReservedWordz");A&&typeof A.success==="function"&&A.success.apply(null,arguments);t("success")},error:function(){Q=true;A&&typeof A.error==="function"&&A.error.apply(null,arguments);t("error")},complete:function(){G=false;if(P)A&&typeof A.complete==="function"&&A.complete.apply(null,arguments);else P={}}};q.doAjax(d)}}var h=namespace("almworks.util"),k=namespace("almworks.structure"),e=k.$,B=k.JSON,q=k.ajax,M=k.ajsbridge,u=U.AJS,P=null,G=false,Q=false,T=[];k=namespace("almworks.structure.jqlutil");h.extend(k,{
loadSearchData:C,whenSearchDataReady:function(A){if(A)if(P)typeof A.success==="function"&&A.success.call(null);else if(Q)typeof A.error==="function"&&A.error.call(null);else if(G)T.push(A);else{T.push(A);C()}},createAutocomplete:function(A){var t=namespace("jira.widget.autocomplete.JQL",false)||U.JIRA.JQLAutoComplete,d=namespace("jira.jql.parser.MyParser",false)||U.JIRA.JQLAutoComplete.MyParser,a=t({fieldID:A.fieldID,parser:d(P.jqlReservedWords),queryDelay:0.65,jqlFieldNames:P.jqlFieldNames,jqlFunctionNames:P.jqlFunctionNames,minQueryLength:0,allowArrowCarousel:true,autoSelectFirst:true,errorID:A.errorID});t=u.$("#"+A.fieldID);t.unbind("keypress");a.buildResponseContainer();t.click(function(){a.dropdownController.hideDropdown()});a.updateParseIndicator=h.seq(a.updateParseIndicator,A.updateParseIndicator);a.completeField=h.seq(a.completeField,A.completeField);a.parse(t.val());u.Meta.set("advanced-search-help-url","https://confluence.atlassian.com/display/JIRA/Advanced+Searching");return a}})})(window);(function(U){function C(d){function a(I){if(I){var R=I.currentTarget||u(I.target).closest(".s-editorpanel")[0];if(R){var b=s.fQ();if(b&&b.jq())if(R===b.hv[0]){R=I.type;if(R===
"keydown"){if(Q)z=k.keyboardCodeFromEvent(I);return b.jF(I)}else if(R==="keyup"){if(Q){R=k.keyboardCodeFromEvent(I);if(Q[R]&&R!==z)if(!b.jF(I))return false}return b.iB(I)}else if(R==="mouseup")return b.iU(I);else if(R==="click")return b.it(I)}}}};if(!d.dK){var s=d.cJ();if(s){d.dK=true;var z=0;d.panel$.delegate(".s-editorpanel",{keydown:a,keyup:a,click:a,mouseup:a})}}}function h(d,a){this.gn= ++t;this.hG=d;this.column=a;this.issueId=k.toInt(d.issueId);this.az=d.panel.widget.az;this.hX=d.panel.aQ();this.fA=new k.Lifecycle(false);this.gD=this.eo=this.jg=this.gF=this.gU=this.editor$=this.gx=this.fY=this.fX=this.kv=this.gr=this.hv=null;this.gI=false;this.gN=null;this.gX="";this.nV=this.gs=false;this.jl=k.delayed(10,k.bottlenecked(100,this.jK,this))}var k=namespace("almworks.util"),e=namespace("almworks.structure.appevents"),B=namespace("almworks.structure.columns"),q=namespace("almworks.structure.apputil"),M=namespace("almworks.structure"),u=namespace("almworks.structure").$,P=U.AJS&&U.AJS.$,G=k.codeMapFromKeyMap({"ctrl+enter":"finishAllEdits","alt+enter":"switchToDialog",enter:"finishAllEdits",escape:"cancelCurrentCellEdit",tab:"nextEditableField","shift+tab":"prevEditableField",
"ctrl+space":"toggleEditorTransparency","ctrl+alt+up":"upEditableField","ctrl+alt+down":"downEditableField","ctrl+alt+left":"leftEditableField","ctrl+alt+right":"rightEditableField"}),Q=k.KeyboardManager.BLOCKED_KEYDOWN_CODES,T=k.codeMapFromKeyMap({up: -2,left: -1,right:1,down:2,"alt+down":100}),A=["s-e-editor","s-e-noeditor","s-e-loading"],t=0;k.extend(h.prototype,{hL:k.pvc,jh:k.pvc,ge:k.pvc,om:function(d){this.nV=d;if(this.ot&& !d){this.ot.remove();this.ot=null}else if(!this.ot&&d&&this.gx){this.ot=u(k.renderTemplate('<a href="#" class="s-editor-dialog" tabIndex="1002" title="{s.w.editor.dialog.tooltip}">{s.w.editor.dialog}</a>'));this.gx.addClass("s-with-dialog").prepend(this.ot)}},nJ:function(){return this.nV},cS:function(){var d= !this.hv;if(d){var a=this.hG.issueId,s=this.az.cI(a);if(!s)return false;if(a>0&& !this.hL(s))return false;this.hv=u(k.renderTemplate(
'<div class="s-editorpanel s-e-loading s-e-active s-e-noeditor"><div class="s-editor-celldiv"></div><div class="s-cellerror-div"><div class="s-cellerror" title=""></div></div><div class="s-editorborder"><div class="s-editor"></div><div class="s-editorparams"></div><div class="s-editerrors"></div><div class="s-editbuttons"><span class="s-editor-right"><a href="#" class="s-editor-revert" title="{s.w.editor.revert.tooltip}" tabIndex="1000">{s.w.editor.revert}</a><input type="submit" class="s-editor-done" tabIndex="1001" value="{s.w.editor.done}" title="{s.w.editor.done.tooltip}"></span></div></div><div class="s-editorpanel-posmarker"></div></div>'));this.jv()}else this.hv.addClass("s-e-active");this.jq()||this.jL();this.fA.cycleStart();this.jK();if(d)this.jh()||this.fA.cycleEnd();else if(this.editor$)this.eo=this.gO(this.editor$);return this.fA.isStarted()},jv:function(){C(this.hG.panel);var d=this.hv;if(d){d.data("cellEditor",this);this.gr=d.find(".s-editor");this.kv=d.find(".s-editorparams");this.fX=d.find(".s-editor-celldiv");this.fY=d.find(".s-editerrors");this.gx=d.find(".s-editbuttons");this.gU=d.find(".s-editorborder");this.gF=d.find(".s-cellerror");this.iz=d.find(
".s-editor-done");this.iH=d.find(".s-editor-revert");this.gT=d.find(".s-editor-cancel");this.hZ=d.find(".s-editorpanel-posmarker");this.om(this.nV)}},ic:function(){return this.hS()},iu:function(){var d=this.ic();this.iH.css("visibility",d?"visible":"hidden");this.gT.css("visibility",d||this.hS()||this.hG.ie()?"visible":"hidden")},iK:function(){},iX:function(d){k.assert(!this.editor$);k.assert(! !d);this.editor$=d;this.gr.empty();this.gr.append(d);k.updateClasses(this.hv,["s-e-editor"],A);d=k.onPage(d);this.jq()&& !d&&this.jL();d&&this.kt();this.fW();this.kn&&this.jN();this.takeFocus(true)},kk:function(d){this.kv.empty();this.kv.append(d)},jI:function(d){k.assert(!this.editor$);this.jB([d]);k.updateClasses(this.hv,["s-e-noeditor"],A);this.jL()},fV:function(d){if(this.jq()){this.fA.cycleEnd();this.hv.removeClass("s-e-active");d?this.kS(false,false):this.im();this.ge();this.lA()}},getInputData:function(){return this.gO(this.editor$)},im:function(){if(this.editor$&&this.jg){var d=this.gO(this.editor$);this.gD=this.iI(this.jg,d)?null:d}},applyData:function(d){this.gp(d,this.editor$);this.im();this.iu()},kS:function(d,a){var s=d?this.jg:this.eo;if(this.editor$&&s){this.gp(s,this.editor$)
;this.im();if(d&&this.gD){k.assert(false,q.ct(this.gD));this.gD=null}this.jB(null);this.iu();a&&this.takeFocus(true)}},gW:function(){this.fV();if(this.hv)if(k.onPage(this.hv)){k.warn("editor is still on page after edit stopped ["+this.issueId+","+this.column.getCsid()+"]");this.hv.remove()}this.fA.dispose()},iR:function(){if(this.hv){var d=k.onPage(this.hv);if(d!==this.gI)if(this.gI=d)this.jn();else this.iZ();else d&&this.jr()}},jn:function(){this.hv.find("form").submit(k.returnFalse);this.kt();this.takeFocus(true)},kt:function(){this.iK();this.jD();this.jr();this.jK()},jD:function(){if(this.editor$){this.editor$.find(".aui-field-versionspicker > .jira-multi-select, .aui-field-componentspicker > .jira-multi-select").remove();var d=this.hG.panel.getAJSBridge();if(d){d.js(this.hv);d=this.editor$.find(".aui-field-datepicker :text");d.length&&P&&P(d[0]).unbind("keydown")}}},iZ:function(){},jz:function(d,a){if(this.editor$){var s=d&&d.target;if(!(!s||d.isDefaultPrevented())){var z=u(s);if(z.is(":input")){if(a===100||a===2){if(z.is('input[type="text"]')&&P){var I=this.editor$.find(".icon-date:visible").parent();if(I.length){P(I[0]).click();d.preventDefault();return}}if(a===100)return}if(
z.is("select")){if(a!== -1&&a!==1)return}else if(z.is('input[type="text"],textarea'))return;z=this.editor$.find(":input:visible");s=k.indexOf(z,s);if(!(s<0)){s=a<0?s-1:s+1;if(!(s<0||s>=z.length)){z[s].focus();d.preventDefault()}}}}}},jF:function(d){var a=k.keyboardCodeFromEvent(d),s=G[a];if(s!=="cancelCurrentCellEdit")if(this.gv)this.gv=0;if(s){if(this.hv.find(".atlassian-autocomplete .suggestions:visible").length||u("body > .ajs-layer:visible").length)return true;if(M.modes.GADGET){var z=this.hv.find(".ajs-layer-placeholder");if(z.length&& !z.children().length)return true}if(z=d&&d.target){if(s==="cancelCurrentCellEdit"&&u(z).is("select")&& !z.multiple)if(!this.gv){this.gv=(new Date).getTime();return true}if(a===13&&u(z).is("textarea")&& !u(z).is(".jira-multi-select > textarea"))return true}this.hG.panel.bD().fireEvent(e.ACTION,s,d);a===13&&document.activeElement!==z&&d.preventDefault();return d&&d.consumed?false:true}else if(a=T[a])this.jz(d,a)},iB:function(){this.jl()},iU:function(){this.jl()},it:function(d){var a=u(d.target),s=null;if(a.is(".s-editor-done"))s="finishAllEdits";else if(a.is(".s-editor-dialog"))s="switchToDialog";else if(a.is(".s-editor-revert"))s=
"revertCurrentCellEdit";else if(a.is(".s-editor-cancel"))if(this.hG.ip(this)){if(!this.fY.find(".s-editor-cancel-confirm").length){d=this.issueId<0?k.text("s.w.editor.cancel.new.confirm"):k.text("s.w.editor.cancel.edit.confirm");u('<div class="s-editor-cancel-confirm"><div>'+d+'</div><div class="s-answer"><a href="#" class="s-editor-cancel-yes">'+k.text("s.w.editor.cancel.confirm.yes")+'</a> | <a href="#" class="s-editor-cancel-no">'+k.text("s.w.editor.cancel.confirm.no")+"</a></div></div>").hide().appendTo(this.fY).slideDown(200)}return false}else s="cancelCurrentIssueEdit";else if(a.is(".s-editor-cancel-yes"))s="cancelCurrentIssueEdit";else if(a.is(".s-editor-cancel-no")){this.fY.find(".s-editor-cancel-confirm").slideUp(200,function(){u(this).remove()});return false}if(s){this.hG.panel.bD().fireEvent(e.ACTION,s,d);d.preventDefault();return false}},jK:function(){if(this.jq()){this.im();this.iu()}},hn:function(d){var a=[];d.find(":input").each(function(){var s=u(this);if(s.attr("name"))if(s.is("select"))s.find("option:selected").each(function(){a.push(u.trim(u(this).html()))});else if(s.is('input[type="text"],textarea'))(s=s.val())&&a.push(k.htmlEscape(s));else if(s.is(":checked"))
{s=s.attr("id")||s.attr("name");(s=d.find('label[for="'+s+'"]').text())&&a.push(k.htmlEscape(s))}});return a.length?a.join(", "):""},iA:function(){},eA:function(d){var a=d.closest(".tr"),s=parseInt(d.css("left"),10)||0,z=a.width(),I=d.offset();a=a.offset();z=z-(I.left-s-a.left)-6;I=d.outerWidth(false);z=z&&I>z?z-I:0;if(z!==s)if(z){d.css("left",z+"px");this.hZ.css("left",-z+10+"px").show()}else{d.css("left","");this.hZ.hide()}},jr:function(){var d=this.hv;if(d){var a=d.parent();if(a.length)if(d.closest(".tr").length){this.iA(d,a);this.eA(d,a);this.ik()}}},fW:function(){this.eo=this.jg=this.gO(this.editor$)},jq:function(){return this.fA.isStarted()},hN:function(){return!this.editor$&&this.hv.is(".s-e-loading")},hc:function(){return this.hv},hS:function(){return! !this.gD},gg:function(){return this.gD},getColumnId:function(){return this.column.getCsid()},getColumn:function(){return this.column},getIssueId:function(){return this.issueId},lA:function(){this.hX.hF(this.issueId,true)},jL:function(){this.hX.hF(this.issueId,false)},bQ:function(d,a){if(this.issueId===d&&a)this.issueId=a},iS:function(){return! !(this.gN&&this.gN.length)},hb:function(){return this.gN},hw:function(){
return this.gX},jB:function(d){this.gN=d&&d.length?d:null;this.gX=this.gR(this.gN);this.gs=false;if(this.hv)if(this.gN){this.hv.addClass("s-e-error");for(var a="",s=0,z=d.length;s<z;s++)a+='<div class="s-editerror"><div></div><span>'+k.htmlEscape(d[s])+"</span></div>";if(this.editor$)a+='<div class="s-editerror-description">'+k.text("s.w.editor.edit.error.description.html")+"</a></div>";this.fY.html(a);this.gF.attr("title",k.htmlEscape(this.gX))}else{this.hv.removeClass("s-e-error");this.fY.empty();this.gF.attr("title","")}this.jL()},jb:function(){if(!this.iS())return false;var d= !this.gs;this.gs=true;return d},gR:function(d){if(!d|| !d.length)return "";for(var a="",s=0;s<d.length;s++){if(a.length){var z=a.substring(a.length-1);if(z==="."||z==="!")a=a.substring(0,a.length-1);a+="; "}a+=u.trim(d[s]||"")}return a},iO:function(){var d=document.activeElement;if(!d)return true;if(d===U||d===U.document)return false;d=u(d);if(d.is("#s-focus-placeholder")){if(d.attr("rel")!=this.gn)return false}else{d=d.closest(".s-editorpanel");if(!d.length||d[0]!==this.hv[0])return false}return true},takeFocus:function(d){if(this.jq()&&this.hv){if(d)if(!this.iO())return false;var a=k.onPage(this.hv)&&
this.hv.find(":input:visible:eq(0)");if(a&&a.length){d=function(){a.is('input[type="text"], input:not([type])')&&a.select();a.focus()};u.browser.msie?setTimeout(d,1):d()}else{d=this.hG.panel.widget.gk;d.attr("rel",this.gn);d.focus()}}},ik:function(){this.hG.panel.cJ().ik()},gO:function(d){return q.ht(d)},gp:function(d,a){return q.hl(d,a)},iI:function(d,a){return q.jc(d,a)},ig:function(d,a){this.hS()&&typeof a==="string"?this.az.jC(this.issueId,d,a):this.az.fP(this.issueId,d)},kc:k.returnFalse,lq:function(d){this.kn=d;this.editor$&&this.jN()},jN:function(){var d=this.kn;if(d&&this.editor$){this.kn=null;this.gp(d,this.editor$);this.iu()}}});B.gc=h})(window);(function(U){function C(G,Q){this.container$=q("<div></div>");this.widget=G;this.hG=Q;this._$={};this.idPrefix="s"+P++ +"-";var T=e.getStored("new.clone.mode");T=T?T==="true":true;var A=Q.iT.creationContext.sample;if(A){var t=G.az.cI(A),d=t&&t.getValue("jira:raw:project")||"0",a=t&&t.getValue("jira:raw:issuetype")||"0";if(a!=="0")this.kr=a}var s=this;this.cells={};this.cells.sample=new h.Cell(A);this.cells.cloneMode=A?(new h.Cell(T)).pipeChanges(function(z){e.setStored("new.clone.mode",z?"true":"false")}):new h.Cell(false);
this.cells.project=(new h.Cell("0")).pipeChanges(function(z){s.cells.cloneMode.value()||s.cells.pickedProject.setValue(z)});this.cells.pickedProject=(new h.Cell(e.getStored("new.project")||"0")).pipeChanges(function(z){s.cells.cloneMode.value()||s.cells.project.setValue(z);z&&e.setStored("new.project",z)});this.cells.type=(new h.Cell("0")).pipeChanges(function(z){s.cells.cloneMode.value()||s.cells.pickedType.setValue(z)});this.cells.pickedType=(new h.Cell(e.getStored("new.issuetype")||"0")).pipeChanges(function(z){s.cells.cloneMode.value()||s.cells.type.setValue(z);z&&e.setStored("new.issuetype",z)});this.cells.ll=new h.Cell(false);this.cells.cloneMode.pipe(function(z){s.cells.project.setValue(z?d:s.cells.pickedProject.value());s.cells.type.setValue(z?a:s.cells.pickedType.value())});this.cells.createMode=new h.Cell(this.cells.cloneMode,function(z){return!z});this.cells.lj=new h.Cell(false);this.cells.output=(new h.Cell(this.cells.cloneMode,this.cells.project,this.cells.type,this.cells.lj,function(z,I,R,b){if(!b)return null;return{mode:z?"clone":"new",pid:z?0:h.toIntSafe(I,0),issuetype:z?"":R}})).setDelay(200);this.cells.kZ=new h.Cell(false);this.cells.km=new h.Cell(true);
this.cells.controlsLoaded=new h.Cell(this.cells.kZ,this.cells.km,h.and);this.presenters={cloneMode:new h.CheckboxPresenter(this.cells.cloneMode),project:new B.SingleSelectPresenter(this.cells.project),type:new B.SingleSelectPresenter(this.cells.type)};this.initHtml();this.jS();this.cells.output.pipe(function(z){z&&Q.kd(z)});this.cells.project.pipeChanges(h.delayed(100,this.presenters.type.viewChanged,this.presenters.type))}var h=namespace("almworks.util"),k=namespace("almworks.structure.columns"),e=namespace("almworks.structure"),B=namespace("almworks.structure.ajsbridge"),q=e.$,M=h.requireGlobal("AJS"),u=h.requireGlobal("JIRA"),P=1;h.extend(C.prototype,{initHtml:function(){this.container$.html(h.renderTemplate(
'<div class="s-newp"><div class="s-newp-title">{s.w.editor.new.title}</div><form class="aui ajs-dirty-warning-exempt" onsubmit="return false"><table><col width="1"/><col width="*"/><tbody><tr class="s-newp-clone"><td>{s.w.editor.new.fields.label}</td><td><div class="s-newp-clone"><span class="grad"></span><input type="checkbox" name="cloneissue" value="clone" checked="checked" id="s-newp-clone-cb"><label class="s-newp-cbl" for="s-newp-clone-cb">{s.w.editor.new.fields.text:html}&nbsp;<span class="s-newp-clone-key"></span></label></div></td></tr></tbody><tbody class="s-newp-pt s-loading"><tr><td>{s.w.editor.new.project}</td><td><div class="s-newp-wait">&nbsp;</div><div class="s-newp-project"></div></td></tr><tr><td>{s.w.editor.new.type}</td><td><div class="s-newp-wait">&nbsp;</div><div class="s-newp-type"></div><div class="s-newp-type-subtask" style="display:hidden"></div></td></tr></tbody></table></form></div>'));var G=this._$;h.extend(G,{projectDiv:this.container$.find(".s-newp-project"),typesDiv:this.container$.find(".s-newp-type"),lv:this.container$.find(".s-newp-type-subtask"),lo:this.container$.find(".s-newp-clone-key"),projectTypeSection:this.container$.find(".s-newp-pt"),kj:
this.container$.find(".s-newp-clone input")});var Q=this.cells.sample.value();if(Q){Q=this.widget.az.cI(Q);var T="",A="";if(Q){T=Q.getValue("jira:raw:issuekey")||"";A=Q.getValue("jira:raw:summary")||"";if(A.length>80){G.lo.attr("title",h.htmlEscape(A));A=A.substring(0,77)+"..."}}(Q=T?T+" "+A:A)||(Q="");G.lo.text(Q);this.presenters.cloneMode.setView(G.kj)}else this.container$.find(".s-newp-clone").hide();new h.ElementClassToggler(this.cells.cloneMode,"s-disabled",G.projectTypeSection,false);(new h.Cell(this.cells.cloneMode,this.cells.ll,h.and)).pipe(function(t){h.showHide(G.typesDiv,!t);h.showHide(G.lv,t)});this.cells.controlsLoaded.pipe(function(t){t&&G.projectTypeSection.removeClass("s-loading")})},jS:function(){this.widget.jiraConfig.kx(h.withThis(this,this.lz))},lz:function(G,Q){var T=G&&G.project&&G.project.createHtml;T?this._$.projectDiv.html(T):this._$.projectDiv.html(h.renderTemplate('<span class="s-newp-pt-err">{s.w.editor.new.project.error}</span>'));var A=G&&G.issuetype&&G.issuetype.createHtml;if(A){this._$.typesDiv.html(A);this._$.typesDiv.find("option[value='']").remove()}else this._$.typesDiv.html(h.renderTemplate(
'<span class="s-newp-pt-err">{s.w.editor.new.type.error}</span>'));var t=this.idPrefix;this.container$.find("[id]").each(function(){this.id=t+this.id});this.container$.find("label[for]").each(function(){var d=q(this);d.attr("for",t+d.attr("for"))});this.container$.find(".project-field").removeClass("project-field").addClass("s-project-field");this.container$.find(".issuetype-field").removeClass("issuetype-field").addClass("s-issuetype-field");if(this.kr&&this.widget.jiraConfig.lk(this.kr)){this.cells.km.setValue(false);this.widget.jiraConfig.gB({issueId:this.hG.issueId,creationContext:{pid:0,issuetype:"",mode:"clone",sample:this.hG.he()},field:"issuetype",ii:h.withThis(this,this.jV),jw:h.withThis(this,this.jX)});this.cells.ll.setValue(true)}this.cells.kZ.setValue(true);!G&&Q&&this.widget.errorCentral.reportError(new e.error.AppError(h.text("s.w.editor.new.pt.error"),Q.title+"\n\n"+Q.details));if(!T|| !A)this.cells.cloneMode.setValue(true)},jX:function(G){if(G=(G=G&&G.fields)&&G.issuetype&&G.issuetype.createHtml){this._$.lv.html(G);var Q=this.idPrefix+"subtask-";this._$.lv.find("[id]").each(function(){this.id=Q+this.id});this._$.lv.find(".issuetype-field").removeClass(
"issuetype-field").addClass("s-issuetype-field")}else this._$.lv.html(h.renderTemplate('<span class="s-newp-pt-err">{s.w.editor.new.type.error}</span>'));this.cells.km.setValue(true)},jV:function(){this.jX(null)},kt:function(){if(this.cells.controlsLoaded.value())if(!this.gl){this.gl=true;this.lw();this.cells.lj.setValue(true)}},lw:function(){function G(){var l;if(t){var j=M.$(z).val();this.ks=new d({element:z,revertOnInvalid:true,pageSize:50,pagingThreshold:100,model:a});new B.SingleSelectEnabler(this.cells.createMode,this.ks);this.presenters.project.setView(this.ks,!T);l=this.cells.project.value();if(!l||l==="0")this.cells.project.setValue(j)}else{this.ks=new M.SingleSelect({element:z,revertOnInvalid:true});new B.SingleSelectEnabler(this.cells.createMode,this.ks);this.presenters.project.setView(this.ks,!T)}T&&this.presenters.project.sync(true);if((l=this.cells.pickedProject.value())&& !this.presenters.project.isValidViewValue(l)){l=this.presenters.project.getViewValue();if(!l||l==="0")l=this.presenters.project.getFirstNonEmptyValue();this.cells.pickedProject.setValue(l)}}function Q(){R.bind("reset",function(){R.find("option[value='']").remove()}).trigger("reset");if(t){this.jP=
new M.SingleSelect({element:R,revertOnInvalid:true,model:a});var l=this._$.typesDiv.find("#"+I.id+"-projects"),j=this._$.typesDiv.find("#"+I.id+"-defaults");this.jP.model.remove("");new u.ProjectIssueTypeSelect({project:M.$(z),issueTypeSelect:this.jP,projectIssueTypesSchemes:M.$(l[0]),issueTypeSchemeIssueDefaults:M.$(j[0])})}else this.jP=new M.SingleSelect({element:I,revertOnInvalid:true});new B.SingleSelectEnabler(this.cells.createMode,this.jP);this.presenters.type.setView(this.jP,!T);T&&this.presenters.type.sync(true);(l=this.cells.pickedType.value())&& !this.presenters.type.isValidViewValue(l)&&this.cells.pickedType.setValue(this.presenters.type.getViewValue());if(l=this._$.lv.find(".s-issuetype-field")[0]){this.kW=new M.SingleSelect({element:l,revertOnInvalid:true,model:a});h.assert(this.kr,this);new B.SingleSelectPresenter(new h.Cell(this.kr),this.kW);new B.SingleSelectEnabler(new h.Cell(false),this.kW)}}if(M.SingleSelect){var T=this.cells.project.value()!=="0"&&this.cells.type.value()!=="0",A=this.widget.jiraConfig.getVersionSignature(),t=A>=60400|| !A,d,a;if(t)try{d=U.require("jira/ajs/select/scrollable-single-select");a=U.require(
"jira/ajs/select/suggestion-collection-model")}catch(s){t=false}var z=this._$.projectDiv.find(".s-project-field")[0];z&&G.call(this);var I=this._$.typesDiv.find(".s-issuetype-field")[0],R=M.$(I);I&&Q.call(this);if(this.ks&&this.jP){A=this._$.typesDiv.find(".project-issue-types");var b=this._$.typesDiv.find(".default-project-issue-type"),i=R.find("option:selected");if(i.length){var r=i.val();R.find("option").each(function(){var l=q(this);l.val()===r?l.attr("data-selected","selected"):l.removeAttr("data-selected")})}if(A[0]&&b[0])if(u.ProjectIssueTypeSelect)new u.ProjectIssueTypeSelect({project:M.$(z),issueTypeSelect:R,projectIssueTypesSchemes:A,issueTypeSchemeIssueDefaults:b});else B.kg(q(z),q(I),A,b)}}},kV:function(G,Q){var T=G.target,A=this.ks&&this.ks.$field,t=this.jP&&this.jP.$field;if(!A|| !t)return false;if(T===Q[0]){this.cells.cloneMode.setValue(false);A.focus().select()}else if(A&&T===A[0]){if(B.mc(this.ks,G))return true;this.cells.cloneMode.setValue(false);t.focus().select()}else{if(t&&T===t[0])if(B.mc(this.jP,G))return true;Q.focus()}return true},lx:function(G,Q){if(!this._$.kj.is(":visible"))return false;this.cells.cloneMode.setValue(!this.cells.cloneMode.value());
Q.focus();return true},validateProjectId:function(G){var Q=this._$.projectDiv.find(".s-project-field");if(!G|| !Q.length)return "0";if(Q.is("select")){if(q('option[value="'+G+'"]',Q).length)return G}else if(Q.is("input")){var T=Q.attr("id");if(T)if(T=this._$.projectDiv.find("#"+T+"-options").attr("data-suggestions"))try{var A=U.JSON.parse(T);if(A&&A.length){var t=null;if(A.some(function(a){return a&&a.items&&a.items.some(function(s){if(!s)return false;if(!t&&s.selected)t=s.value;return s.value==G})}))return G;return t||Q.val()||"0"}}catch(d){h.warn("failed to process project select element: "+d)}h.warn("unknown project select element structure")}return Q.val()||"0"}});k.jQ=C})(window);(function(U,C){function h(n,m){var F=n._metadata;if(!F)n._metadata=F={global:null,preset:null,column:null,config:null};var x=F.global;if(!x)F.global=x=k(n.getMetadataRequests());var H=m?I[m]:null,ha=null;if(H)(ha=F[m])||(F[m]=ha=k(n[H]()));else ha=T.Deferred().resolve({}).promise();var y=T.Deferred(),K={};T.when(x,ha).done(function(N,S){q.isEmpty(N)||q.extendOwn(K,N);q.isEmpty(S)||q.extendOwn(K,S)}).always(function(){y.resolve(K)});return y.promise()}function k(n){function m(S){if(!S|| !S.url)
return T.Deferred().reject().promise();if(!S.dataType)S.dataType="json";if(S.cacheable!==true)return P.doAjax(S);var Y=z[S.url];Y||(z[S.url]=Y=P.doAjax(S));return Y}function F(S,Y){return function(Z){Z=typeof Y.extract==="function"?Y.extract(Z):Z;ha[S]=Z}}function x(){y--;y<=0&&H.resolve(ha)}var H=T.Deferred();if(q.isEmpty(n)){H.resolve({});return H.promise()}var ha={},y=0,K,N;for(K in n)if(n.hasOwnProperty(K)){y++;N=n[K];m(N).done(F(K,N)).always(x)}return H.promise()}function e(n,m){if(!q.isEmpty(m)){var F=n.getMetadata||q.noop;n.getMetadata=function(x){return m.hasOwnProperty(x)?m[x]:F(x)}}return n}function B(n){return! !(n&&n.id&&n.type==="number"&&n.custom&& !g[n.custom])}var q=namespace("almworks.util"),M=namespace("almworks.structure"),u=namespace("almworks.structure.apputil"),P=namespace("almworks.structure.ajax"),G=namespace("almworks.structure.columns"),Q=namespace("almworks.structure.api"),T=M.$,A=namespace("AJS.InlineLayer",false),t=[],d={},a=[],s={},z={},I={preset:"getPresetMetadataRequests",column:"getColumnMetadataRequests",config:"getConfigMetadataRequests"},R=Q.baseClass("ColumnType",{createSwitchTypePreset:function(){return null},createAddColumnPresets:function(){
return[]},createConfigurator:function(){return null},createColumn:function(){return null},getMetadataRequests:function(){return null},getPresetMetadataRequests:function(){return null},getColumnMetadataRequests:function(){return null},getConfigMetadataRequests:function(){return null}}),b=Q.subClass("SimpleColumnType",R,{init:function(n){this.columnClass=n.columnClass;this.columnKeys=n.columnKeys},createColumn:function(n,m){if(m&&m.key&&q.indexOf(this.columnKeys,m.key)>=0)return new this.columnClass({context:n,spec:m});return null}}),i=Q.baseClass("ColumnConfigurator",{init:function(n){q.assert(n.spec);this.spec=n.spec;if(n.context)this.context=n.context;if(this.spec.presetName){this.presetName=this.spec.presetName;delete this.spec.presetName}},getPresetName:function(){return this.presetName||this.getColumnName()},getColumnName:function(){return this.spec.name||this.getDefaultColumnName()||this.getColumnTypeName()},getDefaultColumnName:q.returnConst(""),getColumnTypeName:q.returnConst(""),getGroupKey:q.returnFalse,getOptions:q.returnFalse,isConfigured:q.returnTrue,getColumnSpec:function(){return this.spec},getMetadataRequests:function(){return null}}),r=Q.baseClass("ColumnOption",{
init:function(n){if(n){if(n.configurator)this.configurator=n.configurator;if(n.context||this.configurator)this.context=n.context||this.configurator.context;if(n.spec||this.configurator)this.spec=n.spec||this.configurator.spec}},title:"",createLabel:function(n){T("<label></label>").text(this.title||"").appendTo(n)},createInput:function(){},notify:q.returnTrue,isInputValid:q.returnTrue}),l=Q.subClass("ColumnNameOption",r,{title:q.text("sw.column.opt.name"),init:function(){this.input$=null;this.lastName=this.configurator.getColumnName()},_setName:q.delayed(250,function(){var n=this.input$.val();if(n!==this.lastName){if(n)this.spec.name=n;else{delete this.spec.name;n=this.configurator.getColumnName();this.input$.val(n)}this.lastName=n;this.input$.trigger("notify")}}),createInput:function(n){this.input$=T('<input class="text" type="text">').appendTo(n);var m=this;this.input$.on("keyup",function(){m._setName()})},notify:function(){this.input$.val(this.configurator.getColumnName());return true},isInputValid:function(){return this.spec.name!==""}}),j=Q.baseClass("ColumnGroup",{init:function(){if(typeof this.getGroupKey()!=="string")throw Error("no valid groupKey");if(!this.getTitle())
throw Error("no title");if(typeof this.getOrder()!=="number")throw Error("bad order type");},getGroupKey:function(){return this.options.groupKey},getTitle:function(){return this.options.title},getOrder:function(){return this.options.order||0}});j.getGroups=function(){return q.addAll([],a)};var w=Q.baseClass("Column",{init:function(n){q.assert(n.spec);this.spec=n.spec;if(n.context)this.context=n.context;this.csid=this.spec.csid||n.csid;if(!this.csid)throw Error("cannot create column without csid");if(this.spec.name)this.name=q.renderTemplate(this.spec.name,{column:this})},getColumnSpec:function(){return this.spec},getCsid:function(){return this.csid},getColumnKey:function(){return this.spec.key},isColumnOfType:function(n){return this.getColumnKey()===n},getName:function(){return this.name||this.getDefaultName()||""},getDefaultName:function(){return ""},isResizable:q.returnTrue,canShrinkWhenNoSpace:q.returnFalse,isAutoSizeAllowed:q.returnFalse,getWidth:function(){return this._width},setWidth:function(n){if(typeof n==="number")this._width=Math.max(q.toIntSafe(n),this.getMinWidth());else if(!n)this._width=C},getMinWidth:q.returnConst(27),getDefaultWidth:q.returnConst(120),renderHeader:
function(n){this.safeSetHtml(n,this.getHeaderCellHtml())},getHeaderCellHtml:function(){var n=this.getName();return n?'<div class="celldiv"><div class="grad"></div><span class="value">'+q.htmlEscape(n)+"</span></div>":""},render:function(n){this.renderCellView(n)},renderCellView:function(n){var m=this.getCellViewHtml(n);m!==n._cell$.html()&&this.safeSetHtml(n._cell$,m)},getCellViewHtml:function(n){return '<div class="celldiv"><div class="grad"></div><span class="value">'+this.getCellValueHtml(n)+"</span></div>"},getCellValueHtml:function(){return ""},safeSetHtml:function(n,m){if(n&&n.length)try{n.html(m)}catch(F){var x=this.name||"?";if(!s[x]){s[x]=true;x=this.name||"?";var H="problem rendering column "+x;try{H+=" ("+u.ct(this.spec)+")"}catch(ha){}H+=": "+F;H+="\n***********************\nStructure Plugin caught a JavaScript exception when trying to display a value in column ["+x+"].\nThis problem could be caused by errors or incompatibility in other JIRA plugins.\nPlease contact ALM Works support with the information about this problem and the plugins in use.\n***********************\nCell HTML:\n"+m+"\n***********************";if(F)try{var y=q.getStackTrace(F).join("\n");if(!y&&
F.stack)y=""+F.stack;if(y)H+="\nError:\n"+y+"\n***********************"}catch(K){}q.warn(H)}}},getRequiredFields:function(){return[]},shouldFlash:function(n){var m=this.getRequiredFields();if(!m|| !m.length)return false;for(var F=0,x=m.length;F<x;F++)if(n[m[F]])return true;return false},getMetadataRequests:function(){return null}}),D=Q.subClass("EditableColumn",w,{isEditableColumn:q.returnTrue,gb:q.returnFalse,createCellEditor:q.returnFalse,render:function(n){var m=n._cellEditor;if(m&&m.jq()&& !m.hN()){J(n._cell$);this.renderCellEditor(n)}else{if(m&&m.hv&&m.hv.parent().length){var F=m.hv.find(".ajs-layer-placeholder");F.length&& !F.children().length&&A&&A.current&&typeof A.current.hide==="function"&&A.current.hide();m.hv.detach()}this.renderCellView(n)}m&&m.iR()},renderCellEditor:function(n){var m=n._cellEditor;q.assert(m);q.assert(! !m.hv,m);m.editor$||this.safeSetHtml(m.fX,this.getCellViewHtml(n));m=m.hv;if(!q.arrayEquals(n._cell$,m.parent())){m.detach();n._cell$.empty();n._cell$.append(m)}}});Q.registerColumnType=function(n,m){if(typeof m==="string")m=[m];if(!m|| !q.isArray(m)|| !m.length)throw Error("expected a non-empty array of column keys, but got "+n);if(Q.isSubClass(
Q.Column,n))n=new b({columnClass:n,columnKeys:q.addAll([],m)});if(!n|| !Q.isInstance(Q.ColumnType,n))throw Error("expected subclass of api.ColumnType, but got "+n);t.push(n);for(var F=0,x=m.length;F<x;F++)d[m[F]]=n};R.getColumnTypeForKey=function(n){return d[n]};R.getAllColumnTypes=function(){return q.addAll([],t)};Q.registerColumnGroup=function(n){if(!n||typeof n!=="object")throw Error("bad options object");a.push(new j(n))};var J=q.returnTrue;if(T.browser.msie&&T.browser.version<8)J=function(n){var m=U.document.getElementById("s-edited-td");if(n||m)if(!(n&&m===n[0])){m&&T(m).removeAttr("id");n&&n.attr("id","s-edited-td")}};var c=q.flipSet(["timeoriginalestimate","timeestimate","timespent"]),p=q.flipSet(["votes"]),g=q.flipSet(["com.atlassian.jira.plugin.system.customfieldtypes:importid","com.pyxis.greenhopper.jira:gh-global-rank","com.pyxis.greenhopper.jira:greenhopper-ranking"]);Q.Column=w;Q.ColumnType=R;Q.ColumnConfigurator=i;Q.ColumnOption=r;Q.ColumnNameOption=l;Q.ColumnGroup=j;G.Column=w;G.EditableColumn=D;G.createColumnContext=function(n){var m=M.modes,F=n.widget.jiraConfig;return{structure:{isPrimaryPanel:function(){return n.dN()},isSecondaryPanel:function(){return!n.dN()},
isIssuePage:function(){return! !m.ISSUE_PAGE},isGreenHopperTab:function(){return! !m.GH_TAB},isPCVPage:function(){return! !m.PCV_PAGE},isProjectPage:function(){return m.PCV_PAGE==="project"},isComponentPage:function(){return m.PCV_PAGE==="component"},isVersionPage:function(){return m.PCV_PAGE==="version"},isGadget:function(){return! !m.GADGET},isLocalGadget:function(){return m.GADGET==="local"},isRemoteGadget:function(){return m.GADGET==="remote"},isStructureBoard:function(){return q.contains(["structure","structure-with-details"],m.getStructurePageId())},_panel:n},jira:{getAllIssueFields:function(){return q.addAll([],F.getJiraFields())},getIssueFieldById:function(x){return F.getJiraFieldMap()[x]}},getMetadata:q.noop}};G.loadTypeMetadata=h;G.loadMetadata=k;G.extendMetadata=e;G.createConfiguratorPromise=function(n,m,F){var x=T.Deferred(),H=null;h(n,"config").then(function(ha){if(H=n.createConfigurator(e(q.extendOwn({},m),ha),F))return k(H.getMetadataRequests());return T.Deferred().reject().promise()}).done(function(ha){e(H.context,ha)}).always(function(){x.resolve(H)});return x.promise()};G.copySpec=function(n){return M.JSON.parse(u.ct(n))};G.isNumericCustomField=B;
G.isSummableField=function(n){return! !(n&&n.id&&(c[n.id]||p[n.id]||B(n)))};Q.registerColumnGroup({groupKey:"icons",title:"{sw.conf.colsec.icons}",order:100});Q.registerColumnGroup({groupKey:"progress",title:"{sw.conf.colsec.progress}",order:200});Q.registerColumnGroup({groupKey:"fields",title:"{sw.conf.colsec.fields}",order:300});Q.registerColumnGroup({groupKey:"totals",title:"{sw.conf.colsec.totals}",order:400});Q.registerColumnGroup({groupKey:"",title:"{sw.conf.colsec.other}",order:1E4})})(window);(function(){function U(r,l){if(l&&l.key===T){l=B.copySpec(l);l.key=Q;l.params||(l.params={});l.params.aggregate="sum"}l&&l.key===Q&&l.params&&l.params.aggregate&& !r.structure.isPrimaryPanel()&&delete l.params.aggregate;return l}function C(r,l){if(l&&l.key===Q&&l.params){var j=r.jira.getIssueFieldById(l.params.field);if(!j)return false;var w=l.params.aggregate;if(w){if(w!=="sum")return false;if(!B.isSummableField(j))return false}return true}return false}function h(r,l){var j=l&&l.params&&l.params.field;var w=(j=j&&r.jira.getIssueFieldById(j))&&j.name||"";if(w&&l.params.aggregate==="sum"&&r.structure.isPrimaryPanel()&&B.isSummableField(j))w=q.text("sw.column.opt.aggr.sum.colname",w);
return w}function k(r){d=true;r.div$.delegate(".s-f-thumbnail .value a","click",function(l){if(!l|| !l.target)return true;if(u.hW(G(l.target).closest(".value"),l.target,r)){l.preventDefault();return false}})}function e(r,l){if(typeof r!=="string"||r.indexOf("img")<0)return r;a.html(r);var j=false;a.find("img").each(function(){var D=G(this),J=parseInt(D.attr("width"),10),c=parseInt(D.attr("height"),10);if(J&&c&&c>26){D.attr("height",26);D.attr("width",Math.round(J*26/c));j=true}D.closest("a").attr({target:"imageAttachment",rel:"thumbnail_"+l});s()&&D.attr("vspace","0")});var w=j?a.html():r;a.empty();return w}var B=namespace("almworks.structure.columns"),q=namespace("almworks.util"),M=namespace("almworks.structure"),u=namespace("almworks.structure.ajsbridge"),P=namespace("almworks.structure.api"),G=M.$,Q="field",T="timeAggregate",A=q.flipSet(["issuekey","status","project","created","thumbnail","issuelinks","resolution","resolutiondate","subtasks","updated","votes","watches","workratio","timespent"]),t=q.flipSet(["assignee","issuetype","timeestimate","timeoriginalestimate","priority","reporter","security"]),d=false,a=G("<div></div>"),s=q.lazy(function(){return! !G("#structure.ie7")
.length}),z=P.subClass("FieldColumn",B.EditableColumn,{init:function(){var r=this.spec.params||{};this.jiraField=(this.fieldId=r.field)&&this.context.jira.getIssueFieldById(this.fieldId);this.dataFields=[];this.htmlField="jira:html:"+this.fieldId;if(this.fieldId==="issuekey"&&this.spec.params.compact){this.dataFields.push("jira:raw:issuekey");this.dataFields.push("jira:icon:project")}else this.dataFields.push(this.htmlField);if(r.aggregate==="sum"&&this.context.structure.isPrimaryPanel()&&B.isSummableField(this.jiraField)){this.aggrField="structure:sum:"+this.fieldId;this.dataFields.push(this.aggrField);this.dataFields.push("structure:childcount")}this.gm=this.fieldId&&q.htmlEscape(this.fieldId)===this.fieldId?" s-f-"+this.fieldId:""},getDefaultName:function(){return h(this.context,this.spec)},getRequiredFields:function(){return this.dataFields},getCellViewHtml:function(r){this.fieldId==="thumbnail"&& !d&&k(this.context.structure._panel.widget);var l=r.getFieldValue(this.aggrField||this.htmlField);if(l&&this.fieldId==="thumbnail")l=e(l,r.getIssueId());if(this.fieldId==="issuekey"&&this.spec.params.compact){var j=r.getFieldValue("jira:raw:issuekey");l=r.getFieldValue(
"jira:icon:project");if(j){var w=j.split("-");l=w.length!==2?"":q.renderTemplate('<a class="issue-link" data-issue-key={issueKey} href="{issueUrl}"><span class="s-icons">{icon:html}</span>&nbsp;{issueId}</a>',{issueKey:j,issueUrl:u.issueURL(j),issueId:w[1],icon:l})}else l=""}w=null;if(this.aggrField&&q.toIntSafe(r.getFieldValue("structure:childcount"))>0)if((w=r.getFieldValue(this.htmlField))&&l&&G.trim(w)===G.trim(l))w=null;j='<div class="celldiv'+this.gm+'"><div class="grad"></div>';j+=w?q.renderTemplate('<span class="value" title="{sw.column.opt.aggr.own-hint}">'):'<span class="value">';if(l)j+=l;if(w)j+='<span class="s-aggr-own">'+w+"</span>";l=(r=r._cellEditor)&&r.hw();j+=l&&(r.hS()||r.jq())?'</span><div class="s-cellerror" title="'+q.htmlEscape(l)+'"></div></div>':"</span></div>";if(r&&r.jq()&&r.hN())j='<div class="s-editor-loading" title=""></div>'+j;return j},isAutoSizeAllowed:q.returnTrue,canShrinkWhenNoSpace:q.returnTrue,shouldFlash:function(r){return! !(r[this.htmlField]||this.aggrField&&r[this.aggrField])},createCellEditor:function(r){return new B.FieldCellEditor(r,this)},isEditableColumn:function(){if(this.context.structure.isGadget())return! !t[this.fieldId];return!
A[this.fieldId]},gb:function(r,l){var j={issueId:r};if(r<0){if(this.fieldId==="issuetype")return true;var w=l.master.cJ().oP(r);if(!w)return false;j.creationContext=w.lp();if(!j.creationContext)return false}j=l.jiraConfig.hy(j);if(!j)return false;w=j.fields;if(!w)return false;w=w[B.FieldCellEditor.MAPPING[this.fieldId]||this.fieldId];if(!w)return true;w=w[r<0?"createHtml":"editHtml"];if(!w)return true;if(this.fieldId==="timeoriginalestimate"&& !j.canChangeOriginalEstimate)return true;return false}}),I=P.subClass("FieldConfigurator",P.ColumnConfigurator,{getGroupKey:function(){return this.spec.params.aggregate?"totals":"fields"},getDefaultColumnName:function(){return h(this.context,this.spec)},getColumnTypeName:q.returnConst(q.text("sw.column.type.field")),getOptions:function(){return this.context.structure.isPrimaryPanel()?[new R({configurator:this}),new b({configurator:this}),new i({configurator:this})]:[new R({configurator:this})]}}),R=P.subClass("FieldOption",P.ColumnOption,{title:q.text("sw.column.opt.field"),init:function(){this.select$=null},createInput:function(r){var l=this.context.jira.getAllIssueFields(),j="",w=this.spec.params;w.field||(j+=q.renderTemplate(
'<option value=""></option>'));for(var D=0,J;J=l[D++];)j+=q.renderTemplate('<option value="{id}">{name}</option>',J);this.select$=r.append('<select class="select">'+j+"</select>").find("select");this.select$.val(w.field||"");this.select$.on("change",function(){var c=G(this);c.find('option[value=""]').remove();c=c.val();if(q.isArray(c))c=c[0];w.field=c;r.trigger("notify")});u.createAjsSingleSelect(this.select$)},notify:function(){this.select$.val(this.spec.params.field||"");return true},isInputValid:function(){return! !this.spec.params.field}}),b=P.subClass("AggregateOption",P.ColumnOption,{init:function(){this.checkbox$=null},createInput:function(r){this.checkbox$=r.append(q.renderTemplate('<div class="checkbox"><label><input type="checkbox">{sw.column.opt.aggr.sum.title}</label></div>')).find("input");var l=this.spec.params;this.checkbox$.on("change",function(){if(G(this).prop("checked"))l.aggregate="sum";else delete l.aggregate;r.trigger("notify")})},notify:function(){var r=this.spec.params,l=r.field;l=l&&this.context.jira.getIssueFieldById(l);if(B.isSummableField(l)){this.checkbox$.prop("checked",r.aggregate==="sum");return true}else{this.checkbox$.prop("checked",false);
delete r.aggregate;return false}}}),i=P.subClass("CompactViewOption",P.ColumnOption,{init:function(){this.checkbox$=null},createInput:function(r){this.checkbox$=r.append(q.renderTemplate('<div class="checkbox"><label><input type="checkbox">{sw.column.issueid.compact.title}</label></div>')).find("input");var l=this.spec.params;this.checkbox$.on("change",function(){l.compact=G(this).prop("checked");r.trigger("notify")})},notify:function(){if(this.spec.params.field==="issuekey"){this.checkbox$.prop("checked",this.spec.params.compact);return true}return false}});M=P.subClass("FieldColumnType",P.ColumnType,{createSwitchTypePreset:function(){return{key:Q,params:{}}},createAddColumnPresets:function(r){var l=r.structure.isPrimaryPanel();r=r.jira.getAllIssueFields();for(var j=[],w=0,D=r.length;w<D;w++){var J=r[w];j.push({key:Q,params:{field:J.id}});l&&B.isSummableField(J)&&j.push({key:Q,params:{field:J.id,aggregate:"sum"}})}return j},createConfigurator:function(r,l){l=U(r,l);return new I({context:r,spec:l})},createColumn:function(r,l){l=U(r,l);return C(r,l)?new z({context:r,spec:l}):null}});P.registerColumnType(new M,[Q,T]);B.FieldColumn=z})();(function(){function U(t,d){q.gc.call(this,t,d)
;this.hq=U.MAPPING[d.fieldId]||d.fieldId}function C(t,d,a,s,z,I){var R=d.width()-G;s=typeof s==="string"?a.find(s):s;z=(a=typeof z=="string"?a.find(z):z)&&a.length?a.outerWidth(true):0;z+=s.outerWidth(true)-s.width();t=t.iS()?P-z:0;d=d.find(".s-editbuttons.s-with-dialog").length?210:0;I={width:Math.max(R-z,t,I||0,d)+"px","max-width":"none"};if(!a|| !a.length)I["margin-right"]=0;s.css(I)}function h(t,d,a){return function(s,z,I,R){C(s,R,z,t,d,a)}}function k(t,d,a,s,z,I){z=I.width()-G;s=s.find("textarea");a=s.siblings(".content-inner");d=Math.max(P,d,z);if(a.length){t+=3;d=Math.max(250,d)}t={width:d+"px",height:t*Q+"px"};s.css(t);if(a.length){t.width=d-1+"px";a.css(t)}}function e(t,d,a){return function(s,z,I,R){I=z.find("select");var b=z.find("*").filter(t);if(M.modes.GADGET==="remote"&&I.length){b.remove();I.removeAttr("multiple").show();C(s,R,z,I,d,150)}else if(b.length){b.slice(1).remove();C(s,R,z,b,d,150)}else if(I.length)C(s,R,z,I,d,150);else if(a){b=z.find(a);C(s,R,z,b,d,150)}}}var B=namespace("almworks.util"),q=namespace("almworks.structure.columns"),M=namespace("almworks.structure"),u=M.$;U.MAPPING={timeestimate:"timetracking",timeoriginalestimate:"timetracking"};B.extend(
U.prototype,q.gc.prototype,{hL:function(t){return t.getValue(this.column.fieldId)!==null},iF:function(t){B.assert(! !t);var d=t.error;if(d)this.jI(d);else{var a=(d=t.fields)&&d[this.hq];if(d=a&&a.error)this.jI(d);else if(d=a&&a[this.issueId<0?"createHtml":"editHtml"]){if(this.column.fieldId==="timeoriginalestimate")if(!t.canChangeOriginalEstimate){this.jI(B.text("s.w.rest.config.fields.original-estimate.uneditable"));return}this.jA=d;this.iX(this.hd(d))}else this.jI(B.text("s.w.config.fields.load-got-nothing"))}},pk:function(t,d){this.editor$=this.hd(this.jA);this.hv.css("visibility","hidden");this.gr.empty();this.gr.append(this.editor$);var a=t.apply(this,d);this.jD();this.jr();this.hv.css("visibility","visible");this.hG.panel.bn().gL();return a},kS:function(t,d){if(this.editor$&&B.onPage(this.editor$)){var a=d&&this.iO();this.pk(q.gc.prototype.kS,[t,d]);a&&this.takeFocus(false)}else q.gc.prototype.kS.call(this,t,d)},applyData:function(t){this.editor$?this.pk(q.gc.prototype.applyData,[t]):q.gc.prototype.applyData.call(this,t)},hd:function(t){var d=u('<form class="aui" onsubmit="return false">'+t+"</form>");t=this.column.fieldId;if(t==="timeoriginalestimate")d.find(
'input[name="timetracking_remainingestimate"]').closest("div.field-group").remove();else t==="timeestimate"&&d.find('input[name="timetracking_originalestimate"]').closest("div.field-group").remove();d.find("a.localHelp,legend").remove();var a="";t=d.find(".description,span.example");if(t.length){var s=[];t.each(function(){var z=u(this).text();(z=z&&u.trim(z))&&s.push(z)});if(s.length){a=s.join(" \n");d.attr("title",a)}}t.remove();d.find("label[for]").each(function(){var z=u(this),I=z.attr("for");I=d.find("#"+I+',[name="'+I+'"]');if(!I.is(":checkbox,:radio")){if(I.length){var R=z.text(),b=I.attr("title");if(b)R=b+" \n"+R;if(a)R=R+" \n"+a;I.attr("title",R)}z.remove()}});return d},jh:function(){var t=this.hG.panel.widget.jiraConfig,d=this.hG.lp();if(this.issueId<0&& !d){B.warn("cannot load editors when no project/type is set");return false}d={issueId:this.issueId,creationContext:d,field:this.hq,ii:B.withThis(this,this.jI),jw:B.withThis(this,this.iF)};t.gB(d);return true},ge:function(){var t=this.gD;t=t?this.hn(this.hv,t)||"":"";this.ig(this.column.htmlField,t);if(this.column.aggrField){var d=this.az.cI(this.issueId);d&&B.toIntSafe(d.getValue("structure:childcount"),-1)===0&&this.ig(
this.column.aggrField,t)}},iA:function(t,d){var a=this.editor$;if(a){var s=this.hq;(s=A[B.tail(s,"customfield_")?"customfield":s])&&s(this,a,t,d)}},gO:function(t){t=q.gc.prototype.gO.call(this,t);if((this.column&&this.column.fieldId)==="assignee"&&t){var d=t.assignee;if(d&&typeof d!=="string"&&d.length>1){d=d[0]==="-1"?d[1]:d[0];t.assignee=d}}return t},hn:function(t,d){if((this.column&&this.column.fieldId)==="assignee"&&d){var a=d.assignee;if(a){if(a=typeof a==="string"?a:a.length===1?a[0]:null){a=t.find('select option[value="'+a+'"]');if(a.length&&a.is(":selected"))return u.trim(a.html())}}else if(a===""){a=t.find('select option[value=""]:selected');if(a.length)return u.trim(a.html())}}return q.gc.prototype.hn.call(this,t,d)}});var P=188,G=21,Q=15,T=h("input[type=text]",null,110),A={assignee:B.seq(e("#assignee-single-select","#assign-to-me-trigger","input#assignee"),function(t,d){var a=d.find("#assignee-container"),s=d.find("#assignee-single-select,input#assignee"),z=d.find("#assign-to-me-trigger");if(M.modes.GADGET==="remote"){s=d.find("select#assignee,input#assignee");z.css("top","0")}a.width(s.outerWidth(true)+(z.length?z.outerWidth(true):0))}),description:B.curry(k,9,400),
duedate:h("input","#duedate-trigger",110),environment:B.curry(k,3,0),issuetype:e("#issuetype-single-select",null,null),timeoriginalestimate:T,timetracking:T,priority:e("#priority-single-select",null,null),reporter:h("input","a.popup-trigger",110),security:h("select",null,110),customfield:function(t,d,a,s){var z=d.find("input[type=text],select");if(z.length===1)if(z.siblings().length){if(z.hasClass("datepicker-input")){C(t,s,d,z,'a[href="#"][id$="trigger"]',110);return}}else{C(t,s,d,z,null,130);return}z=d.find("textarea");if(z.length===1&& !z.closest(".jira-multi-select").length)k(3,0,t,d,a,s);else{z=d.find(".wiki-edit");z.length===1&&C(t,s,d,z,null,200)}}};q.FieldCellEditor=U})();(function(){var U=namespace("almworks.structure.columns"),C=namespace("almworks.structure.api"),h=namespace("almworks.util"),k=C.subClass("JoinedFieldsColumn",C.Column,{init:function(){this.fields=this.spec.params&&this.spec.params.fields;this.fieldSpecs=[];if(this.fields)for(var e=0,B=this.fields.length;e<B;e++)this.fieldSpecs.push("jira:html:"+this.fields[e])},getCellValueHtml:function(e){var B="",q=this.fieldSpecs,M=q&&q.length;if(M)for(var u=0;u<M;u++){var P=e.getFieldValue(q[u]);if(P)B+=P}return B},
getRequiredFields:function(){return this.fieldSpecs},isAutoSizeAllowed:h.returnTrue,canShrinkWhenNoSpace:h.returnTrue});C=C.subClass("JoinedFieldConfigurator",C.ColumnConfigurator,{getGroupKey:h.returnConst("icons"),getColumnTypeName:h.returnConst(h.text("sw.column.type.joined"))});U.fU=k;U.JoinedFieldsConfigurator=C})(window);(function(){function U(Q,T){e.addSuper(k.gc,this)(Q,T)}var C=namespace("almworks.structure"),h=namespace("almworks.structure.ajsbridge"),k=namespace("almworks.structure.columns"),e=namespace("almworks.util"),B=namespace("almworks.structure.api"),q=C.$;e.requireGlobal("AJS");var M;e.extend(U.prototype,k.gc.prototype,{jh:function(){var Q=this.az.getIssueSummary(this.issueId);if(Q===null)return false;if(this.hG.kQ){this.kk(this.hG.kQ.container$);var T=this;this.hG.kQ.cells.controlsLoaded.pipeChanges(function(t){t&&e.onPage(T.editor$)&&T.jq()&&T.kt()})}var A=q('<input name="summary" type="text" maxlength="255" class="s-summary-editor" autocomplete="off">');A.val(Q);this.iX(A);return true},kt:function(){this.hG.kQ&&this.hG.kQ.kt();this._super.kt()},jF:function(Q){var T=e.keyboardCodeFromEvent(Q),A=this.editor$;if((T===13||T===10013||T===9)&&A&& !A.val()&& !q(
".ajs-layer.active:visible").length){A=this.hG.kQ;var t;if(A){t=true;if(T===13||T===9)A.kV(Q,this.editor$);else T===10013&&A.lx(Q,this.editor$)}else t=T===13||T===10013;if(t){if(Q){Q.preventDefault();Q.stopPropagation();Q.consumed=true}return false}}return this._super.jF(Q)},iA:function(Q,T){var A=this.editor$;if(A){var t=T.width(),d=Q.data("offsetMargin");if(d)t-=d+20;A.width(Math.max(t,300))}},ge:function(){var Q=this.gg();this.ig("jira:raw:summary",Q&&Q.summary)},hL:function(Q){return Q.getValue("jira:raw:summary")!==null},ic:function(){return this.hS()&&this.issueId>0},gO:function(Q){Q=k.gc.prototype.gO.call(this,Q);if(Q.summary)Q.summary=q.trim(Q.summary);return Q},hasSummary:function(){if(!this.editor$)return false;var Q=this.editor$.val();if(!Q||typeof Q!=="string")return false;return! !q.trim(Q)},kc:e.returnTrue});var u=B.subClass("MainColumn",k.EditableColumn,{_minWidth:0,init:function(){this._description= !this.spec.params||this.spec.params.description!==false;this._fieldSpecs=["jira:raw:summary","jira:raw:issuekey"];this._description&&this._fieldSpecs.push("jira:html:description")},getCellViewHtml:function(Q){var T=Q._getDepthOffset(),A=
'<div class="celldiv offset" style="padding-left: '+T+'px"><div class="grad"></div><span class="expander"></span><span class="value">';if(Q._issueData.isLoadingFailed()){Q=A;M||(M=e.renderTemplate('<span class="s-i-loading-failed">{s.w.issue-loading-failed}</span>'));return A=Q+(M+"</span></div>")}var t=Q.getEscapedFieldValue("jira:raw:summary")||"";if(t){var d=Q.getFieldValue("jira:raw:issuekey")||"";if(d)t='<a class="issue-link" data-issue-key="'+d+'" href="'+h.issueURL(d)+'">'+t+"</a>";A+='<span class="issueSummary">'+t+"</span>"}if(t=this._description&&Q.getFieldValue("jira:html:description")||""){if(t.length>600)t=t.substring(0,600);A+='<span class="ds">-</span><span class="issueDescription">'+t+"</span>"}t=Q._cellEditor&&Q._cellEditor.hw();A+=t&&(Q._cellEditor.hS()||Q._cellEditor.jq())?'</span><div class="s-cellerror" style="left: '+(T+4)+'px" title="'+e.htmlEscape(t)+'"></div></div>':"</span></div>";return A},renderCellEditor:function(Q){var T=Q._cellEditor.hv;if(T){var A=Q._getDepthOffset()+4;T.css("margin-left",A).data("offsetMargin",A)}k.EditableColumn.prototype.renderCellEditor.call(this,Q)},getRequiredFields:function(){return this._fieldSpecs},getWidth:function(){
return "*"},setWidth:e.returnTrue,getMinWidth:function(){if(this._minWidth<=0){var Q=this.context.structure;this._minWidth=Q.isPrimaryPanel()&& !Q.isGreenHopperTab()?200:100}return this._minWidth},canShrinkWhenNoSpace:e.returnTrue,createCellEditor:function(Q){return new U(Q,this)},getDefaultName:function(){var Q=this.context.jira.getIssueFieldById("summary");return Q&&Q.name||e.text("sw.column.main.name")}}),P=B.subClass("MainConfigurator",B.ColumnConfigurator,{init:function(){this.spec.key="main";if(!this.spec.params)this.spec.params={}},getDefaultColumnName:function(){var Q=this.context.jira.getIssueFieldById("summary");return Q&&Q.name||""},getColumnTypeName:e.returnConst(e.text("sw.column.main.name")),getOptions:function(){return[new G({configurator:this})]}}),G=B.subClass("DescriptionOption",B.ColumnOption,{init:function(){this.checkbox$=null},createInput:function(Q){this.checkbox$=Q.append(e.renderTemplate('<div class="checkbox" style="margin-bottom: 8px;"><label><input type="checkbox">&nbsp;{sw.column.main.opt.description}</label></div>')).find("input");var T=this.spec.params;this.checkbox$.on("change",function(){if(q(this).is(":checked"))delete T.description;
else T.description=false;Q.trigger("notify")})},notify:function(){this.checkbox$.prop("checked",this.spec.params.description!==false);return true}});C=B.subClass("MainColumnType",B.ColumnType,{createConfigurator:function(Q,T){return T.key==="main"?new P({context:Q,spec:T}):null},createColumn:function(Q,T){return T.key==="main"?new u({context:Q,spec:T}):null}});B.registerColumnType(new C,"main");k.aM=u})();(function(U){function C(){if(!this.mv())return 32;if(this._isHugeWidth()){if(h.modes.HISTORY)return 88;return 72}if(h.modes.HISTORY)return 76;return 60}var h=namespace("almworks.structure"),k=namespace("almworks.structure.columns"),e=namespace("almworks.util"),B=namespace("almworks.structure.api"),q=["jira:raw:resolution","jira:permission:edit"],M=B.subClass("HandleColumn",B.Column,{getRequiredFields:function(){return q},getCellViewHtml:function(u){var P="";P+='<div class="st-dh" title="'+e.text("sw.widget.dragtip")+'"></div>';P+='<div class="st-handles">';var G=u.getIssueId(),Q="s-ms-"+this._getPanelId()+"-"+G;P+='<a href="#" id="'+Q+'" class="noselmove s-ms-mark"></a>';if(this.mv()){P+=u._issueData.diffIcon?'<span class="s-h-'+u._issueData.diffIcon+'-mark" title="'+e.text(
"sw.widget.h."+u._issueData.diffStatus+".tooltip")+'"></span>':'<span class="s-h-empty-mark"></span>';P+=u._issueData.hz()?'<span class="st-cl-mark" title="'+e.text("sw.widget.resolved.tooltip")+'"></span>':'<span class="st-op-mark"></span>';Q=this._getIssueEditor();P+=Q&&Q.iM(G)?G<0?'<span class="s-ed-err-new-mark" title="'+e.text("s.w.handle.ed-err-new.tooltip")+'"></span>':'<span class="s-ed-err-mark" title="'+e.text("s.w.handle.ed-err.tooltip")+'"></span>':u._issueData.iW()||u._issueData.nA()?'<span class="s-ed-mark" title="'+e.text("s.w.handle.ed.tooltip")+'"></span>':u._issueData.gY()?'<span class="st-ro-mark" title="'+e.text("sw.widget.ro.tooltip")+'"></span>':'<span class="st-rw-mark"></span>'}P+="</div>";return P},getHeaderCellHtml:function(){return e.renderTemplate('<div class="s-th-handle"><a href="#" class="s-ms-toggle-all s-ms-t-a-th s-ms-{panelId}-all"></a></div>',this.options.panel)},isResizable:e.returnFalse,setWidth:e.returnTrue,getWidth:C,getMinWidth:C,getDefaultWidth:C,mv:function(){if(this.lW===U){var u=this.context.structure;this.lW=u.isPrimaryPanel()&& !u.isGreenHopperTab()}return this.lW},_isHugeWidth:function(){if(this._hugeWidth!==true&&this._hugeWidth!==
false){var u=this.context.structure;this._hugeWidth=u.isPrimaryPanel()&&u.isStructureBoard()}return this._hugeWidth},_getPanelId:function(){if(this._panelId===U)this._panelId=this.context.structure._panel.panelId;return this._panelId},_getIssueEditor:function(){if(this._issueEditor===U)this._issueEditor=this.context.structure._panel.cJ();return this._issueEditor}});B.registerColumnType(M,"handle");k.ad=M})();(function(){function U(){return 46}var C=namespace("almworks.structure.columns"),h=namespace("almworks.structure.api"),k=namespace("almworks.structure.ajsbridge"),e=namespace("almworks.util"),B=h.subClass("ActionsColumn",h.Column,{init:function(){this.suffix=k.TOKEN?"?atl_token="+k.TOKEN:""},getCellViewHtml:function(q){q=q.getIssueId();if(q>0){var M=k.localURL("/rest/api/1.0/issues/"+q+"/ActionsAndOperations"+this.suffix);return e.renderTemplate(
'<div class="issue_actions"><div class="action-dropdown aui-dd-parent"><a class="aui-dropdown-trigger issue-actions-trigger aui-dd-link standard icon-tools-small" id="actions_{id}" title="{sw.table.actions.title}" href="{actionsUrl}" hidefocus onClick="return false;"><span><em>Actions</em></span></a><div id="actions_{id}_drop" class="aui-dropdown gadget-dropdown standard hidden"></div></div></div>',{id:q,actionsUrl:M})}return ""},getWidth:U,getMinWidth:U,getDefaultWidth:U,isResizable:e.returnFalse,setWidth:e.returnTrue,shouldFlash:e.returnFalse});h.registerColumnType(B,"actions");C.aR=B})();(function(){function U(j){return j.id}function C(){T.status.url=P.localURL("rest/api/2/status");return T}function h(j){var w={statuses:[],percents:[]};j=j.getMetadata("status");if(!j)return w;for(var D=0;D<j.order.length;D++){var J=j.desc[j.order[D]];if(Q.hasOwnProperty(J.name)){var c=Q[J.name];w.statuses.push(J.id);w.percents.push(c)}}return w}function k(j){return u.isArray(j)?j[0]:j}var e=namespace("almworks.structure.columns"),B=namespace("almworks.structure.api"),q=namespace("almworks.structure"),M=namespace("almworks.structure.apputil"),u=namespace("almworks.util"),P=namespace(
"almworks.structure.ajsbridge"),G=q.$,Q={New:0,Open:0,Reopened:0,"To Do":0,"In Progress":50,Resolved:100,Done:100,Closed:100},T={status:{url:P.localURL("rest/api/2/status"),cacheable:true,extract:function(j){if(u.isArray(j))return{order:u.convertArray(j,U),desc:u.mapArray(j,U)};return{order:[],desc:{}}},timeout:1E4}},A=B.subClass("ProgressColumn",B.Column,{init:function(){function j(){return J.weightBy==="field"?":field:"+J.weightByField:":"+J.weightBy+":o"}function w(c){J.resolvedComplete&&c.push("jira:raw:resolution");return J.resolvedComplete?":1":":0"}function D(c){var p=":";if(J.statuses)for(var g=0;g<J.statuses.length;++g)if(J.percents[g]!==null){if(p.length>1)p+="v";p+=J.statuses[g]+"x"+J.percents[g]}c.push("jira:raw:status");return p}var J=this.spec.params;this.additionalFields=[];if(!J||G.inArray(J.basedOn,["status","resolution","percentfield","timetracking",""])<0){J=this.spec.params={};J.basedOn="timetracking";J.resolvedComplete=true;J.includeSelf=true}if(J&&J.basedOn)this.dataField=J.basedOn==="timetracking"?"structure:progress:timetracking"+w(this.additionalFields)+(J.includeSelf?":1":":0"):J.basedOn==="resolution"?"structure:progress:resolution"+j(
this.additionalFields):J.basedOn==="status"?"structure:progress:status"+D(this.additionalFields)+w(this.additionalFields)+j(this.additionalFields)+(J.includeSelf?":1":":0"):J.basedOn==="percentfield"?"structure:progress:percentfield:"+J.percentField+w(this.additionalFields)+j(this.additionalFields):null},getDefaultName:u.returnConst(u.text("sw.column.progress.name")),getRequiredFields:function(){return u.prependArray(this.dataField,this.additionalFields)},getCellViewHtml:function(j){j=this.dataField&&j.getFieldValue(this.dataField);if(!j)return '<div class="celldiv"></div>';j=u.toIntSafe(j,0)+"%";if(this.spec.params&&this.spec.params.displayPercents)return u.renderTemplate('<div class="celldiv" title="{s.w.progress.title,percent}"><div class="grad"></div><span class="value">{percent}</span></div>',{percent:j});return u.renderTemplate('<div class="celldiv" title="{s.w.progress.title,percent}"><div class="simpleProgress"><div style="width:{percent}"></div></div></div>',{percent:j})},isAutoSizeAllowed:function(){return! !(this.spec.params&&this.spec.params.displayPercents)},canShrinkWhenNoSpace:u.returnTrue,shouldFlash:function(j){if(j[this.dataField])return true;for(var w=0;w<
this.additionalFields.length;++w)if(j[this.additionalFields[w]])return true;return false}}),t=B.subClass("ProgressColumnConfigurator",B.ColumnConfigurator,{init:function(){this.spec.key="progress"},getGroupKey:u.returnConst("progress"),getColumnTypeName:u.returnConst(u.text("sw.column.progress.name")),getOptions:function(){var j={configurator:this};return[new l(j),new d(j),new s(j),new z(j),new r(j),new b(j),new a(j),new I(j),new R(j),new i(j)]}});q=B.subClass("HeaderOption",B.ColumnOption,{createLabel:function(j){G("<div></div>").text(this.title||"").addClass("st-col-opt-header").appendTo(j)}});var d=B.subClass("ProgressIssueHeaderOption",q,{title:u.text("sw.column.progress.hdr.issue")}),a=B.subClass("ProgressSumHeaderOption",q,{title:u.text("sw.column.progress.hdr.sum"),notify:function(){return this.spec.params&&this.spec.params.basedOn&&this.spec.params.basedOn!==""}}),s=B.subClass("ProgressBaseOption",B.ColumnOption,{title:u.text("sw.column.progress.opt.base"),init:function(){this.select$=null},jiraHasCustomFields:function(){for(var j=this.context.jira.getAllIssueFields(),w=0,D;D=j[w++];)if(e.isNumericCustomField(D))return true;return false},createInput:function(j){var w=this,
D='<option value="timetracking">{sw.column.progress.opt.base.timetracking}</option><option value="resolution">{sw.column.progress.opt.base.resolution}</option>';if(this.context.getMetadata("status"))D+='<option value="status">{sw.column.progress.opt.base.status}</option>';if(this.spec.params&&this.spec.params.basedOn==="")D='<option value="">{sw.column.progress.opt.base.choose}</option>'+D;if(this.jiraHasCustomFields())D+='<option value="percentfield">{sw.column.progress.opt.base.percentfield}</option>';this.select$=j.append('<select class="select">'+u.renderTemplate(D)+"</select>").find("select");this.select$.on("change",function(){var J=k(w.select$.val());if(J!==""){w.select$.find('option[value=""]').remove();w.spec.params=w.spec.params||{};if(w.spec.params.basedOn!==J){w.spec.params.basedOn=J;j.trigger("notify")}}});P.createAjsSingleSelect(this.select$)},notify:function(j){var w=this.spec.params&&this.spec.params.basedOn;this.select$.trigger("ajs:update",w).val(w);if(w===""&&j==="show"){var D=this.select$;window.setTimeout(function(){D.trigger("ajs:expand")},10)}return true}}),z=B.subClass("ProgressPercentFieldOption",B.ColumnOption,{title:u.text(
"sw.column.progress.opt.percent"),init:function(){this.select$=null},createInput:function(j){for(var w=this,D=this.context.jira.getAllIssueFields(),J="",c=0,p;p=D[c++];)if(e.isNumericCustomField(p)){this.firstChoice=p.id;J+=u.renderTemplate('<option value="{id}">{sw.column.progress.opt.percent.field,name}</option>',p)}this.select$=j.append('<select class="select">'+J+"</select>").find("select");this.select$.on("change",function(){var g=k(w.select$.val());w.spec.params=w.spec.params||{};if(w.spec.params.percentField!==g){w.spec.params.percentField=g;j.trigger("notify")}});P.createAjsSingleSelect(this.select$)},makesSense:function(){return this.spec.params&&G.inArray(this.spec.params.basedOn,["percentfield"])>=0},notify:function(){if(this.makesSense()){if(!this.spec.params.percentField&&this.firstChoice)this.spec.params.percentField=this.firstChoice;var j=this.spec.params.percentField||"";this.select$.trigger("ajs:update",j).val(j);return true}return false}}),I=B.subClass("ProgressTimeWeightOption",B.ColumnOption,{title:u.text("sw.column.progress.opt.weight"),createInput:function(j){G("<div></div>").addClass("st-col-progress-faketimeweight").text(u.text(
"sw.column.progress.opt.weight.time")).appendTo(j)},makesSense:function(){return this.spec.params&&G.inArray(this.spec.params.basedOn,["timetracking"])>=0},notify:function(){return this.makesSense()}}),R=B.subClass("ProgressWeightFieldOption",B.ColumnOption,{title:u.text("sw.column.progress.opt.weight"),init:function(){this.select$=null},createInput:function(j){for(var w=this,D=this.context.jira.getAllIssueFields(),J=u.renderTemplate('<option value="equal">{sw.column.progress.opt.weight.equal}</option><option value="time">{sw.column.progress.opt.weight.time}</option>'),c=0,p;p=D[c++];)if(e.isNumericCustomField(p))J+=u.renderTemplate('<option value="field|{id}">{sw.column.progress.opt.weight.field,name}</option>',p);this.select$=j.append('<select class="select">'+J+"</select>").find("select");this.select$.on("change",function(){var g=k(w.select$.val()).split("|"),n=false;w.spec.params=w.spec.params||{};n|=w.spec.params.weightBy!==g[0];w.spec.params.weightBy=g[0];if(g[0]==="field"){n|=w.spec.params.weightByField!==g[1];w.spec.params.weightByField=g[1]}n&&j.trigger("notify")});P.createAjsSingleSelect(this.select$)},makesSense:function(){return this.spec.params&&G.inArray(
this.spec.params.basedOn,["status","resolution","percentfield"])>=0},notify:function(){if(this.makesSense()){var j=this.spec.params.weightBy==="field"?"field|"+this.spec.params.weightByField:this.spec.params.weightBy||"equal";this.select$.trigger("ajs:update",j).val(j);return true}return false}}),b=B.subClass("ProgressResolvedCompleteOption",B.ColumnOption,{title:u.text(""),init:function(){this.input$=null},createInput:function(j){this.input$=j.append(u.renderTemplate('<div class="checkbox"><label><input type="checkbox">&nbsp;{sw.column.progress.opt.resolved}</label></div><div class="description">{sw.column.progress.opt.resolved.desc}</div>')).find("input");var w=this;this.input$.on("change",function(){if(!G(this).is(":disabled")){var D=G(this).is(":checked");if(D!== ! !w.spec.params.resolvedComplete){w.spec.params.resolvedComplete=D;j.trigger("notify")}}})},makesSense:function(){return this.spec.params&&G.inArray(this.spec.params.basedOn,["status","timetracking","percentfield","resolution"])>=0},notify:function(){if(this.makesSense()){this.input$.prop("checked",this.spec.params.basedOn==="resolution"?true: ! !this.spec.params.resolvedComplete);this.input$.attr("disabled",
this.spec.params.basedOn==="resolution");return true}return false}}),i=B.subClass("ProgressIncludeSelfOption",B.ColumnOption,{title:u.text(""),init:function(){this.input$=null},createInput:function(j){this.input$=j.append(u.renderTemplate('<div class="checkbox"><label><input type="checkbox">&nbsp;{sw.column.progress.opt.includeself}</label></div>')).find("input");var w=this;this.input$.on("change",function(){var D= !G(this).is(":checked");if(D!== ! !w.spec.params.includeSelf){w.spec.params.includeSelf=D;j.trigger("notify")}})},makesSense:function(){return this.spec.params&&G.inArray(this.spec.params.basedOn,["status","timetracking"])>=0},notify:function(){if(this.makesSense()){this.input$.prop("checked",!this.spec.params.includeSelf);return true}return false}}),r=B.subClass("ProgressStatusHistogramOption",B.ColumnOption,{title:u.text("sw.column.progress.opt.statushist"),init:function(){this.tableSignature=this.adder$=this.div$=this.table$=null},calcSignature:function(){if(this.spec.params&&this.spec.params.statuses&&this.spec.params.percents)return this.spec.params.statuses.join(",")+";"+this.spec.params.percents.join(",");return ""},hi:function(){var j=this.spec.params;if(!(
j.statuses&&j.percents)){var w=h(this.context);j.statuses=w.statuses;j.percents=w.percents}},redrawTable:function(){var j=this.context.getMetadata("status"),w=this.spec.params;if(j){for(var D=[],J=0;J<w.statuses.length;++J)j.desc[w.statuses[J]]&&D.push([w.statuses[J],w.percents[J]]);D.sort(function(n,m){return n[1]-m[1]});var c=this,p=function(n,m){var F=u.renderTemplate('<div class="st-sth-row"><img src="{status.iconUrl}" title="{status.description}"><div class="st-sth-name" title="{status.description}"><span class="grad"></span>{status.name}</div><a class="st-tb" title="{sw.column.progress.opt.statushist.rm.hint}"><div class="st-tbi" style="background-position: -176px -96px;"></div></a><div class="st-sth-input"><span>%</span><input type="text" value="{percent}"></div></div>',{status:j.desc[n],percent:""+m});F=G(u.renderTemplate(F)).addClass("st-progress-status-"+n).data("status",n);M.initializeButton(F.find(".st-tb"));F.find("input").on("change",function(){var x=parseInt(G(this).val(),10),H=G.inArray(n,w.statuses);if(x>=0&&x<=100&&H>=0&&x!==w.percents[H]){w.percents[H]=x;c.redrawTable();c.div$.trigger("notify")}else if(G.trim(x)===""){w.percents[H]=0;c.redrawTable();
c.div$.trigger("notify")}else G(this).val(w.percents[H])});F.find("a").on("click",function(){var x=G.inArray(n,w.statuses);if(x>=0){w.statuses.splice(x,1);w.percents.splice(x,1)}c.redrawTable();c.gK();c.div$.trigger("notify");return false});return F};for(J=0;J<D.length;++J){var g=c.table$.find(".st-progress-status-"+D[J][0]);if(g.length)g.find("input").val(D[J][1]);else{g=p(D[J][0],D[J][1]);c.table$.append(g)}}c.table$.find(".st-sth-row").each(function(){var n=G(this).data("status");G.inArray(n,w.statuses)<0&&G(this).remove()})}this.tableSignature=this.calcSignature()},gK:function(){this.adder$.empty();var j=this.spec.params,w=this.context.getMetadata("status"),D="";if(w)for(var J=0;J<w.order.length;++J){var c=w.desc[w.order[J]];if(G.inArray(c.id,j.statuses)<0){if(D==="")D+=u.renderTemplate('<option value="">{sw.column.progress.opt.statushist.add}</option>');D+=u.renderTemplate('<option value="{id}">{name}</option>',c)}}if(D!==""){var p=this;w=G("<select>"+D+"</select>").appendTo(this.adder$).on("change",function(){var g=k(G(this).val());if(g!==""&&G.inArray(g,j.statuses)<0){j.statuses.push(g);j.percents.push(0);p.redrawTable();p.gK();g=p.adder$.parents(".st-col-edit:first");var n=
p.adder$,m=n.offsetParent();n=n.position();if(!(g.length===0||m.length===0)){for(var F=g.offsetParent();g[0]!==m[0]&&(F.length===0||F[0]!==m[0]);){var x=m.position();n.top+=x.top;n.left+=x.left;m=m.offsetParent()}if(g[0]!==m[0]){m=g.position();n.top-=m.top;n.left-=m.left}}m=n.top+p.adder$.height()-g.height();m>0&&g.scrollTop(g.scrollTop()+m+10);p.div$.trigger("notify")}});P.createAjsSingleSelect(w)}},createInput:function(j){this.div$=j;this.table$=G('<div class="st-col-progress-statushist"></div>').appendTo(j);this.adder$=G('<div class="st-col-progress-statushist-adder"></div>').appendTo(j)},makesSense:function(){return! !(this.spec.params&&G.inArray(this.spec.params.basedOn,["status"])>=0&&this.context.getMetadata("status"))},notify:function(){if(this.makesSense()){if(!this.tableSignature){this.hi();this.gK()}this.tableSignature!==this.calcSignature()&&this.redrawTable();return true}return false}}),l=B.subClass("ProgressDisplayPercentsOptions",B.ColumnOption,{title:u.text(""),init:function(){this.input$=null},createInput:function(j){this.input$=j.append(u.renderTemplate(
'<div class="checkbox"><label><input type="checkbox">&nbsp;{sw.column.progress.opt.displaypercents}</label></div>')).find("input");var w=this;this.input$.on("change",function(){var D=G(this).is(":checked");if(D!== ! !w.spec.params.displayPercents){w.spec.params.displayPercents=D;j.trigger("notify")}})},notify:function(){this.input$.prop("checked",this.spec.params.displayPercents);return true}});q=B.subClass("ProgressColumnType",B.ColumnType,{getPresetMetadataRequests:C,getConfigMetadataRequests:C,findCustomField:function(j,w){for(var D=j.jira.getAllIssueFields(),J=0,c;c=D[J++];)if(e.isNumericCustomField(c))if(w.test(c.name))return c;return null},createSwitchTypePreset:function(j){if(j.structure.isPrimaryPanel()){j=j.jira.getAllIssueFields();for(var w=null,D=null,J=null,c=null,p,g=0;p=j[g++];)if(e.isNumericCustomField(p))if(/\bpoints?/i.test(p.name))w=p.id;else if(/\bcomplet/i.test(p.name))c=p.id;else if(D===null)D=p.id;else if(J===null)J=p.id;return{key:"progress",params:{basedOn:"timetracking",resolvedComplete:true,includeSelf:true,weightBy:"equal",percentField:c||D,weightByField:w||J||D}}}return null},createAddColumnPresets:function(j){if(j.structure.isPrimaryPanel()){var w=
this.createSwitchTypePreset(j),D=[];D.push(G.extend(true,{},w,{presetName:u.text("sw.column.progress.preset.timetracking"),params:{basedOn:"timetracking",resolvedComplete:true,includeSelf:true}}));var J=this.findCustomField(j,/story point/i);j=h(j);var c=j.statuses.length>=2;J&&D.push(G.extend(true,{},w,{presetName:u.text("sw.column.progress.preset.storypoints",J.name),params:{basedOn:"resolution",resolvedComplete:true,weightBy:"field",weightByField:J.id}}));c&&D.push(G.extend(true,{},w,{presetName:u.text("sw.column.progress.preset.status"),params:{basedOn:"status",includeSelf:false,resolvedComplete:true,weightBy:"equal",statuses:j.statuses,percents:j.percents}}));c&&J&&D.push(G.extend(true,{},w,{presetName:u.text("sw.column.progress.preset.statuspoints",J.name),params:{basedOn:"status",resolvedComplete:true,includeSelf:false,weightBy:"field",weightByField:J.id,statuses:j.statuses,percents:j.percents}}));D.push(G.extend(true,{},w,{presetName:u.text("sw.column.progress.preset.custom"),shouldOpenConfigurator:true,params:{basedOn:""}}));return D}return[]},_isSpecValid:function(j,w){return j.structure.isPrimaryPanel()&&w&&w.key==="progress"},createConfigurator:function(j,w){
return this._isSpecValid(j,w)?new t({context:j,spec:w}):null},createColumn:function(j,w){return this._isSpecValid(j,w)?new A({context:j,spec:w}):null}});B.registerColumnType(new q,"progress");e.aS=A})();(function(){var U=namespace("almworks.structure.api"),C=namespace("almworks.structure"),h=namespace("almworks.util"),k=U.subClass("IssueIdColumn",U.Column,{getDefaultName:h.returnConst(h.text("sw.column.type.issueid")),getCellValueHtml:function(B){return ""+B.getIssueId()},isAutoSizeAllowed:h.returnTrue,canShrinkWhenNoSpace:h.returnTrue}),e=U.subClass("IssueIdConfigurator",U.ColumnConfigurator,{getGroupKey:h.returnConst("fields"),getColumnTypeName:h.returnConst(h.text("sw.column.type.issueid"))});h=U.subClass("IssueIdType",U.ColumnType,{createSwitchTypePreset:function(){return C.modes.STRUCTURE_DEBUG?{key:"issueid"}:null},createAddColumnPresets:function(){return C.modes.STRUCTURE_DEBUG?[{key:"issueid"}]:[]},createConfigurator:function(B,q){return new e({context:B,spec:q})},createColumn:function(B,q){return q.key==="issueid"?new k({context:B,spec:q}):null}});U.registerColumnType(new h,"issueid")})();(function(){function U(I){for(var R={},b=0,i=I.length;b<i;b++){var r=I[b];if(r&&
r.id&&r.name&&r.iconUrl)R[r.id]=M.renderTemplate('<img src="{iconUrl}" alt="{name}" title="{name}">',r)}return R}function C(I){if(I&&I.key===G){var R=I.params&&I.params.fields,b;if(M.isArray(R)){for(b=0;b<R.length;b++)if(!A[R[b]])return I;I=B.copySpec(I);I.key=P;if(I.name)I.name=M.renderTemplate(I.name)}}return I}function h(I,R){if(R&&(R.key===P||R.key===G)&&R.params&&M.isArray(R.params.fields)){var b=R.params.fields,i;for(i=0;i<b.length;i++)if(!I.jira.getIssueFieldById(b[i]))return false;if(R.key===P)for(i=0;i<b.length;i++)if(!T[b[i]])return false;return true}return false}function k(I,R,b,i,r){for(var l=0;l<i.length;l++)if(!I.jira.getIssueFieldById(i[l]))return;I={key:P,params:{fields:i}};if(R)I.name=M.text(R);if(b)I.presetName=M.text(b);r.push(I)}var e=namespace("almworks.structure.$"),B=namespace("almworks.structure.columns"),q=namespace("almworks.structure.api"),M=namespace("almworks.util"),u=namespace("almworks.structure.ajsbridge"),P="icons",G="joined",Q=["project","issuetype","priority","status","reporter","assignee"],T=M.flipSet(Q),A=M.flipSet(["issuetype","priority"]),t={},d=q.subClass("IconsColumn",q.Column,{init:function(){this.fields=this.spec.params&&
this.spec.params.fields;this.fieldSpecs=[];this.metaReqs={};if(this.fields)for(var I=0,R=this.fields.length;I<R;I++){var b=this.fields[I];if(t[b]){this.fieldSpecs.push("jira:raw:"+b);this.metaReqs[b]={url:u.localURL("/rest/api/2/"+b),extract:U,cacheable:true}}else this.fieldSpecs.push("jira:icon:"+b)}},getCellValueHtml:function(I){var R='<span class="s-icons">';if(this.fields&&this.fieldSpecs.length)for(var b=0;b<this.fields.length;b++){var i=this.fields[b],r=I.getFieldValue(this.fieldSpecs[b]);if(t[i]){i=this.context.getMetadata(i);r=r&&i&&i[r]}R+=r||""}R+="</span>";return R},getRequiredFields:function(){return this.fieldSpecs},getDefaultName:M.returnConst(M.text("sw.column.type.icons")),isAutoSizeAllowed:M.returnFalse,getDefaultWidth:function(){return(this.fields&&this.fields.length||6)*16+32},canShrinkWhenNoSpace:M.returnTrue,getMetadataRequests:function(){return this.metaReqs}}),a=q.subClass("IconsConfigurator",q.ColumnConfigurator,{init:function(){this.spec.key=P},getGroupKey:M.returnConst("icons"),getDefaultColumnName:M.returnConst(M.text("sw.column.type.icons")),getColumnTypeName:M.returnConst(M.text("sw.column.type.icons")),getOptions:function(){return[new s({configurator:
this})]}}),s=q.subClass("FieldsOption",q.ColumnOption,{title:M.text("sw.column.icons.opt.fields"),init:function(){this.div$=null},createInput:function(I){function R(){b.fields=[];I.find("input:checked").each(function(){b.fields.push(e(this).attr("data-field"))});I.trigger("notify")}var b=this.spec.params,i=M.addAll([],b.fields),r,l,j="";for(r=0;l=Q[r++];)M.indexOf(i,l)<0&&i.push(l);j+='<div class="checkbox">';for(r=0;l=i[r++];)if(l=this.context.jira.getIssueFieldById(l))j+=M.renderTemplate('<div class="st-col-drag"><div class="st-col-drag-handle" title="{sw.column.icons.opt.fields.draghint}"><div class="st-col-drag-icon"></div></div><label><input type="checkbox" data-field="{id}"> {name}</label></div>',l);j+="</div>";e(j).appendTo(I).on("change","input",R).sortable({axis:"y",update:R});this.div$=I},notify:function(){var I=M.flipSet(this.spec.params.fields);this.div$.find("input").each(function(){var R=e(this);R.prop("checked",! !I[R.attr("data-field")])});return true},isInputValid:function(){return! !(this.spec.params.fields&&this.spec.params.fields.length)}}),z=q.subClass("IconsColumnType",q.ColumnType,{createSwitchTypePreset:function(){return{key:P,params:{}}},
createAddColumnPresets:function(I){var R=[];k(I,"s.w.column.tp.label",null,["issuetype","priority"],R);k(I,"s.w.column.stp.label",null,["status","issuetype","priority"],R);k(I,null,"s.w.column.all-icons.label",M.addAll([],Q),R);return R},createConfigurator:function(I,R){R=C(R);return R.key===G?new B.JoinedFieldsConfigurator({context:I,spec:R}):new a({context:I,spec:R})},createColumn:function(I,R){R=C(R);if(h(I,R)){if(R.key===P)return new d({context:I,spec:R});if(R.key===G)return new B.fU({context:I,spec:R})}return null}});q.registerColumnType(new z,[P,G]);B.IconsColumn=d})(window);(function(){function U(A){A=A.params;var t=e.text("sw.column.worklog.period.+"+A.period+"+.colname");return A.sum?e.text("sw.column.opt.aggr.sum.colname",t):t}var C=namespace("almworks.structure"),h=namespace("almworks.structure.ajsbridge"),k=namespace("almworks.structure.columns"),e=namespace("almworks.util"),B=namespace("almworks.structure.api"),q=C.$,M=["today","this_week","this_month","this_year","yesterday","last_week","last_month","last_year"],u=B.subClass("PeriodOption",B.ColumnOption,{title:e.text("sw.column.worklog.opt.period"),init:function(){this.select$=null},createInput:function(A){for(var t=
this.spec.params,d="",a=0;a<M.length;a++){var s=M[a];d+=e.renderTemplate('<option value="{id}">'+e.text("sw.column.worklog.period.+"+s+"+.name")+"</option>",{id:s})}this.select$=A.append('<select class="select">'+d+'</select><div class="description">'+e.text("sw.column.worklog.timezone.desc",t.timeZone)+"</div>").find("select");this.select$.val(t.period);this.select$.on("change",function(){var z=q(this).val();if(e.isArray(z))z=z[0];t.period=z;A.trigger("notify")});h.createAjsSingleSelect(this.select$)},notify:function(){this.select$.val(this.spec.params.period);return true},isInputValid:function(){return! !this.spec.params.period}}),P=B.subClass("SumOption",B.ColumnOption,{init:function(){this.checkbox$=null},createInput:function(A){this.checkbox$=A.append(e.renderTemplate('<div class="checkbox"><label><input type="checkbox">{sw.column.opt.aggr.sum.title}</label></div>')).find("input");var t=this.spec.params;this.checkbox$.on("change",function(){t.sum=q(this).prop("checked");A.trigger("notify")})},notify:function(){this.checkbox$.prop("checked",this.spec.params.sum);return true}}),G=B.subClass("WorklogColumn",B.Column,{getRequiredFields:function(){var A=this.spec.params;if(!
A.timeZone)return[];var t=[],d=this.context.getMetadata("offset");if(typeof d!=="number")return[];var a=new Date;a=new Date(a.getTime()+e.getTimezoneOffset()-d);a.setHours(0,0,0,0);d=a.getTime();this.field="structure:worklog:"+A.period+":"+A.sum+":"+A.timeZone+":"+d;t.push(this.field);if(A.sum){this.ownField="structure:worklog:"+A.period+":false:"+A.timeZone+":"+d;t.push(this.ownField);t.push("structure:childcount")}return t},getCellViewHtml:function(A){var t=A.getFieldValue(this.field)||"",d=null;if(this.ownField&&e.toIntSafe(A.getFieldValue("structure:childcount"))>0)if((d=A.getFieldValue(this.ownField)||"")&&t&&q.trim(d)===q.trim(t))d=null;A='<div class="celldiv"><div class="grad"></div>';A+=d?e.renderTemplate('<span class="value" title="{sw.column.opt.aggr.own-hint}">'):'<span class="value">';if(t)A+=t;if(d)A+='<span class="s-aggr-own">'+d+"</span>";return A+"</span></div>"},getDefaultName:function(){return U(this.spec)},getMetadataRequests:function(){var A=this.spec.params.timeZone;if(!A)return null;return{offset:{cacheable:true,url:h.localURL(C.ajax.RESOURCES.CONFIG_TIMEZONE+"?name="+A),extract:function(t){return t.offset}}}},isAutoSizeAllowed:e.returnTrue,
canShrinkWhenNoSpace:e.returnTrue}),Q=B.subClass("WorklogConfigurator",B.ColumnConfigurator,{init:function(){this.spec.key="worklog";this.spec.params||(this.spec.params={})},getColumnTypeName:e.returnConst(e.text("sw.column.worklog.name")),getDefaultColumnName:function(){return U(this.spec)},getGroupKey:function(){return this.spec.params.sum?"totals":"fields"},getOptions:function(){return[new u({configurator:this}),new P({configurator:this})]}}),T=B.subClass("WorklogColumnType",B.ColumnType,{createConfigurator:function(A,t){return t.key==="worklog"?new Q({context:A,spec:t}):null},createColumn:function(A,t){return t.key==="worklog"?new G({context:A,spec:t}):null},createAddColumnPresets:function(A){A=A.getMetadata("timeZone");if(!A)return[];var t=[],d=M[0];t.push({key:"worklog",shouldOpenConfigurator:true,presetName:e.text("sw.column.worklog.preset.default"),params:{sum:false,period:d,timeZone:A.name}});t.push({key:"worklog",shouldOpenConfigurator:true,presetName:e.text("sw.column.worklog.preset.sum"),params:{sum:true,period:d,timeZone:A.name}});return t},createSwitchTypePreset:function(A){A=A.getMetadata("timeZone");if(!A)return null;return{key:"worklog",presetName:e.text(
"sw.column.worklog.preset.sum"),params:{sum:true,period:M[0],timeZone:A.name}}},getPresetMetadataRequests:function(){return{timeZone:{cacheable:true,url:h.localURL(C.ajax.RESOURCES.CONFIG_TIMEZONE)}}}});B.registerColumnType(new T,"worklog");k.WorklogColumn=G})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.structure.appevents"),h=namespace("almworks.util"),k=namespace("almworks.structure.apputil"),e=U.$;U.aI=function(B){function q(D,J,c){return function(p){function g(){p.toggleClass(D,! !c())}d.addListener(new h.Life,J,g);g()}}function M(D,J){if(!I){I={};d.addListener(new h.Life,C.ly,function(c,p,g){if(c=I[c])if(!(g.panel&&g.panel!==B.aw.getFocusedPanel())){c.toggleClass("s-disabled",!p);c.toggleClass("toggled",! !g.toggled)}})}I[D]=J;d.fireEvent(C.mt,D)}function u(D,J,c){for(var p=false,g=1,n=J[0],m=J[1];n;n=m,m=J[++g])if(n.action){var F="";F+='<div id="s-cp-btn-'+n.action+'" class="st-tb';if(!p){F+=" first";p=true}if(p&&(!m|| !m.action))F+=" last";if(n.extraclass)F+=" "+n.extraclass;var x=h.text(n.tipkey),H=k.actionFormattedShortcut(n.action,n.showShortcut);if(H)x+=" ("+H+")";F+='" title="'+x+'"><div class="'+(n.extraIcon?"st-tbi s-extra":"st-tbi")+
'" style="background-position: '+n.pos+'"></div>';if(n.textkey)F+='<div class="st-tbt">'+h.text(n.textkey)+"</div>";F+="</div>";F=e(F);F.data("action",n.action);if(n.subscribe==="action")M(n.action,F);else typeof n.subscribe==="function"&&n.subscribe(F);F.appendTo(D);k.initializeButton(F,c?n.action:null)}else p=false}function P(D){return Math.max(D,22)}function G(){var D=t.isConfigSet()&&t.getConfig().getParam(s.aU);D?i.removeClass("st-tb-h"):i.addClass("st-tb-h");i.find("#st-tb-tg .st-tb").attr("title",h.text(D?"sw.widget.hide.toolbar":"sw.widget.show.toolbar"));r.is(":animated")||k.bU(D,r,B,P,false)}function Q(D){if(!D)return false;var J=e(D.currentTarget?D.currentTarget:D.target);if(J.is(".s-disabled"))return false;J=J.data("action");var c=z.getFocusedPanel();(c?c.bD():d).fireEvent(C.ACTION,J,D);return D&&D.consumed?false:true}function T(){if(!j){j=true;u(l,[{action:"_poll",pos:"0px 0px",tipkey:"",textkey:"x.poll"},{action:"_uploadTree",pos:"0px 0px",tipkey:"",textkey:"x.uploadTree"},{action:"_toggleDebugMode",pos:"0px 0px",tipkey:"",textkey:"x.debugMode",subscribe:function(D){function J(){U.modes.DEVMODE?D.addClass("toggled"):D.removeClass("toggled")}J();a.register(
"_toggleDebugMode",function(){U.modes.DEVMODE= !U.modes.DEVMODE;J()})}},{action:"_toggleBlockAjax",pos:"0px 0px",tipkey:"",textkey:"x.blockAjax",subscribe:function(D){function J(){U.modes.BLOCK_AJAX?D.addClass("toggled"):D.removeClass("toggled")}J();a.register("_toggleBlockAjax",function(){U.modes.BLOCK_AJAX= !U.modes.BLOCK_AJAX;J();U.modes.BLOCK_AJAX||B.ajax.gH()})}}])}}var A=B.div$,t=B.master.getTableConfig(),d=B.eventBus,a=B.globalActions,s=U.tableConfig.params,z=h.nn(B.aw),I=null,R= ! !B.config.anchorIssue,b=[{action:R?"toggleFixAnchor":"toggleFixSelected",pos:"-144px -144px",showShortcut:"toggleFixCombo",tipkey:R?"s.w.act.fix-on-anchor.tooltip":"s.w.act.fix-on-selected.tooltip",extraclass:R?"s-act-fix-anchor":"",subscribe:h.seq(q("toggled",C.cq,function(){var D=B.master.ao().cb();return R?D===B.config.anchorIssue: ! !D}),function(D){k.jm(B.ir.visibleCell,D)})},{action:"toggleHistory",pos:"-80px -112px",tipkey:"s.w.act.history.tooltip",extraclass:"s-gh-hide",subscribe:function(D){k.pipeToggled(B.ir.visibleCell,D)}},{},{action:"toggleSearch",showShortcut:"focusSearch",pos:"-160px -112px",tipkey:"sw.widget.act.addpopup",textkey:"sw.widget.act.btn.addpopup",extraclass:"s-gh-hide",
subscribe:function(D){k.pipeToggled(B.bF.visibleCell,D)}},{},{action:"expandAll",pos:"-48px -16px",tipkey:"sw.widget.act.expandall"},{action:"collapseAll",pos:"-112px -16px",tipkey:"sw.widget.act.collapseall"},{},{action:"moveUp",pos:"1px -48px",tipkey:"sw.widget.act.moveup",extraclass:"s-ro-hide",subscribe:"action"},{action:"moveDown",pos:"-64px -48px",tipkey:"sw.widget.act.movedown",extraclass:"s-ro-hide",subscribe:"action"},{action:"levelUp",pos:"-240px -48px",tipkey:"sw.widget.act.levelup",extraclass:"s-ro-hide",subscribe:"action"},{action:"levelDown",pos:"-208px -48px",tipkey:"sw.widget.act.leveldown",extraclass:"s-ro-hide",subscribe:"action"},{},{action:"copy",pos:"-176px -128px",tipkey:"sw.widget.act.copy",extraclass:"s-ro-show",subscribe:"action"},{},{action:"cut",pos:"-144px -128px",tipkey:"sw.widget.act.cut",extraclass:"s-ro-hide",subscribe:"action"},{action:"paste",pos:"-160px -128px",tipkey:"sw.widget.act.paste",extraclass:"s-ro-hide",subscribe:"action"},{action:"deleteSubtree",pos:"-80px -128px",tipkey:"s.w.act.delete",extraclass:"s-ro-hide",subscribe:"action"},{},{action:"createSiblingBelow",pos:"-16px -128px",tipkey:"sw.widget.act.create-sibling",textkey:
"sw.widget.act.btn.sibling",extraclass:"s-ro-hide s-nocreate-hide",subscribe:"action"},{action:"createChild",pos:"-16px -128px",tipkey:"sw.widget.act.create-child",textkey:"sw.widget.act.btn.child",extraclass:"s-ro-hide s-nocreate-hide",subscribe:"action"},{action:"toggleEditMode",pos:"-64px -112px",tipkey:"sw.widget.act.edit",textkey:"sw.widget.act.btn.edit",extraclass:"s-ro-hide s-gh-hide",subscribe:"action"},{},{action:"toggleHideClosed",pos:"-32px 0",tipkey:"sw.widget.act.hideClosed",textkey:"sw.widget.act.btn.hideClosed",extraclass:"s-gh-hide",subscribe:q("toggled",C.bC,function(){return t.getConfig().getParam(s.bh)==="hide"})},{},{action:"bulkChange",pos:"-15px -15px",tipkey:"s.w.act.bulk-change.tooltip",extraclass:"s-bulk-show",subscribe:"action",extraIcon:true},{action:"openPrintable",pos:"-160px -96px",tipkey:"s.w.act.printable.tooltip",extraclass:"s-gh-hide"},{action:"openExcel",pos:"0px -15px",tipkey:"s.w.act.excel.tooltip",extraclass:"s-gh-hide",extraIcon:true},{action:"togglePollAlways",pos:"-64px -80px",tipkey:"s.w.act.continuous.poll",extraclass:"s-extra-action",subscribe:function(D){k.pipeToggled(B.poller.iQ,D)}}],i=e("div.mousePanel",A),r=e("div#st-tgp",i),l=e(
"<div></div>").appendTo(r);r.append('<div class="br"></div>');(function(D){var J=e('<div id="st-tb-tg"></div>'),c=e('<div class="st-tb first last"><div class="st-tbi"></div></div>').appendTo(J);k.initializeButton(c);c.data("action","toggleToolbar");J.appendTo(D)})(i);G();d.addListener(new h.Life,C.bC,G);a.register("toggleToolbar",function(){var D= !(t.isConfigSet()&&t.getConfig().getParam(s.aU));k.bU(D,r,B,P,true);t.updateParam(s.aU,D)});u(l,b);l.delegate("div.st-tb","click",Q);e("#st-tb-tg .st-tb").click(Q);h.hoverToClass(e("div.head",A),i);a.register("debugActions",function(){U.modes.DEVMODE=true;T()});var j=false;U.modes.DEVMODE&&T();var w="dim";a.register("toggleHideClosed",function(){var D=t.getConfig().getParam(s.bh);if(D==="hide")t.updateParam(s.bh,w);else{w=D;t.updateParam(s.bh,"hide")}});a.register("togglePollAlways",function(){var D=B.poller.iQ;D.setValue(!D.value())});h.extend(this,{installButtons:u})}})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.structure.appevents"),h=namespace("almworks.util"),k=U.$;U.fl=function(e){function B(c){var p=b[c];if(!p){p=new R(c);b[c]=p}return p}function q(){a.postEvent(C.bf,s)}function M(c,p){var g=b[c];if(!
g)return null;return g.getValue(p)}function u(){var c={};h.extend(c,h.flipSet(z));e.jiraConfig.ke()!==false&&h.extend(c,h.flipSet(I));h.eachOwn(r,function(g){h.extend(c,h.flipSet(this[g]))});var p=h.keysOf(c);p.sort();return p}function P(c){if(c=b[c]){c.bq=false;c.fT++}}function G(c){c=b[c];if(!c)return false;c.dataOutdated=true;c.invalidateAllFields();return true}function Q(c,p){var g=b[c];if(g){g.gG(p);g.hV(p)}return p}function T(c,p){var g=b[c];g&&g.deleteValue(p);return p}function A(){var c=false,p=h.flipSet(i),g;h.eachOwn(w,function(m){if(p[m]){h.eachOwn(b,Q,m);c=true}else{h.eachOwn(b,T,m);if(g)g.push(m);else g=[m]}});if(g&&g.length)for(var n=0;n<g.length;n++)delete w[g[n]];return c}function t(c,p){var g=b[c];if(g){g.setValue(p,"");g.hV(p)}return p}function d(c){if(!h.isArray(c)|| !c.length)return false;var p=h.flipSet(i),g=false;h.eachOwn(w,function(n){for(var m=p[n],F=0,x=c[0];x;x=c[++F])if(x=b[x])if(m){x.gG(n);g=true}else x.deleteValue(n)});return g}var a=e.eventBus,s=this,z=["jira:raw:summary","jira:permission:edit"],I=["jira:raw:project","jira:raw:issuetype"],R=function(){function c(p){this.issueId=p;this.bO={};this.aB={};this.cw=this.du=null;this.dataOutdated=this.bq=
this.loadingFailed=this.loadingNow=this.dirty=false;this.fT=0;this.fh=null}h.extend(c.prototype,{getValue:function(p){if(this.dirty){var g=this.du;g=g&&g[p];if(typeof g==="string")return g}return this.bO[p]},eS:function(p){h.assert(h.tail(p,"jira:raw:"),p);var g=this.aB[p];if(g)return g;g=this.getValue(p);if(!g)return g;g=h.htmlEscape(g);return this.aB[p]=g},setValue:function(p,g,n){var m=this.bO,F=m[p],x=typeof g==="string";if(x){var H=this.cw;if(H&&H[p])H[p]=false}if(n&&x&&typeof F==="string"&&F!==g){F=this.fh;if(!F)F=this.fh={};F[p]=F[p]<0?0:n}m[p]=g;g=this.aB;if(p in g)g[p]=null;this.fT++},setServerValue:function(p,g,n){if(p){if(typeof g!=="string")g="";if(!h.tail(p,"jira:raw:")){g=g.replace(/&nbsp;/g," ");g=k.trim(g)}this.setValue(p,g,n)}},jC:function(p,g){(this.du||(this.du={}))[p]=g;var n=this.aB;if(p in n)n[p]=null;this.dirty=true;this.fT++},jE:function(p,g){this.bO[p]=g;var n=this.aB;if(p in n)n[p]=null;this.fT++},deleteValue:function(p){if(this.bO.hasOwnProperty(p)||this.aB.hasOwnProperty(p)){delete this.bO[p];delete this.aB[p]}},shouldRender:function(){return this.bO["jira:raw:summary"]||this.loadingFailed},hz:function(){var p=this.bO["jira:raw:resolution"];return p&&
p!=="0"},hh:function(){return this.bO["jira:permission:edit"]==="1"},gY:function(){var p=this.bO["jira:permission:edit"];return p&&p!=="1"},isOutdated:function(){return this.dataOutdated},fd:function(){var p=this.fh;if(!p)return null;var g=(new Date).getTime(),n={},m=false,F=false,x;for(x in p)if(p.hasOwnProperty(x)){var H=p[x];if(H<0)F=true;else{p[x]=0;if(g<H)n[x]=m=true}}if(!F)this.fh=null;return m?n:null},gG:function(p){var g=this.cw;if(!g)g=this.cw={};g[p]=true;this.bq=false},invalidateAllFields:function(){var p=this.bO,g=this,n;h.eachOwn(p,function(m){if(typeof p[m]==="string"){if(!n){if(!g.cw)g.cw={};n=g.cw}n[m]=true}});if(n)this.bq=false},hj:function(p){var g=this.cw;return g&&g[p]},hV:function(p){var g=this.fh;if(!g)g=this.fh={};g[p]= -1},iW:function(){return! !this.dirty},nA:function(){return this.externalDirty},isLoadingFailed:function(){return this.loadingFailed},toString:function(){return "{"+this.issueId+"}"}});return c}(),b={},i=[],r={},l={},j=0,w={},D=false,J={};this[C.UPLOAD_FINISHED]=function(c,p){var g=d(c),n=d(p);if(g||n)q()};this[C.STRUCTURE_CHANGED]=function(){A()&&q()};this[C.kl]=function(){var c=false,p= ! !e.ir.lg.value();if(p!==D){D=p;var g=h.flipSet(i),n;
h.eachOwn(w,function(F){if(g[F]){h.eachOwn(b,p?t:Q,F);c=true}else{h.eachOwn(b,T,F);if(n)n.push(F);else n=[F]}});if(n&&n.length)for(var m=0;m<n.length;m++)delete w[n[m]];c&&p&&a.fireEvent(C.aX,h.numericKeys(b),s)}};a.addListener(new h.Life,this);h.extend(this,{cI:function(c){return b[c]},requireIssueData:B,fb:function(c,p){l[c]=p;var g=false;if(p)for(var n in p)if(p.hasOwnProperty(n)&&p[n])if(!B(n).bq){g=true;break}g&&q()},eD:function(c){h.assert(c<0);B(c).setValue("jira:raw:summary","")},kJ:function(c,p){h.assert(c<0);var g=b[c];if(g){var n=e.jiraConfig.gZ(),m,F,x,H;if(p.sample&&p.mode==="clone"){var ha=b[p.sample];if(ha){m=0;for(F=n.length;m<F;m++){x=n[m];(H=ha.getValue(x))&&g.jE(x,H);x="jira:raw:"+x;(H=ha.getValue(x))&&g.jE(x,H)}}}else{m=0;for(F=n.length;m<F;m++){x=n[m];g.jE(x,"");x="jira:raw:"+x;if(x==="jira:raw:project"&&p.pid)g.jE(x,""+p.pid);else x==="jira:raw:issuetype"&&p.issuetype?g.jE(x,p.issuetype):g.jE(x,"")}}}},fz:function(c,p){h.assert(c<0);h.assert(p>0);var g=b[c];if(g){var n=B(p);n.setValue("jira:raw:summary",g.getValue("jira:raw:summary"));g=g.du;for(var m in g)if(g.hasOwnProperty(m)){var F=g[m];typeof F==="string"&&F&&n.jE(m,F)}n.dataOutdated=true;n.bq=false}},
removeIssueData:function(c){h.assert(c<0);delete b[c]},getIssueSummary:function(c){return M(c,"jira:raw:summary")},getIssueKey:function(c){return M(c,"jira:raw:issuekey")},getIssueField:M,jC:function(c,p,g){c=b[c];if(!c)return false;c.jC(p,g);return true},fP:function(c,p){var g=b[c];if(!g|| !g.dirty)return false;var n=g.du;if(!n)return false;if(!(p in n))return false;n[p]=null;var m=g.aB;if(p in m)m[p]=null;g.dirty= ! !h.findKey(n,function(F){return typeof F==="string"});if(!g.dirty)g.du=null;g.fT++;return true},oS:function(c,p){var g=b[c];if(g)g.externalDirty=p},fu:function(c,p){r[c]=p;for(var g=false,n=u(),m=0;m<n.length;m++)if(h.indexOf(i,n[m])<0){g=true;break}i=n;if(g){h.eachOwn(b,P);q()}},fw:function(c){if(c<=0|| !i.length)return null;var p={},g=[],n={};h.eachOwn(l,function(m){var F=l[m];h.eachOwn(F,function(x){if(F[x])if(!(x<0))if(!n[x]){n[x]=true;var H=B(x);if(!(H.loadingNow||H.dirty)){var ha;if(H.bq)ha=false;else{ha=H.dataOutdated;for(var y=true,K=0;K<i.length;K++){var N=i[K];if(ha||typeof H.getValue(N)!=="string"||H.hj(N)){y=false;p[N]=true}}if(y)H.bq=true;ha= !y}if(ha){g.push(h.toInt(x));H.loadingNow=true;if(typeof c==="number"&&g.length>=c)return false}}}})});if(!
g.length)return null;return{issues:g,fields:h.keysOf(p)}},cN:function(c,p,g,n,m,F){if(F&&F>0&&j<=0)j=F;F=(new Date).getTime()+1E4;var x={},H=[],ha,y,K;for(ha=0;ha<c.length;ha++)h.indexOf(g,c[ha])<0&&H.push(c[ha]);for(ha=0;ha<m.length;ha++)if(y=m[ha].issue)if(K=b[y]){x[y]=true;if(!K.dirty){K.loadingNow||h.assert(false,y+" not loading, but data received");var N=m[ha].cells;for(y=0;y<g.length;y++){var S=N[y];if(S===null)S="";K.setServerValue(g[y],S,F)}for(y=0;y<H.length;y++)K.setServerValue(H[y],null);K.dataOutdated=false;K.loadingNow=false;K.loadingFailed=false}}for(ha=0;ha<p.length;ha++){y=p[ha];if(!x[y])if(K=b[y])if(!K.dirty){K.loadingNow||h.assert(false,y+" not loading, but data received");for(y=0;y<c.length;y++)K.setServerValue(c[y],null);K.dataOutdated=false;K.loadingNow=false;K.loadingFailed=true}}h.flipSet(n,null,w);a.fireEvent(C.aX,p,s)},hs:function(c,p,g){var n=b[c];if(n&&n.dirty){var m=n.du,F=n.aB,x=n.bO;if(m)for(var H in m)if(m.hasOwnProperty(H)){if(F)F[H]=null;if(p){x[H]=m[H];n.gG(H);n.hV(H)}}n.dirty=false;n.du=null;if(p&&g)if(j===g-1){j=g;G(c)}q()}},jp:function(c,p){function g(F,x,H){if(F&&F.length)for(var ha=0,y=F.length;ha<y;ha++){var K=F[ha];B(K)[x]=H;J[K]=true;n[K]=
true}}var n={},m;(function(){var F,x;for(F in J)if(J.hasOwnProperty(F)&&J[F])if((x=b[F])&&(x.diffStatus||x.diffIcon)){n[F]=true;x.fT++;x.diffStatus=null;x.diffIcon=null}})();J={};if(c)for(m in c)c.hasOwnProperty(m)&&g(c[m],"diffStatus",m);if(p)for(m in p)p.hasOwnProperty(m)&&g(p[m],"diffIcon",m);a.fireEvent(C.aX,function(){var F,x,H=[];for(F in n)if(n.hasOwnProperty(F)&&n[F]){(x=b[F])&&x.fT++;H.push(F)}return H}(),s)},dY:function(){return j},eB:function(c,p,g){var n=false,m=false,F;if(c)j=c;if(p==="all"){h.eachOwn(b,G);n=true}else if(p&&p.length){c=0;for(F=p.length;c<F;c++)if(G(p[c]))n=true}if(g&&p!=="all")if(g==="all")m=A();else if(g.length)m=d(g);if(n||m)q()},hh:function(c){if(!c)return false;if(c<0)return true;return(c=b[c])&&c.hh()}})}})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.structure.appevents"),h=namespace("almworks.util"),k=U.$;U.eR=function(e){function B(t){if(Q!==t){Q=t;P.fireEvent(C.cF)}}function q(t){if(!Q){var d=t.fw(100);if(d){var a=d.issues,s=d.fields;if(a.length&&s.length){var z,I="",R;z=0;for(R=s.length;z<R;z++)I+="&f="+s[z];z=0;for(R=a.length;z<R;z++)I+="&i="+a[z];if(I){if(d=e.currentStructure.id)I+="&s="+d;var b=e.ir.lg.value();
if(b&&b.version)I+="&v="+b.version;I=I.substring(1);B(true);var i=(z=I.length>U.MAX_GET_PARAMETERS_LENGTH)?U.ajax.RESOURCES.RENDER:U.ajax.RESOURCES.RENDER+"?"+I;I=new u.Task(i,U.ajax.DOWNLOAD,function(l){B(false);T=0;var j,w,D;if(l){j=l.fields||[];w=l.aggregates||[];D=l.issues||{};l=h.toIntSafe(l.version,-1)}else{j=[];w=[];D={};l= -1}t.cN(s,a,j,w,D,l);q(t)},function(l,j){B(false);t.cN(s,a,[],[],[],-1);T++;if(T>=4)M(l,j,i);else{A=T<=1?1E3:Math.min(A*2,8E3);h.warn("data loading failed, backing off for "+A);B(true);setTimeout(function(){B(false);q(t)},A)}});if(z){var r={fieldSpecs:[],issues:[]};z=0;for(R=s.length;z<R;z++)r.fieldSpecs.push(s[z]);z=0;for(R=a.length;z<R;z++)r.issues.push(a[z]);if(d)r.structureId=d;if(b&&b.version)r.version=b.version;I.type="POST";I.data=U.apputil.ct(r)}u.addTask(I)}}}}}function M(t,d,a){t=h.httpErrorReport(t,d);G.reportError(new U.error.AppError(h.text("sw.error.data-load",t.title),"When requesting url:\n"+a+"\n\n"+t.details))}var u=e.ajax,P=e.eventBus,G=e.errorCentral,Q=false,T=0,A=0;k.extend(this,{isLoading:function(){return Q}});P.addListener(new h.Life,C.bf,q)}})();(function(){function U(B,q){this.displayMessage=B;this.additionalInformation=q}var C=
namespace("almworks.structure.error"),h=namespace("almworks.structure.appevents"),k=namespace("almworks.util"),e=namespace("almworks.structure.$");k.extend(C,{AppError:U,eC:function(B){function q(Q){if(Q){P.push(Q);M.fireEvent(h.dF,Q,u)}}var M=B.eventBus,u=this,P=[],G=[];k.extend(this,{getErrors:function(){return P.slice(0)},reportError:q,dismissError:function(){if(P.length){var Q=P.splice(0,1);G.push(Q[0]);M.fireEvent(h.cR,Q[0],u)}},dismissAllErrors:function(){k.addAll(G,P);var Q=P;P=[];M.fireEvent(h.cR,Q,u)}});k.setErrorSink(function(Q){q(new U(k.text("sw.error.js"),Q))})},fg:function(B){function q(){I.stop().animate({height:0},400,"swing",function(){I.css("display","none");a.find(".st-error-details-link a").text(k.text("sw.errorpanel.showdetails"))})}function M(){var R=I.find(".st-error-details-view");I.stop().css("display","block");Q();I.animate({height:R.outerHeight(true)},400,"swing",function(){a.find(".st-error-details-link a").text(k.text("sw.errorpanel.hidedetails"))})}function u(){I.is(":animated")||(I.is(":visible")?q():M())}function P(){var R=d.getErrors();if(R.length===0)a.data("error")&&a.stop().data("error",null).animate({bottom: -a.height(),opacity:0},400,"swing");
else{var b=R[0],i=a.data("error"),r=R.length>1;if(r){R=R.length-1;R=R===1?k.text("sw.errorpanel.moreerror1"):k.text("sw.errorpanel.moreerrors",R);a.find(".st-more-error-text").text(R)}if(i===b){z.css("display",r?"block":"none");T()}else i?a.animate({bottom: -a.height(),opacity:0},250,"swing",function(){G(b,r)}):G(b,r)}}function G(R,b){a.data("error",R);z.css("display",b?"block":"none");a.find(".st-error-text").text(R.displayMessage);a.find(".st-error-details-link").css("display",R.additionalInformation?"block":"none");a.find(".st-error-details-view").val(R.additionalInformation||"");a.find(".st-error-details-view").scrollTop(0);if(I.height()>0&& !R.additionalInformation){I.stop().css({height:0,display:"none"});a.find(".st-error-details-link a").text(k.text("sw.errorpanel.showdetails"))}var i=k.getClientWidth(e("body")),r=s.width();i-=s.outerWidth(true)-r;if(b)i-=z.outerWidth(true);s.width(i);a.animate({bottom:0,opacity:0.85},500,"swing")}function Q(){var R=a.find("textarea"),b=k.getClientWidth(R.parent());e.browser.webkit&&R.width(b-28);k.setOuterWidth(R,b)}function T(){Q();if(a.data("error")){var R=k.getClientWidth(e("body")),b=s.width();R-=s.outerWidth(true)-b;if(z.is(":visible")
)R-=z.outerWidth(true);R!=b&&s.animate({width:R+"px"},400,"swing")}}var A=false,t=B.eventBus,d=B.errorCentral,a=e("#st-error-panel");if(!a.length){a=e('<div id="st-error-panel">  <div style="width: 9999px">    <div class="st-top-error">      <div class="s-ui-icon s-ui-icon-alert"></div>      <div class="st-error-actions">        <div class="s-ui-icon s-ui-icon-circle-close"></div>        <div class="st-error-details-link"><a href="#">'+k.text("sw.errorpanel.showdetails")+'</a></div>      </div>      <span class="st-error-text"></span>    </div>    <div class="st-more-errors">      <div class="st-error-actions">        <div class="st-close-all"><a href="#">'+k.text("sw.errorpanel.dismissall")+'</a></div>      </div>      <span class="st-more-error-text"></span>    </div>  </div>  <div class="st-error-details">    <textarea class="st-error-details-view ajs-dirty-warning-exempt" wrap="off" readonly>    </textarea>  </div></div>');a.appendTo(e("body"));a.css({opacity:0,bottom: -a.height()});a.find(".st-error-details-link a").click(function(R){u();R.preventDefault();R.stopImmediatePropagation();return false});a.find(".st-close-all a").click(function(R){d.dismissAllErrors();
R.preventDefault();R.stopImmediatePropagation();return false});a.find(".st-top-error .s-ui-icon-circle-close").click(function(R){d.dismissError();R.preventDefault();R.stopImmediatePropagation()});a.find(".s-ui-icon-circle-close").hover(function(){e(this).addClass("st-hover")},function(){e(this).removeClass("st-hover")});a.find("textarea").focus(function(){e(this).select()})}var s=a.find(".st-top-error"),z=a.find(".st-more-errors"),I=a.find("div.st-error-details");s.click(u);P();T();t.addListener(new k.Life,this);this[h.dF]=function(){A||P()};this[h.cR]=P;this[h.av]=T;this.disable=function(){A=true}}})})();(function(U){function C(a,s,z){t.assert(s-a>=0);t.assert(z>=0);this.from=a;this.to=s;this.count=z}function h(a,s){this.id=a;this.depth=s;this.sequence=d++}function k(){function a(b,i,r){s.debugName&&t.debug(s.debugName+" fire "+b+".."+i+":"+r+" ["+s.size()+"]");z.fireEvent(C.E,new C(b,i,r),s)}var s=this,z=new t.Observable,I=null,R=0;t.extend(this,{jy:function(){R++;I||(I={from:Number.MAX_VALUE,to:0,delta:0})},ap:function(){if(!(--R>0))if(I){s.check();var b=I.from,i=I.to,r=I.delta;I=null;b<=i&&a(b,i,i-b+r)}},fire:function(b,i,r){if(i<b)t.assert(false,"to "+i+" from "+b);else if(!(
i===b&&r===0))if(I){I.from=Math.min(b,I.from);I.to=Math.max(i-I.delta,I.to);I.delta+=r-(i-b)}else a(b,i,r)},events:z,report:function(b){for(var i={},r=0,l="",j=s.size(),w=0;w<j;w++){var D=s.row(w),J=D.getId();if(i[J])l+="ixn:"+J+":"+w+"\n";i[J]=true;D=D.getDepth();if(D<0)l+="nd:"+D+":"+w+"\n";if(D>r+1)l+="wd:"+D+":"+r+":"+w+"\n";r=D;D=s.indexOf(J);if(D!==w)l+="cidx:"+J+":"+w+":"+D+"\n"}if(b)b.items=i;return l},check:function(){if(t.assertionsEnabled())if(!I){var b=s.report();b&&t.error("Forest consistency check failed:\n"+b)}},debugName:null})}function e(a){function s(c,p,g){w.check();if(!c|| !c.length)return false;p=I(p,g);if(!p)return false;g=p.targetDepth-c[0].getDepth();if(g!==0){for(var n=[],m=0,F=c.length;m<F;m++)n.push(c[m].aC(g));c=n}z(c,p.targetIndex);w.check();return true}function z(c,p){w.check();if(c&&c.length){if(p<0)p=0;if(p>D.length)p=D.length;if(p===D.length)t.addAll(D,c);else{var g=D.slice(0,p);t.addAll(g,c);t.addAll(g,D.slice(p));D=g}for(g=p;g<D.length;g++)J[D[g].id]=g;w.check();g=w.gQ(p);w.fire(g,p,p-g+c.length)}}function I(c,p){var g= -1;if(c){g=w.indexOf(c);if(g<0)return null}var n=g<0?0:w.row(g).getDepth()+1,m=g+1;if(p){var F=w.indexOf(p);if(F>=0){F=w.ak(F,n);
if(F>=0&&w.bz(F)===g)m=w.bH(F)}}return{underIndex:g,targetIndex:m,targetDepth:n}}function R(c,p,g){c=w.indexOf(c);if(c<0)return false;var n=w.bH(c);p=I(p,g);if(!p)return false;if(p.underIndex>=c&&p.underIndex<n)return false;b(c,p);return true}function b(c,p){var g=p.targetIndex,n=p.targetDepth,m=p.underIndex;w.check();var F=w.bH(c);if(g==F)g=c;if(!(g==c&&n==D[g].getDepth()))if(g>c&&g<=F)t.assert(false,c+" "+F+" "+g);else{m=m<0?Math.min(g,w.gQ(c)):Math.min(m,w.gQ(c));var x,H= -1,ha= -1;for(x=g-1;x>=0;x--)if(x>=c&&x<F)x=c;else{var y=D[x].getDepth();if(y==n&&ha== -1){ha=x;if(n===0)break}if(y==n-1){H=x;break}}if(n>0&&H<0){t.assert(false,c+" "+F+" "+g+" "+n);throw Error("bad target depth");}x=n-D[c].getDepth();var K,N;H=function(S,Y,Z,la){for(var da=Y;da<Z;da++)D[S+da-Y]=K[da-N].aC(la)};if(g<=c){K=D.slice(N=g,n=F);H(g,c,F,x);H(g+F-c,g,c,0)}else{K=D.slice(N=c,n=g);H(c,F,g,0);H(c+g-F,c,F,x)}for(x=N;x<n;x++)J[D[x].getId()]=x;w.check();N=Math.min(N,m);w.fire(N,n,n-N)}}function i(c){w.check();if(t.isArray(c)){c=t.addAll([],c);c.sort(function(K,N){return K-N})}else c=[c];var p=c[0],g=w.gQ(p),n,m,F,x,H,ha,y=0;n=0;for(m=c.length;n<m;n++){p=c[n];if(x=D[p]){H=x.getDepth();ha=p;for(F=D.length;ha<
F;ha++){x=D[ha];if(ha>p&&x.getDepth()<=H)break;J[x.getId()]= -1;D[ha]=null;y++}}}p=D.slice(0,c[0]);n=c[0];for(m=D.length;n<m;n++)D[n]&&p.push(D[n]);D=p;n=c[0];for(m=D.length;n<m;n++)J[D[n].getId()]=n;w.check();w.fire(g,ha,ha-g-y)}function r(c){w.check();for(var p={},g=c.length,n=D.length,m=g,F= -1,x=0;x<g;x++){var H=c[x];p[H.getId()]=x;if(x>=n|| !H.isSame(D[x])){m=Math.min(x,m);F=Math.max(x+1,F)}}if(g===n&&m===g)return this;x=F-m;if(g!==n){F=D.length;x=c.length-m}D=c;J=p;w.check();c=w.gQ(m);w.fire(c,F,x+(m-c));return this}function l(c,p,g,n){var m=c[p],F=m.getId();w.indexOf(F)>=0?R(F,g,n):s([m.aC(-m.getDepth())],g,n);g=m.getDepth();n=c.length;p++;for(m=0;p<n&&c[p].getDepth()>g;){var x=c[p].getId();p=l(c,p,F,m);m=x}return p}k.call(this);var j=t.extend({},this),w=this,D=[],J={};t.extend(this,{size:function(){return D.length},row:function(c){return c>=0&&c<D.length?D[c]:null},indexOf:function(c){c=J[c];return c===U? -1:c},report:function(){var c={},p=j.report(c),g;for(g in J)if(J.hasOwnProperty(g))if(J[g]!== -1&& !c.items[g])p+="xidx:"+g+":"+J[g]+"\n";return p},clear:function(){w.check();var c=D.length;D=[];J={};w.check();w.fire(0,c,0)},append:function(c){z(c,D.length)},cP:s,cT:R,dk:
function(c){c=w.indexOf(c);c>=0&&i(c)},oW:function(c){var p,g,n,m=[];p=0;for(g=c.length;p<g;p++){n=w.indexOf(c[p]);n>=0&&m.push(n)}m.length&&i(m)},aH:r,bo:function(c,p,g){w.check();if(!c|| !c.length)return false;var n;a:{n=0;for(var m=c.length;n<m;n++)if(w.contains(c[n].getId())){n=false;break a}n=true}if(n)return s(c,p,g);if(p){n=w.indexOf(p);if(n<0)return false;a:{n=t.flipSet(w.aG(n));m=0;for(var F=c.length;m<F;m++)if(n[c[m].getId()]){n=true;break a}n=false}if(n)return false}w.jy();try{var x=c.length;for(n=0;n<x;){var H=c[n].getId();n=l(c,n,p,g);g=H}}finally{w.ap()}w.check();return true}});a&&a.length&&r(a)}function B(){k.call(this);this.source=null;var a=this,s=new t.Lifecycle;this.setSource=function(z){var I=this.source&&this.source.size()||0;s.cycle();(this.source=z)&&z.events.addListener(s.life(),a);if(a.debugName)t.debug(a.debugName+" decorator source updated old["+I+"] new["+(this.source&&this.source.size()||0)+"]");this.sourceUpdated(I);return this};this[C.E]=function(){t.pvc()}}function q(){function a(){var i=b.length,r=R.source;if(!r&&i>0)return "len "+i+" no source";if(!r)return null;r=r.size();for(var l= -1,j=0;j<i;j++){var w=s(b[j]);if(w<=l)return "["+j+"] "+l+" "+w;
if(w>=r)return "["+j+"] "+w+" m "+r;l=w}return null}function s(i){return i>=0?i: -i-1}function z(i){return s(b[i])}function I(i){if(R.source){var r=i.from===0?0:s(t.binarySearch(i.from,0,b.length,z,t.compareNumbers)),l=s(t.binarySearch(i.to,r,b.length,z,t.compareNumbers));R.debugName&&t.debug(R.debugName+" got update "+i.from+".."+i.to+":"+i.count+" filtered "+r+".."+l);var j=i.count-(i.to-i.from);if(j)for(var w=l,D=b.length;w<D;w++){var J=b[w];b[w]=J<0?J-j:J+j}w=l<b.length?R.source.rowDepth(s(b[l])):0;j=[];D=i.from;J=R.filter(R.source,D,D+i.count);for(i=D+i.count-1;i>=D;i--){var c=R.source.row(i),p=J[i];c=c.getDepth();if(p||w>c){w=c;j.push(p?i: -i-1)}}if(!(l<=r&& !j.length)){D=r;if(j.length){i=s(j[j.length-1]);w=R.source.row(i).getDepth();for(D=D>0?s(b[D-1]): -1;w>0;){i=R.source.bz(i);w--;if(i>D)j.push(-i-1);else break}}if(!(r<=0)){i=j.length?R.source.rowDepth(s(j[j.length-1])):l<b.length?R.source.rowDepth(s(b[l])):0;for(w=r-1;w>=0;w--){D=b[w];if(D>=0)break;R.source.row(-D-1).getDepth()>=i&&r--}}i=r;if(l-i===j.length){w=0;for(D=l-1;D>=i;D--,w++)b[D]=j[w]}else{D=[];t.addAll(D,b,0,i);for(w=j.length-1;w>=0;w--)D.push(j[w]);t.addAll(D,b,l);b=D}R.debugName&&t.debug(R.debugName+
" updated to {"+b.join(",")+"}");if(t.assertionsEnabled())(i=a())&&t.error(i);R.fire(r,l,j.length)}}}B.call(this);var R=this,b=[];this[C.E]=function(i,r){r!==R.source?t.assert(false,r):I(i)};t.extend(this,{size:function(){return b.length},row:function(i){var r=R.source;return r?r.row(s(b[i])):null},indexOf:function(i){var r=R.source;if(!r)return-1;i=r.indexOf(i);i=t.binarySearch(i,0,b.length,z,t.compareNumbers);return i<0? -1:i},sourceUpdated:function(i){var r=R.source;if(r)I({from:0,to:i,count:r.size()});else{b=[];R.fire(0,i,0)}},update:I,cn:function(){if(R.source){var i=R.source.size();I({from:0,to:i,count:i})}}})}function M(){q.call(this);var a=this,s=null;t.extend(this,{filter:function(z,I,R){var b={};if(!s)return b;for(;I<R;I++)b[I]=s(I,z);return b},setFilter:function(z){s=z;a.cn();t.safeCall(a.decoratingCallback);return a},ai:function(){return s&&s!==t.returnTrue}})}function u(){function a(l){try{l(R)}catch(j){t.error("error applying change "+l+": "+j,j)}}function s(){if(i)r=true;else{var l=I.source?I.source.as():[];R.jy();try{R.aH(l);l=0;for(var j=b.length;l<j;l++)a(b[l])}finally{R.ap()}}}function z(l){if(!l)return-1;l=t.indexOf(b,l);if(l>=0){b.splice(l,1);if(!i&& !b.length)
{t.safeCall(I.decoratingCallback);I.source&&s()}else s()}return l}B.call(this);var I=this,R=new e,b=[],i=0,r=false;R.events.addListener(new t.Life,C.E,function(l){I.fire(l.from,l.to,l.count)});this[C.E]=s;t.extend(this,{sourceUpdated:function(){s()},add:function(l){if(l){var j=b.length||I.source;b.push(l);if(i)r=true;else j?a(l):t.safeCall(I.decoratingCallback)}},remove:z,replace:function(l,j){if(l)if(j){var w=t.indexOf(b,l);if(w>=0){b[w]=j;s()}}else z(l)},size:function(){return R.size()},row:function(l){return R.row(l)},indexOf:function(l){return R.indexOf(l)},ai:function(){return b.length>0},clear:function(){if(b.length){b=[];i||t.safeCall(I.decoratingCallback);s()}},al:function(l){if(l){if(i++ ===0)r=false}else if(--i<=0){if(r){! !b.length^ ! !I.source&&t.safeCall(I.decoratingCallback);s()}r=false}}})}function P(a){B.call(this);var s=this;t.extend(this,{sourceUpdated:function(z){var I=s.source?s.source.size():0;s.fire(0,z,I)},size:function(){return s.source?s.source.size():0},row:function(z){return s.source?s.source.row(z):null},indexOf:function(z){return s.source?s.source.indexOf(z): -1}});this[C.E]=function(z){s.fire(z.from,z.to,z.count)};a&&this.setSource(a)}function G(a,s){
function z(b){I.debugName&&t.debug(I.debugName+" switch decorating "+b);if(b){s.setSource(a);I.setSource(s)}else{I.setSource(a);s.setSource(null)}}P.call(this);var I=this,R= ! !s.ai();z(R);s.cs(function(){var b= ! !s.ai();if(b!==R){R=b;z(R)}})}function Q(){M.call(this);var a=new t.Lifecycle,s=this,z=null;t.extend(this,{setExcludeFrom:function(I){if(z===I)return s;z=I;a.cycle();if(I){s.setFilter(function(R,b){return!I.contains(b.rowId(R))});I.events.addListener(a.life(),C.E,function(){s.cn()})}else s.setFilter(t.returnTrue);return s}})}function T(a,s,z){function I(){var r=[],l= -1,j,w,D;R=[];b=[];j=0;for(w=a.size();j<w;j++){D=a.rowDepth(j);if(D<l)for(;l>D;l--)r[l]=0;R[j]=r[D-1]||s||0;b[j]=r[D]||0;r[D]=a.rowId(j);l=D}if(z>0)b[0]=z}var R=null,b=null,i=null;t.extendOwn(this,{getUnder:function(r){R||I();return R[r]},oE:function(r){r=a.indexOf(r);return r<0? -1:this.getUnder(r)},ow:function(r){var l=this.oE(r),j=[];if(l>=0)for(j.push(r);l>0;){j.push(l);l=this.oE(l)}return j},getAfter:function(r){b||I();r=b[r];if(i)for(;i.hasOwnProperty(r);)r=i[r];return r},replaceAfter:function(r,l){i||(i={});i[r]=l}})}var A=namespace("almworks.structure"),t=namespace("almworks.util");C.E="onFUE";var d=
1;h.prototype={getId:function(){return this.id},getDepth:function(){return this.depth},clone:function(){return t.extend({},this)},aC:function(a){if(a===0)return this;var s=this.getDepth()+a;if(s<0)throw Error("invalid depth "+this+" delta "+a);a=this.clone();a.depth=s;return a},isSame:function(a){return a===this}};t.extend(k.prototype,{size:function(){t.pvc()},row:function(){t.pvc()},indexOf:function(){t.pvc()},isEmpty:function(){return this.size()===0},rowId:function(a){return(a=this.row(a))&&a.getId()},rowDepth:function(a){return(a=this.row(a))&&a.getDepth()},contains:function(a){return this.indexOf(a)>=0},gz:function(a){if(a<0)return null;if(a+1>=this.size())return null;var s=this.row(a+1);a=this.row(a);if(!s|| !a)return null;return s.getDepth()===a.getDepth()+1?s.getId():null},cG:function(a){return this.gz(this.indexOf(a))},hasChildren:function(a){return! !this.cG(a)},il:function(a){return! !this.gz(a)},aG:function(a){if(typeof a!=="number"||a<0||a>=this.size())return null;var s=this.row(a);if(s.getDepth()===0)return[s.getId()];a=this.aG(this.bz(a));if(!a|| !a.push)return a;a.push(s.getId());return a},bS:function(a){if(!a)return null;return this.aG(this.indexOf(a))},bL:
function(a){a=this.bz(this.indexOf(a));return a<0?null:this.row(a).getId()},aL:function(a){a=this.indexOf(a);return a<0?null:this.row(a)},bz:function(a){if(a<0||a>=this.size())return-1;var s=this.row(a).getDepth();if(s===0)return-1;for(var z=a-1;z>=0;z--)if(this.row(z).getDepth()===s-1)return z;t.assert(false,a);return-1},dX:function(a){if(a>=this.size())return-1;for(var s=a;s>=0;s--)if(this.row(s).getDepth()===0)return s;t.assert(false,a);return-1},ak:function(a,s){if(a<0)return-1;var z=this.row(a).getDepth()-s;if(z<0)return-1;for(var I=0;I<z;I++)a=this.bz(a);return a},bH:function(a){var s=this.row(a).getDepth(),z=this.size();for(a+=1;a<z;a++)if(this.row(a).getDepth()<=s)break;return a},eh:function(a,s){if(a<0||s<0)return false;for(var z=a;s<z;){z=this.bz(z);if(z==s)return true}return false},fD:function(a,s){for(;a>=0;){if(this.row(a).getDepth()===s)break;a--}return a},as:function(){for(var a=[],s=this.size(),z=0;z<s;z++)a.push(this.row(z));return a},dg:function(a,s){var z=s||[],I=this.indexOf(a);if(I<0)return z;for(var R= -this.rowDepth(I),b=this.bH(I);I<b;I++)z.push(this.row(I).aC(R));return z},dI:function(a){if(!a&&a!==0)return null;var s=this.size();if(a<0||a>s)return null;if(
a===0)return{under:0,after:0};var z=a===s? -1:this.bz(a),I=z<0?0:this.rowId(z),R=0;if(z<a-1){s=a===s?0:this.rowDepth(a);R=this.rowId(this.ak(a-1,s))}return{under:I,after:R}},cf:function(a,s){var z=this.size();if(a<0||a>z)return null;if(a===0)return s===0?{under:0,after:0}:null;if(a<z)if(this.rowDepth(a)>s)return null;z= -1;var I=0;if(s>0){z=this.ak(a-1,s-1);if(z<0)return null;I=this.rowId(z)}var R=0;if(z<a-1)R=this.rowId(this.ak(a-1,s));return{under:I,after:R}},normalizeIdMap:function(a){if(!a)return[];var s,z,I=[],R={},b=new T(this);for(s in a)if(a.hasOwnProperty(s)&&a[s]){var i=this.indexOf(s);if(!(i<0)){var r=b.ow(s);for(z=r.length-1;z>0;z--)if(a[r[z]])break;if(!(z>0))try{var l=t.toInt(s);I.push(l);R[l]=i}catch(j){t.warn("normalizeIdMap problem",j)}}}I.length>1&&I.sort(function(w,D){return R[w]-R[D]});return I},dB:function(a){for(var s=[],z=0,I=a.length;z<I;z++)this.dg(a[z],s);return s},cD:function(a){return(new A.bx).aH(this.dB(a))},aD:function(){for(var a=[],s=0,z=this.size();s<z;s++)a.push(this.rowId(s));return a},fc:function(a){for(var s=0,z=0,I=this.size();z<I;z++)a(this.rowId(z))&&s++;return s},getSizeCell:function(){var a=this.bB;if(a)return a;a=(new t.Cell).setValue(
this.size());var s=this,z=t.delayed(10,function(){a.setValue(s.size())});this.events.addListener(new t.Life,C.E,z);return this.bB=a},onChange:function(a){this.events.addListener(new t.Life,C.E,a);return this},fH:function(a,s){var z=a<0? -1:s?a:this.bz(a);z=z<0?0:this.rowId(z);var I=0;if(s){var R=this.bH(a)-1;if(R>a){R=this.ak(R,this.rowDepth(a)+1);I=this.rowId(R)}}else I=a<0?0:this.rowId(a);return{under:z,after:I}},dU:function(a){var s=a?this.indexOf(a): -1;if(a&&s<0)return 0;return this.ec(s)},ec:function(a){var s;if(a>=0){s=this.bH(a)-1;if(s<=a)return 0;a=this.rowDepth(a)+1}else{s=this.size()-1;if(s<0)return 0;a=0}s=this.ak(s,a);return s<0?0:this.rowId(s)},ds:function(a,s){var z=a?this.indexOf(a): -1;if(a&&z<0)return 0;var I=s?this.indexOf(s): -1;if(I<0)return this.ec(z);if(I<=z+1)return 0;var R=z<0?0:this.rowDepth(z)+1;if(this.rowDepth(I)<R)return this.ec(z);I=this.ak(I,R);if(I<=z+1)return 0;I=this.ak(I-1,R);if(I<=z)return 0;return this.rowId(I)},eY:function(a){var s=a&&a.length;if(s){for(var z=1E9,I= -1,R=0;R<s;R++){var b=this.indexOf(a[R]);if(!(b<0)){if(b<z)z=b;if(b>I)I=b}}if(!(I<z)){z=this.gQ(z);this.fire(z,I+1,I-z+1)}}},gQ:function(a){var s=this.bz(a);return s<0?a:s},fI:
function(a){for(var s=this.aG(a)||[],z=0,I=s.length;z<I;z++)s[z]=this.row(this.indexOf(s[z]));z=a+1;for(I=this.bH(a);z<I;z++)s.push(this.row(z));return s},hf:function(){var a,s,z,I=[];a=0;for(s=this.size();a<s;a++){z=this.row(a);z.getDepth()===0&&I.push(z.getId())}return I},lG:function(a){var s=this.row(a),z,I;if(!s)return-1;s=s.getDepth();for(z=a-1;z>=0;z--){I=this.row(z).getDepth();if(I===s)return z;if(I<s)return-1}t.assert(a==0,a);return-1}});t.extend(e.prototype,k.prototype);t.extend(B.prototype,k.prototype,{sourceUpdated:function(){},ai:t.returnTrue,cs:function(a){this.decoratingCallback=a}});t.extend(q.prototype,B.prototype,{filter:function(){return{}}});t.extend(M.prototype,q.prototype);t.extend(u.prototype,B.prototype);t.extend(P.prototype,B.prototype);t.extend(G.prototype,P.prototype);t.extend(Q.prototype,M.prototype);t.extend(A,{bi:C,Row:h,ev:k,bx:e,eO:B,cg:q,dE:M,bv:u,eG:P,ac:G,dq:Q,ju:T})})();(function(){function U(q,M,u){B.assert(typeof q==="number");B.assert(typeof M==="number");B.assert(u||q>0,q);B.assert(M>=0,M);k.Row.call(this,q,M)}function C(q,M){k.cg.call(this);var u=this;this[e.bu]=function(P){u.debugName&&B.debug(u.debugName+" update issues ["+(P&&P.length)+
"]");var G=u.source;if(G){var Q=1E9,T= -1;if(P){if(typeof P==="number"||typeof P==="string")P=[P];for(var A=0,t=P.length;A<t;A++){var d=G.indexOf(P[A]);if(!(d<0))if(!(d>=Q&&d<T)){Q=Math.min(Q,d);T=Math.max(T,G.bH(d))}}}else{Q=0;T=G.size()}T>Q&&u.update({from:Q,to:T,count:T-Q})}};B.extend(this,{filter:function(P,G,Q){var T={};if(G>=Q)return T;for(var A=P.dX(G);A<Q;){if(A>=G)T[A]=true;if(q.isExpanded(P.row(A).getId()))A++;else A=P.bH(A)}return T}});M.addListener(new B.Life,this)}function h(q){k.dE.call(this);var M=this,u=q.widget.config.anchorIssue||0,P=q.cJ(),G=q.rootPath,Q={},T=[],A={},t=q.widget.ir.lg;M.setFilter(function(d,a){var s=a.row(d),z=s.getId();if(z<0||A[z])return true;if(u&&z===u)return true;if(P&&P.iC(z))return true;if(G&&B.indexOf(G.value(),z)>=0)return true;var I=t.value();if(I&&B.indexOf(I.parentPathFrom,z)>=0)return true;if(I&&B.indexOf(I.parentPathTo,z)>=0)return true;I=true;for(var R=0,b=T.length;I&&R<b;R++)I=T[R](z,s);return I});B.extend(this,{gy:function(d,a,s){if(Q[d]!==a){if(Q[d]=a)a.ci=s||0;d=[];for(var z in Q)if(Q.hasOwnProperty(z))if(a=Q[z]){s=a.ci||0;for(var I=0,R=d.length;I<R;I++)if(s<(d[I].ci||0))break;d=B.arrayInsert(d,I,a)}T=d;M.cn();B.safeCall(
M.decoratingCallback)}},ai:function(){return T.length>0},pinIssue:function(d){A[d]=true},removePins:function(){A={}}})}var k=namespace("almworks.structure"),e=namespace("almworks.structure.appevents"),B=namespace("almworks.util");B.extend(U.prototype,k.Row.prototype,{toString:function(){return ""+this.getId()+":"+this.getDepth()},clone:function(){return new U(this.getId(),this.getDepth(),this.getId()<0)},isSame:function(q){return q instanceof U&&q.id===this.id&&q.depth===this.depth}});B.extend(C.prototype,k.cg.prototype);B.extend(h.prototype,k.dE.prototype);B.extend(k,{fB:C,fq:h,bP:U})})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.util");U.oM=function(){var h={};this.aO=function(k){if(C.isArray(k)){if(k.length){C.extendOwn(h,C.flipSet(k));h[0]=true}}else if(typeof k==="number"){h[k]=true;h[0]=true}};this.mw=function(){var k=h;h={};return k}}})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.util"),h=namespace("almworks.structure.appevents");U.ez=function(k){function e(c,p,g){if(r.iY())return false;if(!r.aW())return true;if(c){c=j.indexOf(c);if(c>0){if(g)g=g.getUnder(c);else{g=j.bz(c);g=g>=0?j.rowId(g):0}if(g>0&& !J.hh(g))
return false}}return!p||J.hh(p)}function B(c,p,g){var n=false,m;if(c.issue&&c.issue===p){if(g)c.issue=g;n=true}if(c.issues){m=C.indexOf(c.issues,p);if(m>=0){if(g)c.issues[m]=g;n=true}}if(c.forest){m=c.forest.indexOf(p);if(m>=0){if(g){n=c.forest.as();n[m]=new U.bP(g,n[m].getDepth());c.forest=new U.bx(n)}n=true}}if(c.under&&c.under===p){if(g)c.under=g;n=true}if(c.after&&c.after===p){if(g)c.after=g;n=true}if(c.before&&c.before===p){if(g)c.before=g;n=true}return n}function q(c){if(c.issue&&c.issue<0)return false;if(c.issues&&C.find(c.issues,function(n){return n<0})>=0)return false;if(c.forest)for(var p=0,g=c.forest.size();p<g;p++)if(c.forest.rowId(p)<0)return false;if(c.under&&c.under<0)return false;if(c.after&&c.after<0)return false;if(c.before&&c.before<0)return false;return true}function M(c,p){for(var g={action:p},n=c.actions?C.addAll([],c.actions):[c],m=0,F=n.length;m<F;m++){var x=n,H=m,ha=n[m],y={};if(ha.issue)y.issue=ha.issue;else if(ha.issues)if(ha.issues.length===1)y.issue=ha.issues[0];else y.issues=ha.issues;else if(ha.forest){for(var K=y,N=ha.forest.as(),S="",Y=0;Y<N.length;Y++){if(Y>0)S+=",";S+=N[Y].id+":"+N[Y].depth}K.forest=S}if(typeof ha.under!=="undefined")y.under=
ha.under;if(typeof ha.before!=="undefined")y.before=ha.before;else if(typeof ha.after!=="undefined")y.after=ha.after;x[H]=y}if(n.length===1)C.extendOwn(g,n[0]);else g.actions=n;return g}function u(c,p){var g=c.actions?C.addAll([],c.actions):[c],n,m,F;n=0;for(m=g.length;n<m;n++){F=g[n]=C.extendOwn({},g[n]);if(typeof F.issue!=="undefined"){F.issues=[F.issue];delete F.issue}}return function(x){for(var H=0,ha=g.length;H<ha;H++)p(g[H],x)}}function P(c){if(c.issue)return[c.issue];if(c.issues)return c.issues;if(c.forest)return c.forest.aD();if(c.actions){for(var p=0,g=[];p<c.actions.length;p++)C.addAll(g,P(c.actions[p].data||c.actions[p]));return g}return[]}function G(c){c=P(c);var p=[],g,n,m;for(g=0;g<c.length;g++){n=j.indexOf(c[g]);if(n>=0)for(m=j.bH(n);n<m;)p.push(j.rowId(n++))}return p}function Q(c){if(c.under)return[c.under];if(c.actions){for(var p=0,g=[];p<c.actions.length;p++)C.addAll(g,Q(c.actions[p].data||c.actions[p]));return g}return[]}function T(c){U.bG.call(this);this.structure=r.id;this.root=r.getRoot();this.data=c;this.init(c)}function A(c){T.call(this,c)}function t(c){T.call(this,c)}function d(c){T.call(this,c)}function a(c){T.call(this,c)}function s(c){T.call(this,c)}
function z(c,p,g){if(!w){C.assert(false,"readonly?");return false}var n,m,F;n=0;for(m=c.length;n<m;n++){F=c[n];if(j.indexOf(F)<0){C.warn("cannot move or delete missing issue "+F);return false}if(!e(F,p,g))return false}return true}function I(c,p,g,n,m){if(!w){C.assert(false,"readonly?");return false}if(!c|| !c.size())return false;var F,x;if(p>0){F=j.bS(p);if(!F){C.warn("cannot merge under "+p);return false}F=C.flipSet(F);for(x=c.size()-1;x>=0;x--)if(F[c.rowId(x)])return false}if(b()){p=n||new U.ju(c,p,g);g=m||new U.ju(j);x=0;for(m=c.size();x<m;x++){n=c.rowId(x);F=j.indexOf(n);n=p.getUnder(x);if(F>=0){F=g.getUnder(F);if(F!==n){if(F>0&& !J.hh(F))return false;if(n>0&&j.indexOf(n)>=0&& !J.hh(n))return false}}else if(n>0&&j.indexOf(n)>=0&& !J.hh(n))return false}}return true}function R(c,p,g){var n=p?j.indexOf(p):null,m=g?j.indexOf(g):null;if(p&&n<0){C.assert(false,"bad under: "+p);return true}if(g&&m<0){C.assert(false,"bad after: "+g);return true}var F=p?j.rowDepth(n)+1:0;p=g?m:p?n+1:0;n=0;for(var x=c.size(),H=j.size(),ha=true;n<x;n++,p++){if(p>=H)return false;if(c.rowId(n)!==j.rowId(p)){ha=false;break}if(c.rowDepth(n)!==j.rowDepth(p)-F){ha=false;break}}if(ha)return true;if(!g)
return false;n=0;for(p=j.bH(m);n<x;n++,p++){if(p>=H)return false;if(c.rowId(n)!==j.rowId(p))return false;if(c.rowDepth(n)!==j.rowDepth(p)-F)return false}return true}function b(){return!r.iY()&&r.aW()}function i(){function c(){if(n){var x=g.length-1,H;if(x>=0){H=g[x];if(H instanceof s){g[x]=new s({issues:C.addAll(H.data.issues,n)});n=null;return}}g.push(new s({issues:n}));n=null}}function p(x){var H=null,ha= -1;this.addItem=function(y,K,N){if(!H||K!==ha){this.finish();ha=K;H=[{items:new C.LinkedList(y),after:N}]}else H.push({items:new C.LinkedList(y),after:N})};this.finish=function(){if(H){var y={},K,N=H.length,S,Y,Z;for(K=0;K<N;K++){S=this.getIssue(H[K].items.get(0));y[S]=K}for(K=0;K<N;K++){S=this.getIssue(H[K].items.get(0));Y=H[K].after;Z=y[Y];if(Z>=0){H[Z].items.addList(H[K].items);y[S]=Z;H[K]=null}}S=[];y={};for(K=0;K<N;K++)if(H[K]){Y=H[K].after;Z=y[Y];if(Z>=0)S[Z].items.addList(H[K].items);else{S.push({items:H[K].items,under:ha,after:Y});y[Y]=S.length-1}}K=0;for(N=S.length;K<N;K++){y=S[K].items;delete S[K].items;this.packItems.call(S[K],y)}S.length>1&&S.reverse();K=g.length-1;if(K>=0){N=g[K];if(N instanceof this.actionClass){g[K]=new this.actionClass({actions:C.addAll(S,
N.data.actions||[N.data])});H=null;ha= -1;return}}S.length===1?g.push(new this.actionClass(S[0])):g.push(new this.actionClass({actions:S}));H=null;ha= -1}};this.actionClass=this.packItems=this.getIssue=C.pvc;C.extendOwn(this,x)}var g=[],n=null,m=new p({getIssue:function(x){return x},packItems:function(x){this.issues=x.toArray()},actionClass:t}),F=new p({getIssue:function(x){return x[0].getId()},packItems:function(x){this.forest=new U.bx(x.foldLeft(C.addAll,[]))},actionClass:d});C.extendOwn(this,{addDelete:function(x){if(n)n.push(x);else n=[x]},addMove:function(x,H,ha){c();F.finish();m.addItem(x,H,ha)},addMerge:function(x,H,ha){c();m.finish();F.addItem(x,H,ha)},getUndoAction:function(){c();m.finish();F.finish();if(g.length===1)return g[0];g.reverse();return new A({actions:g})}})}var r=k.widget.currentStructure,l=k.aT(),j=k.bd(),w=k.bE(),D=k.bD(),J=k.widget.az;C.extend(T.prototype,U.bG.prototype,{forestAction:true,init:function(){C.pvc()},aj:function(){return this.spec},bN:function(){return this.ff},bQ:function(c,p){C.assert(c<0);var g=this.data,n,m,F=false;if(g.actions){n=0;for(m=g.actions.length;n<m;n++)if(B(g.actions[n],c,p))F=true}else F=B(g,c,p);if(F){this.init(g);return true}
return false},an:function(){if(!this.spec)return false;var c=this.data;if(c.actions){for(var p=0,g=c.actions.length;p<g;p++)if(!q(c.actions[p]))return false;return true}return q(c)},getInverseAction:function(){return this.inverse||null},getAffectedIssues:function(){return P(this.data)}});C.extend(A.prototype,T.prototype,{init:function(c){this.spec={actions:[]};for(var p=0,g=c.actions.length;p<g;p++)this.spec.actions.push(c.actions[p].aj());this.ff=function(n){for(var m=0,F=c.actions.length;m<F;m++)c.actions[m].bN()(n)}},bQ:function(c,p){for(var g=false,n=0,m=this.data.actions.length;n<m;n++)if(this.data.actions[n].bQ(c,p))g=true;return g},an:function(){for(var c=0,p=this.data.actions.length;c<p;c++)if(!this.data.actions[c].an())return false;return true},getAffectedIssues:function(){var c=[],p,g;p=0;for(g=this.data.actions.length;p<g;p++)C.addAll(c,this.data.actions[p].getAffectedIssues());return c}});C.extend(t.prototype,T.prototype,{init:function(c){this.spec=M(c,"move");this.ff=u(c,function(p,g){var n=p.issues,m=p.under,F=p.after,x,H,ha;x=0;for(H=n.length;x<H;x++){ha=n[x];if(g.cT(ha,m,F))F=ha}})},isOverridingAction:function(c){if(c instanceof t&&this.spec.action===c.spec.action&&
this.structure===c.structure){if(this.data.issue)return this.data.issue===c.data.issue;if(this.data.issues&&this.data.issues.length)return C.arrayEquals(this.data.issues,c.data.issues)}return false},getAffectedIssues:function(){return G(this.data)}});C.extend(d.prototype,T.prototype,{init:function(c){this.spec=M(c,"merge");this.ff=u(c,function(p,g){g.bo(p.forest.as(),p.under,p.after)})}});C.extend(a.prototype,T.prototype,{init:function(c){this.spec=M(c,"add");this.ff=u(c,function(p,g){var n=p.issues,m=p.under,F,x,H,ha=[];F=typeof p.before!=="undefined"?g.ds(m,p.before):p.after;x=0;for(H=n.length;x<H;x++)ha.push(new U.bP(n[x],0));g.cP(ha,m,F)})}});C.extend(s.prototype,T.prototype,{init:function(c){this.spec=M(c,"delete");this.ff=u(c,function(p,g){g.oW(p.issues)})},getAffectedIssues:function(){return G(this.data)}});w.aF(new function(){function c(p,g,n,m){m=m?0:1;var F,x,H;F=0;for(x=g.length;F<x;F++)if((H=n.ow(g[F]))&&H.length>m)C.extendOwn(p,C.flipSet(m?H.slice(m):H))}this.dw=function(p){var g,n,m,F=0,x=0;g=0;for(n=p.length;g<n;g++){m=p[g];if(!m.forestAction)break;if(!m.an()){C.debug("action not ready for upload: "+U.apputil.ct(m.aj()));break}if(g===0){F=m.structure;x=m.root}
else if(m.structure!==F||m.root!==x)break}if(!g)return null;n=p.slice(0,g);m=0;var H=null;if(F===r.id&&x===r.getRoot()){m=r.version;H={attempt:1,cY:1,structureId:F,baseVersion:m,root:x}}var ha=[];for(p=0;p<g;p++)ha.push(n[p].aj());F=U.ajax.RESOURCES.forest(F);x=U.apputil.ct({base:m,root:x,actions:ha});var y={},K={};ha=new U.ju(j);var N=new U.ju(l);for(p=0;p<g;p++){m=n[p].data;var S=P(m);C.flipSet(S,null,y);c(K,S,N,false);c(K,Q(m),ha,true)}K=C.numericKeys(K);y=C.numericKeys(y);return{count:g,url:F,data:x,cB:true,ax:function(){D.fireEvent(h.UPLOAD_FINISHED,y,K)},fF:H}}});C.extend(this,{nP:function(c,p,g,n){if(!c|| !c.length)return false;var m=null,F=null,x,H,ha;if(n||b())m=new U.ju(j);if(!z(c,p,m))return false;if(p>0){F=j.bS(p);if(!F){C.warn("cannot move under "+p);return false}F=C.flipSet(F);x=0;for(H=c.length;x<H;x++)if(F[c[x]])return false}F=new t({issues:c,under:p,after:g});if(!n){w.enqueue(F);return true}var y=new i,K,N=g,S=false;x=0;for(H=c.length;x<H;x++){g=c[x];ha=j.indexOf(g);K=m.getUnder(ha);ha=m.getAfter(ha);if(x===0&&p===K&&N===g)N=ha;if(K!==p||ha!==N){y.addMove(g,K,ha);m.replaceAfter(g,ha);S=true}else N=g}S&&w.enqueue(F,y.getUndoAction(),n);return true},bI:function(c,p,
g,n){if(!e(0,p))return false;if(!w){C.assert(false,"readonly?");return false}w.enqueue(new a(n?{issue:c,under:p,before:g}:{issue:c,under:p,after:g}));return true},eH:function(c,p){if(!c|| !c.length)return false;var g=null;if(p||b())g=new U.ju(j);if(!z(c,0,g))return false;var n=new s({issues:c});if(!p){w.enqueue(n);return true}var m=new i,F,x,H,ha,y;F=0;for(x=c.length;F<x;F++){H=c[F];ha=j.indexOf(H);y=j.dg(H);m.addMerge(y,g.getUnder(ha),g.getAfter(ha));g.replaceAfter(H,g.getAfter(ha))}w.enqueue(n,m.getUndoAction(),p);return true},bo:function(c,p,g,n){if(!c|| !c.size())return false;var m=null,F=null;if(n||b()){m=new U.ju(c,p,g);F=new U.ju(j)}if(!I(c,p,g,m,F))return false;var x=F;if(!R(c,p,g)){F=new d({forest:new U.bx(c.as()),under:p,after:g});if(n){p=m||new U.ju(c,p,g);g=x||new U.ju(j);m=new i;var H,ha,y,K,N,S;x=0;for(H=c.size();x<H;x++){ha=c.rowId(x);y=j.indexOf(ha);if(y<0){K=p.getUnder(x);if(K===0||j.indexOf(K)>=0)m.addDelete(ha)}else{K=g.getUnder(y);y=g.getAfter(y);S=p.getAfter(x);N=p.getUnder(x);if(K!==N||y!==S){m.addMove(ha,K,y);g.replaceAfter(ha,y);K===N&&ha!==S&&p.replaceAfter(ha,S)}}}w.enqueue(F,m.getUndoAction(),n)}else w.enqueue(F)}return true},canMergeForest:I,eP:e})}})();
(function(U){function C(M){var u=[];if(!M)return u;M=M.split(",");var P,G,Q,T,A,t=M.length;for(P=0;P<t;P++)if(G=M[P]){Q=G.indexOf(":");A=0;if(Q<0)T=k.toInt(G);else{T=k.toInt(G.substring(0,Q));G=G.substring(Q+1);A=k.toInt(G)}u.push(new h.bP(T,A))}return u}var h=namespace("almworks.structure"),k=namespace("almworks.util"),e=namespace("almworks.structure.appevents"),B=h.$,q=h.getUrlHashParam("traceForestLoad");h.eb=function(M){function u(J){if(J){var c=w;w+=J;if(c===0||w===0)i.fireEvent(e.cQ)}};function P(J,c,p,g,n){q&&k.debug("FL:update",! !J);k.assert(c);if(!J||J.empty===true){q&&k.debug("FL:update:empty");k.safeCall(c.updateCallback,U,c,J,true)}else{var m=k.toIntSafe(J.structure,0);if(m!==z.id)q&&k.debug("FL:update:id",m,z.id);else{z.id===m&&c.root===0&&J.formula&&z.gu(J);if(c.structureId!==m||c.root!==z.getRoot())q&&k.debug("FL:update:root",c.structureId,m,c.root,z.getRoot());else{var F;r=p;l=g;j=n;I.jy();try{F=G(J,c);q&&k.debug("FL:update:r="+F)}finally{j=l=r=null;I.ap()}if(F)k.safeCall(c.updateCallback,U,c,J,true);else{p=(c.attempt||0)+1;q&&k.debug("FL:update:attempt",p);if(p>2){k.safeCall(c.updateCallback,U,c,J,false);b.reportError(new h.error.AppError(k.text(
"s.w.error.communication-error.title"),k.text("s.w.error.communication-error.desc")+"\n\n"+h.apputil.ct(J)))}else{J=k.extend({},c);J.attempt=p;s(J)}}}}}}function G(J,c){var p=k.toIntSafe(J.version,0),g=z.version;if(p<g){k.isDebugging()&&k.debug("received update with an older version "+p+" vs current "+g);return!(c&&c.baseVersion===0)}var n=J.formula,m=typeof n==="string",F=J.update,x=typeof F==="string";if(!m&& !x){k.warn("structure information without content");return false}var H=true,ha=g,y=z.getRoot();if(m){q&&k.debug("FL:apply:f",n.length);r&&r("all");l&&l("all");j&&j("all");ha=C(n);if(y)ha=Q(ha,y);I.aH(ha);ha=p}else if(x){if(!z.isLoaded()){q&&k.debug("FL:apply:u:notload");return false}if(p==g){q&&k.debug("FL:apply:u:same");return true}n=k.toIntSafe(J.updateFrom,0);if(n!==g){k.warn("update for unknown version "+n+" ("+g+")");return false}g=null;if(y)g=M.aT().bS(y)||[];y=F.split("|");q&&k.debug("FL:apply:u",y.length,! !(g&&g.length));F=0;for(n=y.length;F<n;F++){if(!A(y[F],g)){H=false;break}ha++}H=H&&ha===p}q&&k.debug("FL:apply:done",H,ha);z.gE(ha);return H}function Q(J,c){if(!c)return J;if(T(J,c))return J;var p=new h.bx(J),g=p.indexOf(c);if(g<0)return[];return p.fI(g)}
function T(J,c){var p,g,n=J.length,m=0;if(!n)return true;for(g=0;g<n;g++){p=J[g];if(p.getDepth()!==m)return false;if(p.getId()===c)break;m++}if(g===n)return false;for(g++;g<n;g++)if(J[g].getDepth()<=m)return false;return true}function A(J,c){var p=J.split(".");if(p[0]==="m")return t(p,J,c);else if(p[0]==="a")return d(p,J,c);else if(p[0]==="d"){a:{p=k.toIntSafe(p[1],0);var g,n;if(p){g=I.indexOf(p);if(g<0){k.warn("failed to apply "+J+" ("+g+")");p=false}else{if(c&&c.length)if(k.indexOf(c,p)>=0){p=false;break a}l&&a(I.aG(g),1);if(j){n=g;for(g=I.bH(g);n<g;n++)j(I.rowId(n))}I.dk(p);p=true}}else{k.warn("bad update "+J);p=false}}return p}k.warn("unrecognized update "+J);return false}function t(J,c,p){var g,n,m;g=k.toIntSafe(J[1],0);if(!g){k.warn("bad update "+c);return false}n=k.toIntSafe(J[2],0);m=k.toIntSafe(J[3],0);if(p&&p.length){if(k.indexOf(p,g)>=0)return false;J=k.indexOf(p,n);if(J>=0&&J<p.length-1)return false}if(l){a(g,1);n&&a(n,0)}if(!I.cT(g,n,m)){k.debug("failed to apply "+c);return false}if(j){J=I.indexOf(g);for(c=I.bH(J);J<c;J++)j(I.rowId(J))}return true}function d(J,c,p){var g=J[3];if(!g){k.warn("bad update "+c);return false}var n=k.toIntSafe(J[1],0);J=k.toIntSafe(J[2],0);
var m=C(g),F;if(!m.length){k.warn("bad formula "+g);return false}if(p&&p.length){g=k.indexOf(p,n);if(g>=0&&g<p.length-1)return false;g=0;for(F=m.length;g<F;g++)if(k.indexOf(p,m[g].getId())>=0)return false}if(r){g=0;for(F=m.length;g<F;g++)r(m[g].getId())}if(l){g=0;for(F=m.length;g<F;g++){p=m[g].getId();l(p);a(p,1)}n&&a(n,0)}if(!I.bo(m,n,J)){k.debug("failed to apply "+c);return false}if(j){g=0;for(F=m.length;g<F;g++)j(m[g].getId())}return true}function a(J,c){if(typeof J==="number")J=I.bS(J);if(J&&J.length>c)for(var p=0,g=J.length-c;p<g;p++)l(J[p])}function s(J){if(z.id){J||(J={});if(!J.attempt)J.attempt=0;J.structureId=z.id;J.baseVersion=0;J.root=z.getRoot();var c="base=0";if(J.root)c+="&root="+encodeURIComponent(J.root);q&&k.debug("FL:req",J.attempt,z.id,J.root);var p=h.ajax.RESOURCES.forest(z.id)+"?"+c;c=new R.Task(p,h.ajax.DOWNLOAD,function(n){M.widget.div$.removeClass(D);try{P(n,J)}catch(m){k.error(m)}},function(n,m){q&&k.debug("FL:err",J.attempt,m,z.id,z.version,z.getRoot());var F;F=n.responseText;if(J.structureId!==z.id||J.root!==z.getRoot())F=false;else{var x=k.flipSet([4001,4003]),H;try{H=h.JSON.parse(F)}catch(ha){}if(!J.root|| !H|| !x[H.code]){M.widget.div$.removeClass(D);
F=false}else{F={formula:"",root:J.root,structure:z.id,version:z.version};try{P(F,J)}catch(y){k.error(y)}M.widget.div$.addClass(D);F=true}}if(!F)if(!J.ignoreError){F=k.httpErrorReport(n,m);b.reportError(new h.error.AppError(k.text("sw.error.load-forest",F.title),"When loading GET "+p+"\n:"+F.details))}});var g=J.cY;if(g){u(g);c.chainComplete(k.curry(u,-g))}R.addTask(c)}}var z=M.widget.currentStructure,I=k.nn(M.aT()),R=M.widget.ajax,b=M.widget.errorCentral,i=M.bD(),r=null,l=null,j=null,w=0,D="s-unstructured-issue-pinned";B.extend(this,{getLoadingWeight:function(){return w},reloadStructure:function(J,c){q&&k.debug("FL:reload",! !J,! !c);if(z.id&&z.er&& !z.getRoot()){q&&k.debug("FL:cached",z.er.version);P(z.er,{updateCallback:J,ignoreError: ! !c,attempt:1,cY:1,structureId:z.id,baseVersion:0,root:0})}else s({updateCallback:J,ignoreError: ! !c,cY:1})},applyUpdate:P})};h.parseFormula=C;h.hU=function(M){if(!M)return[];for(var u=0,P=0,G=[];u>=0;){P=M.indexOf(",",u+1);var Q=P<0?M.substring(u):M.substring(u,P);u=P<0? -1:P+1;P=parseInt(Q,10);isNaN(P)||P<=0||G.push(P)}return G}})();(function(U){function C(A){if(arguments.length>0){B.setStored(Q,A?"true":"false");return A}
else return B.getStored(Q)==="true"}function h(){return!B.modes.GADGET&&B.openCreateIssueDialog}function k(A,t){q.assert(A<0,A);return function(d){var a=t.under===0?0:d.rowDepth(d.indexOf(t.under))+1;a=new B.bP(A,a,true);d.cP([a],t.under,t.after)}}function e(A,t,d){this.issueId=A;this.panel=t;this.ho={};this.hB={};this.jiraDialogData={};this.kF={};this.ji=new q.Cell(G.EDITING);this.iT=d;if(this.issueId<0)if(t.widget.jiraConfig.jW())this.kQ=new B.columns.jQ(t.widget,this);else if(A=this.iT&&this.iT.creationContext){A.mode="clone";A.pid=0;A.issuetype=""}}var B=namespace("almworks.structure"),q=namespace("almworks.util"),M=namespace("almworks.structure.appevents"),u=namespace("almworks.structure.columns"),P=B.$,G={EDITING:0,UPLOAD_STARTED:1,UPLOAD_FAILED:2,UPLOAD_FINISHED:3,EDIT_CANCELLED:4,UPLOAD_CANCELLED:5},Q="prefer.create.dialog";q.extend(e.prototype,{bQ:function(A,t){q.assert(A<0,A);q.assert(t>0|| !t,t);var d=false;if(this.issueId===A){if(t)this.issueId=t;d=true}q.eachValue(this.ho,function(I){I.bQ(A,t)});var a=this.iT,s=a&&a.placement,z=a&&a.creationContext;if(s)if(z.sample===A||s.under===A||s.after===A){d=true;if(t){if(z.sample===A)z.sample=t;if(s.under===A||s.after===A){if(
s.under===A)s.under=t;if(s.after===A)s.after=t;z=a.aV;a.aV=k(a.issueId,s);this.panel.dC().replace(z,a.aV)}}}return d},ix:function(A){if(typeof A!=="string")return "";if(!A)return A;var t=q.tail(A,"pid:")||q.tail(A,"issuetype:");if(t)return P.trim(t);return P.trim(A)},jj:function(A){this.ji.setValue(G.UPLOAD_FAILED);var t=A&&A.formErrors,d=A&&A.fieldErrors;t&&t.length||d&& !q.isEmptyOrFalsy(d)||(t=[q.text("s.w.edit.generic-error")]);this.hY=true;var a=[];if(t&&t.length)for(A=0;A<t.length;A++){var s=this.ix(t[A]);s&&a.push(s)}t=q.extend({},this.jiraDialogData,this.hB);if(d){var z={},I=this.panel.widget.jiraConfig.getJiraFieldMap();A=function(b){var i=I[b];i=i?i.name:q.capitalize(b.toLowerCase().replace(/_.*$/,""));return q.text("s.w.edit.error.for.field",i,d[b])};q.eachValue(this.ho,function(b){b=b.getInputData();for(var i in d)if(d.hasOwnProperty(i)&&i in b)z[i]=true});for(var R in d)if(d.hasOwnProperty(R)&&(!(R in z)|| !(R in t)))a.push(A(R));a.sort()}q.eachValue(this.ho,function(b){var i=b.getInputData(),r=q.addAll([],a);if(d)for(var l in d)d.hasOwnProperty(l)&&l in i&&r.push(d[l]);b.jB(r)});this.hA=d},gM:function(){this.hY=false;this.hA=null;q.eachValue(this.ho,function(A){A.jB(
null)})},ie:function(){return! !q.findKey(this.ho,function(A){return A&&A.hS()})},ip:function(A){return! !q.findKey(this.ho,function(t){return t&&t!==A&&t.hS()})},he:function(A){if(this.issueId>0)return 0;var t=this.iT;if(!t)return 0;if(A&&q.indexOf(A,this.issueId)>=0){q.warn("recursive call "+this.issueId+" "+A.join(","));return 0}t=t.creationContext&&t.creationContext.sample;if(!t)return 0;if(t>=0)return t;t=this.panel.cJ().oP(t);if(!t)return 0;A||(A=[]);A.push(this.issueId);return t.he(A)},lp:function(){if(this.issueId>0)return null;var A=this.iT;if(!A)return null;A=q.extend({},A.creationContext);A.sample=this.he();if(!A.sample&&(!A.pid|| !A.issuetype))return null;return A},kd:function(A){if(this.iT){var t=this.iT.creationContext;if(t){t.mode=A.mode;t.pid=A.pid;t.issuetype=A.issuetype;var d=this;q.eachValue(this.ho,function(s,z){if(!s.jq()&& !s.kc()){var I=s.gg();s.gW();d.kF[z]=I}});for(var a in d.kF)if(d.kF.hasOwnProperty(a)&&d.kF[a]!=null)this.ho[a]=null;this.panel.widget.az.kJ(this.issueId,t);this.panel.aQ().hF(this.issueId,false);this.jU()}}},jU:function(){var A=this.lp();this.issueId<0&& !A||this.panel.widget.jiraConfig.iG({issueId:this.issueId,creationContext:A})}});
B.IssueEditor=function(A){function t(f,v,E){if(typeof E==="boolean"){var o=A.widget.dm;if(f===o.lastResult()){f={};f[v]=E;o.lu([v],f)}}}function d(f,v){if(v){var E=v.request;if(E&&E.structure===da.id){f.search={type:E.type||"",q:E.q||""};if(E.scope)f.search.scope=E.scope}}}function a(f,v){B.bG.call(this);this.issue=f;this.edit=v;this.hT=v.hB}function s(f,v,E){B.bG.call(this);q.assert(f<0);this.issue=f;this.spec={};this.spec.structure=da.id;this.spec.root=da.getRoot();this.spec.issue=q.extend({},v.jiraDialogData,v.hB);this.init(v.iT.placement,v.iT.creationContext);this.edit=v;this.priority=E}function z(f,v,E,o){B.bG.call(this);q.assert(f<0);q.assert(v>0);this.editingIssue=f;this.createdIssue=v;this.spec={actions:[{action:"add",under:E.iT.placement.under,after:E.iT.placement.after,issue:v}],root:da.getRoot()};this.structure=da.id;this.edit=E;this.priority=o}function I(){var f=0,v=false,E=0;q.eachValue(na,function(ga){if(ga.hY){f++;if(ga.hJ){if(!v)E=ga.issueId;v=true}else if(!E)E=ga.issueId}});if(f){var o='<span></span><a href="#" class="s-editor-warning-jump" rel="'+E+'" title="'+q.text("s.w.editor.footer-warning.tooltip")+'">',L=v?"s.w.editor.footer-warning.blocking":
"s.w.editor.footer-warning";L+=f===1?".1":".n";o+=q.text(L,f);o+="</a>";ua.html(o)}else ua.empty()}function R(f,v){if(!h())return null;if(!f)return null;if(da.iY())return null;if(!Z.hh(f))return null;var E=qa.value();E&&w(E);q.assert(!na[f]);E=na[f]=new e(f,A,v);E.ji.setValue(G.EDITING);var o=document.activeElement;if(o&&o!==U&&o!==U.document&& !P(o).closest(".s-editorpanel").length)ba=o;la.fireEvent(M.dz,pa,f);ra=true;try{A.cc().jZ(f,true)}finally{ra=false}if(!S(E)){J(E,f);return null}c();return E}function b(f,v,E){if(!f|| !v)return null;if(da.iY())return null;if(!v.isInstanceOf(u.EditableColumn))return null;if(!v.isEditableColumn())return null;if(!Z.hh(f))return null;var o=false,L=na[f];if(L){q.assert(!E);if(L.ji.value()===G.UPLOAD_STARTED)return null}else{na[f]=L=new e(f,A,E);o=true}var ga=document.activeElement,ma=v.getCsid();if(E=L.ho[ma]){if(E.jq())return L;E.cS()}else{E=v.createCellEditor(L);if(!E)return null;E.om(f<0&&h());if(L.kF[ma]){q.assert(f<0,ma);E.lq(L.kF[ma]);L.kF[ma]=null}if(!E.cS()){q.warn("cannot start edit "+f+" column "+v);return null}q.assert(E.jq());L.ho[ma]=E}L.ji.setValue(G.EDITING);ma=E.hc();q.assert(! !ma,ma);if(ga&&ga!==U&&ga!==U.document&& !P(ga)
.closest(".s-editorpanel").length)ba=ga;(ga=qa.value())&&ga!==E&&w(ga);qa.setValue(E);A.aQ().hF(f,true);K();E.takeFocus();o&&la.fireEvent(M.dz,pa,f);ea=v;ra=true;try{A.cc().jZ(f,true)}finally{ra=false}c();return L}function i(f){if(!ra)if(!ka){var v=qa.value();if(v)if(f!==v.issueId){var E= ! !f;if(E)E= ! !b(f,v.column);E||m()}}}function r(f,v,E,o){if(!E&& !A.widget.jiraConfig.jW())return false;if(da.iY())return false;if(na[f])return false;q.assert(f<0,f);Z.eD(f,E);var L=k(f,v);O.add(L);v={issueId:f,placement:v,aV:L,creationContext:{sample:E,pid:0,issuetype:"",mode:E?"clone":"new",parentIssue:0}};A.bn().fs();E=A.af().gj();var ga=o||C()?R(f,v):null;if(!ga&& !o)ga=b(f,E,v);ga?ga.jU():O.remove(L);return ga}function l(){if(ba){if(q.isVisibleOnPage(ba))try{P(ba).focus()}catch(f){}ba=null}}function j(f){if(f){f.gW();f===qa.value()&&qa.setValue(null)}}function w(f){if(f){f.fV();f===qa.value()&&qa.setValue(null)}};function D(f,v,E){var o=na[f];if(o){delete na[f];q.eachValue(o.ho,w);o.iT&&O.remove(o.iT.aV);Z.hs(f,v,E);A.aQ().hF(f,true);q.eachValue(o.ho,j);la.fireEvent(M.aN,pa,f,v);I()}}function J(f,v){if(!f)return false;q.assert(na[v]===f,v);if(f.ji.value()===G.UPLOAD_STARTED)return false;
f.ji.setValue(G.EDIT_CANCELLED);if(f.createDialog){f.createDialog.hide();ca=f.createDialog=null}D(v,false);if(v<0){Z.removeIssueData(v);var E=[];ja.dv(function(ma){var va=ma.bQ(v,null);if(va&&ma.edit){E.push(ma.edit.issueId);ma.edit.ji.setValue(G.UPLOAD_CANCELLED)}return!va});la.fireEvent(M.aA,v,null);F(v,null);if(E.length)for(var o=0;o<E.length;o++){var L=E[o],ga=na[L];ga&&J(ga,L)}f.hJ&&ja.hx(f.issueId)}K();return true}function c(){q.eachValue(na,function(f){if((!ca||ca!==f.createDialog)&& !q.findKey(f.ho,function(v){return v&&v.jq()}))n(f.issueId)})}function p(f){if(!f)return false;if(f.ji.value()===G.UPLOAD_FINISHED){J(f,f.issueId);return false}else if(f.ji.value()!==G.EDITING)return false;return true}function g(f){f.hB={};var v= !q.isEmpty(f.kF);q.eachValue(f.ho,function(o,L){if(v)f.kF[L]=null;w(o);q.extendOwn(f.hB,o.gg())});if(v){var E={};q.eachValue(f.kF,function(o){q.extendOwn(E,o)});q.extendOwn(E,f.hB);f.hB=E}}function n(f){var v=na[f];if(!p(v))return false;v.gM();g(v);var E=q.isEmpty(v.hB);if(!E){var o=v.iT;if(o){q.assert(f===o.issueId);q.assert(f<0);q.assert(! !o.aV);if(v.hB.summary){o= ! !v.hJ;ja.enqueue(new s(f,v,o));o&&ja.hx(f)}else E=true}else ja.enqueue(new a(f,v))}
E?J(v,f):v.ji.setValue(G.UPLOAD_STARTED);K();return!E};function m(){q.eachValue(na,function(f){n(f.issueId)});l()}function F(f,v){q.eachValue(na,function(E){E.ji.value()!==G.UPLOAD_STARTED&&E.issueId!==f&&E.bQ(f,v)&& !v&&J(E,E.issueId)})}function x(){return qa.value()}function H(){var f=qa.value();if(f){f.fV(true);m()}}function ha(f){q.eachValue(f.ho,y)}function y(f){f.iR()}function K(){var f=0,v=qa.value();if(v&&v.hv){f=Math.max(v.hv.height(),0);if(f>0)f+=5}aa.setValue(f)};function N(f){f=na[f];if(!f|| !f.hY)return null;var v=q.findKey(f.ho,function(E){return E&&E.iS()});return v&&f.ho[v]}function S(f){function v(za){f.kQ.cells.project.setValue(""+za)}function E(za){f.kQ.cells.type.setValue(""+za)}if(!h())return false;var o;if(!f){o=x();f=o.hG}if(f){if(ca){f.createDialog=ca;return true}var L=f.panel;if(!p(f))return false;g(f);if(!f.iT)return false;var ga=f.iT.creationContext,ma,va,Ba=f.kQ.cells.cloneMode.value(),Ga= ! !L.widget.jiraConfig.getFeature("altInitialValuesInDialog");if((Ba||Ga)&&ga.sample&&(ga.pid===0||ga.issueType==="")){ma=(ga=Z.cI(ga.sample))&&ga.getValue("jira:raw:project")||"0";va=ga&&ga.getValue("jira:raw:issuetype")||"0"}else if(ga.pid===0||ga.issueType===""){ma=
B.getStored("new.project")||0;va=B.getStored("new.issuetype")||0}else{ma=ga.pid;va=ga.issuetype}Ba&&f.kQ.cells.cloneMode.setValue(false);va=q.toInt(va);var oa=q.extend({},f.jiraDialogData,f.hB),ta={cancel:function(){ca=f.createDialog=null;J(f,f.issueId);m()},inline:function(za,Ca){ca=f.createDialog=null;C(false);var Ea=f.panel.af().gj();L.cc().oQ(f.issueId,function(Ia){var Ka=Ia.getCsid(),Na=f.ho[Ka];if(Na){Na.cS();Na.applyData(za);Na.fV()}else if(Na=Ia.createCellEditor(f)){Na.om(true);Na.cS();Na.applyData(za);Na.fV();if(Na.hS()||Ea.getCsid()===Ka)f.ho[Ka]=Na;else Na.gW()}});f.jiraDialogData=za;f.kQ.cells.cloneMode.setValue(false);f.kQ.cells.project.setValue(""+za.projectId);f.kQ.cells.type.setValue(""+za.issueType);Ca&&f.jj({fieldErrors:Ca});f.ji.setValue(G.EDITING);o||(o=f.ho[Ea.getCsid()]);qa.setValue(o);o.cS();L.aQ().hF(f.issueId,true);K();o.takeFocus();ra=true;try{L.cc().jZ(f.issueId,true)}finally{ra=false}},submit:function(za,Ca){var Ea= ! !f.hJ;ja.enqueue(new z(f.issueId,za,f,Ea));Ea&&ja.hx(f.issueId);f.ji.setValue(G.UPLOAD_STARTED);if(Ca){Ea=L.cJ().nextTemporaryIssueId();var Ia=q.extendOwn({},f.iT.placement),Ka=f.iT.creationContext.sample;Ia.under!==0&&L.ao().by(Ia.under,
true);Ia.after=f.issueId;f=r(Ea,Ia,Ka,true);L.ao().kK(Ea,L.bs());L.bn().aJ()}else ca=f.createDialog=null},onProjectId:v,onIssueType:E,openFailed:function(){q.eachValue(f.ho,function(za){za.om(false)})}},Aa=ca=f.createDialog={hide:q.noop};f.kQ.cells.kZ.pipeOnce(function(za){return za},function(){ma=f.kQ.validateProjectId(ma);ma=q.toIntSafe(ma,0);var za=L.widget.jiraConfig.validateStructuredProjectId(ma);if(za&&za!==ma){ma=za;va=null}if(ma){v(ma);va&&E(va)}B.openCreateIssueDialog(ma,va,oa,f.hA,Ba,f.panel.widget,ta,Aa)})}return true}function Y(){q.eachValue(na,function(f){q.eachValue(f.ho,function(v){v.jr()})})}var Z=A.widget.az,la=A.bD(),da=q.nn(A.widget.currentStructure),O=A.dC(),W=A.aT(),ia=A.bd(),ja=A.bE(),pa=this,na={},qa=(new q.Cell).setValue(null),aa=(new q.Cell).setValue(0),X= -100,ba,ea=null,ra=false,ka=false,ca=null;qa.pipeChanges(function(){ka=false});q.extend(a.prototype,B.bG.prototype,{aj:function(){return this.hT},bN:function(){return null},isOverridingAction:function(f){return f instanceof a&&this.issue===f.issue},bQ:function(f,v){var E=this.edit.bQ(f,v);if(this.issue===f){q.assert(E,this.edit);E=true;this.issue=v}return E}});ja.aF({dw:function(f){function v(ma){var va=
 ! !(ma&&ma.success);if(va){E.edit.ji.setValue(G.UPLOAD_FINISHED);D(E.issue,true,ma.newDataVersion||0);t(L,E.issue,ma.searchResult)}else{E.edit.jj(ma);A.aQ().hF(E.edit.issueId,false);I()}la.fireEvent(M.EDIT_UPLOAD_FINISHED,E.edit.issueId,va)}var E=f[0];if(!(E instanceof a))return null;if(E.issue<0)return null;f=B.ajax.RESOURCES.issueUpdate(E.issue);var o={};o.issue=E.hT;var L=A.widget.dm.lastResult();d(o,L);var ga=ia.bS(E.issue)||[];return{count:1,url:f,data:B.apputil.ct(o),cB:false,es:v,eI:v,ax:function(){la.fireEvent(M.UPLOAD_FINISHED,[E.issue],ga)}}}});q.extend(s.prototype,B.bG.prototype,{aj:function(){return this.spec},bN:function(){return null},isOverridingAction:function(f){return f instanceof s&&this.issue===f.issue},bQ:function(f,v){q.assert(this.issue!==f);var E=this.edit.bQ(f,v);E&&this.init(this.edit.iT.placement,this.edit.iT.creationContext);return E},init:function(f,v){q.extend(this.spec,f,v);if(this.spec.mode!=="clone")this.spec.sample=0}});ja.aF({dw:function(f){function v(ma){var va=E.issue;E.edit.jj(ma);E.edit.hJ=true;ja.iP(va);A.aQ().hF(E.edit.issueId,false);I()}var E=f[0];if(!(E instanceof s))return null;var o=A.widget.dm.lastResult();f=E.spec;if(f.under<0){
q.warn("cannot upload creation of a new issue under "+f.under);return null}if(f.sample<0){q.warn("cannot upload creation of a new issue with sample "+f.sample);return null}if(f.after<0){q.warn("cannot upload creation of a new issue after "+f.after+", using 0");f.after=0}var L=null;f.base=0;if(f.structure===da.id&&f.root===da.getRoot()){f.base=da.version;L={attempt:1,cY:1,structureId:f.structure,baseVersion:f.base,root:f.root}}d(f,o);var ga={};q.flipSet(W.bS(W.bL(f.under)),null,ga);q.flipSet(ia.bS(E.issue),null,ga);return{count:1,url:B.ajax.RESOURCES.ISSUE_CREATE,data:B.apputil.ct(f),cB:true,es:function(ma){var va=q.toIntSafe(ma&&ma.newIssue,-1);if(va>0){E.edit.ji.setValue(G.UPLOAD_FINISHED);E.createdId=va;A.dR().pinIssue(va);var Ba=E.issue;ja.dv(function(Ga){Ga.bQ(Ba,va);return true});Z.fz(Ba,va);D(E.issue,true,ma.newDataVersion||0);la.fireEvent(M.aA,Ba,va);F(Ba,va);t(o,va,ma.searchResult)}else v(ma)},eI:v,ax:function(){var ma=[E.issue];if(E.createdId){q.flipSet(W.bS(E.createdId),null,ga);ma.push(E.createdId)}la.fireEvent(M.UPLOAD_FINISHED,ma,q.numericKeys(ga))},fF:L}}});q.extend(z.prototype,B.bG.prototype,{aj:function(){return this.spec},bN:function(){return null},
isOverridingAction:function(f){return f instanceof s&&this.editingIssue===f.issue||f instanceof z&&this.editingIssue===f.editingIssue},bQ:function(f,v){q.assert(this.editingIssue!==f);var E=this.edit.bQ(f,v);E&&q.extendOwn(this.spec.actions[0],this.edit.iT.placement);return E}});ja.aF({dw:function(f){var v=f[0];if(!(v instanceof z))return null;f=v.spec;var E=f.actions[0];if(E.under<0){q.warn("cannot upload creation of a new issue under "+E.under);return null}if(E.after<0){q.warn("cannot upload creation of a new issue after "+E.after+", using 0");E.after=0}var o=null;f.base=0;if(v.structure===da.id&&f.root===da.getRoot()){f.base=da.version;o={attempt:1,cY:1,structureId:v.structure,baseVersion:f.base,root:f.root}}var L={};q.flipSet(W.bS(W.bL(E.under)),null,L);q.flipSet(ia.bS(v.editingIssue),null,L);return{count:1,url:B.ajax.RESOURCES.forest(v.structure),data:B.apputil.ct(f),cB:true,es:function(){v.edit.ji.setValue(G.UPLOAD_FINISHED);var ga=v.createdIssue;A.dR().pinIssue(ga);var ma=v.editingIssue;ja.dv(function(va){va.bQ(ma,ga);return true});Z.fz(ma,ga);D(v.editingIssue,true,0);la.fireEvent(M.aA,ma,ga);F(ma,ga)},ax:function(){var ga=[v.editingIssue];if(v.createdIssue){q.flipSet(W.bS(
v.createdIssue),null,L);ga.push(v.createdIssue)}la.fireEvent(M.UPLOAD_FINISHED,ga,q.numericKeys(L))},fF:o}}});var ua=A.widget.div$.find(".s-editor-warning");ua.delegate("a","click",function(f){var v=q.toIntSafe(P(f.target).attr("rel"),0);if(v){f.preventDefault();(f=(f=N(v))&&f.column)&&b(v,f);return false}});q.extend(this,{cu:function(){return!q.isEmptyOrFalsy(na)},iC:function(f){return! !na[f]},kH:function(f){if(!(f<0))return false;f=na[f];return! !(f&&f.ji.value()!==G.UPLOAD_STARTED)},nextTemporaryIssueId:function(){return X--},hm:function(f,v){var E=na[f];return E&&E.ho[v]},oP:function(f){return na[f]},po:function(f){f=(f=this.oP(f))?new q.Cell(f.ji,q.curry(q.accessArray,T)):new q.Cell(null);return f},dO:b,fN:r,moveNew:function(f,v,E){var o=na[f];if(!o)return false;o=o.iT;if(!o)return false;o.placement.under=v;o.placement.after=E;v=o.aV;o.aV=k(f,o.placement);O.replace(v,o.aV);return true},gf:function(){q.eachValue(na,J);l()},fR:m,fZ:function(){var f=qa.value();if(f)if(f=f.hG){J(f,f.issueId);q.assert(!qa.value())}m()},gd:function(f){var v=na[f];if(!v)return false;f=J(v,f);m();return f},hI:H,finishEdit:n,hH:function(f){if(!f|| !f.target)return null;var v=
B.apputil.getIssueIdFromEvent(f);if(!v)return null;v=na[v];if(!v)return null;var E=P(f.target).parents().andSelf(),o=null;q.eachValue(v.ho,function(L){var ga=L.hc();if(ga&&ga.length)if(q.indexOf(E,ga[0])>=0){o=L;return false}});return o},fQ:x,hE:function(){return qa},fS:function(){return aa},je:function(){q.eachValue(na,ha)},gq:function(){return ea},ik:K,iM:function(f,v){var E=na[f];if(!E|| !E.hY)return false;if(!v)return true;return(E=E.ho[v.getCsid()])&&E.iS()},hD:N,ih:function(){var f=qa.value();f&&f.kS(true,true)},iE:function(){var f=0,v=[],E=0;q.eachValue(na,function(L){if(L.ie()){f++;L=L.issueId;if(L<0)E++;else v.push(Z.getIssueKey(L)||"#"+L)}});if(!f)return null;if(E>0)v.push(q.text(E===1?"s.w.warn.edited.sub.new.1":"s.w.warn.edited.sub.new.n",E));var o=q.text("s.w.warn.edited.sub",v.join(", "));o=q.text("s.w.warn.edited")+" \n\n"+o;if(ja.jk())o+=" \n\n"+q.text("s.w.warn.edit.blocked");return o},kX:function(f){if(f>0)return true;f=na[f];if(!f)return true;var v=false;q.eachValue(f.ho,function(E){if(E.hasSummary){v=E.hasSummary();return false}});return v},switchToDialog:function(){S(null)&&C(true)},canCreateDialog:h,nM:C});pa[M.ar]=Y;pa[M.au]=Y;pa[M.eu]=i;pa[M.mg]=function(f,
v){var E=qa.value();if(E){if(E=v===A&&f&&f.rowId(0)===E.issueId)for(var o=1,L=f.size();o<L;o++)if(f.rowDepth(o)===0){E=false;break}if(E)ka=true;else m()}};pa[M.aq]=q.delayed(50,function(){if(ka){ka=false;i(A.ao().bm());var f=qa.value();f&&f.takeFocus()}});pa[M.cv]=H;la.addListener(new q.Life,pa)};B.IssueEditStates={EDITING:1,SUCCESS:2,CANCEL:3};var T={};T[G.EDITING]=B.IssueEditStates.EDITING;T[G.UPLOAD_STARTED]=B.IssueEditStates.EDITING;T[G.UPLOAD_FINISHED]=B.IssueEditStates.SUCCESS;T[G.UPLOAD_FAILED]=B.IssueEditStates.EDITING;T[G.EDIT_CANCELLED]=B.IssueEditStates.CANCEL;T[G.UPLOAD_CANCELLED]=B.IssueEditStates.CANCEL})(window);(function(U,C){var h=namespace("almworks.structure"),k=namespace("almworks.structure.apputil"),e=namespace("almworks.util"),B=namespace("almworks.structure.appevents"),q=h.$;h.JiraConfig=function(M){function u(ba,ea){return ba.name.localeCompare(ea.name)}function P(){if(!(K||N)){N=true;var ba=new l.Task(h.ajax.RESOURCES.CONFIG_WIDGET,h.ajax.DOWNLOAD,function(ea){if(ea){p=ea.structureVersion||"";g=ea.jiraVersion||"";n=ea.licenseInvalid||false;var ra=ea.jiraFields;if(ra)if(ra.length){for(var ka=[],ca=0;ca<ra.length;ca++){var ua=ra[ca];if(!ua.id|| !ua.name)
e.warn("bad column "+ua);else na[ua.id]||ka.push(ua)}D=ka}else D=[];else{e.warn("invalid columns "+ra);D=[]}D.sort(u);J=null;c= ! !ea.canCreate;m= ! !ea.canBulkChange;F= ! !ea.canCreateViews;x= ! !ea.canShareViews;H= ! !ea.admin;ha=ea.features||{}}else Y.push("Cannot load widget configuration")},pa);ba.chainComplete(function(){N=false;K=true;for(var ea=0;ea<S.length;ea++)e.safeCall(S[ea],C,w);S=[]});l.addTask(ba)}}function G(ba){var ea=ba.creationContext;if(ea)if(ea.pid&&ea.issuetype)return da;else{if(ea.sample)return la}else if(ba.issueId>0)return Z;return null}function Q(ba,ea){if(ba===Z)return ea.issueId;else if(ba===la)return ea.creationContext.sample;else if(ba===da){var ra=ea.creationContext;return ""+ra.pid+":"+ra.issuetype}else return null}function T(ba){var ea=G(ba);ba=Q(ea,ba);return ea&&ba?ea.getValue(ba):null}function A(ba){if(ba){var ea=ba.field,ra=G(ba),ka=Q(ra,ba);if(!ra|| !ka){e.safeCall(ba.ii);e.safeCall(ba.hQ)}else{var ca=ra.getValue(ka);if(ca){e.safeCall(ba.jw,ba,ca);e.safeCall(ba.hQ)}else{ca=ra===da?h.ajax.RESOURCES.CREATE_FIELDS+"?project="+ba.creationContext.pid+"&issuetype="+ba.creationContext.issuetype:ra===la?h.ajax.RESOURCES.CREATE_FIELDS+"?sample="+
ba.creationContext.sample:h.ajax.RESOURCES.UPDATE_FIELDS+"?issue="+ba.issueId;if(ea)ca+="&field="+encodeURIComponent(ea);ca=new l.Task(ca,h.ajax.DOWNLOAD,function(ua){if(ua){e.safeCall(ba.jw,ba,ua);ea?d(ba):ra.putValue(ka,ua)}else e.safeCall(ba.ii,ba,e.text("s.w.config.fields.load-got-nothing"))},function(ua,f){var v=e.httpErrorReport(ua,f);e.safeCall(ba.ii,ba,e.text("s.w.config.fields.load-error",v.title))});ca.chainComplete(function(){e.safeCall(ba.hQ)});l.addTask(ca)}}}}function t(){O=false}function d(ba){if(!O)if(!T(ba)){O=true;A({issueId:ba.issueId,creationContext:ba.creationContext&&e.extend({},ba.creationContext),hQ:t})}}function a(ba){Z.removeValue(ba);la.removeValue(ba)}function s(ba,ea){try{if(ba&&ea){var ra=ba.project&&ba.project.createHtml;if(ra){var ka=e.flipSet(ea,e.returnTrue),ca=q("<div></div>").html(ra),ua=ca.find('select[name="pid"]');ua.length?ua.find("option").filter(function(){var v=e.toIntSafe(q(this).attr("value"),0);return v>0&& !ka[v]}).remove():z(ca,ka);ba.project.createHtml=ca.html()}}}catch(f){e.warn("cannot filter project selections: "+f)}}function z(ba,ea){var ra=ba.find("#project-options"),ka=U.JSON.parse(ra.attr("data-suggestions")),ca=false;if(
q.isArray(ka))ka=ka.filter(function(ua){if(!ua|| !q.isArray(ua.items))return true;var f=false;ua.items=ua.items.filter(function(v){var E=v&&ea[v.value];if(!E){ca=true;if(v&&v.selected)f=true}return E});if(!ua.items.length)return false;if(f)ua.items[0].selected=true;return true});ca&&ra.attr("data-suggestions",k.ct(ka));return ca}function I(ba,ea,ra,ka){if(y[ba])ra(y[ba]);else{ea=new l.Task(ea,h.ajax.DOWNLOAD,function(ca){y[ba]=typeof ka==="function"?ka(ca):ca&&ca[ka]||null},function(ca,ua){e.httpErrorReport(ca,ua)});ea.chainComplete(function(){ra(y[ba])});l.addTask(ea)}}function R(){if(!ja){if(!W)return null;var ba=W&&W.issuetype&&W.issuetype.createHtml;if(!ba)return null;var ea=q("<div></div>");ea.html(ba);(ja=b(ea))||(ja=i(ea))}return ja}function b(ba){function ea(ua){if(ua)for(var f=0;f<(ua?ua.length:0);f++){var v=e.toIntSafe(ua[f].value,0);if(v>0)ca[v]=true}}ba=ba.find("#issuetype-options").attr("data-suggestions");if(!ba)return null;var ra;try{ra=U.JSON.parse(ba)}catch(ka){e.warn("cannot parse data-suggestions from #issuetype-options",ka)}if(!ra)return null;var ca={};if(ra.length>0)if(ra[0]&&ra[0].items)for(ba=0;ba<ra.length;ba++)ea(ra[ba].items);else ea(ra);return ca}
function i(ba){var ea={};ba.find('select[name="issuetype"] option[value]').each(function(){var ra=e.toIntSafe(q(this).attr("value"),0);if(ra>0)ea[ra]=true});return ea}function r(){if(g){var ba=aa.exec(g);if(ba){var ea=e.toIntSafe(ba[1],0),ra=e.toIntSafe(ba[2],0);ba=e.toIntSafe(ba[4],0);return ea*1E4+ra*100+ba}}return C}var l=e.nn(M.ajax),j=e.nn(M.errorCentral),w=this,D=[],J=null,c=false,p="",g="",n=false,m=false,F=false,x=false,H=false,ha={},y={},K=false,N=false,S=[],Y=[],Z=new e.LRUCache(20),la=new e.LRUCache(10),da=new e.LRUCache(20),O=false,W=null,ia=null,ja=null;this.getJiraFields=function(){return D};this.getJiraFieldMap=function(){J||(J=e.mapArray(D,function(ba){return ba.id}));return J};this.getFeature=function(ba){return ha[ba]};this.load=function(ba){if(typeof ba==="function")K?e.safeCall(ba,C,w):S.push(ba);P()};this.getErrors=function(){return Y};this.isReady=function(){return K};var pa=function(ba,ea){var ra=e.httpErrorReport(ba,ea);j.reportError(new h.error.AppError(e.text("sw.error.load-config",ra.title),ra.details))},na={aggregatetimeoriginalestimate:true,aggregateprogress:true,aggregatetimeestimate:true,aggregatetimespent:true,progress:true},qa=null,aa=
/^(\d+)\.(\d+)(\.(\d+))?/,X=["project","issuetype","assignee","environment","priority","security","versions","fixVersions","components"];M.eventBus.addListener(new e.Life,this);this[B.aX]=function(ba){if(ba){if(Z.size()||la.size())for(var ea=0,ra=ba.length;ea<ra;ea++)a(ba[ea])}else{Z.clear();la.clear()}};this[B.aN]=function(ba,ea,ra){ra&&a(ea)};e.extend(this,{gB:A,hy:T,gZ:function(){return X},iG:d,hK:a,ke:function(){return K?c&& !n:null},kx:function(ba){if(W)ba(W);else{var ea=null,ra=new l.Task(h.ajax.RESOURCES.CREATE_FIELDS+"?field=project&field=issuetype",h.ajax.DOWNLOAD,function(ka){if(typeof ka==="object"&&ka.fields){W=ka.fields;(ia=ka.structuredProjects)&&s(W,ia)}},function(ka,ca){ea=e.httpErrorReport(ka,ca)});ra.chainComplete(function(){ba(W,ea)});l.addTask(ra)}},lk:function(ba){var ea=R();return ea&& !ea[ba]},lf:function(){return p},jW:function(){if(qa!==null)return qa;var ba=true;if(g){ba=r();ba=ba>=40403||ba===C}return qa=ba},le:function(){return n},lP:function(){return K&&m},isCreateViewAllowed:function(){return K&&F&& !n},isShareViewAllowed:function(){return K&&x&& !n},isAdmin:function(){return K&&H},getVersionSignature:r,filterProjectsSelectionJira64:z,mJ:function(ba){
I("assignableGroups",h.ajax.RESOURCES.CONFIG_GROUPS+"?assignable=true",ba,"groups")},mB:function(ba){I("availableRoles",h.ajax.RESOURCES.CONFIG_ROLES,ba,"roles")},mn:function(ba){I("projectsWithRoles",h.ajax.RESOURCES.CONFIG_PROJECTS+"?withRoles=true",ba,function(ea){var ra=ea&&ea.projects;if(!ra)return null;ea=e.mapArray(ea.roles,function(E){return E.id});for(var ka=0,ca=ra.length;ka<ca;ka++){var ua=ra[ka],f=ua.userRoles;if(f){ua=0;for(var v=f.length;ua<v;ua++){f[ua]=ea[f[ua]];if(!f[ua]){f.splice(ua,1);ua--;v--}}}else ua.userRoles=[]}return ra})},validateStructuredProjectId:function(ba){if(!ia|| !ia.length)return ba;for(var ea=0;ea<ia.length;ea++)if(ia[ea]==ba)return ba;return ia[0]}})}})(window);(function(){var U=namespace("almworks.structure"),C=namespace("almworks.structure.ajsbridge"),h=namespace("almworks.util"),k=namespace("almworks.structure.appevents"),e=namespace("AJS",false),B=U.getUrlHashParam("traceForestLoad");U.fv=function(q){function M(){N=false;m=(new Date).getTime()}function u(){if(N||z.getLoadingWeight()>0||i.isLoading()||j.isLoading())return false;var O=r.dY(),W=b.id;if(O<0)return false;if(!W)return false;var ia=b.getRoot();B&&h.debug("P:forest",W,b.version,ia);
var ja=U.ajax.RESOURCES.POLL+"?data="+O+"&sid="+encodeURIComponent(W);U.modes.GADGET||(ja+="&loggedIn="+J);var pa=j.lg.value();ja+=pa?"&hver="+encodeURIComponent(pa.version):"&base="+encodeURIComponent(b.version);if(j.visibleCell.value())ja+="&htop="+encodeURIComponent(j.gA());if(ia)ja+="&root="+encodeURIComponent(ia);if(l.activeCell.value())ja+="&markResolved=true";var na=w.lastResult();if(na){var qa=na.request;if(qa&&qa.structure===W){ja+="&search="+qa.type+"&q="+encodeURIComponent(qa.q);if(qa.scope)ja+="&scope="+encodeURIComponent(qa.scope)}}var aa={attempt:1,cY:1,structureId:W,baseVersion:b.version,root:ia};N=true;s.addTask(new s.Task(ja,U.ajax.DOWNLOAD,function(X){M();if(X){var ba=T(X.data,O,X.resolvedInForest),ea=null,ra=function(f){if(f==="all")ea="all";else if(typeof f==="number"){h.assert(ea!=="all");ea||(ea={});ea[f]=true}},ka=null,ca=null;if(na)ca=function(f){if(f==="all")ka="all";else if(typeof f==="number"){h.assert(ka!=="all");ka||(ka=[]);ka.push(f)}};var ua=null;Q(X.forest,aa,ca,ra,function(f){if(f==="all")ua="all";else if(typeof f==="number"){h.assert(ua!=="all");ua||(ua={});ua[f]=true;D.aO(f)}});ca=null;if(ba){ca=X.data.toVersion;ba!=="all"&&ea!=="all"&&P(ba,ra)}
if(ea!=="all")ea=h.numericKeys(ea);r.eB(ca,ba,ea);A(X.history);G(X.searchResult,qa,ba,ka);if(ua!=="all")ua=h.numericKeys(ua);q.eventBus.fireEvent(k.POLL_FINISHED,ua,ba,ea)}},function(X){M();if(X.status===401){la=false;if((X=namespace("JIRA.Messages",false))&&X.showErrorMsg){var ba=C.localURL("/login.jsp")+"?os_destination="+encodeURIComponent(C.currentURL());X.showErrorMsg(h.renderTemplate("{s.w.error.http.401:html,loginUrl}",{loginUrl:ba}),{closeable:true,timeout:0})}}}));m=(new Date).getTime();return true}function P(O,W){var ia=q.master.aT(),ja,pa,na,qa,aa;ja=0;for(na=O.length;ja<na;ja++)if((aa=ia.bS(O[ja]))&&aa.length>0){pa=0;for(qa=aa.length;pa<qa;pa++)W(aa[pa])}}function G(O,W,ia,ja){if(ia==="all"||ja==="all")w.ln();else if(ia||ja)if(typeof O==="string"){var pa=w.lastResult();if(!(!pa||pa.request!==W)){W=ja||ia;ia&&ja&&h.addAll(W,ia);O=U.apputil.kf(O);w.lu(W,O)}}}function Q(O,W,ia,ja,pa){if(O)try{z.applyUpdate(O,W,ia,ja,pa)}catch(na){h.error(na)}}function T(O,W,ia){if(!O||O.empty)return null;if(W!==r.dY())return null;var ja=O.fromVersion,pa=O.toVersion;if(ja!==W){h.warn("unexpected data version update "+ja+" -> "+pa+" ["+W+"]");return null}W=O.issues;var na;if(O.global)na=
"all";else if(W)na=U.apputil.cl(W);O=typeof ia==="string"?U.apputil.kf(ia):null;l.resolvedIssuesUpdate(na,O);return na}function A(O){O&&j.iL(O)}function t(){n<=0||g>p||(K=(new Date).getTime()+n)}function d(){if(U.modes.DEVMODE|| !y|| !la)return false;if(!b.id|| !b.version|| !b.isLoaded())return false;if(F||x|| !Z)return false;if(!S&& !Y.value())return false;var O=(new Date).getTime();if(O<K&&O>=m+g)return true;if(O<m+c)return false;if(ha&&O<m+p)return false;return true};function a(){d()&&u()}var s=q.ajax,z=q.master.bJ(),I=q.globalActions,R=q.eventBus,b=q.currentStructure,i=q.fk,r=q.az,l=q.hC,j=q.ir,w=q.dm,D=q.master.nX(),J= ! !(e&&e.params&&e.params.loggedInUser),c=q.config.pollInterval,p=q.config.inactivePollInterval,g=q.config.boostedPollInterval,n=q.config.boostDuration,m=0,F=false,x=false,H=false,ha=false,y=true,K=0,N=false,S=true,Y=new h.Cell(false),Z=true,la=true;c>0&&window.setInterval(a,500);var da=h.delayed(1E3,t);R.addListener(new h.Life,this);this[k.dz]=function(){F=true};this[k.ISSUE_DETAILS_EDIT_STARTED]=function(){x=true};this[k.aN]=function(O,W,ia){F=O.cu();if(ia)H=true;if(!F){H&&da();H=false}};this[k.ISSUE_DETAILS_EDIT_STOPPED]=function(){x=false};this[k.cX]=
function(){ha=true};this[k.cj]=function(){ha=false;a()};this[k.bX]=function(O){y=O};this[k.cd]=da;this[k.aE]=function(O){(Z=O.isIdle())&&da()};R=h.delayed(100,t);this[k.gJ]=R;this[k.kD]=R;this[k.jx]=function(O){if(S=O){da();a()}};I.register("_poll",u);this.poll=u;this.iQ=Y}})();(function(){function U(q){return C(q[0])}function C(q){if(!q)throw Error("no element");q=q.id||B(q).attr("id");if(!q)throw Error("no id");var M=q.indexOf("_");if(M<0)throw Error("bad id "+q);return k.toInt(q.substring(M+1))}var h=namespace("almworks.structure"),k=namespace("almworks.util"),e=namespace("almworks.structure.appevents"),B=h.$;k.extend(h,{eE:function(q){function M(j,w){return!w|| !k.onPage(w)}function u(j,w,D,J){var c=r.getValueNoLRU(j);if(!c)return false;return P(c,j,w,D,J)}function P(j,w,D,J,c){var p=T.cI(w);if(!p)return false;c=d.aL(w)||A.aL(w)||c;if(!c)return false;k.assert(c.id==w,c.id+" "+w);if(!J&&p.fT===R[w]&&c.sequence===I[w])return false;R[w]=p.fT;I[w]=c.sequence;Q.render(j,p,c);D&&s.fireEvent(e.bY,j);return true}function G(j,w){if(w.columns){var D=j.getColumns();if(D&&D.length){for(var J={},c=0;c<D.length;c++)k.flipSet(D[c].getRequiredFields(),null,J);T.fu(q.panelId,k.keysOf(J));
r.removeMatching(M);r.forEach(function(p,g){P(g,k.toInt(p),true,true,null)});s.fireEvent(e.kE)}}}var Q=q.ew(),T=q.widget.az,A=q.aT(),t=q.bd(),d=q.bs(),a=q.ae(),s=q.bD(),z=q.panelId,I={},R={},b={},i="t"+q.sequence+"_",r=k.extend(new k.LRUCache(q.widget.config.rowCacheSize),{isExpungePossible:M}),l=k.delayed(25,function(){var j=b;b={};for(var w in j)if(j.hasOwnProperty(w)){var D=k.toIntSafe(w,0);D!==0&&u(D,true,false)}});this.cZ=function(j,w){var D=r.getValue(j);if(!D){T.requireIssueData(j);D=B("<div></div>");D.addClass("tr "+z+"fullwidth");D.attr("id",i+j);D.attr("rel",j);r.putValue(j,D);u(j,false,true,w)}return D};this.rowByIssueId=function(j){var w=h.apputil.fJ(j);w||k.warn("rowr: bad issueId "+j);return B("#"+(i+w))};this.hF=function(j,w){if(r.getValueNoLRU(j)){R[j]= -1;if(w){b[j]=false;u(j,true,true)}else{b[j]=true;l()}}};this.forEachRow=function(j){r.forEach(j)};this[e.aX]=function(j){if(j&&j.length){for(var w=0;w<j.length;w++)u(j[w],true,false);setTimeout(function(){t.eY(j)},50);s.fireEvent(e.kE)}};this[e.ko]=G;this[e.aA]=function(j,w){var D=r.removeValue(j);if(D)if(w&& !r.getValueNoLRU(w)){D.attr("id",i+w);D.attr("rel",w);r.putValue(w,D)}};a.events.addListener(new k.Life,
h.bi.E,function(j,w){if(j&&w)for(var D=j.from+j.count,J=j.from;J<D;J++){var c=w.row(J);u(c.id,true,false)}});s.addListener(new k.Life,this);G(q.af(),{columns:true})},getIssueIdFromTR:U,gi:C,getIssueIdFromParentTR:function(q){if(!q)return null;q=B(q).closest(".tr");return q.length?U(q):null}})})();(function(){var U=namespace("almworks.util"),C=namespace("almworks.structure"),h=C.$;C.ei=function(k){function e(u,P){u.stop(true,false).addClass("s-bganimation").animate({backgroundColor:P},{duration:200,easing:"swing",complete:function(){if(U.onPage(u)){var G=u.parent().css("background-color")||"#ffffff";u.animate({backgroundColor:G},{duration:800,easing:"swing",complete:function(){u.removeClass("s-bganimation").css("background-color","")}})}else u.removeClass("s-bganimation").css("background-color","")}})}var B=k.af(),q=k.cJ(),M={getIssueId:function(){return this._rowData.getId()},getFieldValue:function(u){return this._issueData.getValue(u)},getEscapedFieldValue:function(u){return this._issueData.eS(u)},_cell$:null,_issueData:null,_rowData:null,_cellEditor:null,_getDepthOffset:function(){return k.widget.config.getDepthOffset(this._rowData.getDepth())}};this.render=function(u,P,G){if(!(!
P|| !u|| !G)){var Q=B.getColumns(),T=u.children();if(!T.length){T="";for(var A=0;A<Q.length;A++)T+='<div class="'+("td "+k.columnClass(A))+'"></div>';u.append(T);T=u.children()}A=q&&q.iC(G.getId());for(var t=P.shouldRender()||G.getId()<0||A,d=t&&U.onPage(u),a=d?P.fd():null,s=T.length,z=0;z<Q.length;z++){var I=Q[z],R;if(z>=s){R=h('<div class="'+("td "+k.columnClass(z))+'"></div>');u.append(R)}else R=h(T[z]);if(t){var b=A&&q.hm(G.getId(),I.getCsid()),i=P,r=G,l=b;M._cell$=R;M._issueData=i;M._rowData=r;M._cellEditor=l;try{I.render(M)}catch(j){U.warn(j)}finally{M._cell$=null;M._issueData=null;M._rowData=null;M._cellEditor=null}if(d)if(b&&b.jb())e(R,"#ffbbbb");else a&&I.shouldFlash(a,R,P,G)&&e(R,"#ffffbb")}}z<s&&T.slice(z).remove()}}}})();(function(){function U(u){this.params=u||{}}var C=namespace("almworks.structure.tableConfig"),h=namespace("almworks.structure.columns");namespace("almworks.structure.ajsbridge");var k=namespace("almworks.structure.appevents"),e=namespace("almworks.util"),B=namespace("almworks.structure.$"),q=namespace("almworks.structure"),M=namespace("almworks.structure.api");C.params={bh:"dci",aU:"tb"};e.extend(U.prototype,{getParam:function(u){if(!u)throw Error(
"bad parameter");return this.params[u]},updateParams:function(u){this.params=u},getParams:function(){return this.params}});e.extend(C,{fn:U,dZ:function(u){function P(R){e.assert(R instanceof U);z=R;I=true;T();t.fireEvent(k.bC,z)}function G(R,b){return b+";"+R+"="+this[R]}function Q(){var R="",b=z.getParams();return R=e.eachOwn(b,G,R)}function T(){s.storageKey&&q.setStored(s.storageKey,Q(),d.lE)}function A(){var R={};R[C.params.bh]=a?d.showClosed:"show";R[C.params.aU]=a?d.showToolbar:false;return R}e.nn(u.widget.jiraConfig);var t=e.nn(u.bD()),d=e.nn(u.widget.config);e.nn(u.config);var a=u.widget.master===u,s=this,z=new U(A()),I=false;e.extend(this,{setConfig:P,getConfig:function(){return z},aK:Q,lb:function(R){if(a)R.master.showClosedIssues=z.getParam(C.params.bh)},isConfigSet:function(){return I},updateParam:function(R,b){var i=z.getParams();i[R]=b;z.updateParams(i);T();t.fireEvent(k.bC,z)},restoreConfig:function(R){if(a){var b=A(),i="";if(R){s.storageKey=R;if(d.lE){s.storageKey+=".perspective";i=q.getStored(s.storageKey)}i||(i=q.getStored(R));if(i){R=i.split(";");i=0;for(var r=R.length;i<r;i++){var l=R[i];if(l)for(var j in C.params)if(C.params.hasOwnProperty(j)){var w=C.params[j],
D=w+"=";if(l.indexOf(D)===0){l=l.substring(D.length);if("false"==l)l=false;else if("true"==l)l=true;b[w]=l;break}}}}}if(d.perspectiveSpec){b[C.params.bh]=d.perspectiveSpec.master.showClosedIssues;T()}P(new U(b))}}})},mk:function(u){function P(){var i=z.vd.value().spec;if(i)if(i=i.columns){for(var r=[],l=i.length,j=0;j<l;j++){var w=G(i[j]);w&&r.push(w)}B.when.apply(B,r).then(function(){I=e.arrayFilter(e.toArray(arguments),function(D){return! !D});R=e.mapArray(I,function(D){return D.csid});T(true,false,null);a.fireEvent(k.ko,d,{columns:true,columnWidths:true})})}}function G(i){if(!i)return null;var r=i.csid;if(!r)return null;if(r=R[r])if(!r.isColumnOfType(i.key)|| !e.deepEquals(i,r.getColumnSpec()))r=null;r||(r=Q(i));return r}function Q(i){var r=M.ColumnType.getColumnTypeForKey(i.key);if(!r){e.warn("cannot create column ["+i.key+"] - no column type registered");return null}var l=B.Deferred(),j=null;h.loadTypeMetadata(r,"column").then(function(w){if(j=r.createColumn(h.extendMetadata(e.extendOwn({},b),w),i))return h.loadMetadata(j.getMetadataRequests());return B.Deferred().reject().promise()}).done(function(w){h.extendMetadata(j.context,w)}).always(function(){l.resolve(j)});
return l.promise()}function T(i,r,l){if(!e.isEmptyOrFalsy(R)){var j=z.vd.value().widths;if(!e.isEmptyOrFalsy(j)){var w=j.manual||{},D=j.preferred||{};e.eachOwn(R,function(J){var c=this[J];c.setWidth(w[J]||null);if(c.isAutoSizeAllowed())c._preferredWidth=D[J]||null});i||a.fireEvent(k.ko,d,{columnWidths:true,manualResize:r,kC:l})}}}function A(i){var r,l,j,w,D,J,c=null;r=0;for(l=I.length;r<l;r++){j=I[r];if(j.isAutoSizeAllowed()){w=j.csid;if(i)if(i(j)){j._isAutoSized=true;if(j._stretchedWidth)j._stretchedWidth=null}else continue;else if(j._isAutoSized){c=c||{};c[w]=j._preferredWidth>0?j._preferredWidth:null;continue}D=u.columnClass(r);J=u.panel$.find("div.td."+D+" span.value");if(J.length){D=u.panel$.find("div.th."+D+" div.celldiv span.value");J=t(J,D);if(J>0){c=c||{};c[w]=J;j._isAutoSized=true}}}}return c}function t(i,r){var l=0,j=0,w;i.each(function(){l=Math.max(l,this.clientWidth)});if(l>0){j=r.length&&r.outerWidth(true);j=Math.min(j,90);j=Math.max(l+32,60,j);w=j>=90?10:5;j=Math.ceil(j/w)*w}return j};var d=this;e.nn(u.widget.jiraConfig);var a=e.nn(u.bD()),s=u.bW(),z={vd:s.mR()},I=[],R={},b=h.createColumnContext(u);u.widget.jiraConfig.load(function(){z.vd.pipe(function(r,l){e.assert(
r);if(!l||r.spec!==l.spec)P();else{T(false,r.ey.manual!==l.ey.manual,r.kC);r.kC=null}});var i={};i[k.kE]=function(){var r=A(null);e.isEmptyOrFalsy(r)||s.df({preferred:r},null)};i[k.mh]=function(r){var l,j={},w={},D;if(r&&r.length){r=e.flipSet(r);D=function(J){return r[J.csid]};l=A(D);e.eachOwn(r,function(J){j[J]=null;w[J]=l&&l[J]||null})}else{D=z.vd.value().widths;e.eachOwn(D.manual,function(J){j[J]=null});e.eachOwn(D.preferred,function(J){w[J]=null});D=e.returnTrue;l=A(D);e.extendOwn(w,l)}s.df({manual:j,preferred:w},D)};a.addListener(new e.Life,i)});e.extend(this,{getColumns:function(){return I},eV:function(){return e.find(I,function(i){return i.isColumnOfType("main")})},gj:function(){var i=this.eV();return i<0?null:I[i]}})}})})();(function(U){var C=namespace("almworks.structure"),h=namespace("almworks.structure.apputil"),k=namespace("almworks.structure.columns"),e=namespace("almworks.util"),B=namespace("almworks.structure.appevents"),q=C.$,M=e.requireGlobal("AJS");C.eT=function(u){function P(V){return function(){return ta.value()?false:V.apply(this,arguments)}}function G(V){for(var $=0,fa=V.length;$<fa;$++)V[$]()}function Q(V){if(za)za.push(V.update);else{za=[V.update];
ca.addListener(new e.Life,B.nl,e.delayed(200,function($){$===u&&G(za)}))}}function T(V){if(Ia)Ia.push(V.update);else{Ia=[V.update];var $={};$[B.eu]=$[B.aX]=e.delayed(200,e.curry(G,Ia));ca.addListener(new e.Life,$)}Q(V)}function A(V){if(Ka)Ka.push(V.update);else{Ka=[V.update];var $={};$[B.am]=$[B.aX]=e.delayed(200,t);ca.addListener(new e.Life,$)}Q(V)}function t(){Na=d();try{G(Ka)}finally{Na=null}}function d(){return{expanded:a(E),displayed:a(o),forMove:e.lazy(function(){if(u.widget.currentStructure.iY())return[];var V=this.expanded.original();if(V.length){if(J(V[0]))return[];var $;if($=V.length>1){a:{e.assert(V.length);var fa,sa,xa,Da;$=E.indexOf(V[0]);e.assert($>=0);fa=E.rowDepth($);sa=1;for(xa=V.length;sa<xa;sa++){Da=E.indexOf(V[sa]);e.assert(Da>$&&($=Da));if(E.rowDepth(Da)!==fa){$=false;break a}Da=E.lG(Da);if(Da<0||E.rowId(Da)!=V[sa-1]){$=false;break a}}$=true}$= !$}if($)return[]}return V}),mI:e.lazy(function(){var V=this.expanded.original(),$;if($=V.length)a:{e.assert(V.length);$=e.flipSet(V);var fa,sa,xa,Da,Fa;fa=E.indexOf(V[0]);e.assert(fa>=0);V=E.indexOf(V[V.length-1]);e.assert(V>=fa);for(sa=xa= -1;fa<=V;fa++){Da=E.row(fa);Fa=Da.getId();Da=Da.getDepth();if(Da<=sa)sa=xa= -1;
else if(Da<=xa)xa=Da-1;if($[Fa]){if(Fa<0){$=null;break a}if(sa<0){sa=xa=Da;$[Fa]=0}else if(Da>xa+1){$=null;break a}else{xa=Da;$[Fa]=Da-sa}}}}return $||"disabled"})}}function a(V){return{count:e.lazy(function(){return ea.mp(V)}),original:e.lazy(function(){return ea.getSelected(V)}),normalized:e.lazy(function(){return ea.kT(V)})}};function s(V){this.subscribe=A;this.update=function($,fa,sa){sa.panel=u;return V.update(sa,$,fa)};this.perform=function($,fa,sa){return V.perform(sa,$,fa)}}function z(V){return s.call(this,{update:function($){var fa=(Na||d()).forMove();if(fa.length&&V.update(fa,$)){$.selection=fa;return true}return false},perform:function($){return V.perform($.selection,$)}})}function I(V){if(Ua)Ua.push(V.update);else{Ua=[V.update];var $={},fa=e.delayed(200,e.curry(G,Ua));$[B.be]=fa;$[B.eu]=fa;$[B.cq]=fa;ca.addListener(new e.Life,$)}Q(V)}function R(V,$,fa){ea.jZ(V,$,fa);ba.aJ();return true}function b(V,$){return R(o.rowId(V),false,$)}function i(V){if(ta.value())return false;var $=o.size();if($===0)return false;var fa=ea.bm();if(fa){fa=o.indexOf(fa);if(fa<$-1)fa++;else return false}else fa=0;return b(fa,V)}function r(V){if(ta.value())return false;var $=ea.bm();if(!$)
return false;$=o.indexOf($);if($<=0)return false;$--;return b($,V)}function l(V){if(ta.value())return false;var $=o.size();if($===0)return false;var fa=ea.bm();if(!fa)return false;fa=o.indexOf(fa);if(fa<0||fa>=$-1)return false;var sa=ba.cE();fa=fa!==sa.to&& !sa.animation?sa.to:Math.min($-1,sa.to+(sa.to-sa.from+1));return b(fa,V)}function j(V){if(ta.value())return false;if(o.size()===0)return false;var $=ea.bm();if(!$)return false;$=o.indexOf($);if($<=0)return false;var fa=ba.cE();$=$!==fa.from&& !fa.animation?fa.from:Math.max(0,fa.from-(fa.to-fa.from+1));return b($,V)}function w(V){if(ta.value())return false;if(o.isEmpty())return false;var $=ea.bm();if(!$)return false;if(o.indexOf($)<=0)return false;return b(0,V)}function D(V){if(ta.value())return false;var $=o.size();if($===0)return false;var fa=ea.bm();if(!fa)return false;fa=o.indexOf(fa);if(fa<0||fa>=$-1)return false;return b($-1,V)}function J(V,$){var fa=u.rootPath;if(!fa)return false;fa=fa.value();if(!fa)return false;if(V===0)return true;var sa=e.indexOf(fa,V);return sa>=0&&(!$||sa<fa.length-1)}function c(){var V=ea.bm();if(!V)return-1;return E.indexOf(V)}function p(V){if(u.widget.currentStructure.iY())return null;if(V<0)
return null;V=E.row(V);if(!V)return null;return V}function g(V){var $=null;if(ka){if(V)$=ka.hH(V);$||($=ka.fQ())}return $}function n(V,$,fa,sa){for(var xa=false,Da=$.length;fa>=0&&fa<Da&& !xa;){var Fa=$[fa];if(m(Fa,V))xa= ! !ka.dO(V,Fa);fa+=sa}return xa}function m(V,$){return V&&V.isInstanceOf(k.EditableColumn)&&V.isEditableColumn()&& !V.gb($,u.widget)}function F(V,$){if(!V)return-1;for(var fa=V.length-1;fa>=0;fa--)if(V[fa].getCsid()===$)break;return fa}function x(V,$){if(ta.value())return false;var fa=g($);if(!fa){if(!V&& !ka.fQ()){var sa={};return Pa.update($,null,sa)&&Pa.perform($,null,sa)}return false}sa=fa.getIssueId();var xa=o.indexOf(sa),Da=o.size();if(xa<0)return false;var Fa=u.af().getColumns(),La=F(Fa,fa.getColumnId());if(La<0)return false;fa=V? -1:1;La=n(sa,Fa,La+fa,fa);if(!La){if(!ka.kX(sa))return ha(sa);xa+=fa;if((sa=xa>=0&&xa<Da?o.rowId(xa):0)&&ua.hh(sa))La=n(sa,Fa,V?Fa.length-1:0,fa)}La||ka.fR();return true}function H(V,$){if(ta.value())return false;var fa=g($);if(!fa)return false;var sa=u.af().getColumns(),xa=F(sa,fa.getColumnId());if(xa<0)return false;var Da=V? -1:1;n(fa.getIssueId(),sa,xa+Da,Da);return true}function ha(V){var $=u.af().gj();if(!$)return false;
ka.dO(V,$);return true}function y(V,$){if(ta.value())return false;var fa=g($);if(!fa)return false;if(F(u.af().getColumns(),fa.getColumnId())<0)return false;var sa=fa.getIssueId();fa=fa.getColumn();if(!ka.kX(sa))return ha(sa);var xa=o.indexOf(sa),Da=o.size();if(xa<0)return false;for(var Fa=V? -1:1,La=false,Ha=0;!La&&Ha<Va&&xa>=0&&xa<Da;){xa+=Fa;Ha++;if((sa=xa>=0&&xa<Da?o.rowId(xa):0)&&ua.hh(sa))La= ! !ka.dO(sa,fa)}return true}function K(V,$){return{subscribe:T,update:function(fa,sa,xa){if($&& !ka.canCreateDialog())return false;if(ta.value())return false;if(!u.widget.jiraConfig.ke())return false;var Da=c();if(Da>=0&&J(E.rowId(Da),V))return false;var Fa=null;if(Da>=0){Fa=p(Da,true);if(!Fa&& !$)return false}fa=Fa?Fa.getId():0;sa={};if(Fa)if(V){sa.under=fa;sa.after=0}else{Da=E.bz(Da);sa.under=Da<0?0:E.rowId(Da);sa.after=fa}else{if((Da=u.rootPath&&u.rootPath.value())&& !Da.length)return false;sa.under=Da?Da[Da.length-1]:0;sa.after=E.dU(sa.under)}if(!ra.eP(0,sa.under))return false;xa.placement=sa;xa.sample=fa;return true},perform:function(fa,sa,xa){fa=xa.placement;sa=xa.sample;Ga=ea.ml();xa=ka.nextTemporaryIssueId();fa.under!==0&&ea.by(fa.under,true);fa=ka.fN(xa,fa,sa,$);ea.kK(xa,E);
ba.aJ();return! !fa}}};function N(){return u===u.widget.master&&C.oH.shouldBlockActions()}function S(){if(ta.value()||N())return true;var V=ea.bm();if(V&&V>0)if((V=v.jiraApp.issueActionsPopup)&&typeof V.show==="function"){V.show();return true}return false}function Y(V,$){if(ta.value()||N())return true;var fa=ea.bm();if(!fa||fa<0)return true;if((fa=v.jiraDialogs[V])&&typeof fa.show==="function"){fa.$activeTrigger=M.$("a."+$);fa.show();return true}return false}function Z(){if(ta.value()||N())return true;var V=O();if(V){if(oa){M.$("a.issueaction-edit-issue").click();return true}return W("a.issueaction-edit-issue",V)}return false}function la(){if(ta.value()||N())return true;var V,$=O();if(C.modes.ISSUE_PAGE||C.modes.GH_TAB){if((V=u.widget.config.anchorIssue)&&$&&V!==$)return false}else V=$;if(V)return W("a.issueaction-assign-to-me",V);return false}function da(){var V=e.curry(Y,"comment","issueaction-comment-issue");return u.widget.config.showIssueDetails===true?function(){var $=M.$("#footer-comment-button");if(C.oH.visibleCell.value()&&$.length){$.click();return true}else return V.apply(this,arguments)}:V}function O(){var V=c();if(V<0)return false;V=E.row(V).getId();if(V<0)
return false;if(!ua.hh(V))return false;return V}function W(V,$){var fa,sa;q(V).each(function(){var Da=q(this).attr("href");if(Da=Xa.exec(Da))if(Da[1]==="{0}")sa=this;else if(e.toIntSafe(Da[1],0)===$)fa=this});var xa=sa||fa;if(!xa)return false;M.$(xa).click();return true}function ia(V){return function(){if(ta.value())return true;var $=O(),fa;if($){fa=q("#s-issueaction-links").find(V);if(fa.length)if((fa=fa.attr("href"))&&fa.indexOf("id={0}")>=0){fa=fa.replace("id={0}","id="+$);fa=e.setUrlParameter(fa,"returnUrl",U.top.location.href);U.top.location=fa;return true}}return false}}function ja(V){return new s({update:function($,fa){if(ta.value())return false;var sa=Na||d(),xa=sa.mI();if(!xa||xa==="disabled")return false;if(!V){var Da=fa&&fa.type;if((Da==="keydown"||Da==="keyup"||Da==="keypress")&&e.getSelectedText())return false}$.selection=sa.expanded.original();$.depths=xa;return true},perform:function($){var fa=$.selection;$=$.depths;var sa=[],xa,Da,Fa,La;xa=0;for(Da=fa.length;xa<Da;xa++){Fa=fa[xa];La=$[Fa];e.assert(typeof La==="number"&&La>=0);sa.push(new C.bP(Fa,La,Fa<0))}ga.setContent(sa);return true}})}function pa(V){if(ta.value())return false;var $=c();if($<0&&V.pasteUnder)
return false;if(!V.forest||V.forest.isEmpty())return false;if(u.widget.currentStructure.iY())return false;var fa=E.fH($,V.pasteUnder);if(J(fa.under,true)){if($>=0)return false;$=u.rootPath&&u.rootPath.value();if(!$|| !$.length)return false;$=E.indexOf($[$.length-1]);if($<0)return false;V.pasteUnder=true;fa=E.fH($,true)}if(!ra.canMergeForest(V.forest,fa.under,fa.after))return false;V.row=$;V.position=fa;return true}function na(V,$){var fa=E.aG(V.row);V.pasteUnder&&fa&&ea.by(fa);fa=V.forest;var sa=V.position;if(!ra.bo(fa,sa.under,sa.after,$||"paste"))return false;sa=sa.after||sa.under;for(var xa=0,Da=fa.size();xa<Da;xa++){var Fa=fa.rowId(xa);if(o.contains(Fa)){sa=Fa;break}}R(sa);return true}function qa(V){return{subscribe:I,update:function($,fa,sa){sa.panel=u;sa.pasteUnder=V;sa.forest=ga.accessForest();return pa(sa)},perform:function($,fa,sa){if(na(sa)){ga.clear();return true}return false}}}function aa(V){if(ka.cu())return false;var $=ba.db();if(!$)return false;for(var fa=c()+V,sa=E.size();fa>=0&&fa<sa;){var xa=E.rowId(fa);if($(xa)){R(xa,true);return true}fa+=V}return false}function X(){if(ta.value())return true;if(!M)return false;var V=ea.bm();if(!V||V<0||typeof V!=="number")
return false;V=M.$("a#actions_"+V);if(!V.length)return false;V.click();return true}var ba=u.bn(),ea=u.ao(),ra=u.aZ(),ka=u.cJ(),ca=u.bD(),ua=u.widget.az,f=u.ah(),v=u.getAJSBridge(),E=u.bs(),o=u.ae(),L=u.widget.mouseController,ga=u.widget.clipboard,ma=u.widget.ni,va= ! !ra,Ba= ! !ka,Ga=null,oa=M.$&&typeof namespace("JIRA.Forms.createEditIssueForm",false)==="function",ta=u.eN();ta.pipeChanges(function(){za&&G(za)});var Aa;u.dN()&&u.bE().og().pipeChanges(function(V){if(Aa&&V&&V.redo){Aa.hide();Aa=null}});var za=null,Ca={subscribe:Q,update:function(V,$,fa){fa.panel=u;return false},perform:e.returnFalse},Ea={subscribe:Q,update:function(V,$,fa){fa.panel=u;return true},perform:e.returnTrue},Ia=null,Ka=null,Na=null,Ua=null,Ra=new z({update:function(V){if(ta.value())return false;var $=E.indexOf(V[0]);if($<1)return false;var fa=E.bz($);if(fa===$-1)return false;$=fa<0?0:E.rowId(fa);if(!ra.eP(V[0],$))return false;return true},perform:function(V){var $=E.indexOf(V[0]),fa=E.rowDepth($),sa=E.bz($);sa=sa<0?0:E.rowId(sa);var xa=E.ak($-1,fa);e.assert(xa>=0,xa+" "+$);if(xa<0)return false;xa=E.ak(xa-1,fa);xa=xa<0?0:E.rowId(xa);ra.nP(V,sa,xa);ba.aJ();return true}}),ab=new z({update:function(V,$){if(
ta.value())return false;var fa=E.indexOf(V[V.length-1]),sa=E.bH(fa);if(sa>=E.size())return false;if(E.rowDepth(sa)!==E.rowDepth(fa))return false;fa=E.bz(fa);fa=fa<0?0:E.rowId(fa);if(!ra.eP(V[0],fa))return false;$.under=fa;$.after=E.rowId(sa);return true},perform:function(V,$){ra.nP(V,$.under,$.after);ba.aJ();return true}}),Ya=new z({update:function(V,$){if(ta.value())return false;var fa=E.indexOf(V[0]);if(fa<=0)return false;var sa=E.row(fa),xa=E.row(fa-1);if(sa.getDepth()>xa.getDepth())return false;sa=E.ak(fa-1,sa.getDepth());e.assert(sa>=0,fa);var Da=E.rowId(sa);if(!ra.eP(V[0],Da))return false;$.under=Da;$.after=sa===fa-1?0:xa.getId();return true},perform:function(V,$){ea.by($.under,true);ra.nP(V,$.under,$.after);ba.aJ();return true}}),Sa=new z({update:function(V,$){if(ta.value())return false;var fa=E.indexOf(V[0]);if(fa<=0||E.rowDepth(fa)<1)return false;var sa=E.bz(fa);e.assert(sa>=0,sa+" "+fa);if(J(E.rowId(sa)))return false;fa=E.bz(sa);fa=fa<0?0:E.rowId(fa);if(!ra.eP(V[0],fa))return false;$.under=fa;$.after=E.rowId(sa);return true},perform:function(V,$){ra.nP(V,$.under,$.after);ba.aJ();return true}}),Pa={subscribe:function(V){T(V);ka.hE().pipe(V.update)},update:function(V,$,fa){
if(ta.value())return false;if(ka.fQ())return fa.toggled=true;V=p(c(),false);if(!V)return false;$=V.getId();if(!V|| !ua.hh($))return false;fa.issue=$;return true},perform:function(V,$,fa){if(ka.fQ()){ka.fR();return true}V=fa.issue;$=ka.gq();if(ka.iM(V))if(!ka.iM(V,$))$=($=ka.hD(V))&&$.column;m($,V)||($=null);fa=u.af();if($&&e.indexOf(fa.getColumns(),$)<0)$=null;$||($=fa.gj());if(!$)return false;ka.dO(V,$);return true}},Va=100,Xa=/[\?&]id=([^\?&]+)/,wa=new s({update:function(V){if(ta.value())return false;var $=(Na||d()).expanded.normalized();if(!$.length)return false;for(var fa=0,sa=$.length;fa<sa;fa++)if(J($[fa],true)|| !ra.eP($[fa],0))return false;V.selection=$;return true},perform:function(V){var $=V.selection,fa=u.bd();V=true;var sa,xa,Da,Fa,La=0,Ha=u.bd(),Ja;sa=[];xa=0;for(Da=$.length;xa<Da;xa++){Ja=Ha.indexOf($[xa]);for(Fa=Ja<0?Ja:Ha.bH(Ja);Ja<Fa;Ja++)sa.push(Ha.rowId(Ja))}if(e.indexOf(sa,ea.bm())>=0){Ha=null;xa=0;for(Da=$.length;xa<Da;xa++){Fa=o.indexOf($[xa]);if(Fa>=0){Ja=o.rowDepth(Fa);var Ma=o.bH(Fa);if((Ma=Ma<o.size()?o.row(Ma):null)&&Ma.getDepth()===Ja)Ha=Ma.getId();else if(Fa>0){Ma=o.row(Fa-1);if(Ma.getDepth()<Ja)Ha=Ma.getId();else{Fa=o.ak(Fa-1,Ja);if(Fa>=0)Ha=o.rowId(
Fa)}}}}}else Ha=null;a:{if(ka){xa=0;for(Da=sa.length;xa<Da;xa++){Fa=sa[xa];if(ka.iC(Fa))if(!ka.gd(Fa)){sa=false;break a}}}sa=true}if(!sa)return false;sa=[];xa=0;for(Da=$.length;xa<Da;xa++){Fa=$[xa];if((Fa=fa.dg(Fa))&&Fa.length){sa.push(Fa);La+=Fa.length}else{$.splice(xa,1);xa--;Da--}}if($.length)V=ra.eH($,"delete");if(V){xa=0;for(Da=sa.length;xa<Da;xa++)u.widget.fK.addDeleted(sa[xa]);Ha&&o.indexOf(Ha)>=0&&R(Ha);if(u.dN())if(($=namespace("JIRA.Messages",false))&&$.showWarningMsg){La=La>1?e.text("s.w.info.deleteSubtree.n.html",La):e.text("s.w.info.deleteSubtree.1.html");La+='<br><a href="#" data-s-action="undoOrRedo">'+e.text("s.w.+undo+.action.+delete+")+"</a>";Aa=$.showWarningMsg(La,{closeable:true,timeout:5})}}return V}}),ya=new s({update:function(V){if(ta.value())return false;if(!u.widget.jiraConfig.lP())return false;var $=(Na||d()).expanded.original();if($.length<2)return false;V.selection=$;return true},perform:function(V){V={issues:V.selection.join(" "),homeUrl:U.location.toString()};h.openWindow("/secure/StructureBulkChange.jspa",V,"_self","POST");return true}});f.register("down",e.curry(i,false));f.register("up",e.curry(r,false));f.register("pageDown",e.curry(l,false));
f.register("pageUp",e.curry(j,false));f.register("pageHome",e.curry(w,false));f.register("pageEnd",e.curry(D,false));f.register("selectDown",e.curry(i,true));f.register("selectUp",e.curry(r,true));f.register("selectPageDown",e.curry(l,true));f.register("selectPageUp",e.curry(j,true));f.register("selectPageHome",e.curry(w,true));f.register("selectPageEnd",e.curry(D,true));f.register("selectSubtrees",P(function(){ea.selectSubtrees(E)}));f.register("selectRoots",P(function(){ea.selectRoots(E)}));f.register("cancelMode",function(){if(L&&L.cU())return true;if(ma&&ma.hideCurrentPopup())return true;if(ka&&ka.cu()){ka.hI();return true}if(u.widget.bF.nj())return true;if(ea.kz(E)>0){ea.jo();return true}return false});f.register("collapseOrMoveToParent",function(){if(ta.value())return false;var V=ea.bm();if(!V)return false;if(ea.isExpanded(V)&&E.hasChildren(V)){ea.by(V,false);ba.aJ();return true}if(V=E.bL(V))return R(V);return false});f.register("expandOrMoveToNext",function(){if(ta.value())return false;var V=ea.bm();if(!V){if(o.isEmpty())return false;return b(0)}if(E.cG(V)&& !ea.isExpanded(V)){ea.by(V,true);ba.aJ();return true}return i()});f.register("expandAll",function(){ea.cC(true);ba.aJ(
);return true});f.register("collapseAll",function(){ea.cC(false);ba.aJ();return true});f.register("closestHighlighted",function(){if(ka.cu())return false;var V=ba.db();if(!V)return false;var $=ea.bm();if(!$)return aa(1);if(V($))return true;if(aa(1))return true;return aa(-1)});f.register("nextHighlighted",e.curry(aa,1));f.register("prevHighlighted",e.curry(aa,-1));f.register("toggleSelected",function(){if(ta.value())return false;var V=ea.bm();if(!V)return false;ea.toggleSelected(V);i();return true});f.register("toggleSelectAll",function(){if(ta.value())return false;if(!ea.bm())return false;ea.toggleSelectAll();return true});f.register("copy",ja(false));f.register("cut",ja(true));f.register("viewThumbnails",function(){if(ta.value())return false;var V=ea.bm();if(!V)return false;var $=u.af().getColumns();if(e.find($,function(fa){return fa instanceof C.columns.FieldColumn&&fa.fieldId==="thumbnail"})<0)return false;ba.aJ();V=u.aQ().rowByIssueId(V).find(".s-f-thumbnail .value a").eq(0);if(V.length){C.ajsbridge.hW(V.closest(".value"),V[0],u.widget);M.$(V[0]).click()}return true});f.register("bulkChange",ya);f.register("moveUp",va?Ra:Ca);f.register("moveDown",va?ab:Ca);f.register("levelUp",
va?Sa:Ca);f.register("levelDown",va?Ya:Ca);f.register("deleteSubtree",va?wa:Ca);f.register("paste",va?qa(false):Ca);f.register("pasteUnder",va?qa(true):Ca);f.register("toggleEditMode",Ba?Pa:Ca);f.register("createChild",Ba?K(true):Ca);f.register("createSiblingBelowWithDialog",Ba?K(false,true):Ca);f.register("createSiblingBelow",Ba?K(false):Ca);f.register("nextEditableField",Ba?e.curry(x,false):Ea);f.register("prevEditableField",Ba?e.curry(x,true):Ea);if(Ba){f.register("rightEditableField",e.curry(H,false));f.register("leftEditableField",e.curry(H,true));f.register("downEditableField",e.curry(y,false));f.register("upEditableField",e.curry(y,true));f.register("finishAllEdits",function(){ka.fR()});f.register("cancelCurrentIssueEdit",function(){ka.fZ()});f.register("cancelCurrentCellEdit",function(){ka.hI()});f.register("revertCurrentCellEdit",function(){ka.ih()});f.register("switchToDialog",function(){ka.switchToDialog()})}f.register("openIssue",function(){function V(){var fa=ea.bm();if(fa&&fa>0){fa=ua.getIssueKey(fa);if(!fa)return false;u===u.widget.master&&h.jJ(u.widget,fa);if(fa=C.ajsbridge.issueURL(fa)){if(C.modes.GADGET)U.open(fa,"_parent");else U.location.href=fa;return true}}
return false}var $=u.widget.config.showIssueDetails===true&&u===u.widget.master;if(!$&&u.config.areJiraActionsDisabled())return Ca;return{subscribe:function(fa){if($){T(fa);C.oH.enabledCell.pipe(fa.update)}},update:function(fa,sa,xa){if($){xa.toggled=C.oH.enabledCell.value();xa.panel=u;fa=C.oH.isValidFocusedIssueId(u.ao().bm());return xa.toggled||fa}else return true},perform:function(){if(ta.value())return true;return $?C.oH.toggleEnabledAndFocus():V()}}}());if(!u.config.areJiraActionsDisabled()){f.register("jira.showActions",S);f.register("jira.actions.dropdown",X);if(C.modes.GADGET){if(C.modes.GADGET==="local"){f.register("jira.assign",ia("a.issueaction-assign-issue"));f.register("jira.edit",ia("a.issueaction-edit-issue"));f.register("jira.assignToMe",ia("a.issueaction-assign-to-me"));f.register("jira.comment",ia("a.issueaction-comment-issue"));f.register("jira.labels",ia("a.issueaction-edit-labels"))}}else{f.register("jira.assign",e.curry(Y,"assignIssue","issueaction-assign-issue"));f.register("jira.edit",Z);f.register("jira.assignToMe",la);f.register("jira.comment",da())}}u.panel$.delegate("a.s-ms-mark","click",function(V){if(V.shiftKey&& !V.ctrlKey&& !V.altKey&& !V.metaKey){
V.preventDefault();return false}var $=h.getIssueIdFromEvent(V);V.preventDefault();ea.toggleSelected($);u.widget.aw.setFocusedPanel(u);return false});u.panel$.delegate("a.s-ms-toggle-all","click",function(V){V.preventDefault();ea.toggleSelectAll()});ca.addListener(new e.Life,this);this[B.aN]=function(V,$,fa){if(!fa&&$<0)if(ea.mU()===$){ea.eJ(Ga);ba.aJ()}Ga=null};this.jZ=R;this.oQ=function(V,$){for(var fa=u.af().getColumns(),sa=0,xa=fa.length;sa<xa;++sa)m(fa[sa],V)&&$(fa[sa])};this._paste=function(V,$,fa){V={pasteUnder:V,forest:$};return pa(V)&&na(V,fa)}}})(window);(function(U){var C=namespace("almworks.structure"),h=namespace("almworks.structure.apputil"),k=namespace("almworks.util"),e=namespace("almworks.structure.appevents"),B=namespace("almworks.structure.columns"),q=C.$,M=k.requireGlobal("AJS");C.fj=function(u){function P(ca){if(J=ca)if(ca===2)u.div$.addClass("dragactive");else{if(ca===1){ca=k.dragBind(q,r,a,l,true);if(C.modes.GADGET){q(U).focus();if(q.browser.webkit){var ua=k.withThis(ca,ca.detach);ua=k.seq(l,ua);ca.bind(q("body"),"mouseleave",ua)}}ha.disableSelection();R()}}else{n=0;pa=ja=null;x=0;qa= -1;u.div$.removeClass("dragactive");ha.enableSelection();z();da=0}}
function G(ca,ua){var f=q(ca.target).closest(".td");if(!f.length)return null;for(var v=k.getClasses(f),E=ua.panelId+"col",o=0,L=v.length;o<L;o++){f=k.toIntSafe(k.tail(v[o],E),-1);if(f>=0){v=ua.af().getColumns();if(f<v.length)return v[f];break}}return null}function Q(ca){if(!(ca&&ca.target))return false;ca=q(ca.target);return ca.is("a")&& !ca.closest(".s-editorpanel").length};function T(ca){if(ca){if(!ca.which&&(ca.type==="click"||ca.type==="dblclick"))try{ca.which=1}catch(ua){}if(!(ca.which!==1||J!==0))if(!q(ca.target).closest(".s-editorpanel, .aui-dd-parent, .s-ms-mark").length){var f=C.apputil.getDominator(ca.target,"panel");if(f)if(!(!q.browser.msie&&ca.isDefaultPrevented())){var v=C.getIssueIdFromParentTR(ca.target);if(v){var E=k.mouseCodeFromEvent(ca),o=false,L=f.cJ();if(ca.type==="dblclick"&&E===1){aa=null;f=G(ca,f);if(!f)return;L&&L.dO(v,f);o=true}else if(E===1)if(L&&L.hE().value())if(Q(ca))o=true;if(!o&&E===1){if(!ha.isSelectionDisabled()){ha.disableSelection();ra()}if(ca.target&&ca.target!==X)if(q(ca.target).closest("a[href]").length){aa=ca.target;ea();ca.preventDefault()}}X=null;if(o){ca.preventDefault();ca.stopImmediatePropagation()}}}}}}function A(ca){if(!(!ca||
ca.type!=="click"||J!==0))if(!(ca.which&&ca.which!==1))if(!k.modifiersFromEvent(ca)){var ua=C.apputil.getDominator(ca.target,"panel");if(ua)if(C.getIssueIdFromParentTR(ca.target)){if((ua=ua.cJ())&&ua.hE().value()&&Q(ca)){ca.preventDefault();ca.stopImmediatePropagation()}else if(ca.target&&ca.target!==ba){ua=M.$(ca.target);var f=ua.closest("a[href]");if(f.length&& !ua.closest(".aui-dd-parent").length){ca.preventDefault();f.hasClass("issue-link")&&ca.stopImmediatePropagation()}}ba=null}}}function t(ca){if(J===1)P(0);else if(J===2){var ua=D.dV(),f=D.dA(),v=false;if(ca)ca=(v=D.fo())?f:ua;else{D.dM();ca=ua}if(n&&ca){ca.ao().eJ(n,ca.ae());ca.bn().aJ();u.aw.setFocusedPanel(ca)}P(0)}}function d(){var ca=J===2;t(false);return ca}function a(ca){if(J)if(ca.which===1){J===1&&ca.shiftKey&& !ca.ctrlKey&& !ca.altKey&& !ca.metaKey&&ja.ao().jZ(n,false,true);t(true)}}function s(ca,ua){K=ca;N=Math.min(Z,Math.max(Y,ua));y||(y=U.setInterval(I,S))}function z(){K=0;if(y){U.clearInterval(y);y=null}}function I(){if(!K|| !pa)z();else{var ca=pa.bn(),ua=ca.scrollpane.scrollTop(),f=null;if(K<0){if(ua>0)f=Math.max(0,ua-N)}else{var v=ca.scrollpaneHeight();v=ca.issueAreaHeight.value()-v;if(ua<v)f=Math.min(v,ua+N)
}if(f===null){z();i(null)}else{ca.scrollpane.scrollTop(f);if(la.rowsY)la.rowsY-=f-ua}}}function R(){var ca=(new Date).getTime();if(ca-da>O&&pa){da=ca;ca=u.glass$.offset();la.glassX=ca.left;la.glassY=ca.top;if(K){ca=pa.fr().offset();la.rowsX=ca.left;la.rowsY=ca.top}else{la.rowsX=ca.left;la.rowsY=null}}return la}function b(ca,ua){for(var f=Y;ca>ua&&f<Z;){f=Math.round(f*2);ca-=ua}return f}function i(ca){if(D.isDragging()){var ua,f;if(ca){ua=ca.pageX;f=ca.pageY;if(ua===g.x&&f===g.y)return;g.x=ua;g.y=f;var v=null;if((v=qa>=0?ua>=qa?u.slave:u.master:u.master)&&v!==pa){pa=v;da=0}}else{ua=g.x;f=g.y}pa||d();var E=f;if(f=D.ce()){v=R();E-=p.top;var o=v.rowsY;if(o===null)o=v.glassY-pa.bn().containerScrollTop()+na();o=Math.round(E-o);f.css("top",E-v.glassY);f=o}else f=0;v=ua;if(E=D.ce()){var L=pa;o=ka[L.panelId];if(!o){o={};ka[L.panelId]=o;L=L.panel$.offset();var ga=u.glass$.offset();o.xgo=L.left-ga.left}o=o.xgo;if(x===F&&pa===ja)o+=v-c.left;E.css("left",o)}v=pa.bn().fm(f);E=f;o=D.dQ();L=D.dA();ga=v.rowY;var ma=v.rowHeight,va=v.forestIndex,Ba=Math.min(pa.ae().size(),va+1),Ga=ma/4;E=E<ga+Ga?va:E>ga+ma-Ga?Ba:o<=va&&L===pa?va:Ba;ga=D.dQ();va=ua;if(E===0|| !pa)ua=0;else{o=pa.ae();L=o.size();ma=
D.dW();ua=0;if(x===m)ua=D.fE()+Math.floor((va-W)/ia);else if(x===F)if(E>0&&E<=L){va=o.row(E-1);ua=va.getDepth();va=va.getId();Ba=pa.rootPath&&pa.rootPath.value();if(o.hasChildren(va)&&pa.ao().isExpanded(va))ua++;else E===L&&Ba&&Ba.length&&k.indexOf(Ba,va)>=0&&ua++}if(ua===ma&&ga===E)ua=ma;else{if(E===0)ga=[];else{ga=o.aG(E-1);ga= !ga|| !ga.length?[]:ga}o=E<L?o.row(E).depth:0;ua=k.minmax(o,ga.length,ua);ua>0&&pa.ao().by(ga.slice(0,ua))}}if(ca){ca=f;f=v.rowHeight;o=false;ga=f/2;if(v.pxfrom>0){L=v.pxfrom-ca;if(L>ga){s(-1,b(L,f));o=true}}if(!o&&ca>v.pxto-ga){L=pa.bn().issueAreaHeight.value();if(v.pxto<L){L=ca+f-v.pxto;s(1,b(L,f));o=true}}o||z()}D.dp(pa,E,ua)}}function r(ca){if(J)if(J===1){if(Math.abs(ca.pageX-c.left)+Math.abs(ca.pageY-c.top)>=H){var ua=ja.ao(),f=null;if(ua.isSelected(n))f=ua.kT(ja.ae());if(!f|| !f.length)f=[n];if(f=ja&&D.ef(ja,f)){ua.eJ(null);x=ja.co()?m:F;qa=u.aw.getSplitterPageX()}P(f?2:0);i(ca)}}else J===2&&i(ca)}function l(){J&&t(false)}function j(){if(M)M.$(u.div$[0]).off("click.structure").on("click.structure",A)}var w=k.nn(u.eventBus),D=k.nn(u.dJ),J=0,c={top:0,left:0},p={top:0,left:0},g={x:0,y:0},n=0,m=1,F=2,x=0,H=3,ha=new k.SelectionDisabler,y=null,K=0,N=0,S=
100,Y=9,Z=100,la={rowsX:0,rowsY:0,glassX:0,glassY:0},da=0,O=3E3,W=0,ia=50,ja=null,pa=null,na=k.lazy(function(){return u.master.panel$.find(".sechead").outerHeight(true)}),qa= -1,aa=null,X=null,ba=null,ea=k.delayed(550,function(){if(aa){var ca=aa;aa=null;var ua=q(ca);if(k.onPage(ua)){var f={link$:ua,prevent:false};w.fireEvent(e.BEFORE_CLICK,f);if(f.prevent!==true){h.lh(u,ua);ba=X=ca;f=false;try{if(U.document.createEvent&&ca.dispatchEvent){var v=document.createEvent("MouseEvents");u.div$.is(".ie9")?v.initMouseEvent("click",true,true,U,1,1,1,1,1,false,false,false,false,1,ca):v.initEvent("click",true,true);f=ca.dispatchEvent(v)!==false}else if(ca.click){ca.click();f=true}}catch(E){}if(!f&& !ua.hasClass("issue-link"))if(ca=ua.attr("href")){ua=ua.attr("target")||"_self";try{U.open(ca,ua)}catch(o){}}}}}}),ra=k.delayed(500,function(){ha.enableSelection()}),ka={};u.div$.mousedown(function(ca){if(ca.which===1){var ua=C.apputil.getDominator(ca.target,"panel");if(ua){var f=h.getIssueIdFromEvent(ca),v=q(ca.target);if(f&&J===0&&(ca.shiftKey&& !ca.ctrlKey&& !ca.altKey&& !ca.metaKey||q(ca.target).hasClass("st-dh"))){var E=v.closest(".tr");if(E.length){c.left=ca.pageX;c.top=ca.pageY;pa=ja=ua;ua=
E.offset();p.top=Math.round(ca.pageY-ua.top);p.left=Math.round(ca.pageX-ua.left);W=ca.pageX;n=f;P(1);ca.preventDefault();ca.stopImmediatePropagation();return false}}var o=ua.ao(),L=ua.bs();E=o.bm();if(f&&ca.target&&v.hasClass("expander")){v= !o.isExpanded(f);o.by(f,v);if(!v&&E){f=L.indexOf(f);E=L.indexOf(E);L.eh(E,f)&&ua.bn().aJ()}ca.preventDefault();ca.stopImmediatePropagation()}else{if(f&&(!ca.target|| !v.closest(".noselmove").length)){L=false;if(o=ua.cJ()){var ga=o.fQ();if(ga){if((v=G(ca,ua))&&(!v.isInstanceOf(B.EditableColumn)|| !v.isEditableColumn()))v=null;if(f!==ga.issueId||v!==ga.column)L= ! !o.dO(f,v||ga.column);L||(L=Q(ca))}else if(o.iM(f)){if((v=G(ca,ua))&& !o.iM(f,v))v=(ga=o.hD(f))&&ga.column;if(v)L= ! !o.dO(f,v)}}if(L){ca.stopPropagation();ca.preventDefault()}else f!==E&&ua.cc().jZ(f)}u.aw.setFocusedPanel(ua);if(ha.isSelectionDisabled())return false}}}}).click(T).dblclick(T);j();w.addListener(new k.Life,this);this[e.ar]=function(){ka={}};q.extend(this,{cU:d,installAJSMouseHandler:j})}})(window);(function(){function U(G,Q){if(G===Q)return 0;var T=G.getOrder(),A=Q.getOrder();if(T!==A)return T<A? -1:1;T=u.renderTemplate(G.getTitle())||"";A=u.renderTemplate(Q.getTitle())||
"";return T.localeCompare(A)}function C(G,Q){if(G===Q)return 0;var T=u.renderTemplate(G.getPresetName())||"",A=u.renderTemplate(Q.getPresetName())||"";return T.localeCompare(A)}function h(G){var Q=q.ColumnGroup.getGroups();Q.sort(U);var T=u.mapArray(Q,function(I){return I.getGroupKey()}),A=q.ColumnType.getAllColumnTypes(),t=[],d,a;d=0;for(a=A.length;d<a;d++)t.push(k(G,A[d]));var s=P.Deferred(),z=[];P.when.apply(P,t).done(function(){var I=[],R,b,i,r,l;R=0;for(b=arguments.length;R<b;R++){l=arguments[R];if(u.isArray(l)){i=0;for(r=l.length;i<r;i++)l[i]&&I.push(l[i])}}I.sort(C);R=0;for(b=Q.length;R<b;R++){l=Q[R];var j=l.getGroupKey(),w=false;i=0;for(r=I.length;i<r;i++){var D=I[i],J=D.getGroupKey();if(J===j|| !J&& !j||J&& !T[J]&& !j){if(!w){z.push(l);w=true}z.push(D)}}}u.assert(z.length>=I.length&&z.length<=I.length+Q.length,z.length+" "+I.length+" "+Q.length)}).always(function(){s.resolve(z)});return s.promise()}function k(G,Q){var T=P.Deferred(),A=[];M.loadTypeMetadata(Q,"preset").then(function(t){t=Q.createAddColumnPresets(M.extendMetadata(u.extendOwn({},G),t));for(var d=[],a=0,s=t.length;a<s;a++)d.push(M.createConfiguratorPromise(Q,G,t[a]));return P.when.apply(P,d)}).done(function(){
u.addAll(A,u.toArray(arguments))}).always(function(){T.resolve(A)});return T.promise()}function e(G){var Q='<div class="st-col-choose">';Q+='<div class="st-col-nf"><input type="text" class="ajs-dirty-warning-exempt s-col-filter" maxlength="20"/></div>';Q+='<div class="st-col-list"><ul>';for(var T=0,A=G.length;T<A;T++){var t=G[T];if(q.isInstance(q.ColumnGroup,t))Q+='<li class="col-gr-mark st-dis"><a>'+u.htmlEscape(t.getTitle())+"</a></li>";else{u.assert(q.isInstance(q.ColumnConfigurator,t));Q+="<li><a>"+u.htmlEscape(t.getPresetName())+"</a></li>"}}Q+='<li class="st-nf-nf st-dis"><a>{s.w.ccnf.nf}</a></li>';Q+="</ul></div>";Q+="</div>";return Q}var B=namespace("almworks.structure"),q=namespace("almworks.structure.api"),M=namespace("almworks.structure.columns"),u=namespace("almworks.util"),P=B.$;B.AddColumnPanel=function(G){function Q(){u.safeCall(b&&b.mN,A)}function T(){var i=P.trim(a.val()).toLowerCase();if(i){var r=false;s.each(function(){var j=P(this),w= !j.is(".st-dis")&&j.text().toLowerCase().indexOf(i)>=0;j.css("display",w?"list-item":"none");r|=w});z.css("display",!r?"list-item":"none");var l=R.getSelectedItem();if(r&&(!l|| !l.is(":visible")))R.selectFirst();else l&& !l.is(
":visible")&&R.jo()}else{s.css("display","list-item");z.hide()}R.lc()}var A=this,t=P.Deferred(),d,a,s,z,I,R,b;h(M.createColumnContext(G)).done(function(i){d=P(u.renderTemplate(e(i)));a=d.find("input.s-col-filter");s=d.find("li");z=s.filter(".st-nf-nf");I=d.find(".st-col-list");R=new B.apputil.MenuList({container$:d,selector:"li:not(.st-dis)",viewPort$:I,handler:{onMenuItemChosen:function(r){r=s.index(r);if(r>=0&&r<i.length){r=i[r];q.isInstance(q.ColumnConfigurator,r)&&r.isConfigured()&&u.safeCall(b&&b.mj,A,r.getColumnSpec())}else Q()},onMenuCancelled:Q}})}).always(function(){t.resolve()});u.extendOwn(this,{whenReady:function(i){t.always(i)},installTo:function(i){d.appendTo(i);i=d.width();if(P.browser.msie&&P.browser.version>8&&P.browser.version<11)i+=20;d.css("min-width",i+"px");a.change(T).keyup(T)},alignWith:function(i,r){var l=parseInt(i.position().left,10)+5,j=l+d.outerWidth(true)-r;if(j>0)l-=j;d.css("left",l)},show:function(i){b=i;R.jo();d.find("input.s-col-filter").val("");T();d.show();I.css("overflow-y","auto");this.focus=u.borrowFocus(a,d);I.scrollTop(0)},hide:function(i){d.hide();if(this.focus)this.focus=this.focus.returnFocus(i)},containsElement:function(i){if(!i)
return false;return P(i).closest(".st-col-choose").length>0},pipeHeightTo:function(i){i.setValue(d.outerHeight(true))}})}})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.structure.api"),h=namespace("almworks.structure.columns"),k=namespace("almworks.util"),e=U.$,B=namespace("almworks.structure.ajsbridge"),q=namespace("almworks.structure.apputil");U.EditColumnPanel=function(M){function u(){l&&k.safeCall(l.mj,l,null,true);return false}function P(){return[new J({configurator:i}),new C.ColumnNameOption({configurator:i})]}function G(p){var g=e(),n,m,F;for(n=0;m=p[n++];){F=e('<div class="field-group"></div>');m.createLabel(F);m.createInput(F);F.data("option",m);g=g.add(F)}return g}function Q(p,g){return h.loadTypeMetadata(p,"preset").then(function(n){return(n=p.createSwitchTypePreset(h.extendMetadata(k.extendOwn({},g),n)))?h.createConfiguratorPromise(p,g,n):null})}var T=e(k.renderTemplate(
'<div class="st-col-choose st-col-edit"><form class="aui s-short-label s-form-12px"><fieldset class="st-col-opt-common"></fieldset><fieldset class="st-col-opt-types"></fieldset><fieldset class="st-col-opt-custom"></fieldset><fieldset class="st-col-buttons"><div class="st-tb st-col-remove" title="{s.w.ccnf.remove}"><div class="st-tbi" style="background-position: -176px -96px;"></div></div> <div class="st-tb st-col-revert" title="{s.w.ccnf.revert}"><div class="st-tbi" style="background-position: 0 -64px;"></div></div> </fieldset></form></div>')),A=T.find("form.aui"),t=A.find(".st-col-opt-types"),d=A.find(".st-col-opt-common"),a=A.find(".st-col-opt-custom"),s=T.find(".st-col-buttons"),z=T.find(".st-col-remove"),I=T.find(".st-col-revert");q.initializeButton(T.find(".st-tb"));var R=h.createColumnContext(M),b=null,i=null,r=null,l=null,j=e.Deferred().reject().promise(),w=false,D={visible:new k.Cell(false),columnLeft:new k.Cell(0),columnWidth:new k.Cell(0),totalWidth:new k.Cell(0),overlap:new k.Cell(0),panelWidth:new k.Cell(0),maxPanelWidth:new k.Cell(0),panelHeight:null};D.panelWidth.pipe(function(p){D.maxPanelWidth.setValue(Math.max(p,D.maxPanelWidth.value()))});T.on("keydown",function(
p){if(p&&p.target&&k.keyboardCodeFromEvent(p)===27)return u()}).on("keypress",":input:not(.aui-ss-field)",function(p){if(p&&p.target&&k.keyboardCodeFromEvent(p)===13)return u()}).on("keydown",":input:visible:last",function(p){if(p&&p.target&&k.keyboardCodeFromEvent(p)===9){T.find(":input:visible:first").focus();return false}}).on("keydown",":input:visible:first",function(p){if(p&&p.target&&k.keyboardCodeFromEvent(p)===1009){T.find(":input:visible:last").focus();return false}}).on("ajs:submitForm",u);A.on("notify",function(p,g){for(var n=e(p.target).closest(".field-group").data("option"),m=A.find(".field-group"),F=[],x=m.length;x>=0;x--){var H=m.slice(x,x+1),ha=H.data("option"),y;if(ha&&ha!==n){y= ! !ha.notify(g||"update");H.toggle(y);ha.isInputValid()||F.push(ha.title)}}n=i.getColumnSpec();m= ! !F.length|| ! !b&& !k.deepEquals(n,b);I.toggle(m);s.toggle(!w||m);D.panelWidth.setValue(T.outerWidth(true));D.panelHeight.setValue(T.outerHeight(true));F=F.length?null:h.copySpec(n);l&&k.safeCall(l.mj,l,F,false)});z.on("click",function(){l&&k.safeCall(l.onColumnRemoved);return false});I.on("click",function(){if(l){var p=C.ColumnType.getColumnTypeForKey(b.key);p?h.createConfiguratorPromise(p,
R,h.copySpec(b)).then(function(g){i=r[0]=g;d.empty().append(G(P()));a.empty().append(G(i.getOptions()||[]));A.trigger("notify")}).always(function(){k.safeCall(l.mj,l,b,false)}):k.safeCall(l.mj,l,b,true)}return false});var J=C.subClass("KeyOption",C.ColumnOption,{notify:k.returnFalse,isInputValid:function(){return! !this.spec.key}}),c=C.subClass("TypeOption",C.ColumnOption,{title:k.text("sw.column.opt.type"),init:function(){this.select$=null},createInput:function(p){for(var g='<select class="select">',n=0,m;m=r[n];n++)g+='<option value="'+n+'">'+k.htmlEscape(m.getColumnTypeName())+"</option>";g+="</select>";this.select$=p.append(g).find("select");this.select$.on("change",function(){var F=e(this).val();if(k.isArray(F))F=F[0];F=k.toIntSafe(F,-1);if(F>=0){F=r[F];if(F!==i){i=F;d.empty().append(G(P()));a.empty().append(G(i.getOptions()||[]));A.trigger("notify")}}});B.createAjsSingleSelect(this.select$)},notify:function(){var p=k.indexOf(r,i);p>=0&&this.select$.trigger("ajs:update",""+p).val(p);return true}});new k.Cell(D.visible,D.columnLeft,D.columnWidth,D.totalWidth,D.overlap,D.panelWidth,D.maxPanelWidth,function(p,g,n,m,F,x,H){if(p){p=g+n-F;x=Math.max(H,x);m=p+x-m;if(m>0)if(m+F<=n/2)
p-=m;else{p=g-x+10;if(p<0)p=0}T.css("left",p+"px").show()}else T.hide()});k.extendOwn(this,{whenReady:function(p){j.done(p)},installTo:function(p){T.hide().appendTo(p)},alignWith:function(p,g){var n=parseInt(p.position().left,10),m=p.outerWidth(true),F=m-5,x=p.find(".th-ctl-cfg");if(x.length)F=m-parseInt(x.position().left,10);k.Cell.prototype.multiUpdate(true);try{D.totalWidth.setValue(g);D.columnLeft.setValue(n);D.columnWidth.setValue(m);D.overlap.setValue(F);D.maxPanelWidth.setValue(0)}finally{k.Cell.prototype.multiUpdate(false)}},show:function(p){if(i){t.empty();w||t.append(G([new c]));d.empty().append(G(P()));a.empty().append(G(i.getOptions()||[]));z.toggle(!w);l=p;A.trigger("notify","prepare");D.visible.setValue(true);A.trigger("notify","show");this.focus=k.borrowFocus(T.find(":input").first(),T)}},hide:function(p){D.visible.setValue(false);t.empty();d.empty();a.empty();l=r=i=b=null;w=false;D.panelHeight=new k.Cell(0);if(this.focus)this.focus=this.focus.returnFocus(p)},containsElement:function(p){return! !p&&e(p).closest(".st-col-choose,.s-aui-dd").length>0},mQ:function(p,g){var n=e.Deferred();j=n.promise();w=g;if(!p|| !p.key){n.reject();return j}var m=
C.ColumnType.getColumnTypeForKey(p.key);if(!m){n.reject();return j}var F=[h.createConfiguratorPromise(m,R,h.copySpec(p))];if(!w)for(var x=C.ColumnType.getAllColumnTypes(),H=0,ha;ha=x[H++];)ha!==m&&F.push(Q(ha,R));e.when.apply(e,F).done(function(){r=k.arrayFilter(k.toArray(arguments),function(y){return! !y});if(i=r[0]){b=p;n.resolve()}else{i=r=null;n.reject()}}).fail(function(){n.reject()});return j},pipeHeightTo:function(p){D.panelHeight=p}})}})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.util"),h=namespace("almworks.structure.appevents"),k=namespace("almworks.structure.apputil"),e=U.$,B=C.flipSet(["handle","actions"]),q=C.flipSet(["main"]);U.ee=function(M){function u(oa){if(oa===X)return true;X=oa;return false}function P(oa,ta){if(ta.columns){for(var Aa=oa.getColumns(),za=K.children(".th"),Ca=za.length,Ea=[],Ia="",Ka=0;Ka<Aa.length;Ka++){var Na=Aa[Ka];Ea.push(Na.getCsid());var Ua;Ua=Ka<Ca?e(za[Ka]):e('<div class="th '+M.columnClass(Ka)+'"></div>');Na.renderHeader(Ua);Ka>=Ca&&Ua.appendTo(K);if(Ka>0)Ia+='<div class="'+M.columnClass(Ka)+'"><a href="#">{add column}</a></div>'}Ca>Aa.length&&za.slice(Aa.length).remove();pa.setValue(Ea);l(Aa)}if(ta.columns||
ta.columnWidths){Q(0,function(Ra){u(Ra);return ta.manualResize});G(ta.kC)}}function G(oa){if(oa){var ta=c.getColumns(),Aa=c.eV();if(!(!ta||Aa<0)){var za=e();Z.children(".s-resizer").each(function(Ea){if((Ea=ta[Ea<Aa?Ea:Ea+1])&&Ea.isResizable()&&oa(Ea))za=za.add(e(this).find("a.handle"))});if(za.length){var Ca=za.css("background-color");za.stop().css("background-color",Ca).animate({"background-color":"#eeee00"},{duration:200,easing:"swing"}).animate({"background-color":Ca},{duration:800,easing:"swing",complete:function(){e(this).css("background-color","")}})}}}}function Q(oa,ta){var Aa=c.getColumns(),za=c.eV();if(Aa){var Ca=K.data(F);if(!Ca){Ca={widths:{},kP:{}};K.data(F,Ca)}var Ea=C.getClientWidth(N);if(!(Ea===0&& !N.is(":visible")))if(oa&&(Ea===N.width()&& !ba()||Ea<20))setTimeout(C.curry(Q,oa-1,ta),100);else if(!(Ea<20)){var Ia=T(Aa,Ea,ta(Ea));K.data(F,Ia);Ea=Ca.widths;Ca=Ia.widths;Ia=false;if(Ea.length!==Ca.length)Ia=true;else for(var Ka=0;Ka<Aa.length;Ka++)if(Ca[Ka]!==Ea[Ka]){Ia=true;break}if(Ia){Ea=Aa.length;Ia="";for(var Na=Ka=0;Na<Ea;Na++){var Ua=Ca[Na];Ia+="  #structure ."+M.columnClass(Na)+" { left: "+Ka+"px; width: "+Ua+"px }\n";Ka+=Ua}Ia+="  #structure ."+n+
"fullwidth { width: "+Ka+"px }";e("#"+x).remove();e("head").append('<style type="text/css" id="'+x+'">'+Ia+"\n</style>");a(Aa,Ca,za);Aa=Ca[0];Aa>=49?la.show().css("left",Aa-24+"px"):la.hide();J.fireEvent(h.au,Ca);na.setValue(Ca)}}}}function T(oa,ta,Aa,za,Ca,Ea,Ia){function Ka(fa){if(za&&za.hasOwnProperty(fa.csid))return za[fa.csid];return fa.getWidth()}function Na(){return{widths:Va,kP:Xa}}function Ua(fa,sa){var xa,Da,Fa;xa=0;for(Da=oa.length;xa<Da;xa++){Fa=oa[xa];if(Fa.isResizable()&&Ca(xa,Fa)&&fa(xa,Fa)&&sa(xa,Fa)===false)break}}function Ra(fa,sa){Ua(fa,function(xa,Da){var Fa=Math.min(Va[xa]-sa(xa,Da),-ta);if(Fa>0){Va[xa]-=Fa;ta+=Fa;Ea(xa,Da,Va[xa])}return ta<0})}function ab(fa,sa){var xa=0,Da={},Fa;Ua(fa,function(La,Ha){Da[La]=Math.max(0,Va[La]-Math.max(Ya,sa(La,Ha)));xa+=Da[La]});if(xa>0){Fa= -ta<xa? -ta/xa:1;Ra(function(La){return Da[La]>0},function(La){return Va[La]-Math.ceil(Da[La]*Fa)})}}Ca=Ca||C.returnTrue;Ea=Ea||C.noop;var Ya=U.MIN_COLUMN_WIDTH,Sa= -1,Pa=[],Va=[],Xa={},wa=Math.round(ta/(oa.length||1)),ya,V;for(ya=0;ya<oa.length;ya++){V=oa[ya];if(V.isColumnOfType("main"))Sa=ya;else{var $=Ka(V);if(!$&&Aa)$=V._stretchedWidth;if(!$){$=V._preferredWidth;if($>0){if(
V._stretchedWidth)V._stretchedWidth=null;if($>wa){Pa.push(ya);continue}}else $=V.getDefaultWidth()||2*Ya}Va[ya]=$;ta-=$}}Sa>=0&&Pa.push(Sa);for(ya=0;ya<Pa.length;ya++){V=oa[Pa[ya]];$=Math.round(ta/(Pa.length-ya));$=Math.max($,C.toIntSafe(V.getMinWidth(),0),Ya,wa);if(V._preferredWidth>0){$=Math.min($,V._preferredWidth);V._stretchedWidth=$}Va[Pa[ya]]=$;ta-=$}Xa.stretch= -ta;if(ta>=0)return Na();ab(function(fa,sa){if(fa!==Sa){var xa=sa._stretchedWidth||sa._preferredWidth||sa.getDefaultWidth();return xa>0&&xa<Va[fa]}return false},function(fa,sa){return sa._stretchedWidth||sa._preferredWidth||sa.getDefaultWidth()});Xa.shrinkPreferred= -ta;if(ta>=0){C.assert(ta===0);return Na()}ab(function(fa){return fa!==Sa},function(fa,sa){return sa.getMinWidth()||0});Xa.shrinkMinimum= -ta;if(ta>=0){C.assert(ta===0);return Na()}if(Ia)return Na();Ra(function(fa,sa){return sa.canShrinkWhenNoSpace()},function(){return Ya});Xa.shrinkShrinkable= -ta;if(ta>=0){C.assert(ta===0);return Na()}Ra(C.returnTrue,function(){return Ya});Xa.shrinkAll= -ta;ta<0&&C.warn("cannot fit all columns ("+ta+")");return Na()}function A(oa){oa.addClass("s-resizer");oa.append(
'<a class="handle" onclick="return false;">Resize column</a>');oa.draggable({axis:"x",containment:"parent",scroll:false,start:function(ta,Aa){if(!Aa.helper.length)return false;if(Aa.helper.hasClass("s-rs-nomove"))return false;Aa.helper.addClass("s-rs-moving");v=C.indexOf(Z.children(".s-resizer"),Aa.helper[0]);ca.setValue(true);O.css("left",Aa.position.left+ha+"px").show()},drag:function(ta,Aa){if(!Aa.helper.length)return false;var za=t(Aa.helper,Aa.position.left,ta);if(za){if(za.backoff)Aa.position.left=za.x;if(za.lQ){var Ca=c.getColumns(),Ea=c.eV();d(Ca.length,za.lQ);a(Ca,za.lQ,Ea)}O.css("left",za.x+ha+"px");Aa.helper.toggleClass("s-rs-snapped",! !za.snapped);O.toggleClass("s-rs-snapped",! !za.snapped)}return! !za},stop:function(ta,Aa){O.hide();v= -1;ca.setValue(false);if(Aa.helper.length){Aa.helper.removeClass("s-rs-moving s-rs-snapped");O.removeClass("s-rs-snapped");var za=t(Aa.helper,Aa.position.left,ta);if(za){p.df({manual:za.widths},null);d(0,null)}}}})}function t(oa,ta,Aa){ta=Math.round(ta);var za=Z.children(".s-resizer"),Ca=C.indexOf(za,oa[0]);if(Ca<0)return false;za=K.data(F);var Ea,Ia=0,Ka;if(C.isEmptyOrFalsy(za))return false;if(za.kP.shrinkMinimum>0)return false;oa=
za.widths;za=za.kP.stretch>0;for(Ea=0;Ea<Ca;Ea++)Ia+=oa[Ea];Ka=Ia+oa[Ca]+oa[Ca+1];Ea=Aa.altKey;var Na= !Ea&& !Aa.metaKey&& !Aa.ctrlKey,Ua=c.getColumns();Ea=Ea? -1:c.eV();Aa=Ea<0||Ca<Ea?Ua[Ca]:null;Ea=Ea<0||Ca>=Ea?Ua[Ca+1]:null;var Ra=ta-H,ab=false,Ya=false,Sa={},Pa;if(Aa)Sa[Aa.csid]=Ra-Ia;if(Ea)Sa[Ea.csid]=Ka-Ra;if(Aa){Pa=Ia+Aa.getMinWidth();if(Ra<Pa){ta=Pa+H;ab=true;Sa[Aa.csid]=Aa.getMinWidth();if(Ea)Sa[Ea.csid]-=Pa-Ra}else if(Na){Pa=Aa._stretchedWidth||Aa._preferredWidth||Aa.getDefaultWidth();if(Pa>0){Ia+=Pa;if(Math.abs(Ra-Ia)<=y){ta=Ia+H;Ya=ab=true;Sa[Aa.csid]=za?Pa:null}}}}if(Ea){Ia=Ka-Ea.getMinWidth();if(Ra>Ia){ta=Ia+H;ab=true;Sa[Ea.csid]=Ea.getMinWidth();if(Aa)Sa[Aa.csid]-=Ra-Ia}else if(Na){Pa=Ea._stretchedWidth||Ea._preferredWidth||Ea.getDefaultWidth();if(Pa>0){Ia=Ka-Pa;if(Math.abs(Ra-Ia)<=y){ta=Ia+H;Ya=ab=true;Sa[Ea.csid]=za?Pa:null}}}}Ka=C.getClientWidth(N);var Va=Pa=Ra=Ia=Na=null;if(Ua&&oa&&(Ka!==0||N.is(":visible"))&&Ka>=20){if(! !Aa!== ! !Ea){Ra=Aa?function(Xa){return Xa>Ca}:function(Xa){return Xa<=Ca};Pa=function(Xa,wa,ya){Va=Va||{};Va[wa.csid]=ya}}za&&C.eachOwn(oa,function(Xa){var wa=Ua[Xa].csid;Sa.hasOwnProperty(wa)||(Sa[wa]=this[Xa])});Na=T(Ua,Ka,true,Sa,Ra,Pa,true)
}if(Na){Ia=Na.widths;Va&&C.extendOwn(Sa,Va);oa=Na.kP.shrinkMinimum||0;if(oa>0){ab=true;if(Ya&&oa>y)Ya=false;if(Aa){ta-=oa;Ia[Ca]-=oa;Sa[Aa.csid]=Ia[Ca]}else{ta+=oa;Ia[Ca+1]-=oa;Sa[Ea.csid]=Ia[Ca+1]}}}return{widths:Sa,backoff:ab,x:ta,snapped:Ya,lQ:Ia}};function d(oa,ta){var Aa=M.panel$.find("div.tableHeader div.th"),za,Ca,Ea;if(oa===0)Aa.css({left:"",width:""});else for(Ea=za=0;za<oa;za++){Ca=ta[za];za>0&&e(Aa[za]).css({left:Ea+"px",width:Ca+"px"});Ea+=Ca}}function a(oa,ta,Aa){var za=Z.children(".s-resizer"),Ca=oa.length-1,Ea,Ia,Ka;if(za.length<Ca){for(Ea=za.length;Ea<Ca;Ea++)A(e("<div>").appendTo(Z));za=Z.children(".s-resizer")}else Ca<za.length&&za.slice(Ca).remove();Ea=0;for(Ia=H;Ea<Ca;Ea++){Ia+=ta[Ea];Ka=Aa<0?oa[Ea].isResizable()&&oa[Ea+1].isResizable():Ea<Aa?oa[Ea].isResizable():oa[Ea+1].isResizable();e(za[Ea]).css("left",Ia+"px").toggleClass("s-rs-nomove",!Ka)}}function s(oa){if(typeof oa!=="string")oa=e(oa).closest(".th-ctl").attr("id");return C.toIntSafe(C.tail(oa,m),-1)}function z(oa){if(E<0)return-1;for(var ta=na.value(),Aa=c.getColumns(),za=0,Ca=ta.length;za<Ca;){var Ea=ta[za];if(oa<Ea/2)break;oa-=Ea;za++}if(za===E||za===E+1)return-1;za>E&&za--;ta=za<E? -1:1;for(Ca=E+ta;(
za-Ca)*ta>=0;Ca+=ta)if(!Aa[Ca]||B[Aa[Ca].getColumnKey()]){za=Ca-ta;break}if(za===E)return-1;return za}function I(oa){return oa.csid}function R(oa){ma&&ma.whenReady(function(){ma.hide(oa)});va&&va.whenReady(function(){va.hide(oa)});f.setValue(-1);aa.setValue(0);e("body").unbind("click",b);M.widget.ni.popupHidden(w)}function b(oa){oa&&(ma&&ma.containsElement(oa.target)||va&&va.containsElement(oa.target))||R(true)}function i(){var oa=e(this),ta,Aa;if(!va){va=new U.EditColumnPanel(M);va.installTo(Y)}Aa=oa.closest(".th-ctl");ta=s(Aa.attr("id"));if(ta<0)return false;var za=c.getColumns();if(ta>=za.length)return false;if(!r(ta))return false;var Ca=Aa.find("a.th-ctl-cfg");window.setTimeout(function(){Ca&&Ca.addClass("th-ccnf-loading")},300);oa=za[ta];va.mQ(oa.getColumnSpec(),! !q[oa.getColumnKey()]).done(function(){va.alignWith(Aa,S.width());va.pipeHeightTo(aa);va.show({mj:function(Ea,Ia){Ia&&R();if(Ea){var Ka=c.getColumns()[ta];if(Ka&& !B[Ka.getColumnKey()]&& !C.deepEquals(Ea,Ka.getColumnSpec())){p.changeColumn(Ka.csid,Ea);Ga.forceUpdate()}}},onColumnRemoved:function(){var Ea=za[ta];if(Ea&& !B[Ea.getColumnKey()]&& !q[Ea.getColumnKey()]){R();p.removeColumn(Ea.csid);Ga.forceUpdate()}}});
M.widget.ni.lV(w,R);e("body").click(b)}).fail(R).always(function(){Ca.removeClass("th-ccnf-loading");Ca=null});return false}function r(oa){var ta=f.value();ta!== -1&&R();if(ta!==oa){f.setValue(oa);return true}return false}function l(oa){var ta="",Aa,za,Ca;Aa=0;for(za=oa.length;Aa<za;Aa++){Ca=oa[Aa];B[Ca.getColumnKey()]||(ta+=C.renderTemplate('<div class="th-ctl {ctlClass}" id="{ctlId}"><div><div class="th-ctl-hi"><a class="th-ctl-cfg" title="{sw.widget.column.configure}">{s.w.ccnf.configure}</a><div class="th-ctl-mv"><div class="celldiv">{colName}</div></div></div></div></div>',{ctlClass:M.columnClass(Aa),ctlId:m+Aa,colName:Ca.getName()}))}Z.children(".th-ctl").remove();e(ta).appendTo(Z);e(".th-ctl-mv",Z).draggable(ga);e(".th-ctl-cfg",Z).click(i)}function j(oa,ta){var Aa=Z.children(".s-resizer");Aa.removeClass(oa);if(ta>=0&&ta<Aa.length){Aa=e(Aa[ta]);Aa.hasClass("s-rs-nomove")||Aa.addClass(oa)}}var w=this,D=M.panel$,J=M.bD(),c=M.af(),p=M.bW(),g=M.ah(),n=M.panelId,m=n+"-st-tc-",F="ColWidths",x="structure_style_"+n,H= -Math.floor(4),ha=Math.floor(3),y=15,K=e(".tableHeader",D);if(K.size()!==1)throw Error("THP cannot find .tableHeader");var N=e(".main",D);if(N.length!==1)throw Error(
"THP cannot find .main");var S=e('<div class="st-hc"></div>').appendTo(K),Y=e('<div class="st-hc-d"></div>').appendTo(S),Z=e('<div class="th-ctls"></div>').appendTo(Y);e(C.renderTemplate('<div class="s-th-handle"><a href="#" class="s-ms-toggle-all s-ms-t-a-hc s-ms-{panelId}-all"></a></div>',M)).appendTo(Y);var la=e(C.renderTemplate('<div class="th-ccnf th-ccnf-asz"><a class="th-ccnf-asz-icon" title="{s.w.ccnf.autosize}"></a></div>')).appendTo(Y),da=e(C.renderTemplate('<div class="th-ccnf th-ccnf-add"><a class="th-ccnf-add-icon" title="{s.w.ccnf.title}"></a></div>')).appendTo(Y);D=e(".secbody",D);var O=e('<div class="resizeIndicator"></div>').appendTo(D),W=e('<div class="s-issue-cover s-ic-left"></div>').appendTo(D),ia=e('<div class="s-issue-cover s-ic-middle"><div class="s-ic-middle-fill"></div></div>').appendTo(D),ja=e('<div class="s-issue-cover s-ic-right"></div>').appendTo(D),pa=(new C.Cell).setValue([]),na=(new C.Cell).setValue([]),qa=new C.Cell(na,function(oa){var ta=[],Aa=oa.length;ta.length=Aa+1;for(var za=0,Ca=0;Ca<Aa;Ca++){ta[Ca]=za;za+=oa[Ca]}ta[Ca]=za;return ta}),aa=(new C.Cell).setValue(0);Z.on("dblclick",".th-ctl-mv, .s-resizer",function(oa){if(!oa|| !oa.target)
return false;var ta=s(oa.target),Aa=null;if(ta<0){Aa=e(oa.target).closest(".s-resizer");if(!Aa.length||Aa.hasClass("s-rs-nomove"))return false;ta=C.indexOf(Z.children(".s-resizer"),Aa[0]);if(ta<0)return false}var za=c.getColumns(),Ca=c.eV(),Ea=[],Ia=null,Ka=null;if(Aa){Ia=(oa.altKey||Ca<0||ta<Ca)&&za[ta];Ka=(oa.altKey||Ca<0||ta>=Ca)&&za[ta+1]}else if(ta!==Ca)Ia=za[ta];Ia&&Ia.isResizable()&&Ea.push(Ia.csid);Ka&&Ka.isResizable()&&Ea.push(Ka.csid);J.fireEvent(h.mh,Ea);oa.preventDefault()});var X=null,ba=C.lazy(function(){return C.isMac()&&e.browser.webkit&&k.getScrollBarSize().width===0}),ea=C.timeCache(1E4,function(){return K.offset().left}),ra=(new C.Cell).setValue(-1);K.mousemove(function(oa){ra.setValue(oa.pageX-ea())});var ka=(new C.Cell).setValue(false),ca=(new C.Cell).setValue(false),ua=(new C.Cell).setValue(false),f=(new C.Cell).setValue(-1);D=new C.Cell(ka,ca,ua,f,ra,na,function(oa,ta,Aa,za){if(ta||Aa||za!== -1)return 2;if(!oa)return 0;return 1});D.pipeChanges(function(oa,ta){if(oa===2)Y.stop(true,true).show();else if(oa===1)ta===0&&Y.stop().hide().fadeIn("slow");else{C.assert(oa===0,oa);ta===2?Y.stop(true,true).hide():Y.stop().fadeOut()}});(new C.Cell(ca,ua,C.or))
.pipeChanges(function(oa){K.toggleClass("drag",! !oa)});K.hoverIntent({over:function(){ka.setValue(true)},out:function(){ka.setValue(false)},timeout:500});var v= -1,E= -1,o=(new C.Cell).setValue(-1);o.pipeChanges(function(oa){if(oa<0)O.hide();else{oa>E&&oa++;oa=qa.value()[oa];O.css("left",oa-1+"px").show()}});var L=0,ga={axis:"x",containment:Z,appendTo:Z,scroll:false,helper:function(){var oa=s(this);E=oa;if(oa<0)return e("<div></div>");var ta=c.getColumns();if(oa>=ta.length)return e("<div></div>");oa=ta[oa];if(B[oa.getColumnKey()])return e("<div></div>");return e('<div class="th-ctl-mv-helper"><div class="celldiv">'+C.htmlEscape(oa.getName())+"</div></div>")[0]},start:function(oa,ta){if(!ta.helper.length)return false;ua.setValue(true);L=ta.helper.outerWidth(false)},drag:function(oa,ta){if(!ta.helper.length)return false;var Aa=oa.pageX-ea(),za=ta.position.left;if(Aa<za)za=ta.position.left=Aa;else if(Aa>za+L)za=ta.position.left=Aa-L;o.setValue(z(za+L/2));return true},stop:function(oa,ta){var Aa=E,za=z(ta.position.left+L/2);ua.setValue(false);E= -1;o.setValue(-1);if(ta.helper.length)if(za>=0&&za!==Aa){var Ca=c.getColumns();if(za<Ca.length&&Aa<Ca.length){var Ea;if(za<Aa){Ea=
C.convertArray(Ca.slice(0,za),I);za=C.convertArray(Ca.slice(za,Aa),I);C.addAll(za,C.convertArray(Ca.slice(Aa+1),I))}else{Ea=C.convertArray(Ca.slice(0,Aa),I);C.addAll(Ea,C.convertArray(Ca.slice(Aa+1,za+1),I));za=C.convertArray(Ca.slice(za+1),I)}p.moveColumn(Ca[Aa].csid,Ea,za);Ga.forceUpdate()}}}},ma=null,va=null;U.apputil.initializeButton(da);da.click(function(){if(!ma){ma=new U.AddColumnPanel(M);ma.whenReady(function(){ma.installTo(Y)})}if(!r(Ba))return false;var oa=da.find("a.th-ccnf-add-icon");window.setTimeout(function(){oa&&oa.addClass("th-ccnf-loading")},300);var ta=e(this);ma.whenReady(function(){oa.removeClass("th-ccnf-loading");oa=null;ma.alignWith(ta,S.width());ma.show({mj:function(Aa){R();if(Aa){var za=c.getColumns();za=C.convertArray(za,I);var Ca;if(Aa.shouldOpenConfigurator){Aa=e.extend({},Aa);delete Aa.shouldOpenConfigurator;window.setTimeout(function(){var Ea=C.indexOf(C.convertArray(c.getColumns(),I),Ca);i.apply(e("#"+m+Ea))},100)}Ca=p.addColumn(Aa,za,[]);Ga.forceUpdate()}},mN:R});ma.pipeHeightTo(aa);M.widget.ni.lV(w,R);e("body").click(b)});return false});g.register("addColumn",function(){da.click();return true});U.apputil.initializeButton(la);la.click(function(){
J.fireEvent(h.mh)});new C.Cell(f,na,function(oa,ta){if(oa=== -1){W.hide();ia.hide();ja.hide()}else if(oa===Ba){ja.hide();ia.hide();W.css("width","100%").show()}else{for(var Aa=0,za=ta[0]||0,Ca=1;Ca<=oa;Ca++){Aa+=ta[Ca-1]||0;za+=ta[Ca]||0}W.css("width",Aa+"px").show();ia.css({left:Aa+"px",width:za-Aa+"px"}).show();ja.css("left",za+"px").show()}});var Ba="add",Ga=new C.Cell(D,na,ra,ca,ua,f,function(oa,ta,Aa,za,Ca,Ea){if(oa===0||za)return-1;if(Ca)return E;if(Ea===Ba)return-1;if(Ea>=0)return Ea;oa=0;for(za=ta.length;oa<za;oa++){if(Aa<4)return-1;Ca=ta[oa];if(Aa<Ca-4)break;Aa-=Ca}return oa===za? -1:oa});Ga.pipeChanges(function(oa,ta){ta>=0&&e(".th-ctl."+M.columnClass(ta)).removeClass("active");oa>=0&&e(".th-ctl."+M.columnClass(oa)).addClass("active")});g=new C.Cell(D,na,ra,ca,ua,f,function(oa,ta,Aa,za,Ca,Ea){if(oa===0||Ca||Ea===Ba||Ea>=0)return-1;if(za)return v;oa=0;for(za=ta.length-1;oa<za;oa++){if(Math.abs(ta[oa]-Aa)<=4)return oa;Aa-=ta[oa]}return-1});g.pipeChanges(C.curry(j,"s-rs-active"));D=new C.Cell(D,ua,f,Ga,function(oa,ta,Aa,za){if(oa===0||ta||Aa===Ba||Aa>=0)return-1;if(za>=0){oa=c.getColumns();ta=c.eV();if(za<oa.length&&ta>=0&&oa[za].isResizable()){if(za<ta)return za;if(za>ta)
return za-1}}return-1});(new C.Cell(g,D,Math.max)).pipeChanges(C.curry(j,"s-rs-onduty"));(g=M.cJ())&&(new C.Cell(pa,g.hE(),function(oa,ta){if(!ta)return-1;return C.indexOf(oa,ta.column.csid)})).pipeChanges(function(oa){var ta=K.children(".th");if(oa<0)ta.removeClass("s-col-edited");else{ta.filter(":not(:eq("+oa+"))").removeClass("s-col-edited");ta.filter(":eq("+oa+")").addClass("s-col-edited")}});f.pipeChanges(function(oa){J.fireEvent(oa<0?h.bM:h.cv)});this[h.ko]=P;this[h.ar]=C.bottlenecked(100,C.curry(Q,10,u));J.addListener(new C.Life,this);P(c,{columns:true,columnWidths:true});this.fO=function(){return aa};this.ng=function(){return ca};this.fL=function(){return f}}})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.util"),h=namespace("almworks.structure.appevents"),k=U.$;U.eF=function(e){function B(c,p){if(e.currentStructure.iY())return false;if(c.eN().value())return false;if(c!==e.master)return!e.master.eN().value();var g,n,m,F=c.rootPath&&c.rootPath.value();if(F){g=0;for(n=p.length;g<n;g++){m=p[g];if(C.indexOf(F,m)>=0)return false}}if(!e.currentStructure.aW())return true;F=c.bd();g=0;for(n=p.length;g<n;g++){m=p[g];m=F.bz(F.indexOf(m));if(m>=0&& !
e.az.hh(F.rowId(m)))return false}return true}function q(){l.empty();for(var c=j.length,p=0;p<c;p++){var g=j[p],n=a.aL(g.id);n=I.aQ().cZ(g.id,n).clone();C.updateClasses(n,D,J);g.row$=n;l.append(n)}}function M(){var c=r;if(c){l=r=null;t=false;z=0;s=a=null;b=0;R= -1;i=false;j=null;d.mH().remove(w);I=d=null;c.remove();Q.fireEvent(h.aq)}};function u(){t&&M();return false}function P(){if(!I)return false;if(I.eN().value())return false;var c=I.ae(),p=c.size();if(R<0||R>p)return false;c=c.cf(R,b);if(!c)return false;if(I===d&&c.under===s.under&&c.after===s.after)return true;return I.isDropPossible(c,a,d)}function G(c){for(var p=0,g=j.length;p<g;p++){var n=j[p],m=c+a.rowDepth(a.indexOf(n.id));n.row$.find(".offset").stop().animate({"padding-left":T.getDepthOffset(m)},300,"swing")}}var Q=e.eventBus,T=e.config,A=this,t=false,d=null,a=null,s=null,z=0,I=null,R= -1,b=0,i=false,r=null,l=null,j=null,w=function(c){t&&a&&c.oW(a.hf())},D=["dragged"],J=["dragged","s-focused","hrow","hrowf","dimmed"];C.extend(this,{ef:function(c,p){if(t|| !c|| !p.length)return false;if(!B(c,p))return false;d=c;for(var g=d.ae(),n= -1,m=0,F=p.length;n<0&&m<F;m++)n=g.indexOf(p[m]);if(n<0)return false;s=g.dI(n);if(!s)
return false;I=c;R=n;b=z=g.rowDepth(n);i=true;a=d.bd().cD(p);Q.fireEvent(h.mg,a,d);j=[];g=d.ao();n=0;for(m=a.size();n<m;){F=a.rowId(n);j.push({id:F});if(j.length>=5)break;n=g.isExpanded(F)?n+1:a.bH(n)}k("#st-drag").remove();r=k('<div id="st-drag"></div>');l=k('<div class="st-dnd-content"></div>').appendTo(r);g=k('<div class="st-dnd-nhint"></div>').appendTo(r);j.length<a.size()&&g.append('<div class="s-dnd-n">'+C.text("sw.dnd.n.hint",a.size())+"</div>");g.append('<div class="s-dnd-nodrop-ind"></div>');r.append('<div id="st-dragcover"></div>');q();G(z);r.data("fixedHeight",j.length*e.config.getFixedRowHeight());t=true;d.mH().add(w);e.glass$.append(r);Q.fireEvent(h.cr);return true},dp:function(c,p,g){if(!t)return false;if(c!==I||p!==R||g!==b){var n=g!==b,m=c!==I;I=c;R=p;b=g;m&&q();(i=P())?r.removeClass("s-nodrop"):r.addClass("s-nodrop");n&&G(g);Q.fireEvent(h.dP,A)}return i},dM:u,fo:function(){if(!t|| !s)return false;if(!i|| !I)return u();var c=I.ae().cf(R,b);if(!c)return u();if(I===d&&c.under===s.under&&c.after===s.after)return u();var p=a,g=d,n=I,m=I===d,F=I.bg();F.jy();try{M();m?n.aZ().nP(p.hf(),c.under,c.after,"dnd"):n.aZ().bo(p,c.under,c.after,"dnd")}finally{F.ap()}g.cL(p,g,n,c);
m||n.cL(p,g,n,c);return true},dQ:function(){return t?R: -1},dW:function(){return t?b:0},dA:function(){return t?I:null},dV:function(){return t?d:null},ce:function(){return t?r:null},fE:function(){return z},isDragging:function(){return t}})}})();(function(U){function C(M){function u(){A=false;if(M.widget.config.perspectiveSpec)M.ao().jd();else M.widget.ir.lg.value()?M.bn().gC():M.bn().aJ()}function P(){A=true;if(!t){M.widget.ir.visibleCell.pipeChanges(G);M.widget.hC.activeCell.pipeChanges(G);M.widget.bF.dh.pipeChanges(G);t=true}}function G(d){if(A&& !d&& !T()){A=false;u()}};function Q(){if(A)if(T()){var d=new k.Life;M.dH().events.addListener(d,h.bi.E,function(){if(!A|| !T()){U.setTimeout(Q,0);d.detach()}})}else u()}function T(){var d=M.widget.hC;if(d.activeCell.value()&&d.isLoading())return true;d=M.widget.ir;if(d.visibleCell.value()&&d.isLoading())return true;d=M.widget.bF;return d.isSearching()&&d.dh.value()}var A=false,t=false;(function(){var d={};d[e.STRUCTURE_CHANGED]=P;d[e.cd]=Q;M.widget.eventBus.addListener(new k.Life,d)})();k.extend(this,{iy:function(){return A}})}var h=namespace("almworks.structure"),k=namespace("almworks.util"),e=namespace("almworks.structure.appevents"),B=
h.$,q=function(){function M(T,A){if(T<0||A<0)return 0;return Q[T*P+A]}var u=0,P=0,G=0,Q=null;return function(T,A){var t={};if(!T|| !A)return t;u=T.length;P=A.length;G=0;if(!u|| !P)return t;for(var d;u>0&&P>0;){d=T[u-1];if(d!==A[P-1])break;u--;P--;t[d]=true}for(var a=Math.min(u,P);G<a;){d=T[G];if(d!==A[G])break;G++;u--;P--;t[d]=true}if(!u|| !P)return t;Q=Array(u*P);var s,z;for(d=0;d<u;d++)for(a=0;a<P;a++)Q[d*P+a]=T[G+d]===A[G+a]?M(d-1,a-1)+1:Math.max(M(d-1,a),M(d,a-1));d=M(u-1,P-1);if(d!=0){s=d-1;d=u-1;for(a=P-1;d>=0&&a>=0&&s>=0;){z=T[G+d];if(z===A[G+a]){t[z]=true;d--;a--;s--}else if(M(d,a-1)>M(d-1,a))a--;else d--}}Q=null;u=P=G=0;return t}}();h.el=function(M){function u(wa){var ya=wa*F.getFixedRowHeight();if(oa&&ta<wa)ya+=oa;return ya}function P(){if(L>o&& !ga.is(":animated")){var wa=Math.max(L-Ca.value(),o);if(L>wa){ga.height(L);ga.animate({height:wa},{duration:Ba,easing:"swing",step:function(ya){L=Math.ceil(ya);Q()},complete:function(){L=o;Q()}})}else{L=o;Q()}}ma=null}function G(){var wa=0,ya=E.value();if(ya){var V=ya[1];ya=H.indexOf(ya[0]);if(ya>=0)wa=F.getFixedRowHeight()*ya+V}if(o===wa)return false;o=wa;if(ma){U.clearTimeout(ma);ma=null}ga.stop(true,false);if(wa>L||Ca.value()<=
0)L=wa;else ma=U.setTimeout(P,va);return true}function Q(){var wa=H.size();if(ua!==wa||f!==oa||v!==L){ua=wa;f=oa;v=L;var ya=ua*F.getFixedRowHeight()+f;wa=Math.max(ya,v);ya=Math.max(wa-ya,0);ja.height(wa);k.Cell.prototype.multiUpdate(true);try{za.setValue(wa);Ca.setValue(ya)}finally{k.Cell.prototype.multiUpdate(false)}}}function T(wa,ya){ya||(ya=h.getIssueIdFromTR(wa));if(!ya)return ya;var V=[],$=N.cI(ya);if($&&$.getValue("jira:raw:summary"))if(x.hasChildren(ya))ha.isExpanded(ya)?V.push("expanded"):V.push("collapsed");else V.push("leaf");if(ha.bm()==ya)V.push("s-focused");else{var fa;a:if(Ea&& !Ea(ya))fa=true;else{if(S.getConfig().getParam(h.tableConfig.params.bh)==="hide")if($&&$.hz()){fa=true;break a}fa=false}fa&&V.push("dimmed")}Z.hasIssue(ya)&&V.push("cut");if(fa=M.rootPath)if((fa=fa.value())&&fa.length){var sa=k.indexOf(fa,ya);if(sa>=0){V.push(sa===fa.length-1?"root":"rootpath");sa===fa.length-2&&V.push("rootpathlast")}}$&&$.diffStatus&&V.push("s-h-"+$.diffStatus);if(la)($=la.fQ())&&$.getIssueId()===ya&&V.push("s-edited");k.updateClasses(wa,V,Na);return ya}function A(wa,ya){if((!wa|| !wa.length)&&(!ya|| !ya.length))return 0;var V=t(ya,true);if(V<0)V=t(wa,false);return Math.max(
V,0)}function t(wa,ya){var V,$;if(wa&&wa.length)for(V=wa.length-1;V>=0;V--){$=H.indexOf(wa[V]);if($>=0){if(ya)$=H.bH($);else $++;return $}}return-1}function d(wa){var ya,V,$;if(wa&&wa.length){ya=0;for(V=wa.length;ya<V;ya++){$=H.indexOf(wa[ya]);if($>=0)return $}}return-1}function a(wa){var ya,V;if(wa&&wa.length)for(ya=wa.length-1;ya>=0;ya--){V=H.indexOf(wa[ya]);if(V>=0)return V}return-1}function s(){var wa=Ga.from,ya=Ga.to;if(!(wa>=ya)){for(;wa<ya;wa++){var V=H.rowId(wa);z(V)}ya=B("a.s-ms-"+M.panelId+"-all");if(ya.length){wa=ha.kz(x);ya.toggleClass("s-ms-t-a-all",wa===x.size());ya.toggleClass("s-ms-t-a-some",wa>0)}}}function z(wa){if(wa)if(!(Ga.from>=Ga.to)){var ya=ha.isSelected(wa),V=false,$=x.indexOf(wa),fa,sa,xa;if($>=0&& !ha.isExpanded(wa)){sa=x.bH($);for(fa=$+1;fa<sa;fa++){xa=x.rowId(fa);if(fa===$+1)V= ! !ha.isSelected(xa);else if(! !ha.isSelected(xa)!==V){V=null;break}}}wa=B("#s-ms-"+M.panelId+"-"+wa);if(wa.length){if(ya){wa.addClass("s-ms-on");wa.toggleClass("s-ms-auto",ya==="auto")}else wa.removeClass("s-ms-on s-ms-auto");if(V===true)wa.removeClass("s-ms-some").addClass("s-ms-all");else V===false?wa.removeClass("s-ms-some s-ms-all"):wa.removeClass("s-ms-all").addClass(
"s-ms-some")}}}function I(wa,ya){R(wa.stop(true,false));var V=wa.css("background-color")||"#ffffff";wa.addClass(Ia).animate({"background-color":"#ffffbb"},200,"swing");ya?wa.fadeOut(800,"swing",function(){R(B(this).remove())}):wa.animate({"background-color":V},800,"swing",function(){R(B(this))})}function R(wa){return wa.removeClass("s-bganimation").removeAttr("style")}function b(wa){if(wa&&wa.length)for(var ya=0,V=wa.length;ya<V;ya++){var $=wa[ya],fa=y.rowByIssueId($);fa.length&&T(fa,$)}}function i(wa){if(wa&&wa.length&&wa.is(":visible")){var ya=c(),V=wa.position().top;wa=V+wa.height();var $=F.getFixedRowHeight();V=Math.max(V-$,0);wa+=$;if(V<ya.pxfrom)j(V);else wa>ya.pxto&&j(wa-(ya.pxto-ya.pxfrom))}}function r(wa,ya){if(wa){var V=H.indexOf(wa);if(!(V<0)){var $=c(),fa=F.getFixedRowHeight(),sa=V*fa,xa=$.pxto-$.pxfrom,Da= -1;if(oa&&ta<=V)sa+=oa;if(typeof ya==="number"){Da=sa-Math.round(xa*Math.min(1,Math.max(0,ya)));Da=Math.max(0,Da);$=H.size()*fa;xa=Da+xa;if(xa>$)Da-=Math.max(Da,xa-$)}else if(sa<$.pxfrom)Da=sa;else{V=sa+fa;if(la)if((fa=la.fQ())&&fa.issueId===wa)V=Math.max(V,sa+la.fS().value());if(V>$.pxto)Da=V-xa}Da>=0&&j(Da)}}}function l(){if(!Ka|| !Ka.iy())r(ha.bm())}function j(wa)
{if(ab){var ya={duration:100,easing:"swing",queue:false,callback:w};Ra=wa;pa.animate({scrollTop:wa},ya)}else{pa.scrollTop(wa);w()}}function w(){Ra= -1}function D(){var wa=false;try{wa=document.activeElement}catch(ya){}return wa}function J(wa){na=pa.scrollTop();G();var ya;Q();var V=p();ya=V.pxto-V.pxfrom;var $=F.getFixedRowHeight();$=Math.ceil(ya/$);ya=H.size();$=Math.ceil(Math.max(F.preloadRowsFactor,0.5)*$/2);var fa=Math.max(0,V.from-$),sa=Math.min(ya,V.to+$);if(Ga.from<=fa&&Ga.to>=sa&&Ga.from>=0&&Ga.to<=ya)ya=false;else{V=Math.max(0,Math.floor(fa-2*$));$=Math.min(ya,Math.ceil(sa+2*$));fa=F.minCachedRows-($-V);if(fa>0){V=Math.max(0,V-Math.floor(fa/2));fa=F.minCachedRows-($-V);$=Math.min(ya,$+fa)}Ga.from=V;Ga.to=$;ya=true}if(ya||wa){ya=ha.ml();wa=D();$=[];V={};for(fa=Ga.from;fa<Ga.to;fa++){(sa=H.row(fa))||k.error("null row in table presenter ["+fa+"]["+Ga.from+"]["+Ga.to+"]");sa=sa?sa.getId(): -1;V[sa]=true;$.push(sa)}var xa=[];fa={};var Da=qa[0],Fa,La,Ha,Ja=0,Ma=0,Qa=0,Wa=W.mw();for(Fa=Da.firstChild;Fa;){La=Fa.nextSibling;if(Fa.nodeType===1){sa=h.gi(Fa);if(V[sa]){xa.push(sa);fa[sa]=Fa;T(B(Fa),sa)}else{Wa[sa]?I(B(Fa),true):Da.removeChild(Fa);Ja++}}Fa=La}if(k.arrayEquals($,xa)){if(!
k.isEmptyOrFalsy(Wa)){Da=0;for(La=$.length;Da<La;Da++){sa=$[Da];if(Wa[sa])(Fa=fa[sa])&&I(B(Fa),false)}}}else{La=xa.length;if(La===0)Ja={};else if(La===1){Ja={};Ja[xa[0]]=true}else{Fa=null;Da=0;for(La=$.length;Da<La;Da++){sa=$[Da];if(fa[sa])Fa&&Fa.push(sa);else Fa||(Fa=$.slice(0,Da))}Ja=q(Fa||$,xa)}xa=null;Da=0;for(La=$.length;Da<La;Da++){sa=$[Da];Fa=fa[sa];if(Ja[sa])k.assert(! !Fa);else{if(Fa){Ha=B(Fa);Qa++}else{Ha=y.cZ(sa);T(Ha,sa);Fa=Ha[0];Ma++}xa?Ha.insertAfter(xa):Ha.prependTo(qa)}if(Wa[sa]){if(Ja[sa])Ha=B(Fa);I(Ha,false)}k.assert(! !Fa);xa=Fa}}Ha=Ga.from;if(!(Ha<0||Ha>=H.size()))for(Ha=H.bz(Ha);Ha>=0;Ha=H.bz(Ha))V[H.rowId(Ha)]=true;N.fb(M.panelId,V);a:if(aa.length){aa.hide();if(Ha=da.value()){fa=Ha.forest.aD();V=F.getFixedRowHeight();$=d(fa);var Za,Oa,$a,Ta;if($>=0){Za=a(fa)+1;k.assert(Za>$);$*=V;Za*=V;if(Ha.operation==="add"||Ha.operation==="move"&&Ha.presenter.showsTo()){$a=X;fa=ba}else{$a=ra;fa=ka}if(Ha.operation==="move")if(Ha.presenter.showsTo()){Oa=A(Ha.parentPathFrom,Ha.precedingSiblingsFrom)*V;Ta=ca}else{Oa=A(Ha.parentPathTo,Ha.precedingSiblingsTo)*V;Ta=ea}Ha=$;V=fa;$=za.value();if(Ta){k.assert(Oa<=Ha||Oa>=Za);if(Oa===Ha)if(Oa===0){Oa=1;Ha=4}else{Oa-=2;Ha+=1}else if(
Oa===Za)if(Oa===$){Za=$-2-6+5;Oa=$-2+1}else{Za-=1;Oa+=1}Oa-=1;Oa=Math.max(0,Oa);Oa=Math.min($-2,Oa)}Ha=Math.max(0,Ha-2);Za=Math.min($-6,Za-5);$a.css("top",Ha).show();V.css("top",Za).show();Ta&&Ta.css("top",Oa).show()}else{if(Ha.operation==="add"){Oa=ea;Ta=A(Ha.parentPathTo,Ha.precedingSiblingsTo)*V}else if(Ha.operation==="move"){Oa=ea;Ta=A(Ha.parentPathTo,Ha.precedingSiblingsTo)*V;Za=ca;$a=A(Ha.parentPathFrom,Ha.precedingSiblingsFrom)*V}else if(Ha.operation==="remove"){Oa=ca;Ta=A(Ha.parentPathFrom,Ha.precedingSiblingsFrom)*V}else{k.assert(false,Ha.operation);aa.hide();break a}Ha=za.value();if(Za){if($a==Ta)if(Ta===0){Ta=1;$a=3}else if(Ta===Ha){Ta=Ha-2-2+1;$a=Ha-2+1}else{Ta-=1;$a+=1}$a-=1;$a=Math.max(0,$a);$a=Math.min(Ha-2,$a)}Ta-=1;Ta=Math.max(0,Ta);Ta=Math.min(Ha-2,Ta);Oa.css("top",Ta).show();Za&&Za.css("top",$a).show()}}}s();Ua();qa.css("top",u(Ga.from));Oa=null;if(ya)for(Ta=ya.length-1;Ta>=0;Ta--)if(Oa=x.bS(ya[Ta]))break;ha.eJ(Oa);Oa=D();if(wa&&Oa!==wa&&wa!==U&&wa!==U.document){Oa=B(wa);try{Oa.focus()}catch(bb){}Oa.closest(".s-editorpanel").length&&l()}K.fireEvent(e.kE)}}function c(){Q();var wa=Ra>=0,ya=wa?Ra:na,V=Aa();return{animation:wa,pxfrom:ya,pxto:ya+V}}function p(){
var wa=c(),ya=F.getFixedRowHeight(),V=H.size()-1,$=0;if(oa)$=ta*ya;return B.extend(wa,{from:Math.min(V,Math.floor((wa.pxfrom<$?wa.pxfrom:wa.pxfrom<$+oa?$:wa.pxfrom-oa)/ya)),to:Math.min(V,Math.ceil((wa.pxto<$?wa.pxto:wa.pxto<$+oa?$:wa.pxto-oa)/ya)-1),gappx:$})}function g(){var wa=Y.isDragging(),ya=Y.dQ();if(wa)ta=ya}function n(){if(Y.dA()===M){if(!Va){Va=true;var wa=Y.ce(),ya=wa.data("fixedHeight");oa=typeof ya==="number"?ya:wa.height();Ya.fM(oa);g();Q()}g();wa=null;if(Y.isDragging()&&ta>=Ga.from&&ta<Ga.to)if(ya=qa.children()[ta-Ga.from])wa=B(ya);Ya.eU(wa)}else if(Va){Va=false;oa=0;ta= -1;Ya.eZ();Q()}}var m=M.panel$,F=M.widget.config,x=M.bs(),H=M.ae(),ha=M.ao(),y=M.aQ(),K=M.bD(),N=M.widget.az,S=M.getTableConfig(),Y=M.widget.dJ,Z=M.widget.clipboard,la=M.cJ(),da=M.widget.ir.lg,O=M.eg().ng(),W=M.nX(),ia=new k.Life,ja=B(".issueArea",m);if(ja.length!==1)throw Error("TP cannot find .issueArea");var pa=ja.parent(),na=0,qa=B(".cacheTable",ja);if(qa.length!==1)throw Error("TP cannot find .cacheTable");var aa=ja.find(".s-h-position"),X=ja.find(".s-h-pos-to-start"),ba=ja.find(".s-h-pos-to-end"),ea=ja.find(".s-h-pos-to"),ra=ja.find(".s-h-pos-from-start"),ka=ja.find(".s-h-pos-from-end"),ca=
ja.find(".s-h-pos-from"),ua=0,f=0,v=0,E=(new k.Cell).setValue(null),o=0,L=0,ga=B("<div></div>"),ma=null,va=5E3,Ba=800,Ga={from:0,to:0},oa=0,ta= -1;B("#st-glass");var Aa=k.timeCache(1E3,function(){return pa.height()}),za=(new k.Cell).setValue(0),Ca=(new k.Cell).setValue(0),Ea,Ia="s-bganimation",Ka=M===M.widget.master?new C(M):null;(function(){function wa(){Fa&& !((new Date).getTime()<h.mouseTracker.timeStamp+Da)&&ya(null,2500,"linear")}function ya(Ma,Qa,Wa){if(!(Ma&&Fa&&Fa.length&&Ma===Fa[0])){if(Fa){Qa&& !Fa.hasClass("s-focused")&& !Fa.hasClass(Ia)?V(Qa,Wa):Fa.removeClass($+" "+fa+" "+sa);Fa=null}if(La){U.clearInterval(La);La=null}if(Ma&&(new Date).getTime()<h.mouseTracker.timeStamp+Da){Fa=B(Ma);if(Fa.hasClass("s-focused"))Fa.addClass(sa);else{Fa.hasClass($)&&Fa.hasClass(Ia)&&Fa.stop(true,true);Fa.addClass($+" "+fa);La=U.setInterval(wa,500)}}}}function V(Ma,Qa){Fa.css("backgroundColor",xa).removeClass(fa).addClass(Ia);var Wa="#ffffff";if(Fa.is(".s-h-added, .s-h-movedTo"))Wa="#f3fff3";else if(Fa.is(".s-h-removed, .s-h-movedFrom"))Wa="#fff3f3";Fa.animate({backgroundColor:Wa},{duration:Ma||200,easing:Qa||"swing",complete:function(){var Za=B(this);Za.removeClass($+" "+sa).css(
"backgroundColor","");U.setTimeout(function(){Za.removeClass(Ia)},1)}})}qa.delegate("span.expander","mouseenter",function(){B(this).addClass("hexp")}).delegate("span.expander","mouseleave",function(){B(this).removeClass("hexp")});var $="hrow",fa="hrowf",sa="s-hrow-0",xa="#f0f0f0",Da=5E3,Fa=null,La=null,Ha= -1,Ja= -1;qa.delegate("div.tr","mousemove",function(Ma){if(Ma){var Qa=Ma.pageX;Ma=Ma.pageY;if(Qa!==Ha||Ma!==Ja){Ha=Qa;Ja=Ma;O.value()||ya(this)}}}).delegate("div.tr","mouseleave",function(){this&&Fa&&Fa.length&&this===Fa[0]&&ya(null)});B("body").keyup(function(){ya(null)})})();var Na=["leaf","expanded","collapsed","dimmed","s-focused","nodata","cut","copied","rootpath","root","rootpathlast","s-h-added","s-h-movedTo","s-h-movedFrom","s-h-removed","s-edited"],Ua=la?k.delayed(50,la.je,la):k.returnTrue,Ra= -1,ab=false,Ya=new function(){function wa(Ja,Ma){if(Ja.d!==Ma){Ja.d=Ma;if(Ja.row$)Ja.row$.css("margin-top",Ma>0?Ma:"")}}function ya(){if(Fa){U.clearInterval(Fa);Fa=null}}function V(){for(var Ja=0,Ma=Da[0];Ma;Ma=Da[++Ja])wa(Ma,0);Da=[]}function $(Ja,Ma){var Qa=Math.min(Ja.d,Ma);if(Qa>0){wa(Ja,Ja.d-Qa);Ma-=Qa}return Ma}function fa(){if(sa<=0)return ya();if(!xa)return ya();var Ja=
Math.max(0,Math.min(1,((new Date).getTime()-La)/Ha)),Ma=Math.max(0,Math.min(sa,Math.round(Math.max(0,Math.min(1,-Math.cos(Ja*Math.PI)/2+0.5))*sa))),Qa;if(Ma===sa){ya();V();wa(xa,sa)}else{Ja=Ma-xa.d;if(!(Ja<=0)){wa(xa,Ma);if(Ja>0){Ma=0;for(Qa=Da[0];Ja>0&&Qa;Qa=Da[++Ma])Ja=$(Qa,Ja)}}}}var sa=0,xa=null,Da=[],Fa=null,La=0,Ha=300;B.extend(this,{fM:function(Ja){sa=Ja},eU:function(Ja){if(!(sa<=0)){if(xa){if(xa.row$===Ja||xa.row$&&Ja&&xa.row$[0]===Ja[0])return;Da.push(xa);xa=null}for(var Ma=0,Qa=0,Wa=Da[0];Wa;Wa=Da[++Qa]){Ma+=Wa.d;if(Wa.row$===Ja||Wa.row$&&Ja&&Wa.row$[0]===Ja[0]){xa=Da.splice(Qa,1)[0];Qa--}}if(!xa){Qa=0;if(Ja)if(Wa=Ja.attr("style"))if((Wa=/margin\-top\s*:\s*(\d+)px/.exec(Wa))&&Wa[1])Qa=parseInt(Wa[1],10)||0;xa={row$:Ja,d:Qa};Ma+=xa.d}Ja=sa-Ma;if(Ja<0){Ma=Da.length;for(Qa=xa;Ja<0&&Ma>=0;Qa=Da[--Ma])Ja= -$(Qa,-Ja)}Ja>0&&wa(xa,xa.d+Ja);ya();if(xa.d<sa){Ja=(new Date).getTime();La=Math.round(Ja-xa.d/sa*Ha);Fa=U.setInterval(fa,30)}}},eZ:function(){ya();sa=0;xa&&wa(xa,0);xa=null;V()}})};this[e.eu]=function(wa,ya,V,$){ya=qa.children(".s-focused");V=ya.length?h.getIssueIdFromTR(ya):0;if(wa!==V){V&&T(ya,V);if(wa){ya=y.rowByIssueId(wa);ya.length&&T(ya,wa)}}$&&wa&&Xa()};this[e.bY]=
function(wa){wa=T(wa);z(wa)};this.dispose=ia.detach;var Sa=k.curry(J,true);H.events.addListener(new k.Life,h.bi.E,function(){K.fireAfterDispatch("TP.UP",Sa)});M.rootPath&&M.rootPath.pipeChanges(function(wa,ya){b(k.unionShortArrays(wa,ya))});var Pa=k.delayed(1E3,ha.setIssueScroll);this[e.ar]=function(){Aa.reset();J(false);Pa()};pa.scroll(k.seq(k.delayed(50,k.curry(J,false)),Pa));this[e.be]=function(wa,ya){b(wa);b(ya)};var Va=false;this[e.dP]=n;this[e.cr]=n;this[e.aq]=n;this[e.am]=s;J(true);K.addListener(ia,this);var Xa=k.bottlenecked(250,l);if(la){E=new k.Cell(la.hE(),la.fS(),function(wa,ya){if(!wa|| !ya)return null;return[wa.getIssueId(),ya]});E.pipeChanges(function(){G()&&Q()})}k.extend(this,{aJ:Xa,io:r,gC:function(){var wa=da.value();if(wa){var ya=wa.forest;if(!(!ya||ya.isEmpty())){var V=[],$,fa,sa,xa;if($=x.bS(ya.rowId(0))){fa=0;for(sa=$.length;fa<sa;fa++){xa=$[fa];ha.isExpanded(xa)||V.push(xa)}}fa=0;for(sa=ya.size()-1;fa<sa;fa++){xa=ya.rowId(fa);ya.il(fa)&& !ha.isExpanded(xa)&&V.push(xa)}V.length&&ha.by(V,true)}V=wa.operation;$=wa.forest.aD();ya=d($);if(ya<0)if(V==="add"||V==="move"&&wa.presenter.showsTo())i(ea);else{if(V==="remove"||V==="move"&& !wa.presenter.showsTo())i(ca)}
else{wa=a($)+1;V=c();$=F.getFixedRowHeight();ya*=$;wa*=$;if(!(ya>=V.pxfrom&&wa<=V.pxto)){V=V.pxto-V.pxfrom;wa-=ya;wa<=V?j(Math.max(0,ya-Math.round((V-wa)/2))):j(ya)}}}},containerScrollTop:function(){return Ra>=0?Ra:na},cE:p,fm:function(wa){var ya=c(),V=F.getFixedRowHeight();wa=Math.floor(Math.min(ya.pxto,Math.max(ya.pxfrom,wa))/V);var $=H.size();wa=Math.max(0,Math.min($,wa));return B.extend(ya,{rowHeight:V,rowY:wa*V,forestIndex:wa})},issueAreaHeight:za,hM:Ca,eQ:function(wa){Ea=wa;wa=qa.children();for(var ya=0,V=wa.length;ya<V;ya++)T(B(wa[ya]))},db:function(){return Ea},scrollpaneHeight:Aa,scrollpane:pa,fs:Sa,iV:function(){return Ka!=null&&Ka.iy()},gL:function(){pa.scrollLeft()!=0&&pa.scrollLeft(0)}})}})(window);(function(U){var C=namespace("almworks.structure"),h=namespace("almworks.util"),k=namespace("almworks.structure.appevents"),e=C.JSON,B="uiState",q="selection",M="displayedIssues",u=1E4;C.ft=function(P){function G(){var o=E()+"uistate.global";if(da)o+=".perspective";return o}function Q(){var o=E()+"uistate."+f;if(da)o+=".perspective";return o}function T(){if(f){var o=C.apputil.ct(na);C.setStored(Q(),o,da);if(ia){o=C.apputil.ct(aa);C.setStored(ia,o,true)}}}function A(){var o=
l();a();if(O){var L=O[B];if(L)for(var ga in L){if(L.hasOwnProperty(ga))na[ga]=L[ga]}else C.iw(P.widget,la,B);T()}else if(ga=C.getStored(Q()))try{L=e.parse(ga);for(var ma in na)if(na.hasOwnProperty(ma)&&L[ma])na[ma]=L[ma]}catch(va){h.warn("cannot restore ui state",va)}na.selectedPath=C.apputil.fC(na.selectedPath,true);na.defaultExpanded= ! !na.defaultExpanded;na.expanded=C.apputil.eW(na.expanded);na.selectedPath=function(Ba){if(!Ba)return Ba;a:{for(var Ga=P.bs(),oa,ta=Ba.length-1;ta>=0;--ta)if(oa=Ga.bS(Ba[ta])){Ba=oa;break a}Ba=null}if(!Ba)return Ba;Ga=0;for(oa=Ba.length-1;Ga<oa;++Ga){ta=Ba[Ga];s(ta)||(na.expanded[ta]=true)}return Ba}(na.selectedPath);ka=na.selectedPath;ua=ga=l();S.fireEvent(k.bu);S.fireEvent(k.eu,ga,o,Y,true);S.fireEvent(k.am)}function t(){if(W){var o=C.apputil.ct(qa);C.setStored(G(),o,da)}}function d(o){return o.defaultSelected|| !h.isEmptyOrFalsy(o.selected)};function a(){ua=ka=na.selectedPath=null;na.expanded={};na.defaultExpanded=false;X.selected={};X.defaultSelected=false}function s(o){o=na.expanded[o];return o===true||o===false?o:na.defaultExpanded}function z(o){return ca&&ca[o]}function I(o){ca=null;if(o){var L=o.length-1;if(L>0){o=o.slice(0,L);ca=h.flipSet(
o);r(o,true)}}}function R(){var o=O[q];if(o){o.defaultSelected= ! !o.defaultSelected;o.selected=C.apputil.eW(o.selected);d(o)&&n(o.defaultSelected,o.selected)}else C.iw(P.widget,la,q)}function b(){var o=O[M];o=i(o,M);if(o.length){var L=P.ae(),ga=P.bn(),ma=ga.cE();ma=ma.to-ma.from+1;if(!(L.size()===ma||L.size()<o.length)){o=h.flipSet(o);var va=L.size(),Ba=va-1;va-=1;for(var Ga=0,oa=0,ta=0;va>=0;va--){var Aa=L.rowId(va);(Aa= ! !o[Aa])&&Ga++;if(va+ma<=Ba){var za=L.rowId(Ba);o[za]&&Ga--;Ba--}if(oa<Ga||Aa&&oa===Ga){oa=Ga;ta=Ba}}ga.io(L.rowId(ta))}}}function i(o,L){var ga=[];if(!h.isArray(o))return ga;for(var ma,va=0;va<o.length;va++){var Ba=o[va];if(typeof Ba!=="number"){if(!ma){ma=true;C.iw(P.widget,la,L)}}else Ba>=0&&ga.push(Ba)}return ga}function r(o,L){if(typeof L==="undefined")L=true;L= ! !L;var ga=false;if(typeof o==="number"||typeof o==="string"){if(Y.isExpanded(o)!==L)if(L|| !z(o)){na.expanded[o]=L;ga=true}}else if(o&&o.length)for(var ma=0;ma<o.length;ma++){var va=o[ma];if(typeof va==="number"||typeof va==="string")if(Y.isExpanded(va)!==L)if(L|| !z(o)){na.expanded[va]=L;ga=true}}if(ga){f&&v();S.fireEvent(k.bu,o)}}function l(){var o=na.selectedPath;if(o===null)return null;var L=
o.length;if(!L)return null;o=o[L-1];if(typeof o!=="number"){h.warn("selected issue nan: "+o);return null}return o}function j(o){if(o&&o.length)for(var L=0,ga=o.length-1;L<ga;L++)if(!s(o[L])){o=o.slice(0,L+1);break}return o}function w(o,L){var ga=na.selectedPath;na.selectedPath=o=j(o);if(L)ka=o;f&&v();ga=ga===null|| !ga.length?null:ga[ga.length-1];var ma=l();if(ga!==ma){ua=ma;S.fireEvent(k.eu,ma,ga,Y,L);ha(P.bs())||S.fireEvent(k.am)}}function D(o){var L=o[0];return(o=o[1])&&o.bS?o.bS(L):L}function J(){w(D(arguments),false)}function c(){w(D(arguments),true)}function p(o){o=X.selected[o];return o===true||o===false?o:X.defaultSelected}function g(o){if(ja){if(typeof o!=="number")o=l();o=P.ae().indexOf(o);if(!(o<0)){var L=P.bn().cE();if(o>L.to||o<L.from)na.issueScroll=null;else{var ga=P.widget.config.getFixedRowHeight();na.issueScroll=Math.round(Math.min(1,Math.max(0,(o*ga-L.pxfrom)/(L.pxto-L.pxfrom)))*u)}}}}function n(o,L){X.defaultSelected=o;X.selected=L;m()}function m(o){if(ia&&(!ba||d(X))){ba=false;aa.defaultSelected=X.defaultSelected;aa.selected=X.selected}f&&v();o||S.fireEvent(k.am)}function F(o){n(! !o,{})}function x(o){var L,ga,ma,va;if(X.defaultSelected){L=[];ga=0;for(ma=o.size(
);ga<ma;){va=o.rowId(ga);if(X.selected[va]===false)ga++;else{L.push(va);ga=o.bH(ga)}}}else L=o.normalizeIdMap(X.selected);if(!L.length){va=l();o.contains(va)&&L.push(va)}return L}function H(o){var L,ga,ma;if(!X.defaultSelected){L=0;for(ga=o.size();L<ga;L++){ma=o.rowId(L);if(!X.selected[ma])return false}return true}for(ma in X.selected)if(X.selected.hasOwnProperty(ma)&&o.contains(ma)&&X.selected[ma]===false)return false;return true}function ha(o,L){var ga,ma,va;if(X.defaultSelected){ga=0;for(ma=o.size();ga<ma;ga++){va=o.rowId(ga);if(va>0&&va!==L&&X.selected[va]!==false)return true}return false}for(va in X.selected)if(X.selected.hasOwnProperty(va)&&va!=L&&X.selected[va]&&o.contains(va))return true;return false}function y(o){var L=0,ga,ma=o.size();if(X.defaultSelected){L=ma;for(ga in X.selected)if(X.selected.hasOwnProperty(ga)){X.selected[ga]===false&&o.contains(ga)&&L--;if(L===0)break}}else for(ga in X.selected)if(X.selected.hasOwnProperty(ga)){X.selected[ga]&&o.contains(ga)&&L++;if(L>=ma)break}return L}function K(o,L,ga){if(o){L=h.indexOf(o,L);if(L>=0)if(ga)o[L]=ga;else o=L>0?o.slice(0,L):null}return o}function N(){return ea?ra:qa.targetIssue};var S=P.bD(),Y=this,Z=P===
P.widget.master,la=Z?"master":"slave",da=P.widget.config.lE,O=P.widget.config.perspectiveSpec&&P.widget.config.perspectiveSpec[la],W=Z,ia=Z&& !C.modes.GADGET?"uistate.session":"";if(ia&&da)ia+=".perspective";var ja= !C.modes.ISSUE_PAGE,pa=P.dN()?P.bE().og():P.widget.master.bE().og(),na={selectedPath:null,expanded:{},defaultExpanded:false,version:0,issueScroll:null},qa={targetIssue:0},aa={selected:{},defaultSelected:false},X={selected:{},defaultSelected:false},ba=false,ea= ! !(C.modes.GH_TAB||C.modes.ISSUE_PAGE),ra=0,ka=null,ca=null,ua=null,f="",v=h.delayed(500,T),E=h.lazy(function(){if(C.modes.GADGET&&U.name)return U.name+".";else if(C.modes.GH_TAB)return "ghTab.";return ""});this[k.cK]=h.seq(g,T);this[k.aA]=function(o,L){var ga=l();na.selectedPath=K(na.selectedPath,o,L);ka=K(ka,o,L);if(na.expanded.hasOwnProperty(o)){if(L)na.expanded[L]=na.expanded[o];delete na.expanded[o]}if(X.selected.hasOwnProperty(o)){if(L)X.selected[L]=X.selected[o];delete X.selected[o]}m(true);ga===o&&S.fireEvent(k.eu,L,o,Y,false)};S.addListener(new h.Life,this);P.bd().events.addListener(new h.Life,C.bi.E,function(){if(!(N()>0||C.modes.HISTORY||pa.value())){var o=P.bd(),L,ga=false;for(L in X.selected)if(
X.selected.hasOwnProperty(L)&& !o.contains(L)){delete X.selected[L];ga=true}for(L in na.expanded)if(na.expanded.hasOwnProperty(L)&& !o.contains(L)){delete na.expanded[L];ga=true}ga&&m(true)}});P.bs().events.addListener(new h.Life,C.bi.E,function(){S.postEvent(k.am)});(function(){if(W)if(O){var o=O.pinnedIssue;if(typeof o==="number"&&o>=0){qa.targetIssue=o;t()}else{C.iw(P.widget,la,"pinnedIssue");qa.targetIssue=0}}else{if(o=C.getStored(G()))try{var L=e.parse(o);qa.targetIssue=h.toIntSafe(L&&L.targetIssue,0)}catch(ga){h.warn("cannot restore global ui state",ga)}if(qa.targetIssue<0)qa.targetIssue=0}})();(function(){if(ia){var o,L;if(o=C.getStored(ia))try{if(L=e.parse(o)){aa.defaultSelected= ! !L.defaultSelected;aa.selected=C.apputil.eW(L.selected);if(d(aa))ba=true}}catch(ga){h.warn("cannot restore session ui state",ga)}}})();P.rootPath&&P.rootPath.pipe(I);(function(){if(O)if(Z)P.widget.eventBus.addListener(null,k.cd,function(){R()});else{var o;P.widget.bF.outsideShown.pipe(function(L){if(!(o|| !L)){L=P.widget.ir;if(!(L.visibleCell.value()&&L.isLoading())){o=true;b();R();L=(L=O[B])&&L.selectedPath;L=i(L,B);L.length&&J(L)}}})}})();h.extend(this,{isExpanded:s,by:r,cC:function(o){
na.defaultExpanded= ! !o;na.expanded={};!o&&ca&&h.extend(na.expanded,ca);f&&v();S.fireEvent(k.bu)},bm:l,ml:function(){return na.selectedPath},eJ:J,setIssueScroll:g,restoreScroll:function(){if(ua){var o=null;if(ja){var L=na.issueScroll;if(typeof L==="number")o=L/u}P.bn().io(ua,o)}},kK:c,mU:function(){var o=ka&&ka.length;return o?ka[o-1]:null},nc:function(o){l()||o.isEmpty()||J([o.rowId(0)])},clear:a,isSelected:function(o){if(p(o))return true;if(o===l()&& !ha(P.bs()))return "auto";return false},toggleSelected:function(o){X.selected[o]= !p(o);m()},selectSubtrees:function(o){var L=x(o),ga={},ma,va,Ba,Ga;ma=0;for(va=L.length;ma<va;ma++){Ba=L[ma];Ga=o.indexOf(Ba);if(Ga>=0){Ba=Ga;for(Ga=o.bH(Ga);Ba<Ga;Ba++)ga[o.rowId(Ba)]=true}}n(false,ga)},selectRoots:function(o){o=x(o);o=o.length===1&&o[0]==l()?{}:h.flipSet(o);n(false,o)},jo:h.curry(F,false),jZ:function(o,L,ga){var ma=P.bs().bS(o),va;if(!ma)return false;L&&ma.length>1&&r(ma.slice(0,ma.length-1));if(ga){a:{va=ma;L=P.ae();var Ba,Ga,oa;va=j(va);Ba=va[va.length-1];Ga=L.indexOf(Ba);if(!(Ga<0)){oa=ua;if(!L.contains(oa)){if(va=P.bs().bS(oa)){va=j(va);oa=va[va.length-1]}else{oa=l();if((!oa|| !L.contains(oa))&&L.size()>0)oa=L.rowId(0)}if(oa&&oa>
0)ua=oa;else{ua=null;break a}}va={};if(Ba!=oa){oa=L.indexOf(oa);Ba=Math.min(Ga,oa);for(Ga=Math.max(Ga,oa);Ba<=Ga;Ba++)va[L.rowId(Ba)]=true}n(false,va)}}va=ua}c(ma);if(ga)ua=va;g(o);return true},toggleSelectAll:function(){F(!H(P.bs()))},kT:x,getSelected:function(o){var L=[],ga,ma,va,Ba;if(X.defaultSelected){ga=0;for(ma=o.size();ga<ma;ga++){va=o.rowId(ga);X.selected[va]!==false&&L.push(va)}}else{Ba={};for(va in X.selected)if(X.selected.hasOwnProperty(va)&&X.selected[va]){ga=o.indexOf(va);if(ga>=0){L.push(h.toIntSafe(va));Ba[va]=ga}}L.length>1&&L.sort(function(Ga,oa){return Ba[Ga]-Ba[oa]})}if(!L.length){va=l();o.contains(va)&&L.push(va)}return L},mp:function(o){var L=y(o);if(L>0)return L;return o.contains(l())?1:0},kz:y,syncState:function(o){T();(f=o||"")&&A()},aP:function(){var o=na.expanded,L=na.defaultExpanded,ga=L?"++":"--",ma;for(ma in o)if(o.hasOwnProperty(ma)){var va=o[ma];if(! !va!=L){ga+=".";ga+=va?"+":"-";ga+=ma}}return ga},lb:function(o){o=o[la];o[q]=X;o[B]=na;for(var L=M,ga=[],ma=P.bn().cE(),va=P.ae(),Ba=ma.from;Ba<=ma.to;Ba++){var Ga=va.rowId(Ba);typeof Ga==="number"&&Ga>0&&ga.push(Ga)}o[L]=ga;if(Z)o.pinnedIssue=qa.targetIssue},cb:N,dG:function(o){C.getUrlHashParam(
"traceRoot")&&h.debug("UI:target",P.panelId,o);o=h.toIntSafe(o,-1);var L=N();if(!(o===L||o<0)){if(ea)ra=o;else{qa.targetIssue=o;t()}S.fireEvent(k.cq,N(),L)}},en:function(o){C.getUrlHashParam("traceRoot")&&h.debug("UI:targetOverride",P.panelId,o);o=h.toIntSafe(o,-1);if(!(o<0)){ea=true;var L=N();if(o!==L){ra=o;S.fireEvent(k.cq,N(),L)}}},fe:z,getVersion:function(){return na.version},setVersion:function(o){if(o!==na.version){na.version=o;f&&v()}},nb:function(o){if(!ia|| !o|| !ba)return false;if(d(X))return false;var L=o.size(),ga,ma;if(L===0)return false;if(aa.defaultSelected)for(ma=0;ma<L;ma++){ga=o.rowId(ma);if(aa.selected[ga]!==false)return true}else for(ga in aa.selected)if(aa.selected.hasOwnProperty(ga)&&o.indexOf(ga)>=0)return true;return false},lL:function(){d(aa)&&n(aa.defaultSelected,aa.selected)},jd:b})}})(window);(function(U,C){var h=namespace("almworks.util"),k=namespace("almworks.structure"),e=namespace("almworks.structure.appevents"),B=namespace("almworks.structure.apputil"),q=namespace("almworks.structure.jqlutil"),M=k.$,u="searchPanel.";k.ed=function(P,G){function Q(v,E,o){return A(v,E,{fromCookie:function(L){return o?"false"!==L:"true"===L},toCookie:function(L){
return L?"true":"false"}})}function T(v,E,o,L){return A(v,E,{fromCookie:function(ga){return!ga||L&& !L.hasOwnProperty(ga)?o:ga},toCookie:h.identity})};function A(v,E,o){var L=P.viewCookie;v.setValue(o.fromCookie(L.getSingleValue(E)));v.pipeChanges(o.life||new h.Life,function(ga){o.skipChange&&o.skipChange()||L.replaceValue(E,o.toCookie(ga))});return v}function t(v,E,o){var L=u+E;if(K)E=K[E]===C? ! !o:K[E];else{E=k.getStored(L);E=o?"false"!==E:"true"===E}v.setValue(E);v.pipe(function(ga){k.setStored(L,ga?"true":"false",true)});return v}function d(v,E,o,L){var ga=u+E;E=K?K[E]:k.getStored(ga);if(!E||L&& !L.hasOwnProperty(E))E=o;v.setValue(E);v.pipe(function(ma){k.setStored(ga,ma,true)});return v}function a(){q.loadSearchData({error:function(v,E){var o=h.httpErrorReport(v,E);P.errorCentral.reportError(new k.error.AppError(h.text("sw.error.search-load",o.title),"When requesting StructureSearchData:\n\n"+o.details))},complete:function(){y.dj.setValue(true)}})}function s(){var v=M("#st-jqlerrormsg");v.is(".jqlgood")?y.jqlErrorLocal.setValue(false):y.jqlErrorLocal.setValue(v.text()||true)}function z(v,E,o){if(o)E+=" ("+h.formatShortcut(o)+")";v.attr("title",h.htmlUnescape(E))}function I(v)
{if(!na){na=true;try{var E=y.searchResult.value(),o=y.searchType.value()!=="sjql"&&E&&E.lists,L=0,ga=0;if(o){if(!o.cW){o.cW=true;var ma;var va=o.kM;if(va){var Ba=[],Ga,oa=va.length;for(Ga=0;Ga<oa;Ga++)Ba.push(new k.bP(va[Ga],0));ma=Ba}else ma=[];o.bp=ma;qa= ! !o.kM;b(o.bp)}var ta=Math.max(o.unstructuredCount||0,0);if(qa){L=ga=W.size();var Aa=ta-o.bp.length;if(Aa>0)L+=Aa}else L=ta;y.outsideOn.value()&&L>0&&ga===0&&w(E.request.type,E.request.q,true)}else if(qa){b(null);qa=false}if(L!==aa){aa=L;var za=L===1?h.text("st.search.1.unstructured.found"):h.text("st.search.n.unstructured.found",L);Y.aY.find("span").html(za);h.showHide(Y.resultUnstructured,L>0)}v&& !y.outsideShown.value()&&ga>0&&y.outsideOn.setValue(false);if(!v)if(y.outsideOn.value()&&L>0)p.setValue(ia);else p.value()===ia&&p.setValue(null);R()}finally{na=false}}}function R(){var v=0,E=0,o=y.searchType.value()!=="sjql"&&y.searchResultLists.value();if(o&&o.cW&&y.outsideShown.value()&&W.size()>0){var L=P.slave.ao().mp(W);if(L>0){E=3;v=L}else if(o.bp.length===o.unstructuredCount)E=1;else{E=2;v=W.size()}}if(X!==E||ba!==v){X=E;ba=v;h.showHide(Y.di,E>0&&E<=3);if(E===1){Y.addUnstructured.find("span").text(h.text(
"s.w.unstructured.add.all.label"));z(Y.addUnstructured,h.text("s.w.unstructured.add.all.tip"),Z.paste)}else if(E===2){Y.addUnstructured.find("span").text(h.text("s.w.unstructured.add.first.label",v));z(Y.addUnstructured,h.text("s.w.unstructured.add.first.tip",v),Z.paste)}else if(E===3){Y.addUnstructured.find("span").text(h.text("s.w.unstructured.add.selected.label",v));z(Y.addUnstructured,h.text("s.w.unstructured.add.selected.tip",v),Z.paste)}}}function b(v){v=v||[];W.jy();try{W.setExcludeFrom(v.length?n:null);O.aH(v)}finally{W.ap()}}function i(){y.bw.setValue(true);h.selectText(S,0,S.val().length);S.focus();return true}function r(){if(ea!==ra)if(ra=ea){G.addClass("st-searching");Y.go.addClass("s-disabled");ka=(new Date).getTime()}else{G.removeClass("st-searching");Y.go.removeClass("s-disabled");ka=0}}function l(){ea=false;if(ra){var v=Math.min(ca,(new Date).getTime()-(ka+ca));v>10?U.setTimeout(r,v):r()}}function j(){if(y.bw.value()){var v=y.searchTerm.value();v.type==="none"&& !x||v.type==="jql"&&y.jqlErrorLocal.value()||w(v.type,v.q,true)}}function w(v,E,o){if((!v||v==="none")&& !x){c.clear();return true}if(!o){var L=y.searchResult.value();if((L=L&&L.request)&&L.type===v&&L.q===
E)return false}da&&da.dropdownController.hideDropdown();ea=true;if(o)r();else ra||setTimeout(r,ca);o=y.outsideOn.value()?"max1000":"count";c.search(v,E,o,l,x,y.et.value());g.removePins();return true}function D(){y.bK.setValue(null);j()}function J(v){if(!y.outsideShown.value())return false;if(P.master.eN().value())return false;var E=P.slave,o=W;if(o.isEmpty())return false;var L=null;L=E.ao().kT(o);E=false;if(L.length)L=o.cD(L);else{L=new k.bx(o.as());E=(o=y.searchResultLists.value())&&o.cW&&o.bp&&o.bp.length===o.unstructuredCount}if(L.isEmpty())return false;(v=P.master.cc()._paste(v,L,"add-from-search"))&&E&&y.bw.setValue(false);return v}if(G.length){var c=h.nn(P.dm),p=h.nn(P.slave.controller),g=h.nn(P.master.dR()),n=h.nn(P.master.bd()),m=h.nn(P.eventBus),F=P.globalActions,x=P.config.scopeJQL,H= ! !k.modes.GADGET,ha={text:{order:0,text:"Abc"},jql:{order:1,text:"JQL"},sjql:{order:2,text:"SJQL"}},y={},K=P.config.perspectiveSpec&&P.config.perspectiveSpec.bF;y.bw=k.modes.GH_TAB?(new h.Cell).setValue(false):P.config.pinSearch?(new h.Cell).setValue(true):P.config.lE?t(new h.Cell,"search"):Q(new h.Cell,"search");y.filterOn=P.config.pinFilter?(new h.Cell).setValue(true):P.config.lE?t(
new h.Cell,"filter"):Q(new h.Cell,"filter");y.searchType=P.config.lE?d(new h.Cell,"searchType","text",ha):T(new h.Cell,"searchType","text",ha);y.et=function(v,E,o){function L(){ga.cycle();var va=k.modes.getStructurePageId();!(ma.lE&&ma.perspectiveSpec&&ma.perspectiveSpec.structurePageId===va)&&va===o?A(v,E+"."+o,{life:ga,fromCookie:function(Ba){return Ba==="true"},toCookie:function(Ba){return Ba?"true":"false"},skipChange:function(){return k.modes.getStructurePageId()!==o}}):v.setValue(false)}var ga=new h.Lifecycle,ma=P.config;L();P.eventBus.addListener(new h.Life,e.STRUCTURE_PAGE_CHANGED,L);return v}(new h.Cell,"columns","structure");y.activeSavedFilter=(new h.Cell).setValue(P.config.forceFilterId);var N=P.config.pinOutsiders;y.outsideOn=N===true||N===false?(new h.Cell).setValue(N):P.config.lE?t(new h.Cell,"outside",true):Q(new h.Cell,"outside",true);y.dj=(new h.Cell).setValue(false);y.bK=(new h.Cell).setValue(null);y.searchResult=new h.Cell(y.bw,y.bK,h.and);y.searchResultLists=new h.Cell(y.searchResult,function(v){return v&&v.lists});y.jqlErrorLocal=(new h.Cell).setValue(null);y.queryError=(new h.Cell(y.jqlErrorLocal,y.searchResult,y.searchType,function(v,E,o){if(v===null&&(E===
null||E.errors===null))return null;E= ! !(E&&E.errors&&E.errors.length);return o==="jql"&& ! !v||E})).setValue(null);G.hide();G.html(h.renderTemplate(
'<div id="st-search">  <div class="st-tbt st-sr-label">{st.widget.search.label}</div>  <div id="st-sr-scope"></div>  <div class="st-sr-qbox">    <div id="st-searchtype-switch">    <div id="st-searchtype-but" class="st-tb first last toggled"><div class="st-tbt">JQL</div></div>    <div id="st-jqlerrormsg"></div>  </div>  <textarea id="st-query" rows="1" name="jqlQuery" class="st-search-query ajs-dirty-warning-exempt focus-select-end focused"></textarea></div><div id="st-search-go" class="st-tb first last"><div class="st-tbi"></div><div class="st-tbt"><span></span></div></div><div id="st-search-result">  <div id="st-search-n-found"><span></span></div>  <div id="s-search-columns" class="st-tb first"><div class="st-tbi"></div><div class="st-tbt"><span>{s.w.search.columns.label}</span></div></div>  <div id="st-search-filter" class="st-tb"><div class="st-tbi"></div><div class="st-tbt"><span></span></div></div>  <div id="st-search-result-unstructured">    <div id="st-show-unstructured" class="st-tb first"><div class="st-tbi"></div><div class="st-tbt"><span></span></div></div>    <div id="s-unstructured-actions">      <div id="s-add-unstructured" class="st-tb first s-ro-hide"><div class="st-tbi"></div><div class="st-tbt"><span></span></div></div>    </div>  </div></div><div id="st-search-notfound"><span title="{st.search.notfound.description}">{st.search.notfound.label}</span></div><div id="st-search-error"></div></div><div class="br"></div>')
);k.apputil.initializeButton(G.find(".st-tb"));var S=G.find("textarea");if(k.modes.GADGET)P.viewCookie.replaceValue("q","");else if(P.config.lE){N=K?K.q:k.getStored(u+"q");S.val(N||"")}else S.val(P.viewCookie.getSingleValue("q"));G.find(".st-tb").mouseup(function(){S.focus()});S.focus(function(){G.addClass("s-input-active")}).blur(function(){G.removeClass("s-input-active")});h.hoverToClass(G);var Y={textarea:G.find("#st-query"),go:G.find("#st-search-go"),aY:G.find("#st-show-unstructured"),filter:G.find("#st-search-filter"),searchType:G.find("#st-searchtype-but"),result:G.find("#st-search-result"),resultUnstructured:G.find("#st-search-result-unstructured"),notFound:G.find("#st-search-notfound"),nFound:G.find("#st-search-n-found span"),scopeBox:G.find("#st-sr-scope"),di:G.find("#s-unstructured-actions"),addUnstructured:G.find("#s-add-unstructured"),columns:G.find("#s-search-columns")},Z={searchType:"alt+j",filter:"alt+f",more:"alt+m",nextFound:"down",prevFound:"up",paste:"ctrl+enter",pasteUnder:"ctrl+shift+enter",morePanel:"ctrl+m",tab:"tab"},la={};h.eachOwn(Z,function(v){la[v]=h.keyboardCodeFromString(Z[v])});z(Y.go,h.text("s.w.search.go.tooltip"),"enter");z(Y.nFound,h.text(
"s.w.search.found.tooltip"));z(Y.filter,h.text("s.w.search.filter.tooltip"),Z.filter);z(Y.aY,h.text("s.w.search.outside.tooltip"),Z.more);z(Y.columns,h.text("s.w.search.columns.tooltip"));(function(){var v=h.text("st.widget.search.type.switch.desc",h.formatShortcut(Z.searchType));(new h.Cell(y.searchType,y.queryError,function(E,o){return{type:ha.hasOwnProperty(E)?E:"text",error:(E==="jql"||E==="sjql")&&o}})).pipe(function(E){var o=E.error?h.text("st.widget.search.error"):"",L=h.text("st.widget.search.type.desc.+"+E.type+"+");Y.searchType.attr("title",h.htmlUnescape(o+L+" ("+v+")"));E=h.text((!E.error?"st.widget.search.input.hint.":"st.widget.search.input.error.hint.")+"+"+E.type+"+");Y.textarea.attr("title",E)})})();if(P.config.scopeJQL){N=P.config.scopeName||P.config.scopeJQL;Y.scopeBox.append('<div class="st-sr-scopename" title="'+h.text("sw.search.scope.tooltip")+'"><span>'+N+"</span></div>");Y.scopeBox.show()}Y.filter.find("span").text(h.text("st.widget.search.filter"));Y.aY.find("span").text(h.text("st.widget.showun.label"));Y.go.find("span").text(h.text("st.widget.search.go"));k.apputil.installAction(Y.aY,"searchOutsideToggle");k.apputil.installAction(Y.filter,
"searchFilterToggle");k.apputil.installAction(Y.searchType,"searchTypeSwitch");k.apputil.installAction(Y.go,"runSearch");k.apputil.installAction(Y.addUnstructured,"pasteSearchResult");k.apputil.installAction(Y.columns,"searchColumnsToggle");k.apputil.pipeToggled(y.outsideOn,Y.aY);k.apputil.registerBooleanActions(F,y.outsideOn,"searchOutsideOn","searchOutsideOff","searchOutsideToggle");N=(new h.Cell).fieldInput(S);y.searchTerm=new h.Cell(y.searchType,y.activeSavedFilter,N,function(v,E,o){if(E)return{type:"filter",q:E};E=M.trim(o);if(!E)return{type:"none",q:E};if(E==="*")return{type:"all",q:""};if(v)return{type:v,q:E};return{type:"text",q:E}});var da=null;(new h.Cell(y.searchType,y.dj,y.bw,function(v,E,o){return E&&o?v:null})).pipe(function(v){y.jqlErrorLocal.setValue(null);y.queryError.setValue(null);if(v==="jql"){da||(da=q.createAutocomplete({fieldID:"st-query",errorID:"st-jqlerrormsg",updateParseIndicator:s,completeField:M("#st-query").data("cellUpdate")}));da.enable();da&&da.parse(S.val())}else if(da){da.dropdownController.hideDropdown();da.disable()}});(new h.Cell(y.searchType,y.queryError,N,function(v,E,o){return(v==="jql"||v==="sjql")&&o&&M.trim(o)?E:null})).pipe(function(v){
if(v===null)Y.searchType.removeClass("st-jqlgood st-jqlbad");else if(v===false)Y.searchType.removeClass("st-jqlbad").addClass("st-jqlgood");else v===true&&Y.searchType.removeClass("st-jqlgood").addClass("st-jqlbad")});y.activeTerm=(new h.Cell(y.searchType,y.jqlErrorLocal,y.searchTerm,y.bw,function(v,E,o,L){return!L||v==="jql"&&E?null:o})).setDelay(300);y.activeTerm.pipe(function(v){if(v!==null){if(!k.modes.GADGET){var E=v.type==="all"?"*":v.q;P.config.lE?k.setStored(u+"q",E,true):P.viewCookie.replaceValue("q",E)}w(v.type,v.q,false)}});k.apputil.pipeText(y.searchType,Y.searchType.find("div"),function(v){return v?ha[v].text:null});y.nextSearchType=k.apputil.gV(F,y.searchType,"searchTypeSwitch",h.eachValue(ha,function(v,E,o){o[v.order]=E;return o},false,[]));k.apputil.pipeToggled(y.et,Y.columns);k.apputil.registerBooleanActions(F,y.et,"searchColumnsOn","searchColumnsOff","searchColumnsToggle");var O=new k.bx,W=(new k.dq).setSource(O),ia={getForest:function(){return W}};P.bk.bj(ia,{selectorWeight:20,imagePos:"-160px -112px",toggleAction:"slaveSearchOutsideToggle",showAction:"slaveSearchOutsideOn",hideAction:"slaveSearchOutsideOff",hideEmpty:true,autoHide:false,withoutCount:true,
tooltip:h.text("s.w.search.selector.tooltip")});y.outsideShown=new h.Cell(p,function(v){return v===ia});y.outsideShown.pipeChanges(function(v){v&&y.outsideOn.setValue(true);I(true)});y.issueFilter=new h.Cell(y.searchResultLists,function(v){if(!v)return null;var E=v.issueSet;if(h.isEmptyOrFalsy(E))return h.returnFalse;return function(o){return E[o]}});var ja=new h.Lifecycle,pa=(new h.Cell).setValue(0);(new h.Cell(y.issueFilter,function(v){return v!==null&&v!==h.returnFalse})).pipe(function(v){ja.cycle();v&&n.events.addListener(ja.life(),k.bi.E,h.delayed(10,function(){pa.setValue(pa.value()+1)}))});y.structureFoundCount=new h.Cell(y.issueFilter,pa,function(v){if(v===null)return-1;if(v===h.returnFalse)return 0;return n.fc(v)});y.structureFoundCount.pipe(function(v){v<0?Y.nFound.html(""):Y.nFound.html(h.text("st.search.n.found",v))});var na=false,qa=false,aa;N=h.curry(I,false);y.searchResult.pipeChanges(N);y.outsideOn.pipeChanges(N);W.getSizeCell().pipeChanges(N);var X= -1,ba=0;P.slave.bD().addListener(new h.Life,e.am,function(){y.outsideShown.value()&&R()});(new h.Cell(y.searchResultLists,function(v){if(!v)return 0;if(!h.isEmptyOrFalsy(v.issueSet)||v.unstructuredCount>0)return 2;
return 1})).pipe(function(v){h.showHide(Y.result,v===2);h.showHide(Y.notFound,v===1)});(new h.Cell(y.filterOn,y.issueFilter,function(v,E){return{useFilter:v,filter:E}})).pipe(function(v){g.gy("search",v.useFilter?v.filter:null);P.master.bn().eQ(v.filter);v.useFilter&&v.filter&&P.master.bD().fireEvent(e.ACTION,"closestHighlighted")});k.apputil.pipeToggled(y.filterOn,Y.filter);k.apputil.registerBooleanActions(P.globalActions,y.filterOn,"searchFilterOn","searchFilterOff","searchFilterToggle");N=y.bw.value()&& !H;B.bU(N,G,P,h.returnConst(26),false);N&&a();H?y.bw.pipeChanges(function(v){v||c.clear()}):y.bw.pipeChanges(function(v){B.bU(v,G,P,h.returnConst(26),true);if(v){a();S.focus();S.select()}else c.clear()});k.apputil.registerBooleanActions(P.globalActions,y.bw,"searchOn","searchOff","toggleSearch");var ea=false,ra=false,ka=0,ca=1E3,ua=P.master.ah();S.keydown(function(v){var E=h.keyboardCodeFromEvent(v);if(E===la.searchType){F.action("searchTypeSwitch");return false}if(E===la.filter){y.filterOn.setValue(!y.filterOn.value());v.preventDefault();v.stopImmediatePropagation();return false}if(E===la.more){y.outsideOn.setValue(!y.outsideOn.value());return false}if(E===la.tab){S.blur();
P.aw.getFocusedPanel().bn().aJ();return false}if(!(y.searchType.value()==="jql"&&da&&da.dropdownController&&da.dropdownController.displayed&& !(da.selectedIndex<0)))if(E===27){y.bw.setValue(false);return false}else if(v.keyCode===13){if(E===la.paste||E===la.pasteUnder){v=E===la.paste;P.master.bD().fireEvent(e.ACTION,v?"pasteSearchResult":"pasteSearchResultUnder")}else j();return false}else if(E===la.nextFound){ua.action("nextHighlighted",v);return v.consumed?false:true}else if(E===la.prevFound){ua.action("prevHighlighted",v);return v.consumed?false:true}else if(E===la.morePanel)if(y.outsideShown.value()){S.blur();P.aw.setFocusedPanel(P.slave);P.slave.ao().nc(P.slave.ae())}});y.bA=new h.Cell(y.searchResult,y.et,y.bw,function(v,E,o){if(!E|| !o)return false;return v&&v.view||null});var f=P.master.bW();y.bA.pipe(function(v){if(v!==null){var E=v&&v.id;if(E){P.jT.mb(v);f.mC(E)}else f.mV()}});f.mA().pipeChanges(function(v,E){var o=y.bA.value();(o=o&&o.id)&&o===E&&y.et.setValue(false)});y.et.pipeChanges(function(v){if(v)(v=y.bK.value())&& !v.view&&j()});F.register("focusSearch",i);F.register("runSearch",j);F.register("pasteSearchResult",h.curry(J,false));F.register(
"pasteSearchResultUnder",h.curry(J,true));this[e.dc]=function(){y.bK.setValue(c.lastResult())};this[e.STRUCTURE_CHANGED]=D;this[e.kl]=D;m.addListener(new h.Life,this);h.extend(this,{visibleCell:y.bw,cp:y.activeTerm,dh:y.filterOn,oT:y.bA,outsideShown:y.outsideShown,isSearching:function(){return ea},setForcedFilter:function(v){h.assert(k.modes.GADGET);v=v||0;h.Cell.prototype.multiUpdate(true);try{y.bw.setValue(! !v);y.filterOn.setValue(! !v);y.outsideOn.setValue(v?false:null);y.activeSavedFilter.setValue(v)}finally{h.Cell.prototype.multiUpdate(false)}},nj:function(){if(P.config.forceFilterId)return false;var v=y.bw;if(!v.value())return false;v.setValue(false);return true},lb:function(v){var E={},o=y.bw.value();if(E.search=o){E.filter=y.filterOn.value();E.outside=y.outsideOn.value();if((o=y.activeTerm.value())&&o.type!=="none")if(o.type==="all"){E.searchType="text";E.q="*"}else{E.searchType=o.type;E.q=o.q}}v.bF=E},focusSearch:i})}}})(window);(function(){var U=namespace("almworks.util"),C=namespace("almworks.structure"),h=namespace("almworks.structure.appevents");C.fG=function(k){function e(P,G,Q,T,A,t){if(k.currentStructure.id){var d={type:P,q:G,unstructured:Q||"count",structure:
k.currentStructure.id,scope:A,sequence: ++M};P=C.ajax.RESOURCES.SEARCH+"?search="+d.type+"&q="+encodeURIComponent(d.q)+"&structure="+d.structure+"&unstructured="+d.unstructured;if(G=k.ir.lg.value())P+="&version="+G.version;if(A)P+="&scope="+encodeURIComponent(A);if(t)P+="&withView=true";A=new q.Task(P,C.ajax.DOWNLOAD,function(a){if(d.sequence===M){var s=a&&a.issues?C.apputil.kf(a.issues):{},z=a&&a.unstructured;(z=z?C.hU(z):null)&&U.flipSet(z,U.returnTrue,s);var I=a?U.toIntSafe(a.unstructuredCount,-1): -1,R=a&&a.view||null;a=a&&a.errors||[];u=U.extendOwn({},u||{},a.length?{request:d,view:R,errors:a}:{request:d,view:R,errors:a,lists:{issueSet:s,kM:z,unstructuredCount:I}});B.fireEvent(h.dc)}},function(){});A.chainComplete(T);q.addTask(A)}else U.safeCall(T)}var B=U.nn(k.eventBus),q=U.nn(k.ajax),M=0,u=null;U.extend(this,{search:e,lastResult:function(){return u},clear:function(){M++;u=null;B.fireEvent(h.dc)},lu:function(P,G){if(!(!u|| !P|| !P.length)){var Q=u.lists&&u.lists.issueSet,T,A=P.length,t=false;for(T=0;T<A;T++){var d=P[T];if(G[d]){if(!Q[d])t=Q[d]=true}else if(Q[d]){Q[d]=false;t=true}}if(t){u={request:u.request,view:u.view,errors:u.errors,lists:{issueSet:Q,kM:u.lists&&u.lists.kM,
unstructuredCount:u.lists&&u.lists.unstructuredCount}};window.setTimeout(function(){B.fireEvent(h.dc)},20)}}},ln:function(){var P=u&&u.request;P&&e(P.type,P.q,P.unstructured,null,P.scope)}})}})();(function(){function U(e){for(var B="",q=0,M=e.size();q<M;q++){if(B)B+=",";var u=e.row(q);B+=u.getId()+":"+u.getDepth()}return B}var C=namespace("almworks.structure"),h=namespace("almworks.util"),k=namespace("almworks.structure.appevents");h.extend(C,{Clipboard:function(e){function B(G){var Q=u.aD();u.aH(G);G=u.aD();P();M.fireEvent(k.be,Q,G)}function q(){C.setStored("clipboard",U(u))}var M=h.nn(e.eventBus),u=new C.bx,P=h.delayed(500,q);e.bk.bj({getForest:function(){return u}},{selectorWeight:30,imagePos:"-160px -128px",toggleAction:"slaveClipboardToggle",hideEmpty:true,autoHide:false,withoutCount:false,tooltip:h.text("s.w.clipboard.selector.tooltip")});M.addListener(new h.Life,k.cK,q);h.extend(this,{isEmpty:function(){return u.isEmpty()},hasIssue:function(G){return u.contains(G)},clear:h.curry(B,[]),setContent:B,accessForest:function(){return u}});(function(){var G=C.getStored("clipboard");if(G){var Q=u.aD();G=C.parseFormula(G);u.aH(G);G=u.aD();M.fireEvent(k.be,Q,G)}})()}})})();(function()
{function U(){this.state=e}var C=namespace("almworks.structure");namespace("almworks.structure.ajsbridge");var h=namespace("almworks.util"),k=namespace("almworks.structure.appevents"),e=1,B=2;h.extend(U.prototype,{aj:function(){h.pvc()},bN:function(){h.pvc()},isOverridingAction:function(){return false},getInverseAction:function(){return null},bQ:function(){h.pvc();return false},toString:function(){try{return "upload: "+C.apputil.ct(this.aj())}catch(q){return "?"+q+"?"}},reset:function(){this.state=e;return this},getAffectedIssues:function(){return[]}});C.cA=function(q){function M(da){if(da.priority){h.assert(!da.bN(),da+" "+da.bN());if(!g.length||g[0]!==da)g=h.addAll([da],g)}else{var O=g.length-1,W=g[O];if(W&&W.state===e&&u(da,W)){g.splice(O,1);w.remove(W.bN())}else if(W&&W.state===e&&da.isOverridingAction(W)){g[O]=da;w.al(true);try{w.remove(W.bN());w.add(da.bN())}finally{w.al(false)}}else{g.push(da);w.add(da.bN())}}n=g.length>0;C.modes.DEVMODE||y();J.fireEvent(k.aE,R)}function u(da,O){if(da.edit||O.edit)return false;var W=O.getInverseAction();if(!W)return false;if(da===W)return true;if(da.spec&&W.spec&&h.isDeeplySame(da.spec,W.spec))return true;return false}function P(){if(!(F|| !
g.length||S)){if(H){var da=(new Date).getTime();if(da<H){ha||(ha=window.setTimeout(P,H-da+50));return}}ha=null;H=0;da=null;for(var O=0;!da&&O<g.length;){for(var W=O?g.slice(O):g,ia=0;ia<m.length;ia++)if(da=m[ia].dw(W))break;da||O++}if(da){da.skipped=O;t(da)||window.setTimeout(P,100)}else n=false;J.fireEvent(k.aE,R)}}function G(da,O,W,ia){x=0;W=W||{};var ja,pa;D.jy();try{w.al(true);try{ja=0;for(pa=da.length;ja<pa;ja++){var na=da[ja];h.assert(na.state===B,ja+" "+na);var qa=h.indexOf(g,na);h.assert(qa>=0,ja+" "+qa+" "+na);qa>=0&&g.splice(qa,1);w.remove(na.bN())}var aa=ia?O.es:O.eI;aa&&h.safeCall(aa,W,W)}finally{w.al(false)}W.update&&O.fF&&i.applyUpdate(W.update,O.fF)}finally{D.ap()}if(W.errors){da=W.errors;ja=0;for(pa=da.length;ja<pa;ja++){qa=da[ja];var X=qa.issue||0;na=qa.code||0;qa=qa.message||"";aa="";if(X)(aa=c.getIssueField(X,"jira:raw:issuekey"))||(aa="#"+X);X="s.w.error."+na;var ba=h.text(X,aa);if(ba===X)ba=aa?h.text("s.w.error.upload-generic.issue",aa):h.text("s.w.error.upload-generic");l.reportError(new C.error.AppError(ba,ba+"\n\nError "+na+"\n"+qa))}}if(!W.update&&O.cB|| !ia){ia&&W.success!==false&&h.isDebugging()&&h.debug("UQ:no update");q.widget.poller.poll()}}function Q(
da,O,W){N===O.life&&G(da,O,W,true)}function T(da,O){if(O==="timeout"||O==="connection")return false;var W;try{W=da.status}catch(ia){return false}if(!W)return false;return!la[W]}function A(da,O,W,ia){if(N===O.life)if(T(W,ia)){ia=h.httpErrorReport(W,ia);var ja=O.count===1?"When uploading change:":"When uploading "+O.count+" structure changes:",pa=h.text("sw.error.upload-forest",ia.title),na=pa;try{if(W.status>0){var qa="s.w.error.upload.http."+W.status;na=h.text(qa,ia.title);if(na===qa)na=pa}}catch(aa){}l.reportError(new C.error.AppError(na,pa+"\n"+ja+"\n"+ia.details));G(da,O,null,false)}else{O=0;for(W=da.length;O<W;O++){qa=da[O];h.assert(qa.state===B,O+" "+qa);ia=h.indexOf(g,qa);h.assert(ia===O,O+" "+ia+" "+qa);qa.state=e}x=Math.floor(Math.min(Math.max(z,x*1.5),I));H=(new Date).getTime()+x}}function t(da){h.assert(!F,this);var O=da.count;if(!O)return false;F=true;var W=da.skipped||0;O=g.slice(W,O+W);W=new b.Task(da.url,C.ajax.UPLOAD,h.curry(Q,O,da),h.curry(A,O,da));W.type="POST";W.data=da.data;for(var ia=0,ja=O.length;ia<ja;ia++){h.assert(O[ia].state===e);O[ia].state=B}var pa=W.complete;W.complete=function(){if(N===da.life){F=false;pa.call(this);n=g.length>0;if(g.length===0){var na=
K;K=[];for(var qa=0,aa=na.length;qa<aa;qa++)h.safeCall(na[qa])}else P();J.fireEvent(k.aE,R)}};da.ax&&K.push(da.ax);da.life=N;b.addTask(W);return true}function d(){if(Z){window.clearTimeout(Z);Z=null}}function a(){var da=Y.value();if(da){Y.setValue(h.extendOwn({fading:true},da));Z=window.setTimeout(s,C.nY+500)}else Z=null}function s(){Y.setValue(null);Z=null}var z=3E3,I=3E4,R=this,b=q.widget.ajax,i=q.bJ(),r=q.widget.config.uploadDelay||0,l=q.widget.errorCentral,j=q.ah(),w=q.dC(),D=q.bd(),J=q.bD(),c=q.widget.az,p=q.nX(),g=[],n=false,m=[],F=false,x=0,H=0,ha=null,y=r<=0?h.noop:h.delayed(r,P),K=[],N=1,S=null,Y=new h.Cell(null),Z=null,la=h.flipSet([204,304]);h.extend(this,{enqueue:function(da,O,W){if(da){h.assert(da.state===e);if(O&&W){da.inverse=O;O.inverse=da;d();Z=window.setTimeout(a,C.pf);Y.setValue({i18nKey:W,undo:O})}else if(da.forestAction){d();Y.setValue(null)}M(da)}},aF:function(da){m.push(da)},dv:function(da){var O=0,W=[],ia,ja,pa,na;w.al(true);try{for(;O<g.length;){ia=g[O];if(ia.state!==e)O++;else{pa=ia.bN();ja=da(ia);if(pa){na=ja?ia.bN():null;pa!==na&&w.replace(pa,na)}if(ja)O++;else h.addAll(W,g.splice(O,1))}}}finally{w.al(false)}if(O=Y.value()){ja=da(O.undo||O.redo);if(!ja){
d();Y.setValue(null)}}W.length>0&&J.fireEvent(k.aE,R);return W},clear:function(){N++;g=[];w.clear();F=false;x=H=0;if(ha){window.clearTimeout(ha);ha=null}K=[];d();Y.setValue(null);J.fireEvent(k.aE,R)},isEmpty:function(){return!g.length},isIdle:function(){return!n&& !F|| ! !S},iv:function(){return S},iP:function(da){h.assert(da,da);h.assert(!S,S+" "+da);S=da;n=false;J.fireEvent(k.aE,R)},hx:function(da){h.assert(da,da);h.assert(S===da,S+" "+da);if(S===da){S=null;n=g.length>0;C.modes.DEVMODE||y();J.fireEvent(k.aE,R)}},jk:function(){return S&&g.length>0},og:function(){return Y}});j.register("_uploadTree",P);q.widget.globalActions.register("undoOrRedo",h.curry(function(da){var O=Y.value(),W;if(!O)return false;if(da==="auto")da= ! !O.undo;W=da?O.undo:O.redo;if(!W)return false;d();Z=window.setTimeout(a,C.pf);Y.setValue(da?{i18nKey:O.i18nKey,redo:W.getInverseAction()}:{i18nKey:O.i18nKey,undo:W.getInverseAction()});p.aO(W.getAffectedIssues());M(W.reset());return true},"auto"))};C.bG=U})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.util"),h={up:"up",down:"down",o:"openIssue","shift+o":"toggleIssueDetailsNoFocus",left:"collapseOrMoveToParent",right:
"expandOrMoveToNext",pageup:"pageUp",pagedown:"pageDown",home:"pageHome",end:"pageEnd",escape:"cancelMode","shift+escape":"cancelMode","ctrl+up":"moveUp","ctrl+down":"moveDown","ctrl+left":"levelUp","ctrl+right":"levelDown",f2:"toggleEditMode","s,s":"toggleEditMode",tab:"nextEditableField","shift+tab":"prevEditableField","ctrl+enter":"pasteSearchResult","ctrl+shift+enter":"pasteSearchResultUnder","plus,plus":"expandAll","=,=":"expandAll","=plus,=plus":"expandAll","shift+=,shift+=":"expandAll","shift+=,=":"expandAll","minus,minus":"collapseAll","-,-":"collapseAll","i,d,d,q,d":"debugActions","r,r":"toggleHideClosed","t,=":"addColumn","t,plus":"addColumn","t,t":"addColumn","delete":"deleteSubtree","\\":"tabFocusPanel","]":"nextHighlighted","[":"prevHighlighted","ctrl+]":"historyOlderVersion","ctrl+[":"historyNewerVersion",".":"jira.showActions",a:"jira.assign",e:"jira.edit",i:"jira.assignToMe","alt+down":"jira.actions.dropdown",m:"jira.comment",space:"toggleSelected","shift+down":"selectDown","shift+up":"selectUp","shift+pageup":"selectPageUp","shift+pagedown":"selectPageDown","shift+home":"selectPageHome","shift+end":"selectPageEnd","shift+right":"selectSubtrees","shift+left":
"selectRoots","ctrl+.":"toggleFixCombo","x,x":"toggleExtraActions","ctrl+alt+up":"upEditableField","ctrl+alt+down":"downEditableField","ctrl+alt+left":"leftEditableField","ctrl+alt+right":"rightEditableField","i,i":"viewThumbnails","v,v":"view.select","v,s":"view.save","v,r":"view.revert","v,s,s":"view.save-as",g:"-- pass --",formattedShortcuts:{toggleEditMode:"F2|SS"}};if(C.isMac())C.extend(h,{"meta+c":"copy","meta+x":"cut","meta+v":"paste","meta+shift+v":"pasteUnder","meta+a":"toggleSelectAll"});else{C.extend(h,{insert:"createChild","ctrl+c":"copy","ctrl+x":"cut","ctrl+v":"paste","ctrl+shift+v":"pasteUnder","shift+delete":"cut","shift+insert":"paste","shift+alt+insert":"pasteUnder","ctrl+a":"toggleSelectAll"});C.extend(h.formattedShortcuts,{createChild:C.formatShortcut("insert")})}U.keymap=C.lazy(function(){if(U.modes.GH_TAB){C.extendOwn(h,{t:"gh.closeDetails",minus:"gh.toggleSwimlanes","-":"gh.toggleSwimlanes","s,t":"gh.sendToTop","s,b":"gh.sendToBottom"});return h}C.extendOwn(h,{enter:"createSiblingBelow","shift+enter":"createChild"});U.modes.ISSUE_PAGE||C.extendOwn(h,{k:"up",j:"down"});U.modes.GADGET||C.extendOwn(h,{"alt+/":"focusSearch","ctrl+/":"showShortcuts"});
U.modes.GADGET==="local"&&C.extendOwn(h,{l:"jira.labels"});return h})})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.util"),h=U.$;U.Config=function(k){this.tableConfigKey=null;this.minCachedRows=50;this.preloadRowsFactor=h.browser.msie?1:2;this.height=200;this.minHeight=58;this.maxHeight=0;this.levelOffset=25;this.showClosed="dim";this.showToolbar=true;this.callback=null;this.pollInterval=1E4;this.inactivePollInterval=6E4;this.boostedPollInterval=1E3;this.boostDuration=6E3;this.userInactivityThreshold=3E5;this.uploadDelay=500;this.hideable=this.fixFooterBottom=false;this.anchorIssue=0;this.viewCookie="structure-view";this.rowCacheSize=250;this.scopeName=this.scopeJQL=null;this.pinSearch=this.pinFilter=false;this.pinOutsiders=null;this.initialViewId=this.forceViewId=this.forceFilterId=0;this.forceReadOnly=false;this.masterConfig={areJiraActionsDisabled:U.modes.GADGET==="remote"||U.modes.GH_TAB?C.returnTrue:function(){return U.modes.getStructurePageId()==="structure-with-details"}};this.slaveConfig={areJiraActionsDisabled:C.returnTrue};this.viewSelector="#s-view-dd-trigger";this.getFixedRowHeight=function(){return 29};this.getDepthOffset=function(e){
return e*this.levelOffset+12};this.showIssueDetails=false;k&&C.extend(this,k)}})();(function(){var U=namespace("almworks.structure"),C=namespace("almworks.util"),h=namespace("almworks.structure.appevents"),k=U.$;U.AjaxNotifier=function(e,B){function q(){var a=M();if(a!==t){t=a;A.css({visibility:a?"visible":"hidden"})}}function M(){if(!Q.isIdle())return true;if(u.isLoading())return true;if(G.getLoadingWeight()>0)return true;if(T.isLoading())return true;return false}var u=e.fk,P=e.eventBus,G=e.master.bJ(),Q=e.master.bE(),T=e.ir,A=k('<span class="st-progress-icon"></span>').appendTo(B),t=null,d=C.delayed(200,q);this[h.aE]=d;this[h.cF]=d;this[h.cQ]=d;P.addListener(new C.Life,this);q()}})();(function(U){function C(t,d){var a=t.globalActions;if(P){var s=q.ajsbridge.localURL("/secure/ViewStructureShortcuts.jspa");if(u.isMac())s+="?mac=true";var z=P.$(u.renderTemplate('<a id="structure-help" class="item-link" title="{s.w.kbdhelp.title}" href="{url}">{s.w.kbdhelp.label}</a>',{url:s})).appendTo(d),I=new(P.FormPopup||U.JIRA&&U.JIRA.FormDialog)({id:"structure-shortcuts-dialog",trigger:"#structure-help",widthClass:"large",onContentRefresh:function(){this.dialogEverShown=true},ajaxOptions:{url:
s}}),R=P.consumesKeyboardEvents;if(typeof R==="function")P.consumesKeyboardEvents=function(i){if(R(i))return true;if(i.is(".form-body")&&i.closest("#structure-shortcuts-dialog").length)return true;return false};else{s=P.enableKeyboardScrolling;if(typeof P.disableKeyboardScrolling==="function"&&typeof s=="function"){var b=function(i){var r=i.keyCode,l=G.ui.keyCode,j=G(i.target);if(!(j.is("textarea, :text, select, :radio")||j.is(".form-body")&&j.closest("#structure-shortcuts-dialog").length)&&(r===l.DOWN||r===l.UP||r===l.LEFT||r===l.RIGHT))i.preventDefault()};P.disableKeyboardScrolling=function(){G(document).bind("keypress keydown",b)};P.enableKeyboardScrolling=function(){G(document).unbind("keypress keydown",b)}}}I._focusFirstField=function(){this.get$popupContent().find(".form-body").css("outline-style","none").attr("tabIndex","-1").focus()};a.register("showShortcuts",function(){if(t.div$.is(":visible")){I.show();return true}return false});this.place$=d;this.link$=z}}function h(t){if(t&&t.length){t=q.$(t[0]);q.apputil.initializeButton(t.find("#s-add-target-issue .st-tb"),"addTargetIssue");q.apputil.initializeButton(t.find("#s-unfix-structure .st-tb"),"clearStructureFix")}}
function k(t,d){var a=d.currentStructure.getRoot();a=u.text(d.config.anchorIssue===a?"s.w.fixed-on-missing-hint.issuepage.html":"s.w.fixed-on-missing-hint.html");var s=t.find(".s-blockingcover-desc");s.html(a);h(t);e(s,d)}function e(t,d){function a(){if(I&&R){var i='<a href="'+q.ajsbridge.issueURL(I)+'">'+u.htmlEscape(I)+" "+u.htmlEscape(R)+"</a>";s.html(s.html().replace(/issue/g,i));s.show()}}var s=t.find(".s-lazyload");if(s.length){var z=d.currentStructure.getRoot(),I=null,R=null,b=d.az.cI(z);if(b){I=b.eS("jira:raw:issuekey");R=b.eS("jira:raw:summary")}if(I&&R)a();else{s.hide();d.ajax.addTask(new d.ajax.Task(q.ajax.RESOURCES.RENDER+"?f=jira:raw:issuekey&f=jira:raw:summary&i="+z,q.ajax.DOWNLOAD,function(i){if(i){var r=i.issues||{},l=i.fields||[];i=u.indexOf(l,"jira:raw:issuekey");l=u.indexOf(l,"jira:raw:summary");if(i>=0&&l>=0&&r.length===1)if((r=r[0])&&r.issue==z){r=r.cells;I=r[i];R=r[l];a()}}}))}}}function B(t){var d,a=t.div$.find(".s-info-link"),s=G(".s-info-link-a",a);s.length||(s=G(u.renderTemplate('<a class="s-info-link-a" href="#" title="{s.w.info.tooltip}"><span></span>{s.w.info.label}</a>')).appendTo(a));if(!t.hints)t.hints=new C(t,P.$("<div></div>"));d=P.InlineDialog(
P.$(s[0]),"structure-info",function(z,I,R){if(!z.data("s-initialized")){z.data("s-initialized",true);I=t.jiraConfig.lf()||"?";z.html(u.renderTemplate(A,{version:I,encodedVersion:encodeURIComponent(I),shortcut:u.formatShortcut("ctrl+?")}));t.hints.link$.detach().appendTo(P.$(z.find(".st-kbdhelp")[0]))}R();t.ni.lV(d,d.hide)},{hideDelay:8E3,width:250,offsetX: -180,hideCallback:function(){t.ni.popupHidden(d)}})}var q=namespace("almworks.structure"),M=namespace("almworks.structure.appevents"),u=namespace("almworks.util"),P=U.AJS,G=P&&P.$,Q=null,T,A=
'<div id="s-info-dialog-contents"><div class="s-info-version">{s.w.info.version,version}</div><ul class="s-info-links"><li><span class="st-kbdhelp"></span> ({shortcut:html})</li><li><a href="http://almworks.com/structure/help/widget-overview" target="strhelp" title="{s.w.help.tooltip}">{s.w.help.label}</a></li><li class="s-section"><span>{s.w.info.support.label}</span><ul><li><a href="http://almworks.com/structure/support-request" target="strhelp" title="{s.w.info.support.ticket.title}">{s.w.info.support.ticket.label}</a></li><li><a href="mailto:support@almworks.com?subject=Structure%20Support%20Request%20(version%20{encodedVersion})" title="{s.w.info.support.mail.title}">{s.w.info.support.mail.label}</a></li></ul></li><li class="s-section"><span>{s.w.info.feedback.label}</span><div>{s.w.info.feedback.text}</div><ul><li><a id="s-uservoice-link" href="http://almworks.com/structure/suggest-idea" target="_blank" title="{st.widget.uservoice.title}">{st.widget.uservoice.label}</a></li><li><a href="mailto:structure@almworks.com?subject=Structure%20Feedback%20(version%20{encodedVersion})" title="{s.w.info.feedback.mail.title}">{s.w.info.feedback.mail.label}</a></li></ul></li></ul><div class="s-info-footer">{s.w.info.footer}</div></div>';
q.setupEmptyMasterHint=function(t){function d(){var R= ! !(t.currentStructure.id&&t.currentStructure.version>0&&t.master.bd().isEmpty()&& !t.dJ.isDragging()&& !t.bF.visibleCell.value());if(R!==z)if(z=R){if(!s){R=t;var b=R.currentStructure.isReadOnly(),i=R.jiraConfig.jW()&&R.jiraConfig.ke()!==false;b=G('<div class="s-masterhint" id="s-empty-structure-hint"><span>'+u.text(b?"s.w.empty-structure-hint.html.ro":q.modes.GADGET?i?"s.g.empty-structure-hint.html.create":"s.g.empty-structure-hint.html.nocreate":q.modes.GH_TAB?i?"s.w.empty-structure-hint.html.createOnly":"s.w.empty-structure-hint.html.ro":i?"s.w.empty-structure-hint.html.create":"s.w.empty-structure-hint.html.nocreate")+"</span></div>");R.div$.find(".st-master .main").append(b);s=b}s.show()}else{if(s){s.remove();s=null}a.detach()}}if(!t.__emptyMasterHintSetUp){t.__emptyMasterHintSetUp=true;var a=new u.Life,s=null,z=false;d();var I={};I[M.STRUCTURE_CHANGED]=d;I[M.kl]=d;I[M.cd]=d;I[M.cr]=d;I[q.bi.E]=u.delayed(50,d);I.valueChanged=d;t.eventBus.addListener(a,I);t.master.bd().events.addListener(a,I);t.bF.visibleCell.observable.addListener(a,I)}};q.ep=function(t){var d=t.div$.find("#issuetable"),a=t.currentStructure,s=q.oH,z=G(
"body");(new u.Cell(a.rootPath,a.kA,function(I,R){return! !(R&&I&& !I.length)})).setDelay(100).pipe(function(I){if(I){if(!Q|| !t.div$.find(Q).length){I=G('<div class="s-blockingcover" id="s-structure-fixed-empty">  <div class="s-blockingcover-desc"></div>  <table>  <tr id="s-add-target-issue"><td><div class="s-blockingcover-action">    <div class="st-tb">      <div class="st-tbi" style="background-position: -16px -128px"></div><div class="st-tbt"></div>    </div>  </div>  </td>  <td><div class="s-action-desc"></div></td>  </tr>  <tr id="s-unfix-structure"><td>  <div class="s-blockingcover-action">    <div class="st-tb">      <div class="st-tbi" style="background-position: -128px -144px"></div><div class="st-tbt"></div>    </div>  </div>  </td>  <td><div class="s-action-desc"></div></td></tr>  </table></div>');I.find("#s-add-target-issue .st-tbt").text(u.text("s.w.fixed-on-missing-hint.add.label"));I.find("#s-add-target-issue .s-action-desc").html(u.text("s.w.fixed-on-missing-hint.add.desc.html"));I.find("#s-unfix-structure .st-tbt").text(u.text("s.w.fixed-on-missing-hint.unfix.label"));I.find("#s-unfix-structure .s-action-desc").html(u.text(
"s.w.fixed-on-missing-hint.unfix.desc.html"));h(I);t.div$.append(I);Q=I}k(Q,t);d.hide();T=s.enabledCell.value();s.enabledCell.setValue(false);z.addClass("st-fixed-height");Q.show()}else if(Q){Q.hide();z.removeClass("st-fixed-height");d.show();T===true&&s.enabledCell.setValue(true);T=false;t.forceLayout&&t.forceLayout()}})};q.kN=B;q.reviveHelpPanels=function(t){B(t);Q&&k(Q,t)}})(window);(function(){var U=namespace("almworks.structure");namespace("almworks.structure.appevents");var C=namespace("almworks.util");U.fp=function(h){var k=new U.bx,e=h.master.bd(),B=(new U.dq).setSource(k).setExcludeFrom(e);e={getForest:function(){return B}};h.master.bE().og().pipeChanges(function(q){!k.isEmpty()&& !q&&k.aH(B.as())});h.bk.bj(e,{selectorWeight:100,imagePos:"-176px -96px",toggleAction:"toggleDeleted",showAction:"showDeleted",hideAction:"hideDeleted",hideEmpty:true,autoHide:true,tooltip:C.text("s.w.deleted.selector.tooltip")});C.extend(this,{addDeleted:function(q){var M=0,u=k.size();if(u>0)M=k.ak(u-1,0);k.bo(q,0,M)},getDisplayedForest:e.getForest})}})();(function(){function U(B){B=B||namespace("almworks.structure.global");var q=(B.seq||0)+1;return B.seq=q}function C(B,q,M){var u=U(B),P=this;
k.extend(this,{sequence:u,panelId:"p"+u,columnClass:function(G){return this.panelId+"col"+G},widget:B,panel$:q,fr:k.lazy(function(){return this.panel$.find(".issueArea")}),co:k.returnFalse,config:M,dN:k.returnFalse,bD:k.lazy(function(){var G=new k.Observable(k.nn(B.eventBus));h.apputil.installEventBus(this.panel$,G);return G}),getTableConfig:k.lazy(function(){return new h.tableConfig.dZ(this)}),af:k.lazy(function(){return new h.tableConfig.mk(this)}),ao:k.lazy(function(){return new h.ft(this)}),aT:k.lazy(function(){return new h.bx}),bd:function(){return this.aT()},ae:k.lazy(function(){return(new h.fB(this.ao(),this.bD())).setSource(this.bs())}),ew:k.lazy(function(){return new h.ei(this)}),aQ:k.lazy(function(){return new h.eE(this)}),eg:k.lazy(function(){return new h.ee(this)}),bn:k.lazy(function(){return new h.el(this)}),cc:k.lazy(function(){return new h.eT(this)}),ah:k.lazy(function(){return(new k.ActionRegistry).listen(new k.Life,this.bD(),e.ACTION,e.mt,e.ly)}),bW:k.lazy(function(){return new h.mE(this)}),jY:k.returnFalse,aZ:k.returnFalse,cJ:k.returnFalse,getAJSBridge:k.returnFalse,nX:k.lazy(function(){return new h.oM}),start:function(){this.eg();this.bn();this.cc()},cL:function(
){},isDropPossible:k.returnFalse,rootPath:false,eN:k.lazy(function(){return new k.Cell(P.eg().fL(),function(G){return G!== -1})})});h.apputil.setDominator(q,"panel",this)}var h=namespace("almworks.structure"),k=namespace("almworks.util"),e=namespace("almworks.structure.appevents");k.extend(h,{eL:function(B,q,M){C.call(this,B,q,M);var u=k.extend({},this);k.extend(this,{dN:k.returnTrue,co:k.returnTrue,dC:k.lazy(function(){return new h.bv}),gP:k.lazy(function(){return new h.ac(this.aT(),this.dC())}),bd:k.lazy(function(){return new h.eG(this.gP())}),dR:k.lazy(function(){return new h.fq(this)}),dH:k.lazy(function(){return new h.ac(this.bd(),this.dR())}),mH:k.lazy(function(){return new h.bv}),bg:k.lazy(function(){return new h.ac(this.dH(),this.mH())}),bs:function(){return this.bg()},getAJSBridge:k.lazy(function(){return new h.ajsbridge.AJSBridge(this)}),bJ:k.lazy(function(){return new h.eb(this)}),bE:k.lazy(function(){return new h.cA(this)}),cJ:k.lazy(function(){return new h.IssueEditor(this)}),aZ:k.lazy(function(){return new h.ez(this)}),start:function(){if(!this.isStarted){this.isStarted=true;u.start.call(this);this.getAJSBridge()}},isDropPossible:function(P){if(B.currentStructure.iY()
)return false;var G=B.currentStructure.rootPath.value();if(G&&P){if(P.under===0)return false;var Q=k.indexOf(G,P.under);if(Q>=0&&Q<G.length-1)return false}if(!B.currentStructure.aW())return true;if(P&&P.under>0)if(!B.az.hh(P.under))return false;return true},rootPath:B.currentStructure.rootPath,jY:k.lazy(function(){return new h.lZ(this)})})},bc:function(B,q,M){C.call(this,B,q,M);var u=k.extend({},this);k.extend(this,{controller:(new k.Cell).setValue(null),aT:k.lazy(function(){return new h.eG}),mH:k.lazy(function(){return new h.bv}),bg:k.lazy(function(){return new h.ac(this.aT(),this.mH())}),bs:function(){return this.bg()},start:function(){if(!this.isStarted){this.isStarted=true;u.start.call(this);var P=this;this.controller.pipe(function(G,Q){Q&&Q.onUnbind&&k.safeCall(Q.onUnbind,Q);P.aT().setSource(G&&G.getForest());G&&G.onBind&&k.safeCall(G.onBind,G)})}},cL:function(P,G,Q,T){if(G===this&&Q!==this){var A=this.controller.value();A&&A.de&&A.de(P,G,Q,T)}}})}})})();(function(U,C){var h=namespace("almworks.structure"),k=h.$,e=namespace("almworks.util"),B=namespace("almworks.structure.appevents"),q=150,M="window",u="container",P="pageManager";h.ek=function(G){function Q(Z,la,da){da||(da=
j.width());return Math.min(Math.max(Z,la),Math.floor(da*3/4))}function T(Z){g&&e.debug("setFullWindowHeight("+Z+")");var la=j.height(),da=k(U).height(),O=k("body").outerHeight(true),W=0;k("#header .aui-header, #header>div, #content, #footer, body>div.global-warning, #page>div#announcement-banner").each(function(){var ja=k(this);if(ja.is(":visible"))W+=ja.outerHeight(true)});O=Math.max(O,W);var ia=la+da-O;g&&e.debug("currentHeight="+la+", windowHeight="+da+", bodyHeight="+O+", h="+ia);return s(ia,Z)}function A(){if(Y)if(k.contains(Y[0],j[0]))return Y;Y=null;j.parents().each(function(){var Z=k(this),la=Z.css("overflow"),da=Z.css("overflow-y");if(la==="auto"||la==="scroll"||da==="auto"||da==="scroll"){Y=Z;return false}});Y||(Y=k("body"));return Y}function t(Z,la){var da=0,O=Z.parentsUntil(la).andSelf();O.each(function(){var W=k(this),ia=W.css("margin-bottom");W=W.css("padding-bottom");if(ia)ia=parseInt(ia,10);if(ia)da+=ia;if(W)W=parseInt(W,10);if(W)da+=W});O.nextAll().each(function(){var W=k(this),ia=W.is(":visible")?W.outerHeight(true):0;if(ia>0&&W.css("position")!=="absolute"){var ja=W.css("float");if(ja&&ja!=="none")e.warn(
"cannot set container height: trailing float elements not supported");else{W=W.css("display");if(W!=="block")e.warn("cannot set container height: trailing elements with display:"+W+" not supported");else da+=ia}}});return da}function d(){g&&e.debug("setContainerWindowHeight()");var Z=A(),la=Z.height();if(la){var da=j.offset(),O=Y.offset(),W=Math.ceil(da&&da.top||0)-Math.floor(O&&O.top||0);Z=t(j,Z);var ia=la-Z-W;g&&e.debug("containerHeight="+la+", precedingHeight="+W+", trailingHeight="+Z+", containerPos="+h.apputil.ct(O)+", pagePos="+h.apputil.ct(da)+", h="+ia);s(ia,false)}}function a(Z){g&&e.debug("setPageHeight0("+Z+")");j.height(Z);Z-=H();c.height(Z);l.fireEvent(B.dr);ha.setValue(Z)}function s(Z,la){g&&e.debug("setPageHeight("+Z+", "+la+")");var da=G.config.minHeight;if(da<0)da=0;var O=Math.max(F,da),W=j.height(),ia=H(),ja=Math.min(O,Math.max(da,Z-ia))+ia,pa=k.Deferred();if(W<da||W>O|| !la){a(ja);pa.resolve()}else j.stop(true,true).animate({height:ja},{duration:100,easing:"swing",queue:false,step:function(na){c.height(na-H())},complete:function(){a(ja);pa.resolve()}});return pa}function z(Z){var la=F;F=1E7;var da=G.master.bn().issueAreaHeight,O=G.slave.bn().issueAreaHeight;da=
new e.Cell(da,O,Math.max);O=G.master.cJ().fS();var W=G.master.bn().hM,ia=G.ir.visibleCell;Z=Z?new e.Cell(G.master.eg().fO(),G.slave.eg().fO(),Math.max):(new e.Cell).setValue(0);(new e.Cell(da,Z,O,W,ia,function(ja,pa,na,qa,aa){return Math.max(pa,na,Math.min(la+qa,ja),aa?q:0)})).pipe(function(ja){s(ja+H(),false)})}function I(){k.each(R(),function(Z,la){la.el$.css(la.css)});l.fireEvent(B.ar)}function R(){var Z=[];if(!y.shown&& !K)Z.push({el$:D,css:{left:0,width:"100%"}});else{var la=j.width();if(la<=0)Z.push({el$:D,css:{width:"100%"}},{el$:w,css:{left: -9999}},{el$:y.panel$,css:{left: -9999}},{el$:J,css:{left: -9999}});else{var da;da=0;if(K){J.find(".s-h-entry").length&&J.css("width","auto");da=J.outerWidth(true);da+=da-e.getClientWidth(J.find(".s-h-entries"));da=Math.min(Math.max(da,150),200)}var O=y.shown,W=O?Math.max(y.widthCell.value(),0):0,ia=O?x():0;la=la-da-W-ia;Z.push({el$:D,css:{left:da,width:la}});O&&Z.push({el$:w,css:{left:da+la}},{el$:y.panel$,css:{left:da+la+ia,width:W}});K&&Z.push({el$:J,css:{left:0,width:da}})}}return Z}function b(Z){var la;if(n===M)la=T(!Z&& !N);else n===u&&d();y.updateVertical();return la||k.Deferred().resolve()}function i(){G.div$.is(":visible")&&
l.fireEvent(B.av)}function r(Z){Z!==S&&y.setFocusPanel(Z)}var l=e.nn(G.eventBus),j=G.div$.find(".st-page"),w=G.div$.find(".st-splitter"),D=G.div$.find(".st-master"),J=G.div$.find(".s-history"),c=j.find(".main"),p=G.ir,g=false,n=G.config.height;if(n!==M&&n!=="model"&&n!=="model+selectors"&&n!==u){n=e.toIntSafe(n,0);if(n<=0)n="model"}var m=n===M||n===u,F=G.config.maxHeight;if(!F||F<0)F=1E7;var x=e.lazy(function(){return w.width()}),H=e.lazy(function(){return D.find(".sechead").outerHeight(true)}),ha=(new e.Cell).setValue(0),y=function(){function Z(aa,X){function ba(ka){ka=e.toIntSafe(ka);if(ka>0&&ka<1E4)return ka/1E4;return null}var ea=g&&aa[0].toUpperCase(),ra=e.extendOwn(this,X,{cached:X.cellNoValue,transition:function(ka){var ca=this.dual,ua;if(ka===aa&&ca.cached===ca.cellNoValue){ua=ja.master;w.hide();w.css("left",-9999)}else{ua=ca;if(ka!==aa)this.cached=X.controlCell.value();else{ca.controlCell.setValue(ca.cached);if(ca.controlCell.value()===ca.cellNoValue){ca.cached=ca.cellNoValue;return this.transition(ka)}}}X.controlCell.setValue(X.cellNoValue);r(G.master);return ua},accept:function(ka){this.cached=X.cellNoValue;if(ra.start){ra.start();delete ra.start}ka&&ka.panel$.hide();
w.show();X.panel$.show();ra.widthCell.recalculate();b(true);I();X.hk&&X.hk()},shown:true,oK:null,widthCell:null,lb:function(ka){var ca=ra.oK.value();ka[aa]={width:""+Math.floor(ca*1E4)}},debugName:ea},function(){var ka=new e.Cell(X.defaultWidth/j.width()),ca=new e.Cell(ka,function(v){return Q(v*j.width(),X.minWidth)}),ua=new e.Lifecycle,f=G.config.perspectiveSpec&&G.config.perspectiveSpec[P];G.master.bW().mA().pipe(function(v){ua.cycle();var E,o="pageManager."+aa+".width";if(v)o+="."+v;if(v=v===h.iq&& ! !f)E=f[aa]&&f[aa].width;E||(E=h.getStored(o));if(E=ba(E)){ka.setValue(E);y&&y===ra&&I()}ka.pipe(ua,v,e.delayed(100,function(L){h.setStored(o,""+Math.floor(L*1E4))}))});if(g){ka.debug(ea+".storedWidth");ca.debug(ea+".width")}return{oK:ka,widthCell:ca}}());X.controlCell.pipeChanges(function(ka,ca){if(ka===X.cellNoValue^ca===X.cellNoValue)if(!pa&&y)try{pa=true;var ua=y;y=y.transition(aa);y.accept(ua)}finally{pa=false}})}function la(){var aa=na.offset().top,X=ia.panel$.offsetParent().offset().top,ba=aa-X;g&&e.debug("masterMainTop =",aa,"offsetParentTop =",X,"| detailsTop =",ba);ia.panel$.css("top",ba)}function da(){for(var aa in ja)if(ja.hasOwnProperty(aa)){ja[aa].controlCell&&
ja[aa].controlCell.debug(ja[aa].debugName+".controlCell");ja[aa].visibleCell&&ja[aa].visibleCell.debug(ja[aa].debugName+".visibleCell")}}function O(aa){if(aa!==S){e.assert(aa&&aa.panel$);S&&S.panel$.removeClass("st-focused");(S=aa)&&S.panel$.addClass("st-focused");l.fireEvent(B.nl,S)}}var W=G.slave,ia=h.oH,ja={},pa=false;ja.master={accept:function(){ja.slave.panel$.hide();ja.details.panel$.hide();I()},transition:function(aa){return ja[aa]},shown:false,panel$:k([]),setFocusPanel:O,ps:e.returnFalse,updateVertical:e.noop,oK:new e.Cell(0),widthCell:new e.Cell(0),minWidth:0,lb:e.noop,debugName:g&&"0"};ja.slave=new Z("slave",{controlCell:W.controller,cellNoValue:null,panel$:W.panel$,start:e.withThis(W,W.start),setFocusPanel:O,ps:function(){var aa=S===G.master?W:G.master,X=S;r(aa);var ba=aa.ao(),ea=ba.bm();if(ea)l.fireEvent(B.eu,ea,X.ao().bm(),ba,false);else{aa=aa.ae();aa.isEmpty()||ba.eJ([aa.rowId(0)])}return true},updateVertical:e.noop,defaultWidth:j.width()/3,minWidth:200});ja.details=new Z("details",{controlCell:ia.enabledCell,cellNoValue:false,panel$:ia.panel$,start:function(){c=c.add(ia.panel$);ia.panel$.resize(la);ja.details.widthCell.pipe(ia.onWidthChange)},hk:ia.hk,setFocusPanel:
function(aa){ia.setFocused(aa!==G.master)},ps:function(){ia.setFocused(!ia.isFocused())},updateVertical:la,defaultWidth:1200,minWidth:425});ja.slave.dual=ja.details;ja.details.dual=ja.slave;var na=D.find(".main"),qa=ja.details.controlCell.value()?ja.details:ja.slave.controlCell.value()?ja.slave:ja.master;if(g){e.debug("Initial slave state "+qa.debugName);da()}return qa}();y.accept(null);var K=function(){function Z(la){if(la!==K){if(K=la)J.show();else{J.hide();J.css("left",-9999)}I()}}Z(false);p.visibleCell.pipe(function(la){Z(! !la)});return null}();b(true);I();var N=G.div$.hasClass("ie8"),S=null;r(G.master);e.delayed(250,function(){var Z=false;try{var la=C.compatMode=="BackCompat"?C.body:C.documentElement;Z=la.scrollHeight>la.clientHeight}catch(da){}Z=Z?"auto":"hidden";la=k(C.body);if(la.css("overflow-y")!==Z){la.css("overflow-y",Z);l.fireEvent(B.dr)}});(function(){function Z(W){if(da){y.widthCell.setValue(Q(da.w-(W.pageX-da.x),y.minWidth,da.pw));I()}}function la(W){Z(W);da=null;j.removeClass("resizeActive");O.enableSelection();y.oK.setValue(y.widthCell.value()/j.width())}var da=null,O=new e.SelectionDisabler;w.mousedown(function(W){if(!(!y.shown||da)){var ia=j.width();if(!(ia<=
10)){var ja=y.panel$.width();y.widthCell.setValue(ja);da={w:ja,pw:ia,x:W.pageX};e.dragBind(k,Z,la,la,true);j.addClass("resizeActive");O.disableSelection();W.preventDefault();W.stopImmediatePropagation();return false}}})})();if(n===M)k(C).ready(e.curry(T,false));else if(n==="model"||n==="model+selectors")z(n==="model+selectors");else if(n===u)k(C).ready(d);else n&&a(n+H());(function(){function Z(){U.onfocus=e.seq(function(O){(!O|| !O.target||O.target===U||O.target===C)&&l.fireEvent(B.cj)},U.onfocus);U.onblur=e.seq(function(O){(!O|| !O.target||O.target===U||O.target===C)&&l.fireEvent(B.cX)},U.onblur)}function la(){function O(){W=null;l.fireEvent(B.cX)};var W=null;C.onfocusin=e.seq(function(){if(W){U.clearTimeout(W);W=null}else l.fireEvent(B.cj)},C.onfocusin);C.onfocusout=e.seq(function(){W=U.setTimeout(O,100)},C.onfocusout)}function da(){var O=true;U.setInterval(function(){var W=G.div$.is(":visible");if(W!=O){O=W;l.fireEvent(B.bX,O);O&&i()}},5E3)}k(U).resize(e.delayed(100,function(){var O=j.width(),W=y.oK.value()*O;if(W){W=Q(W,y.minWidth,O);y.widthCell.setValue(W)}l.fireEvent(B.av)}));k("body>div.global-warning, #header>div").on("DOMNodeRemoved",function(){U.setTimeout(function(){
l.fireEvent(B.av)},100)});k.browser.msie&&k.browser.version<11?la():Z();G.config.hideable&&da()})();this[B.av]=function(){b().always(function(){I();l.fireEvent(B.dr)})};this[B.dr]=function(){l.fireEvent(B.ar)};l.addListener(new e.Life,this);G.globalActions.register("tabFocusPanel",function(){return y.ps()});var Y=null;e.extend(this,{forceLayout:i,bZ:function(Z){if(m){Z=j.height()-Z;j.height(Z);c.height(Z-H());y.updateVertical();l.fireEvent(B.dr)}},getFocusedPanel:function(){return S},setFocusedPanel:r,getSplitterPageX:function(){if(!y.shown|| !w.is(":visible"))return-1;var Z=w.offset();return Z?Z.left: -1},getViewportHeightCell:function(){return ha},lb:function(Z){Z=Z[P]={};y&&y.lb(Z)},setDebug:function(Z){g=Z}})}})(window,document);(function(){var U=namespace("almworks.structure"),C=namespace("almworks.util");namespace("almworks.structure.appevents");var h=U.$;U.eK=function(k){function e(P,G,Q){function T(){var a=d.size();Q.withoutCount||A.find("span").text(a);if(Q.hideEmpty){var s=a>0;if(s!==t)if(t=s)A.show();else{A.hide();B(P)}}!a&&Q.autoHide&&B(P)}var A=h('<div class="st-tb" title="'+Q.tooltip+'"><div style="background-position: '+Q.imagePos+
'" class="st-tbi"></div><div class="st-tbt"><span></span></div></div>');Q.buttonId&&A.attr("id",Q.buttonId);U.apputil.initializeButton(A);U.apputil.installAction(A,Q.toggleAction);var t=true,d=P.getForest();d.events.addListener(G,U.bi.E,C.delayed(50,T));T();U.apputil.pipeToggled(q,A,function(a){return a===P});U.apputil.registerBooleanActions(k.globalActions,q,Q.showAction,Q.hideAction,Q.toggleAction,P,null);return A}function B(P){q.value()===P&&q.setValue(null)}var q=C.nn(k.slave.controller),M=k.div$.find(".st-ssel");if(M.length){var u={life:null,c:null,button$:null,next:null,w:0};C.extend(this,{bj:function(P,G){for(var Q=G.selectorWeight||0,T=u;T.next;T=T.next)if(T.next.w>Q)break;var A=new C.Life;Q={life:A,c:P,button$:e(P,A,G),next:T.next,w:Q};T.next=Q;Q.next?Q.button$.insertBefore(Q.next.button$):Q.button$.appendTo(M)},removeSlaveSelector:function(P){for(var G=u;G.next;G=G.next)if(G.next.c===P){B(G.next.c);G.next.life.detach();G.next.button$.remove();G.next=G.next.next;break}}})}}})();(function(U){var C=20,h=namespace("almworks.structure"),k=h.$,e=h.appevents,B=namespace("almworks.util"),q=namespace("JIRA.userhover",false);h.jt=function(M){function u(){N.value()&& !S.value()&&
la&&l(la)}function P(X){var ba={maxCount:Math.max(C,W)};if(da)ba.maxVersion=da-1;a([ba],[A(),X])}function G(X){if(X&&X.length)if(X=X.slice(0,1).data("version")){t(X);pa(X);return true}return false}function Q(){if(!Y.isLoading("history")){var X;if(ia)if((X=ia.next(".s-h-entry"))&&X.length){ia=X;G(ia)}else m.is(":visible")&&P(Q);else if((X=qa.value())&&X.version){ia=g.find("#s-h-entry-"+X.version);Q()}else if(N.value())if((X=g.find(".s-h-entry"))&&X.length){ia=X.slice(0,1);G(ia)}}}function T(){var X;if(ia){if((X=ia.prev(".s-h-entry"))&&X.length){ia=X;G(ia)}}else if((X=qa.value())&&X.version){ia=g.find("#s-h-entry-"+X.version);T()}}function A(){var X=da;return function(){if(da===2||da===X){m.hide();W>0?F.text(B.text("s.w.history.no-more-versions")):F.text(B.text("s.w.history.history-is-empty"));F.show()}else{F.hide();m.show()}}}function t(X){p.find(".s-h-entry.s-h-selected:not(#s-h-entry-"+X+")").removeClass("s-h-selected");var ba=p.find("#s-h-entry-"+X);if(ba.length){ba.addClass("s-h-selected");X=g.scrollTop();var ea=g.height(),ra=X+ea,ka=X+ba.position().top;ba=ba.outerHeight(true);var ca=ka+ba;if(!(ka>=X&&ca<=ra)){if((ka>=ra||ca<=X)&&ea>=3*ba){ka=Math.max(0,ka-ba);ca+=ba}if(ka<X)
g.scrollTop(ka);else ca>ra&&g.scrollTop(ca-(ra-X))}}}function d(X,ba){X= ! !X;h.modes.HISTORY=X;N.setValue(X);var ea=x.isReadOnly()||h.modes.LICENSE_INVALID?"s-history-mode":"s-history-mode ro";if(X){H.ao().dG(0);var ra=[],ka=[];if(ba)if(la&&da){if(ba<da){ra.push({maxVersion:da-1,withVersion:ba,maxCount:C});ra.push({minVersion:la+1});ka.push(A())}else ba>la&&ra.push({minVersion:la+1});ka.push(B.curry(l,ba))}else{ra.push({maxCount:C,withVersion:ba});ka.push(A(),B.curry(l,ba,null,null,u))}else if(la&&da)ra.push({minVersion:la+1});else{ra.push({maxCount:C});ka.push(A())}if(arguments.length>2)for(var ca=2;ca<arguments.length;ca++)typeof arguments[ca]==="function"&&ka.push(arguments[ca]);a(ra,ka);M.div$.addClass(ea)}else M.div$.removeClass(ea);H.bn().fs()}function a(X,ba){if(B.isArray(ba))ba=B.seq.apply(B,ba);if(!X|| !X.length)ba&&ba();else for(var ea=0,ra=X.length;ea<ra;ea++)Y.addTask("history",h.ajax.RESOURCES.versions(x.id,X[ea]),ea==0&&ba?B.seq(s,ba):s)}function s(X){if(X&&X.versions){X=X.versions;var ba,ea,ra,ka;ba=0;for(ea=X.length;ba<ea;ba++){ra=X[ba];if(ka=ra.version){W++;ra=k('<div class="s-h-entry"></div>').prop("id","s-h-entry-"+ra.version).data("version",ra.version)
.addClass("s-h-e-"+ra.operation).append(z(ra),I(ra));if(la&&da)if(ka>la){la=ka;ra.prependTo(g)}else if(ka<da){da=ka;ra.insertBefore(n)}else g.find("#s-h-entry-"+ka).length||ra.insertBefore(i(ka));else{la=da=ka;ra.insertBefore(n)}}}q&&typeof q==="function"&&q(g);M.eventBus.fireEvent(e.av)}}function z(X){X=X.user;var ba=X.avatarUrl;ba=k('<img class="s-h-e-avatar">').attr("src",ba+"&size=small");X.profileUrl&&ba.addClass("user-hover").attr("rel",X.name);return ba}function I(X){var ba=k('<div class="s-h-e-body"></div>').append(R(X),b(X),k('<div class="s-h-e-timestamp"></div>').text(X.dateTimeFormatted));X.operation==="move"&&ba.append(k('<div class="s-h-e-toggle"><div class="s-h-e-t-from" title="'+B.htmlEscape(B.text("s.w.history.toggle-move.from.tooltip"))+'"></div><div class="s-h-e-t-to" title="'+B.htmlEscape(B.text("s.w.history.toggle-move.to.tooltip"))+'"></div></div>'));return ba}function R(X){var ba=X.synchronizer;X=X.user;var ea=k('<div class="s-h-e-subject"></div>');ba?ea.text(ba.description).attr("title",ba.description):ea.text(X.displayName);return ea}function b(X){var ba=X.operation,ea=X.forestSize,ra=B.toIntSafe(X.issueId,0),ka=X.issueKey;X=X.issueSummary;var ca=k(
'<div class="s-h-e-operation"></div>');if(ea==1&&ra&&ka&&X){ca.html(B.text("s.w.history.entry."+ba+".1",B.htmlEscape(ka),B.htmlEscape(X)));ca.find("a").data("issueId",ra).attr("href","#").click(r)}else ca.text(B.text("s.w.history.entry."+ba+".n",ea));return ca}function i(X){var ba;g.find(".s-h-entry").each(function(){var ea=k(this);if(ea.data("version")<X){ba=ea;return false}});B.assert(! !ba,X);return ba}function r(X){function ba(){var ca=qa.value();if(ca&&ca.version==ka){(ca=ca.fullForest.bS(ra))&&ca.length&&H.ao().eJ(ca);return true}return false}var ea=k(X.target),ra=ea.data("issueId"),ka=ea.closest(".s-h-entry").data("version");if(ra&&ka){if(!ba()){t(ka);l(ka,null,ba)}X.preventDefault();X.stopPropagation()}};function l(X,ba,ea,ra){O=X;var ka=Z.getValue(X);ka?aa(ka,ba,ea):Y.addTask("version",h.ajax.RESOURCES.version(x.id,X),B.curry(j,ba,ea),ra)}function j(X,ba,ea){if(ea&&ea.version&&ea.hasOwnProperty("fullForest")){ea={version:ea.version,operation:ea.operation,forest:new h.bx(h.parseFormula(ea.forest)),parentPathFrom:h.hU(ea.parentPathFrom),precedingSiblingsFrom:h.hU(ea.precedingSiblingsFrom),parentPathTo:h.hU(ea.parentPathTo),precedingSiblingsTo:h.hU(ea.precedingSiblingsTo),
fullForest:new h.bx(h.parseFormula(ea.fullForest)),moveDirection:ea.moveDirection};if(ea.operation==="add")ea.presenter=new w(ea);else if(ea.operation==="move")ea.presenter=new D(ea);else if(ea.operation==="remove")ea.presenter=new J(ea);else B.assert(false,ea.operation);Z.putValue(ea.version,ea);aa(ea,X,ba)}}function w(X){return{showDefault:function(){return{statuses:{added:X.forest.aD()},icons:{added:X.forest.hf()}}}}}function D(X){function ba(){if(ca!==true){ca=true;X.fullForest.bo(X.forest.as(),c(X.parentPathTo),c(X.precedingSiblingsTo))}ka("s-h-e-to");var f={statuses:{movedTo:X.forest.aD()},icons:{}};f.icons["moved"+ra(X)+"To"]=X.forest.hf();return f}function ea(){if(ca!==false){ca=false;X.fullForest.bo(X.forest.as(),c(X.parentPathFrom),c(X.precedingSiblingsFrom))}ka("s-h-e-from");var f={statuses:{movedFrom:X.forest.aD()},icons:{}};f.icons["moved"+ra(X)+"From"]=X.forest.hf();return f}function ra(f){var v=f.moveDirection;if(v<0)return "Up";else if(v>0)return "Down";else{v=f.parentPathFrom&&f.parentPathFrom.length||0;f=f.parentPathTo&&f.parentPathTo.length||0;if(f<v)return "Left";if(f>v)return "Right"}return ""}function ka(f){var v=g.find("#s-h-entry-"+X.version+
" .s-h-e-toggle");B.updateClasses(v,[f],ua)}var ca,ua=["s-h-e-from","s-h-e-to"];return{showDefault:function(f){return f?f.showState==="from"?ea():ba():ca===false?ea():ba()},showsTo:function(){return ca}}}function J(X){var ba;return{showDefault:function(){if(ba!==false){ba=false;X.fullForest.bo(X.forest.as(),c(X.parentPathFrom),c(X.precedingSiblingsFrom))}return{statuses:{removed:X.forest.aD()},icons:{removed:X.forest.hf()}}}}}function c(X){if(X&&X.length)return X[X.length-1];return 0}var p=M.div$.find(".s-history"),g=p.find(".s-h-entries"),n=p.find(".s-h-after-entries"),m=p.find(".s-h-show-more"),F=p.find(".s-h-nothing-more"),x=M.currentStructure,H=M.master,ha=H.bD(),y=M.ajax,K=M.globalActions,N=(new B.Cell).setValue(false),S=new B.Cell,Y=new function(){function X(ra){ba--;if(ra){var ka=ea[ra];ea[ra]=ka?ka-1:0}ha.fireEvent(e.cQ)}var ba=0,ea={};return{isLoading:function(ra){return ra&& ! !ea[ra]|| ! !ba},addTask:function(ra,ka,ca,ua){ba++;if(ra)ea[ra]=(ea[ra]||0)+1;ha.fireEvent(e.cQ);ra=B.curry(X,ra);y.addTask(new y.Task(ka,h.ajax.DOWNLOAD,B.seq(ra,ca),B.seq(ra,ua)))}}},Z=new B.LRUCache(10),la=0,da=0,O=null,W=0,ia=null,ja=false;K.register("toggleHistory",function(){d(!N.value(),0)})
;var pa=B.delayed(200,l),na=B.bottlenecked(100,function(){ja?Q():T()});K.register("historyOlderVersion",function(){ja=true;na()});K.register("historyNewerVersion",function(){ja=false;na()});m.attr("value",B.text("s.w.history.show-more")).click(B.curry(P,null));g.delegate(".s-h-entry","click",function(X){if(X=k(X.target).closest(".s-h-entry").data("version")){t(X);l(X)}});g.delegate(".s-h-e-t-from, .s-h-e-t-to","click",function(X){var ba=k(X.target),ea=ba.closest(".s-h-entry").data("version"),ra=qa.value();if(ea){ba={showState:ba.is(".s-h-e-t-from")?"from":"to"};if(ra&&ea===ra.version)if(ra.presenter){ea=ra.presenter.showDefault(ba);M.az.jp(ea.statuses,ea.icons);if(ea.statuses!==null||ea.icons!==null)H.bn().gC()}else{B.assert(false,ra);return}else{t(ea);l(ea,ba)}X.preventDefault();X.stopPropagation()}});var qa=new B.Cell(N,S,B.and);qa.pipeChanges(function(X){ia=null;H.ao().setVersion(X?X.version:0);var ba=H.bd(),ea={statuses:null,icons:null},ra=H.bn(),ka=ra.iV();if(X){t(X.version);ba.jy();try{ba.setSource(X.fullForest);var ca={statuses:null,icons:null};if(X.presenter){ca=X.presenter.showDefault(X.params);X.params=null}ea=ca}finally{ba.ap()}}else ba.setSource(H.gP());M.az.jp(
ea.statuses,ea.icons);if(!ka&&(ea.statuses!==null||ea.icons!==null))ra.gC();M.eventBus.fireEvent(e.kl)});var aa=B.delayed(0,function(X,ba,ea){if(X.version===O){O=null;X.params=ba;S.setValue(X);typeof ea==="function"&&U.setTimeout(ea,0)}});B.extend(this,{visibleCell:N,lg:qa,showHistory:d,isLoading:Y.isLoading,gA:function(){return la},iL:function(X){s(X)},clear:function(){M.div$.removeClass("s-history-mode");g.find(".s-h-entry").remove();h.modes.HISTORY=false;N.setValue(false);S.setValue(0);Z.clear();da=la=W=0;O=ia=null;ja=false}})}})(window);(function(U){var C=namespace("almworks.structure"),h=namespace("almworks.util"),k=namespace("almworks.structure.appevents"),e=C.$;C.ij=function(B){function q(){if(P){u=(new Date).getTime();if(!G){G=true;B.eventBus.fireEvent(k.jx,G)}}}function M(){if(G){var T=(new Date).getTime();if(u>0&&T-u>Q){G=false;B.eventBus.fireEvent(k.jx,G)}}}var u=(new Date).getTime(),P=true,G=true,Q=B.config.userInactivityThreshold;e(function(){e("body").bind({mousedown:q,keydown:q});e(U).bind({resize:q,scroll:q});B.div$.find(".main").bind({scroll:q})});this[k.bX]=function(T){P=T};this[k.cj]=q;B.eventBus.addListener(new h.Life,this);Q>0&&U.setInterval(M,2E3)}})(window);(
function(U,C,h){function k(b,i){var r=I(b);r.append(a.generateDom("div","input","a",function(D,J,c){function p(){return D(".sechead")(D(".tableHeader").apply(void h,arguments))}function g(){return D(".secbody")(D(".main")(D(".issueArea").apply(void h,arguments)))}return[D("#issuetable.fake")(D(".head")(D(".mousePanel")(D("#st-tgp")(D(".st-ssel"))),D(".st-search")),D("#st-glass"),D(".st-page")(D(".s-history vcol")(p(D(".th")(D(".celldiv"))),D(".s-h-entries.main")(D(".s-h-after-entries")(J(".s-h-show-more",{type:"button"}),D(".s-h-nothing-more")))),D(".st-master vcol")(p(),g(D(".s-h-position s-h-marker s-h-pos-from"),D(".s-h-position s-h-marker s-h-pos-to"),D(".s-h-position s-h-bracket s-h-pos-from-start"),D(".s-h-position s-h-bracket s-h-pos-to-start"),D(".s-h-position s-h-bracket s-h-pos-from-end"),D(".s-h-position s-h-bracket s-h-pos-to-end"),D(".cacheTable"))),D(".st-splitter vcol"),D(".st-slave vcol")(p(),g(D(".cacheTable")))),D(".foot")(D(".s-info-link s-frlink"),D(".s-board-link s-frlink"),D(".st-stat"),D(".st-progress"),D(".s-undo-redo")(c({href:"#","data-s-action":"undoOrRedo"})),D(".s-editor-warning"),D(".br"))),D("#st-unavailable")]}));if(i.fixFooterBottom){var l=I(
"footer#footer"),j=l.css("paddingBottom");j&&parseInt(j,10)>20&&l.css("paddingBottom","8px")}if(I.browser.msie){r.addClass("ie");l=8;try{l=parseInt(I.browser.version,10)}catch(w){}if(l===7||C.documentMode==7)r.addClass("ie7");else if(C.documentMode==8||l===8)r.addClass("ie8");else if(C.documentMode==9||l===9)r.addClass("ie9");else if(C.documentMode==10||l===10)r.addClass("ie10");else if(C.documentMode==11||l===11)r.addClass("ie11")}I.browser.webkit&&r.addClass("webkit");I.browser.chrome&&r.addClass("chrome");I.browser.safari&&r.addClass("safari");I.browser.mozilla&&r.addClass("mozilla");a.isMac()&&r.addClass("mac")}function e(b){var i=I(".foot .st-stat",b.div$);if(i.length){var r=a.delayed(50,function(){var w=b.master.bd().size(),D=b.master.bd().size()-b.master.dH().size(),J=Math.max(0,w-D),c=b.master.bs(),p=b.master.ao(),g=p.kz(c);J=w<=0?a.text("sw.widget.status.nothing"):g<1?B("sw.widget.status.showing",J):B("sw.widget.status.selected",g,J);if(D>0)J+=" ("+B("sw.widget.status.hidden",D)+")";w>0&&g===0&&p.nb(c)?i.html(a.renderTemplate(
'<span>{msg}</span>&nbsp;-&nbsp;<a href="#" class="s-foot-restore" data-s-action="uistate.selection.restore" title="{s.w.status.restore-selection.tooltip}">{s.w.status.restore-selection}</a>',{msg:J})):i.text(J);i.toggleClass("s-foot-selected",g>0)}),l=new a.Life,j={};j[d.bi.E]=r;j[z.am]=r;b.master.bD().addListener(l,j);b.master.bd().events.addListener(l,j);b.master.dH().events.addListener(l,j)}}function B(b,i,r){a.assert(i>=0,i);a.assert(!r||r>=i,i+" "+r);return i===1?r===1?a.text(b+".+1-of-1+"):r?a.text(b+".+1-of-n+",r):a.text(b+".+1+"):r?a.text(b+".+k-of-n+",i,r):a.text(b+".+n+",i)}function q(b){var i=U.onbeforeunload;U.onbeforeunload=function(){try{b.eventBus.fireEvent(z.cK)}catch(r){}if(typeof i==="function"){var l=i.apply(this,arguments);if(l!==h)return l}if(l=b.master.cJ().iE())return l;if(!b.master.bE().isEmpty())return a.text("sw.warn.pending.upload");b.errorPanel.disable();return h}}function M(b,i){function r(j,w){if(!b.currentStructure.info)return true;var D=null,J=b.aw.getFocusedPanel();if(J)D=J.bD();if(!D&&w&&w.target)D=d.apputil.getDominator(w.target,"eventBus");if(!D)D=b.eventBus;D.fireEvent(z.ACTION,j,w);return w&&w.consumed?false:true}var l=a.nn(b.keyboardManager);
a.eachOwn(i,function(j){if(typeof j==="string"&&j){var w=i[j];if(w==="-- pass --")l.addShortcutPass(j);else typeof w==="string"&&w&&l.addShortcut(j,a.curry(r,w))}})}function u(b){var i=b.keyboardManager;b=U.JIRA;if(i&&b)if(typeof b.bind==="function"){b.bind("Dialog.show",function(){i.setEnabled(false)});b.bind("Dialog.hide",function(){i.setEnabled(true)})}}function P(b){var i=b.currentStructure.id;if(!i)return null;i={structureId:i};var r=b.ir.lg.value();if(r)i.version=r.version;r=b.master.bW();var l=r.fi();if(l<0||r.ku().value()){if(r=r.mu())i.viewSpec=s.ct(r)}else if(l)i.viewId=l;i.tableConfig=b.master.getTableConfig().aK();i.expand=b.master.ao().aP();if(r=b.currentStructure.getRoot())i.root=r;if(b.bF.dh.value())if((r=b.bF.cp.value())&&r.type&&r.q){i.filterType=r.type;i.filterQuery=r.q}if(b.config.scopeJQL)i.scopeJQL=b.config.scopeJQL;return i}function G(b){function i(r){if(r){var l=I(this),j=l.attr("data-s-action");if(j){var w=d.apputil.getDominator(this,"eventBus");if(!w)w=b.eventBus;var D=null,J=l.attr("data-s-action-options");if(!J&&l.is("form"))J=l;if(J){l=l.closest(J);if(l.length)D=d.apputil.ht(l)}w.fireEvent(z.ACTION,j,r,D);r.preventDefault();return false}}}I("body").off(
".structure-actions").on("click.structure-actions","a[data-s-action],:button[data-s-action],:submit[data-s-action]",i).on("submit.structure-actions","form[data-s-action]",i)}function Q(b){function i(){l.stop().css("background-color","#f0f0f0").removeClass("s-no-bganim").animate({"background-color":"#ffffbb"},{duration:350,easing:"swing"}).animate({"background-color":"#f0f0f0"},{duration:350,easing:"swing"}).animate({"background-color":"#ffffbb"},{duration:350,easing:"swing"}).animate({"background-color":"#f0f0f0"},{duration:350,easing:"swing",complete:function(){l.css("background-color","").addClass("s-no-bganim")}})};var r=b.config.viewSelector;if(r){var l=I(r);if(l.length){l.click(function(J){J.preventDefault();b.master.jY().toggleVisibility();return false});var j=l.find("span.s-view-name"),w=b.master.bW();w.lX().pipe(function(J){var c=J&&J.name||"";j.text(c);var p=J&&J.description||"";if((J&&J.id)<0)J=p;else{if(p)p=" - "+p;J=a.text("s.w.view.current.title")+" "+c+p}l.attr("title",J)});w.ku().pipe(function(J){l.toggleClass("s-view-adjusted",J)});var D=b.master.jY();D.kY().pipe(function(J){l.attr("aria-pressed",J?"true":"false")});l.is(".s-no-bganim")&&b.eventBus.addListener(
new a.Life,z.md,function(J,c){J===w&&c&& !D.kY().value()&&U.setTimeout(i,300)})}}}function T(b){function i(){var w=l+b.getStructureId(),D=b.master.ao().bm();if(D)w+="&selectedIssueId="+D;if(!j){D=a.renderTemplate('<a href="#" target="_top" title="{s.w.open-board.title}"><span></span>{s.w.open-board}</a>');I(".s-board-link").append(D);j=I(".s-board-link a")}j.attr("href",w)}if(!(!d.modes.GADGET&& !d.modes.GH_TAB&& !d.modes.ISSUE_PAGE&& !d.modes.PCV_PAGE)){var r={};r[z.eu]=i;r[z.STRUCTURE_CHANGED]=i;b.master.bD().addListener(null,r);var l=d.ajsbridge.localURL("secure/StructureBoard.jspa?s="),j}}function A(b){function i(){if(b.ir.visibleCell.value())return false;var j=b.config.anchorIssue;if(!j)return false;var w=b.master.ao(),D=w.cb();w.en(j===D?0:j);return true}function r(j){if(b.ir.visibleCell.value())return false;var w=b.master.ao(),D=b.aw.getFocusedPanel()||b.master,J=w.cb();D=D.ao().bm();if(!D){if(J){w.dG(0);return true}return false}if(D<0)return false;w.dG((j===true?J===D:J)?0:D);return true}var l=b.globalActions;l.register("openPrintable",function(){var j=P(b);if(!j)return false;s.openWindow("/secure/StructurePrintable.jspa",j,"strprint"+b.currentStructure.id)});l.register(
"openExcel",function(){var j=P(b);if(!j)return false;s.openWindow("/plugins/servlet/structure/excel",j,"_self")});l.register("toggleExtraActions",function(){var j=b.div$.find(".s-extra-action");j.filter(":visible").length?j.hide():j.show()});l.register("clearStructureFix",function(){b.master.ao().dG(0)});l.register("addTargetIssue",function(){var j=b.currentStructure;if(j.id&&j.isLoaded()){j=b.master.ao().cb();if(!j)return false;b.master.aZ().bI(j,0,0,true)}});l.register("toggleEditorTransparency",function(){b.div$.toggleClass("s-e-transparent")});l.register("toggleFixAnchor",i);l.register("toggleFixSelected",r);l.register("toggleFixCombo",function(){return b.config.anchorIssue?i():r(true)});l.register("uistate.selection.restore",function(){var j=b.master.ao();j.lL();var w=b.master.bs(),D=j.getSelected(w);if(D.length)if((w=w.bS(D[0]))&&w.length){j.eJ(w);b.master.bn().aJ()}return true})};function t(){this.lastPopup=null;this.lV=function(b,i){this.lastPopup&&this.lastPopup.obj!==b&&this.hideCurrentPopup();if(b)this.lastPopup={obj:b,hideF:i}};this.popupHidden=function(b){if(this.lastPopup&&this.lastPopup.obj===b)this.lastPopup=null};this.hideCurrentPopup=function(){if(
this.lastPopup===null)return false;a.safeCall(this.lastPopup.hideF,this.lastPopup.obj);this.lastPopup=null;return true}}var d=namespace("almworks.structure"),a=namespace("almworks.util"),s=namespace("almworks.structure.apputil"),z=namespace("almworks.structure.appevents"),I=d.$,R=d.getUrlHashParam("traceRoot");d.StructureWidget=function(b,i){function r(){if(d.modes.ISSUE_PAGE)return["issue"];if(d.modes.GADGET)return["gadget","gadget."+d.modes.GADGET];if(d.modes.PCV_PAGE)return["pcv","pcv."+d.modes.PCV_PAGE];if(d.modes.GH_TAB)return["agile"];if(d.modes.ISSUE_DETAILS)return["structure-with-details"];return["board"]}function l(){return a.arrayFilter(["ie","ie7","ie8","ie9","ie10","ie11","mozilla","webkit","chrome","safari","mac"],function(N){return H.div$.hasClass(N)})}function j(N){K=[N]}function w(){for(var N=H.master.bs(),S,Y=0,Z=K.length;Y<Z;Y++){var la=K[Y];if(N.contains(la)){S=N.bS(la);break}}N=H.master.ao();if(S){N.by(S,true);N.kK(S);H.master.bn().aJ()}else d.modes.GH_TAB&&N.bm()&&N.kK(null)}function D(){if(!d.modes.GH_TAB){var N=H.config.anchorIssue;if(N){var S=H.anchorController;if(S)S.update();else{var Y=new d.bx,Z=[new d.bP(N,0)],la=H.master.bd(),da=function(){if(
la.indexOf(N)>=0)Y.isEmpty()||Y.aH([]);else Y.isEmpty()&&Y.aH(Z)};la.events.addListener(new a.Life,d.bi.E,a.delayed(50,da));da();H.anchorController=S={getForest:function(){return Y},update:da,onAnchorChanged:a.delayed(300,function(){N=H.config.anchorIssue;Z=[new d.bP(N,0)];var O=Y.isEmpty();Y.clear();da();if(!Y.isEmpty()){O&& !H.slave.controller.value()&&H.slave.controller.setValue(S);H.slave.controller.value()===S&&H.slave.ao().eJ([N])}})};H.bk.bj(S,{selectorWeight: -100,imagePos:"-144px -144px",toggleAction:"toggleAnchored",showAction:"showAnchored",hideAction:"hideAnchored",hideEmpty:true,autoHide:true,withoutCount:true,tooltip:a.text("s.w.anchor.selector.tooltip")})}if(!S.getForest().isEmpty()){H.slave.controller.setValue(S);H.slave.ao().eJ([N]);H.aw.setFocusedPanel(H.slave)}}}}function J(N,S,Y){S=N&&N.structureId;N=N&&N.root;var Z=H.currentStructure;R&&a.debug("W:initState",S,N,Z.id,Z.version,Z.getRoot());if(!(S!==Z.id||N!==Z.getRoot())){Z.hg(! !Y);if(!Z.initialized){Z.gw();H.master.ao().syncState(S);w();D();if(Y=H.master.ao().getVersion())H.ir.visibleCell.value()||H.showHistory(true,Y);H.eventBus.fireEvent(z.cd)}H.config.lE||H.master.ao().restoreScroll()}}function c(N){if(N)
b.removeClass("st-unavailable");else{b.addClass("st-unavailable");b.find("#st-unavailable").text(a.text("s.g.no-such-structure",H.currentStructure.id))}H.currentStructure.setStructureInfo(N);p();H.eventBus.fireEvent(z.ej)}function p(){var N=H.currentStructure;N.iY()?b.addClass("ro"):b.removeClass("ro");N= !N.isReadOnly()&&d.modes.LICENSE_INVALID;var S=b.find("#s-license-warning");if(N)S.length?S.show():I(a.renderTemplate('<div id="s-license-warning" title="{s.w.err.license.title}"><span></span>{s.w.err.license.label}</div>')).insertAfter(b.find(".s-editor-warning"));else S.hide()}function g(){H.currentStructure.setStructureInfo(null);var N=H.currentStructure.id;if(N){var S=false,Y=d.ajsbridge.localURL(d.ajax.RESOURCES.structure(N));d.ajax.doAjax({url:Y,dataType:"json",success:function(Z){S=true;Z&&Z.id===N&&N===H.currentStructure.id&&c(Z)},complete:function(){!S&&N===H.currentStructure.id&&c(null)}})}else c(null)}function n(N){N()}function m(N,S){if(!S)return false;var Y=H.master.aT(),Z=Y.indexOf(S);if(Z<0)return false;if(N&&Y.indexOf(N)>Z)return false;Z=Y.fI(Z);Y.aH(Z);return true}function F(){R&&a.debug("W:rootRecalc",H.currentStructure.initialized);if(
H.currentStructure.initialized){var N=null,S=H.currentStructure;if(S.id){var Y=S.getRoot();if(Y)N=H.master.bd().bS(Y)||[]}Y=S.rootPath.value();if(!(Y===N||a.arrayEquals(Y,N))){if(R)a.debug("W:setRootPath",S.getRoot(),N&&N.length||0);S.rootPath.setValue(N)}}}function x(N){R&&a.debug("W:clear",! !N);var S=H.currentStructure;H.ir.clear();S.setStructureId(0);H.master.cJ().gf();H.master.bE().clear();H.master.aT().clear();H.master.ao().clear();H.dm.clear();N||H.eventBus.fireEvent(z.STRUCTURE_CHANGED);return this}d.modes.STRUCTURE_BETAMODE&&a.setLogWindowErrors(function(N,S){if(typeof S==="string"&&(S.indexOf("structure:")>=0||S.indexOf(".jspa")>=0))return a.ERR;return a.WARN});var H=this;H.currentStructure={id:0,version:0,root:0,kA:new a.Cell(false),isLoaded:function(){return this.kA.value()},initialized:false,er:null,getRoot:function(){return this.id&&this.root},rootPath:(new a.Cell).setValue(null),info:null,isReadOnly:function(){return H.config.forceReadOnly|| !this.info||this.info.readOnly},iY:function(){return d.modes.HISTORY||d.modes.LICENSE_INVALID||this.isReadOnly()},aW:function(){return this.info&&this.info.editRequiresParentIssuePermission},isAdminable:function(){
return this.info&& ! !this.info.adminable},setStructureId:function(N){if(N!==this.id){this.id=N;this.initialized=false;this.kA.setValue(false);this.version=0;this.er=null}},gE:function(N){if(N!==this.version)if(this.version=N){var S=this.er;if(S&&a.toIntSafe(S.version,0)!==N)this.er=null}},hu:function(N){this.root=N},hg:function(N){this.kA.setValue(N)},gw:function(){this.initialized=true},setStructureInfo:function(N){this.info=N},gu:function(N){if(N){var S=a.toIntSafe(N.version,0);if(S)if(!(this.version&&S!==this.version))if(N.formula)this.er=N}}};H.div$=b;H.config=new d.Config(i);k(b,H.config);H.glass$=b.find("#st-glass");H.gk=I('<a id="s-focus-placeholder" name="focus" rel="0" tabindex="9999"></a>').appendTo(H.glass$);H.viewCookie=new a.ConglomerateCookie(H.config.viewCookie,365,d.ajsbridge.cookiePath());H.eventBus=new a.Observable;d.apputil.installEventBus(b,H.eventBus);H.hO=new d.ij(H);H.errorCentral=new d.error.eC(H);H.errorPanel=new d.error.fg(H);H.globalActions=(new a.ActionRegistry).listen(new a.Life,H.eventBus,z.ACTION,z.mt,z.ly);H.keyboardManager=(new a.KeyboardManager(b)).setDominate(true);H.ajax=new d.ajax.AJAX;H.jiraConfig=new d.JiraConfig(H);H.az=new d.fl(H);H.fk=
new d.eR(H);H.dJ=new d.eF(H);H.mouseController=new d.fj(H);H.dm=new d.fG(H);H.jT=new d.lH(H);H.ni=new t;H.master=new d.eL(H,b.find(".st-master"),H.config.masterConfig);H.slave=new d.bc(H,b.find(".st-slave"),H.config.slaveConfig);H.ir=new d.jt(H);H.bk=new d.eK(H);H.clipboard=new d.Clipboard(H);H.aw=new d.ek(H);H.hC=new d.gh(H);H.master.start();H.bF=new d.ed(H,b.find(".st-search"));H.poller=new d.fv(H);H.dS=new d.aI(H);H.ajaxNotifier=new d.AjaxNotifier(H,b.find(".foot .st-progress"));d.kN(H);H.fK=new d.fp(H);H.config.showIssueDetails===true&&d.oH.initialize(H);e(H);q(H);M(H,d.keymap());u(H);d.setupEmptyMasterHint(H);d.ep(H);A(H);G(H);a.trackFocus();Q(H);T(H);d.oD(H.eventBus);(function(){var N=r(),S=l(),Y=["widget.created"],Z,la,da,O;Z=0;for(la=N.length;Z<la;Z++)Y.push("widget.created."+N[Z]);Z=0;for(la=S.length;Z<la;Z++)Y.push("widget.created."+S[Z]);Z=0;for(la=N.length;Z<la;Z++){da=0;for(O=S.length;da<O;da++)Y.push("widget.created."+N[Z]+"."+S[da])}H.eventBus.fireEvent(z.gS,Y)})();H.jiraConfig.load(function(){H.jiraConfig.ke()||H.div$.addClass("s-nocreate");H.jiraConfig.lP()||H.div$.addClass("s-nobulk");if(H.jiraConfig.le()){d.modes.LICENSE_INVALID=true;H.currentStructure.info&&p()}
});var ha=H.config.tableConfigKey,y=null;if(ha)y="tableConfig."+ha+".primary";H.master.getTableConfig().restoreConfig(y);var K=[];H.currentStructure.hu(H.master.ao().cb());ha={};ha[z.cq]=function(N,S){R&&a.debug("W:target",N,S);var Y=H.currentStructure;Y.hu(N);F();if(Y.id){var Z=false;if(Y.isLoaded())Z=m(S,N);if(Z)H.master.bn().aJ();else{Y.hg(false);H.master.bJ().reloadStructure(J)}}};ha[z.cd]=F;ha[d.bi.E]=a.delayed(20,F);H.eventBus.addListener(new a.Life,ha);H.master.bd().events.addListener(new a.Life,ha);(function(N,S){var Y=S.find(".s-undo-redo"),Z=Y.find("a");(new a.Cell(N.ir.visibleCell,N.master.bE().og(),function(la,da){return la?null:da})).pipe(function(la){if(la&&la.i18nKey&&(la.undo||la.redo)){Z.text(a.text("s.w.+"+(la.undo?"undo":"redo")+"+.action.+"+la.i18nKey+"+"));la.fading?Y.stop(true,true).fadeOut(d.nY):Y.stop(true,true).show()}else Y.stop(true,true).hide()})})(H,b);(function(){H.config.lE&&H.eventBus.addListener(null,z.STRUCTURE_PAGE_CHANGED,function(){d.setPerspectiveStructurePageId(d.modes.getStructurePageId())})})();a.extend(this,{setStructure:function(N,S,Y){R&&a.debug("W:set",N,H.currentStructure.getRoot());n(function(){x(true);var Z=H.currentStructure;
a.assert(Z.id===0);Z.setStructureId(N);R&&a.debug("W:init",N,Z.getRoot());S?c(S):g();H.master.bJ().reloadStructure(J,Y);H.eventBus.fireEvent(z.STRUCTURE_CHANGED)});return this},getStructureId:function(){return this.currentStructure.id},clear:x,setInitiallySelectedIssue:j,setInitiallySelectedIssueFromLocation:function(N){var S=[],Y=U.location.href;if(Y)if((Y=/selectedIssueId=(\d+)/.exec(Y))&&Y[1]){Y=a.toIntSafe(Y[1],0);if(Y>0)S=[Y]}N&&S.push(N);K=S},showHistory:H.ir.showHistory,forceLayout:function(){H.aw.forceLayout()},setFixedViewTargetIssueOverride:function(N){H.master.ao().en(N)},getViewportHeightCell:function(){return H.aw.getViewportHeightCell()},getFixedViewRootPathCell:function(){return H.currentStructure.rootPath},setKeyboardEnabled:function(N){H.keyboardManager.setEnabled(N)},getMasterViewModel:function(){return H.master.bW()},getMasterViewAdjustedCell:function(){return H.master.bW().ku()},loadJiraConfig:function(N){H.jiraConfig.load(N)},setView:function(N,S){H.master.bW().mz(N,S)},registerAction:function(N,S){H.globalActions.register(N,S)},getMasterEventBus:function(){return H.master.bD()},makeInitialSelection:w,updateAnchorIssue:function(N,S,Y){H.config.anchorIssue=N;if(
H.anchorController)H.anchorController.onAnchorChanged();j(N);S&&H.master.ao().en(N);Y&&w()},setForcedFilterId:function(N){H.config.forceFilterId=N||0;H.bF.setForcedFilter(N)},reinstallAJSMouseHandler:function(){H.mouseController.installAJSMouseHandler()},reviveIssueActionDropDowns:function(){H.master.getAJSBridge().ob()}});(d.instances||(d.instances=[])).push(this)}})(window,document);(function(U){var C=namespace("almworks.structure"),h=namespace("almworks.structure.apputil"),k=namespace("almworks.util"),e=window.AJS,B=C.$,q='<span class="aui-dd-parent" id="st-select-structure-container"><a class="aui-dd-trigger {selectorClasses}" id="st-select-structure" title="{sw.select.structure}"><span class="xicon"></span><span>{sw.select.structure.label}</span></a><div class="aui-dropdown"></div></span>';C.StructureSelector=function(M){function u(){M.selectorSpan.html(k.renderTemplate(q,{selectorClasses:M.selectorClasses||""}));C.apputil.initializeButton(B("#st-select-structure",M.selectorSpan));e.$(M.selectorSpan.find(".aui-dd-parent")[0]).dropDown("Ajax",{alignment:"left",isHiddenByDefault:true,cache:false,item:"li.s-item",ajaxOptions:function(){var i=C.ajsbridge.localURL(
C.ajax.RESOURCES.STRUCTURE_LIST);if(M.forIssue)i+="?withIssue="+M.forIssue;else if(M.forProject)i+="?forProject="+M.forProject;return{url:i,dataType:"json",error:function(){}}},formatResults:function(i){i=P(i);return G(i)},selectionHandler:function(i,r){i.preventDefault();var l=e.$(r).data("structureInfo"),j;if(l&&d)if((j=l.id)&&j!==d.getStructureId()){A(l,true);k.safeCall(M.onManualStructureChange,U,j);return true}},hideHandler:k.curry(k.safeCall,M.onMenuHide)})}function P(i){function r(D,J){var c={items:[],more:0};if(D){for(var p=0,g=D.length;p<g;p++){var n=D[p],m=j[n];if(m&&(!d||n!==d.getStructureId()))c.items.push(m)}if(J>l+1){c.items.length>l&&c.items.splice(l,c.items.length-l);c.more=J-l}}return c};var l=k.toIntSafe(i.maxItems,10),j=function(D){var J={};if(!D)return J;for(var c=0,p=D.length;c<p;c++){var g=D[c],n=k.toIntSafe(g.id,0);if(!(n<=0)){g=k.extend({},g);g.abbreviatedName=k.abbreviateLabel(g.name||"["+n+"]");g.description=g.description||"";J[n]=g}}return J}(i.structures),w={};if(i.withIssue&&i.issue==M.forIssue)w.withIssue=r(i.withIssue,k.toIntSafe(i.withIssueCount,0));if(i.recent)w.recent=r(i.recent,0);if(i.favorites)w.favorites=r(i.favorites,k.toIntSafe(
i.favoriteCount));if(i.defaults)w.defaults=r(i.defaults,0);return w}function G(i){function r(D,J,c){if(D){var p=D.items;D=D.more;var g,n,m;if(p&&p.length){e.$(k.renderTemplate("<h5>{"+J+"}</h5>")).appendTo(l);J=e.$('<ul class="aui-list-section"></ul>').appendTo(l);g=0;for(n=p.length;g<n;g++){m=p[g];e.$(k.renderTemplate(j,m)).data("structureInfo",m).appendTo(J)}D>0&&c&&e.$(k.renderTemplate(w,{content:k.text(c,D)})).appendTo(J)}}}var l=e.$('<div class="aui-list"></div>'),j='<li class="aui-list-item s-item"><a class="aui-list-item-link" title="{description}" href="#">{abbreviatedName}</a></li>',w='<li class="aui-list-section-footer  s-more">{content}</li>';r(i.withIssue,"s.iv.structure-list.with-issue","s.iv.structure-list.with-issue.n-more");r(i.recent,"s.iv.structure-list.recent",null);r(i.favorites,"s.iv.structure-list.favorites","s.iv.structure-list.favorites.n-more");r(i.defaults,"s.iv.structure-list.defaults",null);l.find("li.s-item").length||l.append(k.renderTemplate('<ul class="st-str-none"><li class="aui-list-item"><a class="aui-list-item-link" href="#"><i>{s.iv.structure-list.none}</i></a></li></ul>'));l.find("ul:first").addClass("first aui-first");l.find("ul:last")
.addClass("last aui-last");k.safeCall(M.afterMenuFilled);return l}function Q(i){b= ! !i;k.addRemoveClass(B("body"),"s-single-structure",b)}function T(){var i=a.value(),r=i&&i.id;if(d)if(r)d.getStructureId()!=r&&d.setStructure(r,i,false);else d.clear()}function A(i,r){a.setValue(i);var l=i&&i.id;l&&r&&(new k.ConglomerateCookie(h.structuresCookie,3650,C.ajsbridge.cookiePath())).makeTopmost(""+l)}function t(){function i(){(new k.Cell(y,function(Y){return Y>0})).pipeBottlenecked(500,function(Y){m.working.css("visibility",Y?"visible":"hidden")});m.dialog.click(N).mouseout(N);m.close.click(function(){F.hide()})}function r(Y){function Z(O,W,ia){O=s[O];(O=O===U?W: ! !O)?ia.attr("checked","checked"):ia.removeAttr("checked");return O}Y.html(k.renderTemplate(
'<div class="s-uioptions-dialog s-inline-dialog"><form class="ajs-dirty-warning-exempt"><div class="s-inline-dialog-header"><div id="s-uid-working-icon"></div><span>{s.w.uisettings.title}</span></div><div class="s-uid-content s-inline-dialog-content"><p class="s-hide-single-structure"><input type="checkbox" id="s-uid-autoswitch"><label for="s-uid-autoswitch">{s.w.uisettings.autoswitch.label}</label></p><p class="s-uioptions-offset1 s-autoswitch-opt s-hide-single-structure"><input type="radio" checked="checked" name="autoselect_type" value="withIssue" id="s-uid-autoswitch-withIssue"/><label for="s-uid-autoswitch-withIssue">{s.w.uisettings.autoswitch.withIssue}</label></p><p class="s-uioptions-offset1 s-autoswitch-opt s-hide-single-structure"><input type="radio" name="autoselect_type" value="default" id="s-uid-autoswitch-default"/><label for="s-uid-autoswitch-default">{s.w.uisettings.autoswitch.default} <span id="s-uid-defaultname">?</span></label></p><p class="s-uid-mt s-hide-single-structure"><input type="checkbox" id="s-uid-keepstructure"><label for="s-uid-keepstructure">{s.w.uisettings.keepstructure.label}</label></p><p class="s-uid-mt"><input type="checkbox" id="s-uid-autocollapse"><label for="s-uid-autocollapse">{s.w.uisettings.autocollapse.label}</label></p></div><div class="s-inline-dialog-footer"><div class="s-uid-help"><a title="{s.w.uisettings.help.title}" href="http://almworks.com/structure/help/uisettings" target="_blank"><span></span></a></div><input class="s-uid-close" type="button" value="{s.w.uisettings.close}"/></div></form></div>')
);m.dialog=Y.find(".s-uioptions-dialog");m.close=Y.find(".s-uid-close");m.autoSwitch=Y.find("#s-uid-autoswitch");m.kO=Y.find("#s-uid-autoswitch-default");m.kB=Y.find("#s-uid-autoswitch-withIssue");m.working=Y.find("#s-uid-working-icon");m.autoCollapse=Y.find("#s-uid-autocollapse");m.keepStructure=Y.find("#s-uid-keepstructure");this.jO=function(){if(s){var O=s.autoSwitch||"off";x=O;if(O==="default"){m.autoSwitch.attr("checked","checked");m.kO.attr("checked","checked")}else if(O==="withIssue"){m.autoSwitch.attr("checked","checked");m.kB.attr("checked","checked")}else m.autoSwitch.removeAttr("checked");H=Z("autoCollapse",true,m.autoCollapse);ha=Z("keepStructureWhenNavigating",true,m.keepStructure);k.Cell.prototype.recalculateAllExternals();O=(O=s.defaultStructure)&&O.abbreviatedName;m.dialog.find("#s-uid-defaultname").text(O||"");if(!s.userConfigurable){m.dialog.find(".s-uid-content input").attr("disabled","disabled");m.dialog.find("label,.s-autoswitch-opt").addClass("s-disabled")}}};this.jO();var la=(new k.Cell).checkboxInput(m.autoSwitch),da=Y.find(".s-autoswitch-opt");la.pipe(function(O){O=O&&s.userConfigurable;k.updateAttr(da.find("input"),"disabled",O?null:"disabled");O?
da.removeClass("s-disabled"):da.addClass("s-disabled")});Y=(new k.Cell).radioInput(m.dialog.find("form"),"autoselect_type");(new k.Cell(la,Y,function(O,W){return O?W:"off"})).pipeChanges(function(O){c(O)});(new k.Cell).checkboxInput(m.autoCollapse).pipeChanges(function(O){if(H!==O){H=O;D({autoCollapse: ! !O},p)}});(new k.Cell).checkboxInput(m.keepStructure).pipeChanges(function(O){if(ha!==O){ha=O;D({keepStructure: ! !O},J)}});i()}function l(Y){Y.html(k.renderTemplate(
'<div class="s-uioptions-dialog s-inline-dialog"><form class="ajs-dirty-warning-exempt"><div class="s-inline-dialog-header"><div id="s-uid-working-icon"></div><span>{s.w.uisettings.title}</span></div><div class="s-uid-content s-inline-dialog-content"><table width="100%"><col width="1"/><col width="*"/><tr><td style="white-space: nowrap;"><input type="checkbox" id="s-uid-autoswitch"><label for="s-uid-autoswitch">{s.w.uisettings.project.autoswitch}</label></td><td id="s-uid-defaultname">?</td></tr><tr id="tr-change-default"><td></td><td><a href="{changeDefaultUrl:html}">{s.w.uisettings.project.change-default}</a></td></tr> </table></div><div class="s-inline-dialog-footer"><input class="s-uid-close" type="button" value="{s.w.uisettings.close}"/></div></form></div>',{changeDefaultUrl:C.ajsbridge.localURL("secure/StructureProjectSettings.jspa?projectKey="+encodeURIComponent(M.forProject))}));m.dialog=Y.find(".s-uioptions-dialog");m.close=Y.find(".s-uid-close");m.autoSwitch=Y.find("#s-uid-autoswitch");m.working=Y.find("#s-uid-working-icon");m.kq=Y.find("#tr-change-default");this.jO=function(){if(s){var Z=s.autoSwitch||"off";x=Z;Z==="default"?m.autoSwitch.attr("checked","checked"):
m.autoSwitch.removeAttr("checked");k.showHide(m.kq,! !s.projectAdmin);k.Cell.prototype.recalculateAllExternals();Z=(Z=s.defaultStructure)&&Z.abbreviatedName;m.dialog.find("#s-uid-defaultname").text(Z||"");if(!s.userConfigurable){m.dialog.find(".s-uid-content input").attr("disabled","disabled");m.dialog.find("label").addClass("s-disabled")}}};this.jO();(new k.Cell).checkboxInput(m.autoSwitch).pipeChanges(function(Z){c(Z?"default":"off")});i()}function j(){if(s&&n){var Y=M.configTrigger;if(Y&&Y.length)if(M.forIssue||M.forProject){Y.show();F=e.InlineDialog(e.$(Y[0]),"structure-uioptions",w,{hideDelay:2E4,width:400,offsetX: -320,hideCallback:function(){d&&d.ni.popupHidden(F)}});(function(){var Z=F.getOptions(),la=Z.calculatePositions;Z.calculatePositions=function(){var da=la.apply(this,k.toArray(arguments));if(da&&da.arrowCss&&typeof da.arrowCss.left==="number")da.arrowCss.left-=8;return da}})()}}}function w(Y,Z,la){if(Y.data("uioptions-initialized"))K&&K.jO();else{Y.data("uioptions-initialized",true);if(M.forIssue)K=new r(Y);else if(M.forProject)K=new l(Y)}la();d&&d.ni.lV(F,F.hide)}function D(Y,Z){y.setValue(y.value()+1);var la=C.ajsbridge.localURL(C.ajax.RESOURCES.CONFIG_UI_SETTINGS)
;if(M.forIssue){Y.forIssue=M.forIssue;h.lm(S)}else Y.forProject=M.forProject;var da=false;B.ajax({url:la,dataType:"json",type:"POST",contentType:"application/json; charset=UTF-8",data:h.ct(Y),success:function(O){da=true;g(O.defaultStructure);g(O.initialStructure);s=O;Q(s.singleStructure);Z&&Z();K&&K.jO()},complete:function(){M.forIssue&&h.ld();if(!da){k.warn("problem uploading autoSwitch setting");H=x=null}y.setValue(y.value()-1)}})}function J(){var Y=s.initialStructure;Y&&Y.id&&A(Y,false)}function c(Y){if(x!==Y){x=Y;D({autoSwitch:Y},function(){J();p()})}}function p(){var Y=s&& ! !s.issueMissingFromInitialStructure,Z=s&& ! !s.autoCollapse;R.setValue(Y);I.setValue(Y&&Z)}function g(Y){if(Y)Y.abbreviatedName=k.abbreviateLabel(Y.name)}var n=false,m={},F,x,H,ha,y=(new k.Cell).setValue(0),K=null,N=function(Y){Y&&Y.stopPropagation()},S=null;k.extend(this,{init:function(){M.configTrigger&&M.configTrigger.hide();var Y=C.ajsbridge.localURL(C.ajax.RESOURCES.CONFIG_UI_SETTINGS),Z={};if(M.forIssue)Z.forIssue=M.forIssue;if(M.forProject)Z.forProject=M.forProject;if(M.forRapidBoard)Z.forRapidBoard=M.forRapidBoard;if(M.preferredStructure)Z.preferredStructure=M.preferredStructure;B.ajax({url:Y+
k.buildUrlParameters(Z),dataType:"json",success:function(la){if(la){g(la.defaultStructure);g(la.initialStructure);s=la;Q(s.singleStructure);J();n=true;p();j()}},complete:function(){if(M.forIssue)S=h.ld();n||k.warn("problem loading UI configuration");k.safeCall(M.initComplete)}})}})}var d=null,a=(new k.Cell).setValue(null),s=null,z=null,I=(new k.Cell).setValue(null),R=(new k.Cell).setValue(null),b=false;a.pipeChanges(function(i){T();var r=C.modes.GH_TAB?"name":"abbreviatedName";r=i&&i[r]||null;i=i&&i.description||null;var l=M.titleSpan;if(l){var j,w;if(r===null)j=k.text("s.iv.module.title");else if(b){j=k.text("s.iv.module.title");w=r||k.text("sw.name.unknown");if(i)w+=" - "+i}else{j=r||k.text("sw.name.unknown");M.hidePrefix||(j=k.text("s.iv.module.title")+": "+j);w=i||""}l.text(j);w?l.attr("title",w):l.removeAttr("title")}});u();k.extend(this,{setWidget:function(i){d=i;a.value()&&T()},getSelectedStructureCell:function(){return a},getAutoCollapsedCell:function(){return I},getIssueUnstructuredCell:function(){return R},reinitialize:function(i){u();M.forIssue=i},reinitializeSettings:function(){z=new t;z.init()}});z=new t;z.init()}})();(function(){var U=namespace("almworks.structure"),
C=namespace("almworks.util"),h=namespace("almworks.structure.appevents");U.gh=function(k){function e(s){var z=G.cI(s);if(z&& !z.isOutdated())if(z=z.getValue("jira:raw:resolution"))return z==="0";return!A[s]}function B(){var s=u.getConfig().getParam(U.tableConfig.params.bh)==="hide";if(s!==T.value()){t=false;T.setValue(s);P.gy("unresolved",T.value()?e:null);T.value()&&M()}}function q(){d=t=false;a++;T.value()&&M()}function M(){if(T.value())if(!(t||d)){var s=k.currentStructure.id;if(s){d=true;var z= ++a;s=new Q.Task(U.ajax.RESOURCES.SEARCH_RESOLVED+"?structure="+s,U.ajax.DOWNLOAD,function(I){if(z===a){d=false;t=true;A=I&&I.issues?U.apputil.kf(I.issues):{};T.value()&&P.cn()}},function(I){C.warn("cannot load /issues/resolved from server: "+I);d=false});Q.addTask(s)}}}var u=C.nn(k.master.getTableConfig()),P=C.nn(k.master.dR()),G=C.nn(k.az),Q=C.nn(k.ajax),T=new C.Cell(false),A={},t=false,d=false,a=0;this[h.bC]=B;this[h.STRUCTURE_CHANGED]=q;k.eventBus.addListener(new C.Life,this);B();this.activeCell=T;this.resolvedIssuesUpdate=function(s,z){if(!s||s==="all")q();else if(z){for(var I=0,R=s.length;I<R;I++){var b=s[I];if(z[b])A[b]=true;else if(b in A)A[b]=false}T.value()&&P.cn()}};
this.isLoading=function(){return d}}})();(function(){function U(b,i){b=typeof b==="object"&&b||{};var r=null;q.eachOwn(i,function(l){var j=this[l],w;if(j===null){if(b.hasOwnProperty(l)){r=r||q.extendOwn({},b);delete r[l]}}else{w=b[l];if(typeof j==="object")j=U(w,j);if(j!==w){r=r||q.extendOwn({},b);r[l]=j}}});return r||b}function C(b){if(!b||typeof b!=="object")return{};var i=e.MIN_COLUMN_WIDTH,r=e.MAX_COLUMN_WIDTH;q.eachOwn(b,function(l){if(l==="manual"||l==="preferred")q.eachOwn(this[l],function(j){var w=this[j];if(typeof w!=="number"|| !(w>=i&&w<=r))delete this[j]});else delete this[l]});return b}function h(b,i,r,l){this.prefix=b+".";this.bA=i||0;this.kp={};this.kU={};this.lE=r;if(i){if((b=this.nk())&&b!==i){this.ki(i);this.lM(i)}this.lY(i);this.lY=q.noop}l&&e.setStored(this.prefix+"perspective.view",e.getStored(this.prefix+"view"),true)}function k(b,i,r){this.key="view.recent."+(b?"primary":"secondary");this.recents=null;if(this.lE=i){b=this.key;this.key+=".perspective";r&&e.setStored(this.key,e.getStored(b),true)}}var e=namespace("almworks.structure"),B=namespace("almworks.structure.api"),q=namespace("almworks.util"),M=namespace("almworks.structure.appevents");namespace(
"almworks.structure.columns");var u=e.$,P="actions",G="handle",Q="main",T="#",A={};A[P]= +1;A[G]= -1;var t=B.baseClass("ViewConfigModification",{init:function(){this.csid=this.validateOption("csid",d)},validateOption:function(b,i,r){var l=this.options;if(!l)throw "no options";if(!l.hasOwnProperty(b))throw "missing option "+b;l=l[b];if(i&&typeof l!==i)throw "bad option "+b+" :"+typeof l;if(r&&l!==r)throw "bad option "+b+" :"+l+" vs. expected "+r;return l},apply:q.pvc,findColumn:function(b,i){var r=b.columns,l=this.columnIndex(r,i);return l>=0?r[l]:null},columnIndex:function(b,i){for(var r=0,l=b.length;r<l;r++)if(b[r].csid===i)return r;return-1},merge:function(){return null},mF:function(b){return b.options.type===this.options.type&&b.options.csid===this.options.csid},mf:function(b,i,r){for(var l=i&&i.length||0,j=r&&r.length||0,w=l>j?l:j,D= -1,J=0;J<w&&D<0;J++){if(J<l){D=this.columnIndex(b,i[l-J-1]);D>=0&&D++}if(D<0&&J<j)D=this.columnIndex(b,r[J])}return D}}),d="string",a=B.subClass("AddColumn",t,{init:function(){this.validateOption("type",d,"colAdd");this.validateOption("prev");this.validateOption("next");this.validateOption("spec","object")},apply:function(b){var i=
this.options.spec,r=this.csid;if(this.findColumn(b,r))throw Error("column "+r+" already present");var l=b.columns,j=l.length,w=this.mf(l,this.options.prev,this.options.next);if(w<0)w=j;if(j>0){for(;w>0&&A[l[w-1].key]=== +1;)w--;for(;w<j&&A[l[w].key]=== -1;)w++}var D=[];q.addAll(D,l,0,w);D.push(q.extend({},i,{csid:r}));q.addAll(D,l,w,j);b.columns=D}}),s=B.subClass("RemoveColumn",t,{init:function(){this.validateOption("type",d,"colRemove")},apply:function(b){b=b.columns;var i=this.columnIndex(b,this.options.csid);i>=0&&b.splice(i,1)},merge:function(b,i){if(b.options.csid!==this.options.csid)return null;var r=b.options.type;if(r==="colChange")return[null,this];if(!i)return null;if(r==="colAdd")return[null,null];return[null,this]}}),z=B.subClass("MoveColumn",t,{init:function(){this.validateOption("type",d,"colMove");this.validateOption("prev");this.validateOption("next")},apply:function(b){var i=q.addAll([],b.columns),r=this.columnIndex(i,this.options.csid);if(!(r<0)){var l=i.splice(r,1)[0],j=this.mf(i,this.options.prev,this.options.next);if(!(j<0||j===r)){i.splice(j,0,l);b.columns=i}}},merge:function(b,i){return i&&this.mF(b)?[null,this]:null}}),I=B.subClass("ChangeColumn",t,{init:
function(){this.validateOption("type",d,"colChange");var b=this.validateOption("spec","object");if(b.csid&&this.csid!==b.csid)throw Error("can change column only to another column with the same csid");},apply:function(b){b=b.columns;var i=this.columnIndex(b,this.csid);i<0||(b[i]=this._newSpec())},merge:function(b,i,r){if(this.mF(b)){a:{b=this.csid;if(r&&b){r=r.columns;if(q.isArray(r))for(i=0;i<r.length;i++){var l=r[i];if(l&&l.csid===b){b=l;break a}}}b=null}if(b&&q.deepEquals(b,this._newSpec()))return[null,null];return[null,this]}return null},_newSpec:function(){return q.extendOwn({},this.options.spec,{csid:this.csid})}}),R={colAdd:a,colRemove:s,colMove:z,colChange:I};q.extend(h.prototype,{nk:function(){var b=this.prefix;if(this.lE)b+="perspective.";return q.toIntSafe(e.getStored(b+"view"),0)},lY:function(b){var i=this.prefix;if(this.lE)i+="perspective.";return e.setStored(i+"view",""+b,this.lE)},kR:function(b){return this.bA?this.prefix+"view.mods":"view."+b+".mods"},lJ:function(b){if(this.bA&&b!==this.bA)return[];b=e.getStored(this.kR(b));if(!b)return[];var i;try{i=e.JSON.parse(b)}catch(r){}if(typeof i==="object"&&i.mods&&i.mods.length)return i.mods;return[]},cO:function(b){var i=
this.kp[b];if(!i){var r=this.lJ(b);i=[];for(var l=0,j=r.length;l<j;l++){var w;w=r[l];if(!w|| !w.type)w=null;else{var D=R[w.type];if(D){var J=void 0;try{J=new D(w)}catch(c){J=null}w=J}else w=null}if(!w)return[];i.push(w)}this.kp[b]=i}return i},mL:function(b,i,r){var l=this.cO(b);q.addAll(l,i);var j,w=l.length,D=false,J,c;for(i=w-1;i>0;i--)if(l[i]){c=true;for(j=i-1;j>=0;j--)if(l[j]){J=l[i].merge(l[j],c,r);c=false;if(J&&J.length===2){D=J[0];J=J[1];q.assert(!D|| !J);l[j]=D;l[i]=J;D=true;if(!J)break}}}if(D){r=[];for(i=0;i<w;i++)(D=l[i])&&r.push(D);l=r}this.kp[b]=l;r=[];i=0;for(w=l.length;i<w;i++)r.push(l[i].options);e.setStored(this.kR(b),e.apputil.ct({mods:r}),e.iJ(b))},ki:function(b){var i=this.cO(b);if(i&&i.length){this.kp[b]=[];e.setStored(this.kR(b),"",e.iJ(b));return true}return false},lB:function(b){return this.bA?this.prefix+"view.widths":this.prefix+"view."+b+".widths"},kG:function(b){if(this.bA&&b!==this.bA)return{};var i=this.kU[b];if(!i){var r=e.getStored(this.lB(b));if(r)try{i=e.JSON.parse(r);i=C(i)}catch(l){i={}}else i={};this.kU[b]=i}return i},kh:function(b,i){var r=this.kG(b),l=U(r,i);if(l!==r){e.setStored(this.lB(b),e.apputil.ct(l),e.iJ(b));this.kU[b]=l}return l},lM:
function(b){var i=this.kG(b);if(!q.isEmptyOrFalsy(i)){this.kU[b]={};e.setStored(this.lB(b),"",e.iJ(b));return true}return false},lT:function(b,i){var r=this.kG(b),l=false;q.eachOwn(r,function(j){var w=null;q.eachOwn(this[j],function(D){if(i.hasOwnProperty(D)){w=w||q.extendOwn({},this);w[i[D]]=w[D];delete w[D]}});if(w){this[j]=w;l=true}});if(l){e.setStored(this.lB(b),e.apputil.ct(r),e.iJ(b));this.kU[b]=r}return r}});q.extend(k.prototype,{nd:function(){if(this.recents)return this.recents;var b=e.getStored(this.key),i=[];if(typeof b==="string"&&b){b=b.split("|");for(var r=0,l=b.length;r<l;r++){var j=q.toIntSafe(b[r],0);j&&i.push(j)}}return this.recents=i},recordRecent:function(b){if(!(!b||b<0&& !e.iJ(b))){var i=this.nd(),r=q.indexOf(i,b);if(r!==0){r>0&&i.splice(r,1);b=q.addAll([],[b]);q.addAll(b,i,0,Math.min(i.length,14));e.setStored(this.key,b.join("|"),this.lE);this.recents=b}}}});e.mE=function(b){function i(O){if(O){var W=false;ha.mi(O,function(ia){if(O===K.ay.value()){K.ag.setValue(ia);W=true;!ia&&O!==e.FALLBACK_VIEW_ID&&K.ay.setValue(e.FALLBACK_VIEW_ID)}});W||K.ag.setValue(null)}else K.ag.setValue(null)}function r(O,W){if(!O|| !W)return false;for(var ia=false,ja=0,pa=W.length;ja<
pa;ja++)try{W[ja].apply(O);ia=true}catch(na){q.warn("cannot modify view spec",na)}if(pa>0)O.columns=j(O.columns);return ia}function l(){var O=K.ag.value();if(O){var W=u.extend(true,{},O.spec),ia={};W.columns=j(W.columns);var ja=false;if(N){ia=N.cO(O.id);ja=r(W,ia);ia=N.kG(O.id)}K.ck.setValue({spec:W,widths:ia,ey:{preferred:1,manual:1}});K.jM.setValue(ja);b.bD().fireEvent(M.mx,W)}else K.ck.setValue({spec:null,widths:null,ey:null})}function j(O){O=O||[];var W=q.find(O,function(aa){return aa.key===Q}),ia=q.find(O,function(aa){return aa.key===G}),ja=[];ja.push(ia>=0?O[ia]:{csid:G,key:G});W<0&&ja.push({csid:Q,key:Q});ia=0;for(var pa=O.length;ia<pa;ia++){var na=O[ia];if(na){var qa=na.key;if(!qa|| !B.ColumnType.getColumnTypeForKey(qa))q.warn("view spec contains column of unknown key "+qa);else if(na.csid)A[qa]||qa===Q&&ia!==W||ja.push(na);else q.warn("view spec contains column without csid ("+qa+")")}}if(!H.areJiraActionsDisabled()){W=q.find(O,function(aa){return aa.key===P});ja.push(W>=0?O[W]:{csid:P,key:P})}return ja}function w(){var O=b.widget.currentStructure.id;if(O){var W="",ia=e.modes.getStructurePageId();if(ia==="structure")W+=O;else if(ia==="structure-with-details")W+=O+
":structure-with-details";else if(ia==="issue")W+=O+":issue";else if(ia==="project"||ia==="version"||ia==="component")W+=O+":pcv";else if(ia==="gadget")W+="gadget:"+(e.modes.GADGET_ID||"0");else if(ia==="greenhopper")W+="gh:"+(e.modes.GH_RAPIDBOARD_ID||"0");O=b.widget.config.forceViewId;var ja=b.widget.config.perspectiveSpec,pa=b.widget.config.originalPerspectiveSpec;pa=ha.jf(e.iq)&&e.oh(pa)===ia;N=new h(W,O,pa,S);if(O){q.assert(e.modes.GADGET||e.modes.GH_TAB,O);Y.recordRecent=q.noop;D()}else{la.cycle();K.ay.pipe(la,false,function(na){Z[ia]=na});if(Z[ia]){K.ay.multiUpdate(true);try{K.structurePageId.setValue(e.modes.getStructurePageId());K.ay.setValue(Z[ia])}finally{K.ay.multiUpdate(false)}}else if(pa&&ja){W=e.iq;N.ki(W);N.lM(W);n(W,true)}else b.widget.config.initialViewId?K.ay.setValue(b.widget.config.initialViewId):D()}}else K.ay.setValue(0)}function D(){if(N){var O;if(y){var W=b.widget.currentStructure.id;O=N.nk();if(O<0&& !N.bA&& !e.iJ(O))O=0;if(O)K.ay.setValue(O);else{K.ay.setValue(0);W&&ha.mD(W,function(ia){if(W===b.widget.currentStructure.id){if(!ia)ia=e.FALLBACK_VIEW_ID;K.ay.setValue(ia)}})}}else{O=N.lE?e.jG:e.SECONDARY_VIEW_ID;K.ay.setValue(O)}}}function J(O,W){if(N){
var ia=K.ag.value();if(ia&&ia.id){N.mL(ia.id,O,ia.spec);W&&N.kh(ia.id,W);ia=K.jM.value();l();var ja=K.jM.value();ia!==ja&&b.bD().fireEvent(M.md,x,ja,ia)}}}function c(){if(!N)return false;var O=K.ag.value();if(!O|| !O.id)return false;return p(O.id)}function p(O){var W=N.cO(O),ia,ja,pa,na=null;if(!W|| !W.length)return false;N.ki(O);ia=0;for(ja=W.length;ia<ja;ia++){pa=W[ia];if(pa instanceof a||pa instanceof I){na=na||{};na[pa.csid]=null}}na&&N.kh(O,{manual:na,preferred:na});return true}function g(O){O=O.columns;var W=0,ia=false,ja,pa=O.length,na,qa={};for(ja=0;ja<pa;ja++)if(na=(na=O[ja])&&na.csid)if(q.tail(na,T))ia=true;else{na=q.toIntSafe(na,0);if(na>W)W=na}else{O.splice(ja,1);ja--;pa--}if(ia)for(ja=0;ja<pa;ja++){na=O[ja];if(q.tail(na.csid,T))na.csid=qa[na.csid]=""+ ++W}return qa}function n(O,W){if(W&&N){N.lY(O);Y.recordRecent(O)}K.ay.setValue(O)}function m(O){return!A[O]}function F(O){if(!N)return false;O=N.cO(O);return! !(O&&O.length)}var x=this,H=q.nn(b.config),ha=b.widget.jT,y=b===b.widget.master,K={},N,S=y&& ! !b.widget.config.perspectiveSpec,Y=new k(y,y&&b.widget.config.lE,S),Z={},la=new q.Lifecycle;K.ay=new q.Cell(0);K.ag=new q.Cell(null);K.structurePageId=new q.Cell;K.ck=
new q.Cell({spec:null,widths:null,ey:null});K.colWidths=new q.Cell(null);K.ay.pipe(i);K.lK=new q.Cell(K.ag,function(O){return{name:O&&O.name||"?",description:O&&O.description||"",id:O&&O.id}});K.jM=new q.Cell(false);new q.Cell(K.ag,K.structurePageId,l);if(y){w();this[M.STRUCTURE_CHANGED]=this[M.STRUCTURE_PAGE_CHANGED]=w}else{var da=ha.jf(e.jG);N=new h("secondary",null,da,S);D()}this[M.jH]=function(O){O===K.ay.value()&&i(O)};b.bD().addListener(new q.Life,this);da=b.ah();da.register("view.revert",function(){if(c()){l();return true}return false});da.register("view.save",function(){if(!N)return false;var O=K.ag.value(),W=O&&O.id;if(!W||W<0)return false;if(!F(W))return false;O=K.ck.value().spec;if(q.isEmptyOrFalsy(O))return false;O=u.extend(true,{},O);var ia=g(O);ha.mY(W,O,function(ja){if(ja){N.ki(W);N.lT(W,ia);K.ay.value()===W&&K.ag.setValue(ja)}});return true});da.register("view.switch",function(O){O=q.toIntSafe(u(O.target).attr("rel"),0);if(!O)return false;n(O,true);return true});da.register("view.share-all",function(O){(O=O&&q.toIntSafe(u(O.target).attr("rel")))||(O=K.ay.value());if(!ha.lN(O))return false;ha.makePublic(O);return true});da.register("view.share-none",function(O){(O=
O&&q.toIntSafe(u(O.target).attr("rel")))||(O=K.ay.value());if(!ha.lN(O))return false;O=ha.np(O);if(!O)return false;O.permissions=[];ha.saveView(O);return true});q.extend(this,{mu:function(){return K.ck.value().spec},mR:function(){return K.ck},fi:function(){return K.ay.value()},mA:function(){return K.ay},getBaseViewName:function(){var O=K.ag.value();if(!O)return "";return O.name||""},getBaseViewCell:function(){return K.ag},mG:function(){return K.ag.value()},lX:function(){return K.lK},ku:function(){return K.jM},df:function(O,W){var ia=K.ag.value(),ja,pa;if(ia&&N){ja=N.kh(ia.id,O);ia=K.ck.value();pa=q.extendOwn({},ia.ey);if(O.manual)pa.manual=(pa.manual||0)+1;if(O.preferred)pa.preferred=(pa.preferred||0)+1;K.ck.setValue({spec:ia.spec,widths:ja,ey:pa,kC:W})}},moveColumn:function(O,W,ia){J([new z({type:"colMove",csid:O,prev:q.arrayFilter(W,m),next:q.arrayFilter(ia,m)})])},removeColumn:function(O){var W=q.collectMap(O,null);J([new s({type:"colRemove",csid:O})],{manual:W,preferred:W})},addColumn:function(O,W,ia){var ja;if(!(ja=O.csid)){ja=K.ag.value();if(!N|| !ja|| !ja.id)ja=T+(new Date).getTime();else{ja=N.cO(ja.id);for(var pa=0,na=0,qa=ja.length;na<qa;na++){var aa=ja[na];if(
B.isInstance(a,aa)){aa=q.toIntSafe(q.tail(aa.options.csid,T),0);if(aa<=0)pa++;else if(aa>pa)pa=aa}}ja=T+(pa+1)}}J([new a({type:"colAdd",csid:ja,spec:O,prev:q.arrayFilter(W,m),next:q.arrayFilter(ia,m)})]);return ja},changeColumn:function(O,W){var ia=q.collectMap(O,null);J([new I({type:"colChange",csid:O,spec:W})],{manual:ia,preferred:ia})},mr:function(){var O;O=K.ag.value();if(!N|| !O|| !O.id)O=null;else O=(O=N.cO(O.id))&&O.length?O:null;return! !(O&&O.length)},nt:F,lC:function(){var O=K.ag.value();return O&&O.writable},mz:n,isCreateViewAllowed:function(){return b.widget.jiraConfig.isCreateViewAllowed()},saveViewAs:function(O,W){O=u.trim(O||"");var ia=K.ck.value().spec;if(!O|| !N||q.isEmptyOrFalsy(ia)){W&&W(null);return false}var ja=K.ay.value();ia=u.extend(true,{},ia);var pa=g(ia);ha.createView(O,ia,function(na){if(na){N.lM(na.id);N.kh(na.id,N.kG(ja));N.lT(na.id,pa);p(ja);ja===K.ay.value()&&n(na.id,true)}q.safeCall(W,na,na)});return true},mo:function(O){var W=Y.nd();!W|| !W.length?O([]):ha.mW(W,O)},mZ:function(O,W){if(!O|| !W)return null;var ia=N.cO(W);if(!ia|| !ia.length)return null;var ja=u.extend(true,{},O);if(!r(ja,ia))return null;g(ja);return ja},kb:function(O){if(O)for(var W=
0,ia=O.length;W<ia;W++){var ja=O[W],pa=ja&&ja.id;if(pa)if(F(pa))ja._adjusted=true}return O},mC:function(O){!O||O>0||n(O,false)},mV:function(){var O=K.ay.value();if(O<0){N&&N.ki(O);D()}}})}})(window);(function(U){var C=namespace("almworks.structure"),h=namespace("almworks.util"),k=namespace("almworks.structure.appevents"),e=C.$,B=C.api,q=B.baseClass({getHtml:function(){}}),M=B.subClass(q,{getHtml:function(G){if(!G.mr())return null;var Q='<span class="s-adjusted-mark">*</span> <span>{s.w.view.stripe.modified}</span><span class="s-view-dd-stripe-actions">';if(G.lC())Q+='<a href="#" data-s-action="view.save" title="{s.w.view.action.save.title}">{s.w.view.action.save.label}</a><span>|</span>';if(G.isCreateViewAllowed())Q+='<a href="#" data-s-action="view.save-as" title="{s.w.view.action.save-as.title}">{s.w.view.action.save-as.label}</a><span>|</span>';Q+='<a href="#" data-s-action="view.revert" title="{s.w.view.action.revert.title}">{s.w.view.action.revert.label}</a></span>';return Q}}),u=B.subClass(q,{getHtml:function(G){if(!this.active)return null;if(!G.isCreateViewAllowed()|| !G.mr()){this.deactivate();return null}
return '<form class="s-save-as-form" data-s-action="view.save-as.apply"><span>{s.w.view.stripe.saveas}</span> <input name="name" type="text" size="20" maxlength="255" class="ajs-dirty-warning-exempt s-view-dd-saveas-name s-menulist-keyboard-ignore"> <input type="submit" value="{s.w.view.stripe.saveas.save}"> <a href="#" data-s-action="view.save-as.cancel">{s.w.view.stripe.saveas.cancel}</a></form>'},deactivate:function(){if(this.active){this.active=false;if(this.focus)this.focus=this.focus.returnFocus()}}}),P=B.subClass(q,{getHtml:function(G,Q){var T=G.mG();if(!T|| !T.adminable)return null;var A= ! !T.shared;T= ! !T.sharedWithAll;if(!A&& !Q.widget.jiraConfig.isShareViewAllowed())return null;return A?"<span>"+(T?"{s.w.view.stripe.shared.public}":"{s.w.view.stripe.shared.true}")+'</span><span class="s-view-dd-stripe-actions"><a href="#" data-s-action="view.details.sharing" title="{s.w.view.action.sharing-details.title}">{s.w.view.action.sharing-details.label}</a></span>':
'<span>{s.w.view.stripe.shared.false}</span><span class="s-view-dd-stripe-actions"><a href="#" data-s-action="view.share-all" title="{s.w.view.action.share-all.title}">{s.w.view.action.share-all.label}</a><span>|</span><a href="#" data-s-action="view.details.sharing" title="{s.w.view.action.share.title}">{s.w.view.action.share.label}</a></span>'}});C.lZ=function(G){function Q(W,ia){return new h.Cell(W,ia,function(ja,pa){return pa?null:ja})}function T(){if(Z.jR.value()===0&&Z.visible.value())if(!x.find("li.s-hover:visible").length){var W=null;if(!Z.showingFound.value()){var ia=g.fi();if(ia)W=x.find('li > a[rel="'+ia+'"]:visible');W=W&&W.length?W.parent():null}if(W)K.selectItem(W);else x.find("li > a[rel]:first").length&&K.selectFirst()}}function A(W){Z.jR.setValue(Z.jR.value()+W)}function t(){if(la){var W=la;A(+1);n.nh(W,function(ia){A(-1);W===la&&Z.foundViews.setValue(g.kb(ia))})}}function d(){if(g.fi()){var W=g.lX().value(),ia=W&&W.name||"";if(W=W&&W.description||"")W=" - "+W;ha.name.text(ia).attr("title",h.text("s.w.view.current.title")+" "+ia+W)}ia=h.onPage(x);W=null;var ja,pa=F.length;for(ja=0;ja<pa;ja++){var na=F[ja],qa=h.renderTemplate(na.getHtml(g,G));if(qa){if(na.div$)
na.div$.html()!=qa&&na.div$.html(qa);else{na.div$=e('<div class="s-view-dd-stripe"></div>').html(qa);ia&&na.div$.css("display","none");W?W.after(na.div$):na.div$.prependTo(ha.stripes);ia&&R(na.div$,true)}W=na.div$}else if(na.div$){ia?R(na.div$,false):na.div$.remove();na.div$=null}}}function a(W,ia,ja){W.pipe(function(pa){var na="";if(pa)for(var qa=0,aa=pa.length;qa<aa;qa++){var X=pa[qa],ba=X.id;if(X.name&&ba)na+=h.renderTemplate('<li{classes:html}><a href="#" data-s-action="view.switch" rel="{id}" title="{description}">{name}</a></li>',X,{classes:X._adjusted?' class="s-view-adjusted"':""})}if(na){ja.html(na);ia.show()}else{ia.hide();ja.html(na)}})}function s(){A(+2);n.mK(G.widget.currentStructure.id,function(W){A(-1);Z.associatedViews.setValue(g.kb(W))});g.mo(function(W){A(-1);Z.nu.setValue(g.kb(W))})}function z(){if(!Y){var W,ia;if(N.length){W=N[0];if(W.data("animate")==="show"){Y=true;W.slideDown("fast",I)}else{Y=true;W.slideUp("fast",function(){e(this).remove();I()})}}else{var ja=S;if(ja.length){S=[];W=0;for(ia=ja.length;W<ia;W++)h.safeCall(ja[W])}}}}function I(){Y=false;N.length&&N.splice(0,1);N.length?U.setTimeout(z,100):z()}function R(W,ia){W.data("animate",ia?"show":"hide");
N.push(W);z()}function b(W){N.length?S.push(W):W()}function i(){return x.is(":visible")}function r(){e(U.document).on({"click.viewPresenter":function(W){if(i()){var ia=x[0];(W=W&&W.target)&&W!==ia&& !e.contains(ia,W)&&j(false,true)}}})}function l(){j(false)}function j(W,ia){var ja=i(),pa=W===true||W===false?W: !ja;if(pa!==Z.visible.value()){if(pa){Z.lF.setValue(g.fi());d();s();K.jo();h.onPage(x)||x.appendTo(e("#s-view-dd-container"));ja||Z.searchTerm.setValue("");x.show();ja||(y=h.borrowFocus(ha.input,x));r();G.widget.ni.lV(p,l)}else{m.deactivate();x.hide();y&&y.returnFocus(ia);e(U.document).off(".viewPresenter");G.widget.ni.popupHidden(p)}Z.visible.setValue(pa)}}function w(W){if(W===true||W===false?W: !m.active){if(!g.isCreateViewAllowed()|| !g.mr())return false;i()||j(true);m.active=true;d();b(function(){var ia=m.div$&&m.div$.find("input:text:visible");if(ia&&ia.length)m.focus=h.borrowFocus(ia,m.div$)})}else{m.deactivate();i()&&d()}return true}function D(W,ia){var ja=e.trim(ia&&ia.name||"");if(!ja){w(false);return true}var pa=e(W.target).closest("form.s-save-as-form");pa.find('input[type="submit"]').attr({disabled:"disabled",value:h.text("s.w.view.stripe.saveas.saving")});
pa.find('input[type="text"]').attr("readonly","readonly").css("color","#666");pa.find("a").hide();g.saveViewAs(ja,function(na){na&&na.id&&Z.lF.setValue(na.id)})}function J(W,ia){j(false);H||(H=new C.mX(G));H.reset(W?g.fi():0,ia);H.show()}function c(){if(h.onPage(x)){d();s()}}var p=this,g=G.bW(),n=G.widget.jT,m=new u,F=[new P,new M,m],x=e(h.renderTemplate(
'<div id="s-view-dd" style="display:none"><div class="s-view-dd-top"><div class="s-view-dd-current"><span class="s-view-dd-current-name" title="">?</span></div><div class="s-view-dd-stripes"></div></div><div class="s-view-dd-controls"><div><label for="s-view-dd-search">{s.w.view.search.label}</label> <input type="text" class="ajs-dirty-warning-exempt s-view-dd-search" maxlength="15" size="15" id="s-view-dd-search"> <span class="s-view-dd-notfound" style="display: none">{s.w.view.list.notfound}</span><div class="s-view-dd-progress" style="display: none"><span class="st-progress-icon"></span></div></div></div><div class="s-view-dd-menu"><div class="s-view-dd-associated s-view-list" style="display: none"><div>{s.w.view.list.suggested}</div><ul></ul></div><div class="s-view-dd-recent s-view-list" style="display: none"><div>{s.w.view.list.recent}</div><ul></ul></div><div class="s-view-dd-found s-view-list" style="display: none"><div>{s.w.view.list.found}</div><ul></ul></div><div class="s-view-dd-actions"><ul><li><a href="#" data-s-action="view.manage">{s.w.view.manage.label}</a></li></ul></div></div></div>')),H,ha={name:x.find(".s-view-dd-current-name"),stripes:x.find(
".s-view-dd-stripes"),input:x.find(".s-view-dd-search"),recent:x.find(".s-view-dd-recent"),recentList:x.find(".s-view-dd-recent ul"),associated:x.find(".s-view-dd-associated"),associatedList:x.find(".s-view-dd-associated ul"),found:x.find(".s-view-dd-found"),foundList:x.find(".s-view-dd-found ul"),notFound:x.find(".s-view-dd-notfound"),progress:x.find(".s-view-dd-progress")},y=null,K=new C.apputil.MenuList({container$:x,handler:{onMenuCancelled:l,onMenuItemChosen:function(W){var ia=W&&h.toIntSafe(W.find("a").attr("rel"))||0,ja=false;if(ia){g.mz(ia,true);ja=true}else if(W.find("a[data-s-action]").attr("data-s-action")==="view.manage"){J(false,null);ja=true}j(false);return ja}}}),N=[],S=[],Y=false,Z={associatedViews:new h.Cell(null),nu:new h.Cell(null),foundViews:new h.Cell(null),lF:new h.Cell(0),visible:new h.Cell(false),jR:new h.Cell(0),searchTerm:new h.Cell("")};Z.me=function(){return new h.Cell(Z.associatedViews,Z.nu,Z.lF,function(W,ia){if(!W|| !ia)return null;for(var ja=[],pa=h.mapArray(W,function(aa){return aa&&aa.id}),na=0;na<ia.length;na++){var qa=ia[na];if(qa&&qa.id&& !pa[qa.id]){ja.push(qa);if(ja.length>=4)break}}return ja})}();Z.showingFound=new h.Cell(Z.foundViews,
function(W){return! !W});(function(){x.find(".s-view-dd-top").keydown(function(W){if(W&&W.target&&e(W.target).is(".s-view-dd-saveas-name:visible"))if(h.keyboardCodeFromEvent(W)===27){w(false);W.preventDefault();W.stopPropagation();return false}})})();(function(){new h.TextPresenter(Z.searchTerm,ha.input);Z.searchTerm.pipe(function(W){if(la=e.trim(W||""))n.nm(la)?t():da();else Z.foundViews.setValue(null)});(new h.Cell(Z.foundViews,function(W){return! !(W&& !W.length)})).pipe(function(W){ha.notFound.toggle(W)})})();(function(){(new h.Cell(Z.jR,function(W){return W>0})).setDelay(500).pipe(function(W){ha.progress.toggle(W)});Z.jR.pipeChanges(function(W){W||U.setTimeout(T,0)})})();a(Q(Z.associatedViews,Z.showingFound),ha.associated,ha.associatedList);a(Q(Z.me,Z.showingFound),ha.recent,ha.recentList);a(Z.foundViews,ha.found,ha.foundList);var la="",da=h.delayed(400,t);this[k.mx]=c;this[k.jH]=c;this[k.dz]=this[k.aN]=l;G.bD().addListener(new h.Life,this);h.extend(this,{toggleVisibility:j,toggleSaveAs:w,kY:function(){return Z.visible}});if(G===G.widget.master){var O=G.widget.globalActions;O.register("view.save-as.cancel",h.curry(w,false));O.register("view.save-as.apply",D);O.register(
"view.select",h.curry(j,true));O.register("view.save-as",w);O.register("view.manage",h.curry(J,false,null));O.register("view.details.sharing",h.curry(J,true,"#s-view-permissions"))}}})(window);(function(U,C){function h(A,t,d,a){B.assert(A<0,A);return{id:A,name:t?B.text(t):"?",description:d?B.text(d):"",writable:false,adminable:false,shared:false,sharedWithAll:false,permissions:[],owner:null,spec:a}}function k(A){var t=[{key:"handle",csid:"handle"},{key:"field",csid:"1",params:{field:"issuekey"}},{key:"main",csid:"main"}];A&&t.push({key:"actions",csid:"actions"});return{columns:t}}var e=namespace("almworks.structure"),B=namespace("almworks.util"),q=namespace("almworks.structure.appevents"),M=e.$,u=h(-1,"s.w.view.fallback-config.name","s.w.view.fallback-config.description",k(true)),P=h(-2,"s.w.view.fallback-config.name","s.w.view.fallback-config.description",k(false)),G=h(-3,"s.w.view.gh.name","s.w.view.gh.description",k(false)),Q=[u,P,G],T="viewSpec";e.lH=function(A){function t(m){var F;a:{var x="perspective.viewSpec."+m;if(A.config.perspectiveSpec){F=A.config.perspectiveSpec[m];if(!F){F=null;break a}(F=F[T])?e.setStored(x,e.apputil.ct(F),true):e.iw(A,m,T)}else try{F=e.JSON.parse(
e.getStored(x))}catch(H){}}if(F){x=m==="master"?e.iq:e.jG;m=h(x,"s.w.view.perspective.+"+m+"+.name","s.w.view.perspective.+"+m+"+.description",F);w[x]=m;D[x]=true}}function d(m){var F=[];if(!m)return F;for(var x=0,H=m.length;x<H;x++){var ha=a(m[x]);ha&&F.push(ha)}return F}function a(m){if(!m)return null;return(m=w[m])?M.extend(true,{},m):null}function s(m,F){if(!m)return null;for(var x=[],H=0,ha=m.length;H<ha;H++){var y=z(m[H],F);y&&x.push(y)}return x}function z(m,F,x){if(!m)return false;if(!m|| !m.spec)return false;var H=m.id;if(!H)return false;if(H<0&& !x)return false;if(!m.name)return false;m.hasOwnProperty("description")||(m.description="");if(A.jiraConfig.le())m.writable=m.adminable=false;x=w[H];w[H]=m;if(F||D.hasOwnProperty(H))D[H]= ! !F;x&& !B.isDeeplySame(x,m)&&A.eventBus.postEvent(q.jH,H);return H}function I(m){var F=null,x;for(x in n)if(n.hasOwnProperty(x)&&typeof x==="string"&&m.indexOf(x)>=0){var H=n[x];if(H&&H.length&&(!F||F.length>H.length))F=H}return F}function R(m){if(!m)return "";return m.toUpperCase().toLocaleLowerCase()}function b(m,F){for(var x=[],H=0,ha=m.length;H<ha;H++){var y=w[m[H]];if(y)(y=y.name)&&R(y).indexOf(F)>=0&&x.push(a(m[H]))}return x}function i(){
n={};g=p=null;c={};J={}}function r(m,F,x){l(m,F,false,x)}function l(m,F,x,H){var ha=null;m=new j.Task(e.ajax.RESOURCES.VIEW+m,F?e.ajax.UPLOAD:e.ajax.DOWNLOAD,function(y){ha=z(y,x)});m.chainComplete(function(){B.safeCall(H,C,a(ha));F&&i()});if(F){m.type="POST";m.data=F}j.addTask(m)}var j=A.ajax,w={},D={},J={},c={},p=null,g=null,n={};(function(){for(var m=0,F=Q.length;m<F;m++){var x=Q[m];w[x.id]=x}if(A.config.lE){t("master");t("slave")}})();B.extend(this,{jf:function(m){return! !w[m]},isViewConfigurationShared:function(m){m=w[m];if(!m)return false;return! !m.shared},isViewConfigurationDefaultForCurrentStructure:function(m){var F=A.currentStructure.id;if(!F)return false;var x=e.modes.getStructurePageId();return J[F+"."+x]===m},lN:function(m){m=w[m];if(!m)return false;return! !m.adminable},mK:function(m,F){if(!m||m<0)F(null);else{var x=e.modes.getStructurePageId(),H=m+"."+x,ha=c[H];if(ha)F(d(ha));else{var y=e.ajax.RESOURCES.VIEW+"/menu";y+="?forPage="+x;y+="&forStructure="+m;j.addTask(new j.Task(y,e.ajax.DOWNLOAD,function(K){K=s(K.views,false);c[H]=K;B.safeCall(F,C,d(K))},function(K,N){var S=B.httpErrorReport(K,N);A.errorCentral.reportError(new e.error.AppError(B.text(
"s.w.error.load-views",S.title),"When loading GET "+y+"\n:"+S.details));c[H]=[];B.safeCall(F,C,[])}))}}},nf:function(m){if(p)m(d(p));else{var F=new j.Task(e.ajax.RESOURCES.VIEW+"?withPermissions=true&withOwner=true&permission=admin",e.ajax.DOWNLOAD,function(x){p=s(x.views,true)});F.chainComplete(function(){m(d(p))});j.addTask(F)}},nx:function(m,F){if(!m||m<0)F(null);else{var x=null,H=new j.Task(e.ajax.RESOURCES.VIEW+"/"+m+"/associations",e.ajax.DOWNLOAD,function(ha){x=ha||null});H.chainComplete(function(){B.safeCall(F,C,x)});j.addTask(H)}},mi:function(m,F){var x=m&&w[m];!m||x===false||x?F(a(m)):r("/"+m,false,F)},np:a,lD:function(m,F){var x=m&&w[m];!m||x===false||x&&D[m]?F(a(m)):l("/"+m+"?withPermissions=true&withOwner=true",false,true,F)},mD:function(m,F){var x=e.modes.getStructurePageId(),H=m+"."+x,ha=J[H]||0;ha|| !m?F(ha):r("/default?forStructure="+m+"&forPage="+x,false,function(y){if(y=y&&y.id)J[H]=y;F(y)})},mW:function(m,F){if(!m|| !m.length)F(null);else{m=M.merge([],m);var x="",H,ha=m.length;for(H=0;H<ha;H++){var y=m[H],K=w[y];if(typeof y==="number"&&y>0&& !K&&K!==false){if(x)x+=",";x+=y}}H=function(){B.safeCall(F,C,d(m))};if(x){x=e.ajax.RESOURCES.VIEW+"?ids="+
encodeURIComponent(x);x=new j.Task(x,e.ajax.DOWNLOAD,function(N){s(N.views,false)});x.chainComplete(H);j.addTask(x)}else H()}},nh:function(m,F){if(!m||typeof m!=="string")F(null);else{var x=R(m),H=n[x];if(H)F(d(H));else if(H=I(x))F(b(H,x));else{H=e.ajax.RESOURCES.VIEW+"?name="+encodeURIComponent(m);var ha=null;H=new j.Task(H,e.ajax.DOWNLOAD,function(y){ha=s(y.views,false)});H.chainComplete(function(){if(ha)n[x]=ha;F(d(ha))});j.addTask(H)}}},lU:function(m){if(g)m(d(g));else{var F=new j.Task(e.ajax.RESOURCES.VIEW+"?withPermissions=true&withOwner=true",e.ajax.DOWNLOAD,function(x){g=s(x.views,true)});F.chainComplete(function(){m(d(g))});j.addTask(F)}},nm:function(m){m=R(m);if(n[m])return true;return! !I(m)},saveView:function(m,F){var x=m&&m.id;if(x){var H=null;x=new j.Task(e.ajax.RESOURCES.VIEW+"/"+x+"/update",e.ajax.UPLOAD,function(ha){H=z(ha,false)});x.chainComplete(function(){B.safeCall(F,C,a(H));i()});x.type="POST";x.data=e.apputil.ct(m);j.addTask(x)}else F(null)},mY:function(m,F,x){!m|| !F?x(null):r("/"+m+"/updateSpec",e.apputil.ct(F),x)},createView:function(m,F,x){m=e.apputil.ct({name:m,spec:F});r("",m,x)},makePublic:function(m,F){!m||m<0?F(null):r("/"+m+"/makePublic","{}",F)},
deleteView:function(m,F){if(!m||m<0)F(false);else{var x=false,H=new j.Task(e.ajax.RESOURCES.VIEW+"/"+m,e.ajax.UPLOAD,function(){x=true;w[m]=null;D[m]=false;J={};A.eventBus.postEvent(q.jH,m)});H.chainComplete(function(){B.safeCall(F,C,x);i()});H.type="DELETE";j.addTask(H)}},mb:function(m){if(!m|| !(m.id<0))return false;return z(m,true,true)},lb:function(m){m.master[T]=A.master.bW().mu();if(m.slave)m.slave[T]=A.slave.bW().mu()}})};e.FALLBACK_VIEW_ID=u.id;e.SECONDARY_VIEW_ID=P.id;e.GREENHOPPER_VIEW_ID=G.id;e.iq= -20;e.jG= -21;e.iJ=function(A){return A===e.iq||A==e.jG}})(window);(function(U){function C(s,z){if(!s.data("loaded")){s.data("loaded",true);z(function(){s.find(".st-progress-icon").hide();s.children(":not(.st-progress-icon)").show()})}}function h(s,z){var I="<select";if(z)I+=' class="'+z+'"';I+=">";if(s&&s.length)for(var R=0,b=s.length;R<b;R++){var i=s[R];if(i){var r=i.name;if(r)I+=u.renderTemplate('<option value="{id}">{name}</option>',{id:i.id||r,name:r})}}I+="</select>";return I}function k(s,z){C(s,function(I){z.jiraConfig.mJ(function(R){s.find(".s-subject-group").parent().html(h(R,"s-subject-group"));s.find(".s-subject-group option:first").attr("selected","selected");I()})
})}function e(s,z){C(s,function(I){z.jiraConfig.mn(function(R){s.find(".s-subject-project").parent().html(h(R,"s-subject-project"));var b=s.find(".s-subject-project");s.find("option:first",b).attr("selected","selected");var i=new u.Cell;(new u.SelectPresenter(i)).setView(b,true);var r=u.mapArray(R,function(l){return l.id});i.pipe(function(l){if(l){var j=r[l];if(j){var w=s.find(".s-subject-role");l=w.val();w.parent().html(h(j.userRoles,"s-subject-role"));if(l){j=s.find('.s-subject-role option[value="'+l+'"]');if(j.length)j.attr("selected","selected");else l=0}l||s.find(".s-subject-role option:first").attr("selected","selected")}}});I()})})}function B(s){var z={view:[],edit:[],admin:[],isPublic:false,isPrivate: !s||s.length===0};if(s)for(var I=0,R=0,b=s.length;R<b;R++){var i=s[R];if(!i)return null;if(i.rule!=="set")return null;var r=i.level;if(!r)return null;var l=a[r];if(!l||l<I)return null;I=l;l=i.subject;if(l!=="anyone"&&l!=="group"&&l!=="projectRole")return null;if(l==="anyone")z.isPublic=true;l=z[r];if(!l){u.assert(false,r);return null}l.push(i)}return z}function q(s,z,I){s.html(d);var R=new u.Cell("anyone");new u.SelectPresenter(R,s.find(".s-subject-type"));var b=s.find(
".s-subject-type-group-params"),i=s.find(".s-subject-type-role-params");R.pipe(function(r){var l=r==="group";r=r==="projectRole";l&&k(b,z);r&&e(i,z);b.toggle(l);i.toggle(r)});s.find(".s-subject-add").click(function(r){var l=R.value(),j={subject:l};if(l==="group")j.groupId=s.find(".s-subject-group").val();else if(l==="projectRole"){j.projectId=u.toIntSafe(s.find(".s-subject-project").val());j.roleId=u.toIntSafe(s.find(".s-subject-role").val())}I(j);r.preventDefault();return false})}var M=namespace("almworks.structure");namespace("almworks.structure.api");var u=namespace("almworks.util"),P=namespace("almworks.structure.appevents"),G=M.$,Q=u.requireGlobal("AJS"),T=namespace("JIRA.userhover",false),A="s-manage-views",t="s-viewdialog-shown",d=u.renderTemplate(
'<span>{s.w.view.d.perm.include}</span> <select class="s-subject-type"><option value="anyone" selected="selected">{s.manage.permissions.add.subject.anyone.label}</option><option value="group">{s.manage.permissions.add.subject.group.label}</option><option value="projectRole">{s.manage.permissions.add.subject.project.label}</option></select><span class="s-subject-type-group-params"><span class="st-progress-icon"></span><span style="display:none"><span class="s-perm-arrow"></span><span><select class="s-subject-group"></select></span></span></span><span class="s-subject-type-role-params"><span class="st-progress-icon"></span><span style="display:none"><span class="s-perm-arrow"></span><span><select class="s-subject-project"></select></span><span class="s-perm-arrow"></span><span><select class="s-subject-role"></select></span></span></span><a class="s-subject-add" href="#"><span></span>{s.manage.permissions.add.action.label}</a>'),a={view:10,edit:20,admin:30};M.mX=function(s){function z(){if(!N){N=c();S=N.page[0];Y=N.page[1];N.page[0].ontabchange=function(){x()};U.JIRA.bind("Dialog.beforeHide",function(aa,X,ba,ea){ea===A&& !(N.curpage!==1||D())&&aa.preventDefault();G("body")
.removeClass(t)})}return N}function I(aa){aa.element.addClass("s-view-selection-page");aa.addHeader(u.text("s.w.view.d.sel.header"));aa.addPanel(u.text("s.w.view.d.sel.current"),u.renderTemplate('<div class="s-view-abovelist"><h3>{s.w.view.d.sel.current.title}</h3><div class="s-manageview-description">{s.w.view.d.sel.current.description}</div></div><div class="s-manageview-list"></div>'));aa.addPanel(u.text("s.w.view.d.sel.my"),u.renderTemplate('<div class="s-view-abovelist"><h3>{s.w.view.d.sel.my.title}</h3><div class="s-manageview-description">{s.w.view.d.sel.my.description}</div></div><div class="s-manageview-list"></div>'));aa.addPanel(u.text("s.w.view.d.sel.associated"),u.renderTemplate('<div class="s-view-abovelist"><h3>{s.w.view.d.sel.associated.title}</h3><div class="s-manageview-description">{s.w.view.d.sel.associated.description}</div></div><div class="s-manageview-list"></div>'));aa.addPanel(u.text("s.w.view.d.sel.search"),u.renderTemplate(
'<div class="s-view-abovelist"><div class="s-manageview-search"><form class="aui ajs-dirty-warning-exempt" action="#"><div class="field-group"><label for="s-search-name">{s.w.view.d.sel.search.name}</label><input type="text" class="text" id="s-search-name" name="s-search-name"><div class="description">{s.w.view.d.sel.search.name.description}</div></div><div class="field-group"><input type="submit" value="{s.w.view.d.sel.search}" class="s-button"><input type="button" value="{s.w.view.d.sel.search.all}" class="s-button s-search-all"></div></form></div></div><div class="s-manageview-list"></div>'));aa.addButton(u.text("s.w.view.d.close"),ha);b(aa.panel[0],function(X){var ba=y.mG();if(ba&&ba.id=== -1)ba=null;X(ba&&[ba]||null)});b(aa.panel[1],function(X){K.nf(X)});b(aa.panel[2],function(X){K.mK(s.widget.currentStructure.id,X)});Z=aa.panel[3];R()}function R(){var aa=Z.body.find("div.s-view-abovelist form"),X=aa.find("#s-search-name"),ba=aa.find("input.s-search-all"),ea=false;b(Z,function(ra){if(ea)K.lU(ra);else{var ka=G.trim(X.val()||"");ka?K.nh(ka,ra):ra(false)}});aa.submit(function(ra){ea=false;Z.ky();ra.preventDefault();return false});ba.click(function(ra){ea=true;X.val("");Z.ky();
ra.preventDefault()})}function b(aa,X){aa.kI=new u.Cell(null);aa.kw=new u.Cell(false);aa.ky=function(){if(!aa.kw.value()){aa.kw.setValue(true);X(function(ba){aa.kw.setValue(false);aa.kI.setValue(ba)})}};aa.kI.pipeChanges(function(ba){aa.body.find(".s-manageview-list").html(F(y.kb(ba)))})};function i(aa){function X(ka,ca,ua){function f(Ga,oa){if(oa){var ta=u.mapArray(oa,function(Aa){return Aa.id});Ba.find(Ga+".s-unresolved-entity").each(function(){var Aa=G(this),za=ta[Aa.attr("data-s-id")];if(za){Aa.text(za.name);Aa.removeClass("s-unresolved-entity")}})}}var v,E=false,o=false;v="<ol>";for(var L=0,ga=ca.length;L<ga;L++){var ma=ca[L],va=ma.subject;if(va==="anyone"){v+=u.renderTemplate('<li><span class="s-perm-marker">{s.w.view.d.perm.list.anyone}</span><a href="#" class="s-perm-remove">{s.w.view.d.perm.list.remove}</a></li>');o=true}else if(va==="group")v+=u.renderTemplate('<li><span class="s-perm-marker">{s.w.view.d.perm.list.group}</span> <span class="s-perm-list-group">{groupId}</span><a href="#" class="s-perm-remove">{s.w.view.d.perm.list.remove}</a></li>',ma);else if(va==="projectRole"){v+=u.renderTemplate(
'<li><span class="s-perm-marker">{s.w.view.d.perm.list.project}</span> <span class="s-perm-list-project s-unresolved-entity" data-s-id="{projectId}">{projectId}</span> <span class="s-perm-marker">{s.w.view.d.perm.list.role}</span> <span class="s-perm-list-role s-unresolved-entity" data-s-id="{roleId}">{roleId}</span><a href="#" class="s-perm-remove">{s.w.view.d.perm.list.remove}</a></li>',ma);E=true}else v+=u.renderTemplate('<li>?<a href="#" class="s-perm-remove">{s.w.view.d.perm.list.remove}</a></li>')}o||(v+=u.renderTemplate('<li class="s-perm-list-default">{'+ua+"}</li>"));v+="</ol>";var Ba=G(v);if(E){s.widget.jiraConfig.mn(u.curry(f,"span.s-perm-list-project"));s.widget.jiraConfig.mB(u.curry(f,"span.s-perm-list-role"))}ka.empty().append(Ba)}function ba(ka,ca){for(var ua=ra.value()||[],f=[],v=a[ka],E=false,o=G.extend(ca,{rule:"set",level:ka}),L=ca.subject==="anyone",ga=0,ma=ua.length;ga<ma;ga++){var va=ua[ga],Ba=a[va.level];if(Ba){if(L&&Ba<=v)continue;if(!L&&va.subject==="anyone"&&Ba===v)continue;if(!E&&v<Ba){E=true;f.push(o)}}f.push(va)}E||f.push(o);ra.setValue(f)}aa.addHeader(u.text("s.w.view.d.det.header"));aa.addPanel("",u.renderTemplate(
'<form class="aui ajs-dirty-warning-exempt"><div class="s-view-det-top"><table><col width="1"><col width="*"><tr><td>{s.w.view.d.det.view}</td><td><div class="s-view-det-name"></div><div class="s-view-det-description"></div></td></tr><tr><td>{s.w.view.d.det.access}</td><td><span class="s-view-det-access"></span></td></tr></table></div><div class="aui-tabs horizontal-tabs"><ul class="tabs-menu"><li class="menu-item active-tab"><a href="#s-view-properties"><strong>{s.w.view.d.det.properties}</strong></a></li><li class="menu-item s-view-permission-tab"><a href="#s-view-permissions"><strong>{s.w.view.d.det.permissions}</strong></a></li><li class="menu-item s-view-associations-tab"><a href="#s-view-associations"><strong>{s.w.view.d.det.associations}</strong></a></li><li class="menu-item"><a href="#s-view-advanced"><strong>{s.w.view.d.det.advanced}</strong></a></li><li class="menu-item s-view-delete-tab"><a href="#s-view-delete"><strong>{s.w.view.d.det.delete}</strong></a></li></ul><div class="tabs-pane active-pane" id="s-view-properties"><div class="s-view-det-msg s-adjusted"><span class="s-adjusted-mark">*</span> <span>{s.w.view.adjusted-mark}</span></div><div class="field-group"><label for="s-view-det-name-input">{s.w.view.d.det.name}</label><input type="text" id="s-view-det-name-input" size="50" maxlength="255" class="text"></div><div class="field-group"><label for="s-view-det-description-input">{s.w.view.d.det.description}</label> <textarea id="s-view-det-description-input" cols="50" rows="4" class="textarea long-field"></textarea></div><div class="field-group"><label>{s.w.view.d.det.owner}</label><div class="checkbox s-view-det-owner"></div></div></div><div class="tabs-pane" id="s-view-permissions"><div class="s-view-perm-editable"><div class="s-view-det-msg s-view-msg-private">{s.w.view.stripe.shared.false} <a href="#" class="s-perm-share-all" title="{s.w.view.action.share-all.title}">{s.w.view.action.share-all.label}</a></div><div class="s-view-det-msg s-view-msg-shared">{s.w.view.stripe.shared.true} <a href="#" class="s-perm-share-all" title="{s.w.view.action.share-all.title}">{s.w.view.action.share-all.label}</a>|<a href="#" class="s-perm-share-none" title="{s.w.view.action.share-none.title}">{s.w.view.action.share-none.label}</a></div><div class="s-view-det-msg s-view-msg-public">{s.w.view.stripe.shared.public} <a href="#" class="s-perm-share-none" title="{s.w.view.action.share-none.title}">{s.w.view.action.share-none.label}</a></div><div class="field-group"><label>{s.w.view.d.perm.view.label:html}</label><div class="s-view-perm-view s-view-perm-control checkbox" data-s-level="view"><div class="s-perm-list"></div><div class="s-perm-add"></div></div></div> <div class="field-group"><label>{s.w.view.d.perm.edit.label:html}</label><div class="s-view-perm-edit s-view-perm-control checkbox" data-s-level="edit"><div class="s-perm-list"></div><div class="s-perm-add"></div></div> </div> <div class="field-group"><label>{s.w.view.d.perm.admin.label:html}</label><div class="s-view-perm-admin s-view-perm-control checkbox" data-s-level="admin"><div class="s-perm-list"></div><div class="s-perm-add"></div></div> </div> </div><div class="s-view-perm-uneditable" style="display:none"><div class="s-view-det-msg s-view-msg-uneditable">{s.w.view.shared.uneditable} <a href="#" class="s-perm-share-none" title="{s.w.view.action.share-none.title}">{s.w.view.action.share-none.label}</a></div><textarea rows="6" readonly="readonly" class="textarea long-field"></textarea></div></div><div class="tabs-pane" id="s-view-associations"><div class="s-view-det-msg">{s.w.view.d.det.assoc.desc:html} <a href="#" class="s-assoc-refresh" title="{s.w.view.d.det.assoc.refresh.title}">{s.w.view.d.det.assoc.refresh.label}</a></div><div class="s-view-assoc-loading"><div><span class="st-progress-icon"></span></div></div><div class="s-view-assoc-loaded"><div class="s-view-det-msg s-view-assoc-failed">{s.w.view.d.det.assoc.failed}</div><div class="field-group s-view-assoc-global"><label>{s.w.view.d.det.assoc.global.label}</label><div class="checkbox"><span>{s.w.view.d.det.assoc.global}</span><div class="s-assoc-admin"><a href="{defaultAdminUrl}" target="_blank" class="s-assoc-global s-newwindow" title="{s.w.view.d.det.assoc.global.open.title}">{s.w.view.d.det.assoc.global.open.label}<span></span></a></div></div></div><div class="field-group"><label>{s.w.view.d.det.assoc.structures.label}</label><div class="checkbox"><div class="s-view-not-assoc">{s.w.view.d.det.assoc.none}</div><div class="s-assoc-manage"><a href="" class="s-newwindow" title="{s.w.view.d.det.assoc.manage.title}" target="_blank">{s.w.view.d.det.assoc.manage.label}<span></span></a></div><table></table></div></div></div></div><div class="tabs-pane" id="s-view-advanced"><div class="s-view-det-msg s-view-advanced-warn">{s.w.view.d.det.advanced.warning:html}</div><div class="field-group s-spec-adjusted-group" style="display:hidden"><label>{s.w.view.d.det.spec.adjusted}</label><textarea rows="5" class="s-view-spec-adjusted textarea long-field" readonly="readonly"></textarea><div class="description">{s.w.view.d.det.spec.adjusted.desc}</div></div> <div class="field-group"><label>{s.w.view.d.det.spec}</label><textarea rows="6" class="s-view-spec textarea long-field"></textarea><div class="s-view-spec-error"><span>{s.w.view.d.det.spec.error}</span><a href="#" class="s-view-spec-restore">{s.w.view.d.det.spec.restore}</a> </div></div> </div><div class="tabs-pane" id="s-view-delete"><div class="s-view-det-msg">{s.w.view.d.det.delete.warning:html}</div><div class="s-view-delete"><input type="button" class="button" href="#" title="{s.w.view.d.sel.delete.title}" value="{s.w.view.d.sel.delete}"></div></div></div></form>',
{defaultAdminUrl:M.ajsbridge.localURL("/secure/admin/StructureDefaults.jspa")}));aa.addButton(u.text("s.w.view.d.det.back"),function(){if(D()){p(0);x(false)}},"s-view-det-back-btn");aa.addButton(u.text("s.w.view.d.det.apply"),function(){J()},"s-view-det-apply-btn");aa.addLink(u.text("sw.generic.cancel-action"),function(){N.curpage===1&& !D()||ha()},"s-view-det-cancel-link");aa=aa.element;pa={all:aa,topName:aa.find(".s-view-det-name"),adjusted:aa.find("div.s-adjusted"),topDescription:aa.find(".s-view-det-description"),topAccess:aa.find(".s-view-det-access"),name:aa.find("#s-view-det-name-input"),description:aa.find("#s-view-det-description-input"),owner:aa.find(".s-view-det-owner"),deleteTab:aa.find("li.s-view-delete-tab"),deletePane:aa.find("div#s-view-delete"),apply:aa.find(".s-view-det-apply-btn"),cancel:aa.find(".s-view-det-cancel-link"),form:aa.find("form"),permissionsTab:aa.find(".s-view-permission-tab"),nv:aa.find(".s-view-perm-editable"),lO:aa.find(".s-view-perm-uneditable"),mP:aa.find("div.s-view-msg-private"),nr:aa.find("div.s-view-msg-shared"),mq:aa.find("div.s-view-msg-public"),uneditableRules:aa.find("div.s-view-perm-uneditable textarea"),spec:aa.find(
"textarea.s-view-spec"),specError:aa.find("div.s-view-spec-error"),specWarn:aa.find("div.s-view-advanced-warn"),nq:aa.find("textarea.s-view-spec-adjusted"),ns:aa.find("div.s-spec-adjusted-group"),mO:aa.find(".s-view-associations-tab"),ib:aa.find("div#s-view-associations"),mT:aa.find("div.s-view-assoc-loading"),cz:aa.find("div.s-view-assoc-loaded")};pa.ownerGroup=pa.owner.closest("div.field-group");da.pipe(function(ka){var ca=ka&&ka.description||"";pa.topName.text(ka&&ka.name||"?");pa.topDescription.text(ca);pa.topAccess.html(j(ka));pa.adjusted.toggle(! !(ka&&ka.id&&y.nt(ka.id)));var ua=(ca=ka&&ka.owner)&&(ca.displayName||ca.name);if(ua){var f="";if(ca.avatarUrl)f+=ca.profileUrl?u.renderTemplate('<img class="user-hover s-avatar" rel="{name}" src="{avatarUrl}&size=small">',ca):u.renderTemplate('<img class="s-avatar" src="{avatarUrl}&size=small">',ca);f+=u.renderTemplate('<span class="s-view-det-user">{name}</span>',{name:ua});ca=f}else ca="";pa.ownerGroup.toggle(! !ca);pa.owner.html(ca);ca&&typeof T==="function"&&T(pa.ownerGroup);pa.permissionsTab.toggle(! !(ka&&ka.adminable&&s.widget.jiraConfig.isShareViewAllowed()));ia.setValue(null)});aa=new u.Cell(da,function(ka){return! !(ka&&
ka.adminable)});(new u.InputEnabler(aa)).setView(pa.name.add(pa.description));new u.ElementToggler(aa,pa.deleteTab);r();aa=new u.Cell(da,function(ka){return! !(ka&&ka.writable)});(new u.InputEnabler(aa)).setView(pa.spec);aa.pipe(function(ka){pa.specWarn.toggle(ka)});aa=new u.Cell(da,function(ka){return! !(ka&&ka.id>0)});new u.ElementToggler(aa,pa.mO);ja=new u.Cell(da,O,function(ka,ca){return ka&&ca&&(ca.adminable||ca.writable)&& !u.isDeeplySame(ka,ca)&&w(ca)});ja.pipe(function(ka){pa.apply.toggle(! !ka);pa.cancel.text(u.text(ka?"sw.generic.cancel-action":"s.w.view.d.close"))});new u.TextPresenter(O.fieldSubCell("name"),pa.name);new u.TextPresenter(O.fieldSubCell("description"),pa.description);var ea=O.fieldSubCell("spec");aa=new u.TextPresenter(ea);aa.getCellValue=function(){var ka=this.cell&&this.cell.value();return ka&&M.apputil.ct(ka)||null};aa.updateCell=function(ka){if(this.cell){var ca=null;if(ka)try{ca=M.JSON.parse(ka)}catch(ua){}this.cell.setValue(ca)}};aa.setView(pa.spec);(new u.Cell(ea,function(ka){return!ka})).pipe(function(ka){pa.specError.toggle(ka)});if(pa.specError.length)G(pa.specError[0]).on("click","a.s-view-spec-restore",function(){var ka=da.value();ea.setValue(
ka&&ka.spec)});O.pipe(function(ka){var ca=ka&&ka.id;ka=ka&&ka.spec;if(ca&&ka){ca=y.mZ(ka,ca);pa.ns.toggle(! !ca);pa.nq.text(M.apputil.ct(ca)||"")}});var ra=O.fieldSubCell("permissions");ra.pipe(function(ka){var ca=B(ka);if(ca){X(pa.all.find(".s-view-perm-view .s-perm-list"),ca.view,"s.w.view.d.perm.list.default.view");X(pa.all.find(".s-view-perm-edit .s-perm-list"),ca.edit,"s.w.view.d.perm.list.default.edit");X(pa.all.find(".s-view-perm-admin .s-perm-list"),ca.admin,"s.w.view.d.perm.list.default.admin");pa.mP.toggle(ca.isPrivate);pa.mq.toggle(ca.isPublic);pa.nr.toggle(!ca.isPublic&& !ca.isPrivate)}else pa.uneditableRules.val(M.apputil.ct(ka));pa.nv.toggle(! !ca);pa.lO.toggle(!ca)});new q(pa.all.find(".s-view-perm-view .s-perm-add"),s.widget,u.curry(ba,"view"));new q(pa.all.find(".s-view-perm-edit .s-perm-add"),s.widget,u.curry(ba,"edit"));new q(pa.all.find(".s-view-perm-admin .s-perm-add"),s.widget,u.curry(ba,"admin"));if(pa.all.length){aa=G(pa.all[0]);aa.on("click","a.s-perm-remove",function(ka){var ca=G(ka.target).closest("li"),ua=ca.closest("div.s-view-perm-control").attr("data-s-level");if(ca.length&&ua){ca=ca.index();for(var f=ra.value()||[],v=[],E=0,o=f.length;E<o;E++){var L=
f[E];if(ca>=0&&L.level===ua){ca--;if(ca<0)continue}v.push(L)}ra.setValue(v)}ka.preventDefault();return false});aa.on("click","a.s-perm-share-all",function(ka){ba("view",{subject:"anyone"});ka.preventDefault();return false});aa.on("click","a.s-perm-share-none",function(ka){ra.setValue([]);ka.preventDefault();return false})}pa.form.submit(function(ka){ka.preventDefault();ka.stopPropagation();J(function(){ha()})});l()}function r(){pa.deletePane.find("input").click(function(aa){var X=da.value();if(X&&X.adminable)U.confirm(u.text(X.shared?"s.w.view.d.delete.confirm.shared":"s.w.view.d.delete.confirm"))&&K.deleteView(X.id,function(ba){if(ba){p(0);x(false)}});aa.preventDefault()})}function l(){var aa=new u.Cell(pa.all.find("div.active-pane").attr("id"));Q.$(pa.all[0]).bind("tabSelect",function(){aa.setValue(pa.all.find("div.active-pane").attr("id"))});var X=false;(new u.Cell(aa,ia,da,function(ba,ea,ra){return ea===null&&ba==="s-view-associations"&&ra?ra.id:false})).pipe(function(ba){if(!(!ba||X)){X=true;K.nx(ba,function(ea){X=false;ia.setValue(ea||false)})}});ia.pipe(function(ba){var ea=ba!==null;pa.mT.toggle(!ea);pa.cz.toggle(ea);if(ea){pa.cz.find("div.s-view-assoc-failed").toggle(!ba);
ea=ba&&ba.associatedStructures;var ra=ba&&ba.associatedDefault;pa.cz.find("div.s-view-not-assoc").toggle(! !(ba&& !(ea&&ea.length)));pa.cz.find("div.s-view-assoc-global").toggle(! !ra);var ka="";ba=false;ra=s.widget.currentStructure.id;var ca=da.value()&&da.value().id;if(ea&&ea.length)for(var ua=0,f=ea.length;ua<f;ua++){var v=ea[ua];if(v.id===ra)ba=true;ka+=u.renderTemplate('<tr><th title="{description}"><a class="s-newwindow" href="{openurl}" target="_blank">{name}<span></span></a></th><td>',u.extend({},v,{openurl:M.ajsbridge.localURL("/secure/StructureBoard.jspa?s="+v.id+"&view="+ca)}));if(v.adminable)ka+=u.renderTemplate('<a class="s-newwindow" href="{link}" target="_blank">{s.w.view.d.det.assoc.str.open}<span></span></a>',{link:M.ajsbridge.localURL("/secure/StructureViews.jspa?id="+v.id)});ka+="</td></tr>"}pa.cz.find("table").html(ka);ea=pa.cz.find("div.s-assoc-manage");ea.toggle(s.widget.currentStructure.isAdminable()&& !ba);ea.find("a").attr("href",M.ajsbridge.localURL("/secure/StructureViews.jspa?id="+ra+"&addedView="+ca))}});s.widget.jiraConfig.isAdmin()||pa.cz.find("div.s-assoc-admin").hide();pa.ib.find("a.s-assoc-refresh").click(function(ba){ia.setValue(null);
ba.preventDefault();return false})}function j(aa){if(!aa)return "?";if(!aa.writable)return u.text("s.w.view.access.view");if(!aa.adminable)return u.text("s.w.view.access.edit");return u.text("s.w.view.access.admin")}function w(aa){if(!aa)return false;var X=aa.id;if(typeof X!=="number"||X<=0)return false;X=aa.name;if(!X||typeof X!=="string"|| !G.trim(X))return false;if(!aa.spec)return null;return true}function D(){if(!(ja&&ja.value()))return true;var aa=U.confirm(u.text("s.w.view.d.det.confirm-navigation"));if(aa){var X=da.value();O.setValue(X&&G.extend(true,{},X))}return aa}function J(aa){var X=O.value();if(ja&&ja.value()){W.setValue(true);var ba=function(ea){if(ea){m(ea.id,ea);u.safeCall(aa)}};if(X.adminable)K.saveView(X,ba);else X.writable&&K.mY(X.id,X.spec,ba)}}function c(){var aa=new Q.Dialog({width:840,height:520,id:A});aa.addPage();I(aa.page[0]);i(aa.page[1]);return aa}function p(aa){if(N.curpage!==aa){var X=aa?1:0,ba=N.page[X],ea=N.page[1-X],ra=ba.element.parent().width();ba.element.css({left:X?ra: -ra,borderRight:"1px solid #ddd",borderLeft:"1px solid #ddd"});ba.element.show();ba.element.animate({left:0},{step:function(ka){ea.element.css({left:ka+(X? -ra-1:ra+1)})},
duration:400,easing:"swing",complete:function(){ea.element.hide();ba.element.css({left:"","border-right":"","border-left":"","border-right-width":"","border-right-style":"","border-right-color":"","border-left-width":"","border-left-style":"","border-left-color":""});ea.element.css("left","")}});N.curpage=aa}}function g(aa){try{Q.tabs.change(Y.element.find(".tabs-menu .menu-item:first a"))}catch(X){u.warn(X)}n(aa);p(1)}function n(aa){if(!(aa===la&&W.value())){la=aa;u.Cell.prototype.multiUpdate(true);try{W.setValue(true);da.setValue(null);O.setValue(null)}finally{u.Cell.prototype.multiUpdate(false)}K.lD(aa,u.curry(m,aa))}}function m(aa,X){if(aa===la){u.Cell.prototype.multiUpdate(true);try{da.setValue(X);O.setValue(X&&G.extend(true,{},X));W.setValue(false)}finally{u.Cell.prototype.multiUpdate(false)}}}function F(aa){if(aa===false)return "";if(!aa|| !aa.length)return qa;for(var X="",ba=0,ea=aa.length;ba<ea;ba++){var ra;if(ra=aa[ba])if(ra.id){var ka=u.renderTemplate('<div class="s-manage-view" data-viewid="{id}">',ra),ca=ra.id===y.fi();ca=u.renderTemplate('<span class="s-current-icon'+(ca?"":" s-notcurrent")+'" title="'+(ca?"{s.w.view.d.sel.current.state}":"")+'"></span>');var ua=
void 0,f=void 0;if(ra.shared)if(ra.sharedWithAll){ua="{s.w.view.stripe.shared.public}";f="s-public"}else{ua="{s.w.view.stripe.shared.true}";f="s-shared"}else{ua="";f="s-private"}ua=u.renderTemplate('<span class="s-sharing '+f+'" title="'+ua+'"></span>');ka+=u.renderTemplate('<div class="s-view-details"><button data-s-action="view.manage.show" rel="{id}">{s.w.view.d.sel.details}</button></div>',ra);ka+='<div class="s-name">'+ca+ua+u.renderTemplate('<a href="#" data-s-action="view.switch" rel="{id}">{name}</a>',ra);if(ra._adjusted)ka+=u.renderTemplate('<span class="s-adjusted-mark" title="{s.w.view.adjusted-mark}">*</span>');ka+="</div>";ka+=ra.description?u.renderTemplate('<div class="s-description">{description}</div>',ra):'<div class="s-description">&nbsp;</div>';ka+="</div></div>";ra=ka}else ra="";else ra="";X+=ra}return X}function x(aa){var X=N.getCurrentPanel();if(X&&X.ky){if(aa)if(aa=X.kI.value())aa.forceUpdate=(new Date).getTime();X.ky()}}function H(){Q.tabs.setup();var aa=G(S.element[0]);aa.on("mouseover","div.s-manage-view",function(){var X=G(this),ba=X.parent().find("div.s-manage-view.s-active");if(!ba.length||ba[0]!==this){ba.removeClass("s-active");X.addClass("s-active")
}});aa.on("click","div.s-manage-view",function(X){if(!(!X||X.isDefaultPrevented()|| !X.target||G(X.target).is("a,:button"))){var ba=u.toIntSafe(G(X.currentTarget||X.target).attr("data-viewid"),0);ba&&g(ba);X.preventDefault();return false}})}function ha(){N.hide()}var y=s.bW(),K=s.widget.jT,N,S,Y,Z;s.widget.jiraConfig.isCreateViewAllowed();var la=0,da=new u.Cell(null),O=new u.Cell(null),W=new u.Cell(false),ia=new u.Cell(null),ja,pa,na=true,qa=u.renderTemplate('<div class="s-manage-viewlist-empty">{s.w.view.list.empty}</div>');G.extend(this,{reset:function(aa,X){var ba=z();ba.gotoPanel(0,0);aa&&ba.gotoPanel(1,0);n(aa);if(X){ba=Y.element.find('.tabs-menu a[href="'+X+'"]');if(ba.length)try{Q.tabs.change(ba)}catch(ea){u.warn(ea)}}},show:function(){var aa=z();try{aa.show()}catch(X){u.warn("Exception while showing view dialog",X);if(X.number!== -2146826178)throw X;}if(na){na=false;H()}x(true);G("body").addClass(t)}});s.bD().addListener(new u.Life,this);this[P.mx]=function(){S.element.is(":visible")&&x(true)};s.ah().register("view.manage.show",function(aa){aa=u.toIntSafe(aa&&G(aa.target).attr("rel"),0);aa!==0&&g(aa)})}})(window);(function(){function U(t){t=e.getStored(t);var d;try{d=
e.JSON.parse(t)}catch(a){}if(d&&typeof d.timestamp==="number"&&typeof d.stats==="object")return d;return null}function C(){var t=new Date;t.setMilliseconds(0);t.setSeconds(0);t.setMinutes(0);t.setHours(0);return t.getTime()}function h(t){if(t&&typeof t==="string"){P.stats[t]=(P.stats[t]||0)+1;T()}}function k(t,d){e.setStored(t,e.apputil.ct(d))}var e=namespace("almworks.structure"),B=namespace("almworks.structure.appevents"),q=namespace("almworks.util"),M=new e.ajax.AJAX,u=0,P=U("statistics.currentData")||{timestamp:C(),stats:{}},G=U("statistics.prevData"),Q={};Q[B.ACTION]=h;Q[B.gS]=function(t){if(t)if(q.isArray(t))for(var d=0,a=t.length;d<a;d++)h(t[d]);else h(t)};var T=q.delayed(1E3,function(){var t=C();if(t!==P.timestamp){G=P;P={timestamp:t,stats:{}};k("statistics.prevData",G);A()}k("statistics.currentData",P)}),A=q.delayed(12E4,function(){var t=new M.Task(e.ajax.RESOURCES.STATISTICS+"/record",e.ajax.UPLOAD,function(){G=null;k("statistics.prevData",G);u=0},function(){u++;if(u<3)A();else{q.warn("failed to send usage statistics to server");G=null;k("statistics.prevData",G);u=0}});t.type="POST";t.data=e.apputil.ct(G);M.addTask(t)});G&&A();e.oD=function(t){t.addListener(new q.Life,Q)}
})();(function(U,C){function h(A){e.setStored("perspective.structurePageId",A)}function k(){var A=U.location;return A.protocol+"//"+A.host+A.pathname+"?p="}var e=namespace("almworks.structure",false),B=namespace("almworks.structure.$",false),q=namespace("almworks.util",false);namespace("AJS",false);var M=namespace("AJS.InlineDialog",false),u=namespace("AJS.$",false),P,G=function(A){A&&A.stopPropagation()},Q=q.renderTemplate('<div class="s-inline-dialog"><div class="s-inline-dialog-content"><div class="s-persp-success-title">{s.p.dialog.success.title}</div><input type="text" class="text s-persp-link" spellcheck="false" value="" readonly><div class="s-persp-success-desc">{s.p.dialog.success.desc:html}</div></div><div class="s-inline-dialog-footer"><input class="s-inline-dialog-close" type="button" value="{s.w.uisettings.close}"/></div></div>'),T=q.renderTemplate(
'<div class="s-inline-dialog"><div class="s-inline-dialog-content"><div class="s-persp-error-title">{s.p.dialog.error.title}</div><div class="s-persp-error-msg">{s.p.dialog.error.msg}</div></div><div class="s-inline-dialog-footer"><input class="s-inline-dialog-close" type="button" value="{s.w.uisettings.close}"/></div></div>');e.addPerspectiveConfig=function(A,t,d){if(A)if(q.toIntSafe(e.getStored("perspective.id"),0)===A){d.lE=true;try{d.originalPerspectiveSpec=e.JSON.parse(t)}catch(a){q.warn("Cannot read original perspective",a)}}else{var s;try{s=e.JSON.parse(t)}catch(z){P=z;return}e.setStored("perspective.id",A.toString(),true);h(s.structurePageId);d.lE=true;d.perspectiveSpec=s;if(!s.master){P="No master panel spec";s.master={}}}};e.installPerspectives=q.seq(function(A){P&&A.errorCentral.reportError(new e.error.AppError(q.text("s.p.error.init"),P))},function(A){function t(b){z.toggle(b);s.toggle(!b);a.toggleClass("s-no-bganim",!b)}function d(b,i,r){var l,j=new A.ajax.Task(e.ajax.RESOURCES.PERSPECTIVE+"/share",e.ajax.UPLOAD,function(w){l=w&&w.id});j.type="POST";j.chainComplete(function(){t(false);a.attr("aria-pressed","true");i.html(l?Q:T);i.width(450);r();A.ni.lV(R,R.hide);
i.click(G);u(".s-inline-dialog-close",i).click(R.hide);if(l){var w=u("input:text",i);w.val(I+l);var D=function(){w.select()};w.click(D);U.setTimeout(D,0)}});j.data=e.apputil.ct(b);A.ajax.addTask(j)}var a=B("#s-share-perspective");if(a.length)var s=B(".s-share-icon",a),z=B(".aui-icon-wait",a),I=k(),R=M(u("#s-share-perspective"),"s-share-perspective",function(b,i,r){if(a.attr("aria-pressed")==="true"){U.setTimeout(R.hide,0);return false}t(true);i=A;var l={};l.master={};var j=i.bF.outsideShown.value();if(j)l.slave={};i.bF.lb(l);i.master.getTableConfig().lb(l);i.master.ao().lb(l);j&&i.slave.ao().lb(l);i.jT.lb(l);i.aw.lb(l);l.structurePageId=e.modes.getStructurePageId();j={};j.structureId=i.getStructureId();j.spec=l;d(j,b,r);return false},{cacheContent:false,persistent:true,hideCallback:function(){A.ni.popupHidden(R);a.removeAttr("aria-pressed")}})});e.iw=function(A,t,d){var a=A.config.perspectiveSpec,s=a[t]===C?"Perspective property is missing.":"Problem with perspective property.";if(d)t+="."+d;try{a=e.apputil.ct(a)}catch(z){a="Could not prepare details"}A.errorCentral.reportError(new e.error.AppError(q.text("s.p.error.restore"),s+"\nKey: "+t+"\nSpec: "+a))};e.oh=function(A){return A?
A.structurePageId:e.getStored("perspective.structurePageId")};e.setPerspectiveStructurePageId=h})(window);(function(){function U(Q,T,A){var t=Q[T];Q[T]=function(){var d=A.call(this,t,Array.prototype.slice.call(arguments));Q[T]=t;return d}}function C(Q,T,A,t,d,a,s,z){var I=e.text("s.w.editor.dialog.title"),R=(new M.Forms.Container(function(){function b(){R._unassignEvents("container",document);R._unassignEvents("trigger",R.options.trigger)}function i(){B(document).off("keydown.stcreatedialog").on("keydown.stcreatedialog",function(m){if(e.keyboardCodeFromEvent(m)===u){B("#st-switch-to-inline").click();m.stopImmediatePropagation();m.preventDefault();return false}return true})}function r(){B(document).off(".stcreatedialog")}function l(m,F,x){var H=m[F];m[F]=function(){H.apply(this,arguments);x.apply(this,arguments)};p.push([m,F,H]);return function(){H.apply(m,arguments)}}var j=["QuickCreateIssue"],w=new M.Forms.CreateIssueModel({projectId:Q,issueType:T}),D=[];if(!e.isEmpty(A))if(A.filetoconvert){U(w,"getFieldsResource",function(m){return m()+"&toggle=true"});D=e.isArray(A.filetoconvert)?A.filetoconvert:[A.filetoconvert]}U(w,"refresh",function(m){var F;if(e.isEmpty(A))F=[];else{var x=
e.keysOf(A),H=A.fieldsToRetain;F=[B.param(B.extend({retainValues:true,fieldsToRetain:H?e.unionShortArrays(x,H):x},A),true)]}var ha=this;if(a){var y=q.$.Deferred();a.jiraConfig.mn(function(K){ha._structureProjects=e.mapArray(K,function(N){return N.id});m.apply(ha,F).then(function(){y.resolveWith(this,arguments)},function(){y.rejectWith(this,arguments)},function(){y.notifyWith(this,arguments)})});return y.promise()}return m.apply(ha,F)});var J=new M.Forms.ConfigurableCreateIssueForm({model:w,title:I,globalEventNamespaces:j}),c=new M.Forms.UnconfigurableCreateIssueForm({model:w,title:I,globalEventNamespaces:j}),p=[],g=l(R,"hide",function(m,F){if(M.Dialog.current===null){if(F&&F.reason&&(F.reason===M.Dialog.HIDE_REASON.cancel||F.reason===M.Dialog.HIDE_REASON.escape)){r();s.cancel()}b()}});z.hide=e.curry(g,true,{reason:M.Dialog.HIDE_REASON.cancel});var n=null;B.each([J,c],function(m,F){q.$(F).on("rendered.stcreatedialog",function(x,H){q.$(F).off("rendered.stcreatedialog");var ha=D,y=H.find("#qf-field-attachment .file-input-list #attachment_div");if(y.length!==0){e.isArray(ha)||(ha=[ha]);for(var K=0;K<ha.length;++K){var N=y.find("label[for=filetoconvert-"+ha[K]+"]"),S=G[ha[K]];S&&
N.after(S)}G={}}i()});l(F.helper,"decorate",function(){if(F.model._structureProjects){var x=false;try{var H=this.getProjectField().find("option").filter(function(){return!F.model._structureProjects[B(this).attr("value")]});if(H.length){H.remove();x=true}else x=a.jiraConfig.filterProjectsSelectionJira64(F.getForm(),F.model._structureProjects)}catch(ha){e.warn("error changing available projects: "+ha)}if(x)q.$(F).off("rendered.stinjectprojtip").on("rendered.stinjectprojtip",function(K,N){N.find(".qf-field-project > .field-group").append(e.renderTemplate('<div class="description">{s.w.editor.dialog.filtered.projects.desc}</div>'))})}x=B('<div id="st-create-buttons"></div>');F.$element.find("#qf-create-another").parents(".buttons").parent().prepend(x);H=B(e.renderTemplate('<input class="button" id="st-switch-to-inline" name="StInline" type="button" value="{s.w.editor.dialog.inline}" title="{s.w.editor.dialog.inline.tooltip}" />'));var y=B(e.renderTemplate('<a href="#" id="st-create-nostruct" title="{s.w.editor.dialog.nostruct.tooltip}">{s.w.editor.dialog.nostruct}</a>'));H.click(function(){for(var K=F.getForm().serializeArray(),N=K.length,S={},Y=0;Y<N;++Y){var Z=K[Y];if(
S.hasOwnProperty(Z.name))if(e.isArray(S[Z.name]))S[Z.name].push(Z.value);else S[Z.name]=[S[Z.name],Z.value];else S[Z.name]=Z.value;if(Z.name==="filetoconvert"){Z=Z.value;var la=B("#filetoconvert-"+Z);if(la.is('input[type="checkbox"]')){la=la.closest("div.field-group");if(la.length!==0){la=la.find("label").nextAll();if(la.length)G[Z]=la}}}}K=F.getActiveFieldIds();S.fieldsToRetain=K;for(Y=0;Y<K.length;++Y)if(typeof S[K[Y]]==="undefined"&&P[K[Y]]&& !F.getForm().find('[name="'+K[Y]+'"]').length)S[K[Y]]="";e.extendOwn(S,{projectId:Q,issueType:T});g(true,{reason:"structure-switch-to-panel"});b();r();s.inline(S,n);return false});y.click(function(){try{J.title=c.title=M.Forms.createCreateIssueForm({}).options().configurableForm.title}catch(K){J.title=c.title=e.text("s.w.editor.new.title")}q.$(F).off("rendered.stinjectprojtip");for(var N=0;N<p.length;++N){var S=p[N];S[0][S[1]]=S[2]}r();s.cancel();F.render(F.serialize(true));return false});x.prepend(y).prepend(H);if(t){M.applyErrorsToForm(F.getForm(),t);F.triggerEvent("validationError",[F,t],true)}d&&M.applyMessageToForm("warning",F.getForm(),e.text("s.w.editor.dialog.clone.disabled"),true)});l(F.helper,"handleSubmitSuccess",function(x){r();
s.submit(e.toInt(x.createdIssueDetails.id),w.isInMultipleMode())});l(F.helper,"setProjectId",function(x){Q=e.toInt(x);s.onProjectId(Q)});l(F.helper,"setIssueType",function(x){T=e.toInt(x);s.onIssueType(T)});F.bind("validationError",function(x,H,ha){n=ha})});return{globalEventNamespaces:j,model:w,errorHandler:new M.Forms.CreateIssueError,configurableForm:J,unconfigurableForm:c}})).asDialog({trigger:document.createElement("a"),id:"create-issue-dialog",windowTitle:I});R.show()}var h=namespace("almworks.structure");namespace("almworks.structure.api");var k=namespace("almworks.structure.appevents"),e=namespace("almworks.util"),B=h.$,q=e.requireGlobal("AJS"),M=window.JIRA,u=e.keyboardCodeFromString("alt+enter"),P=e.flipSet(["project","timetracking","issuelinks","attachment","worklog"]);if(M){var G={};h.openCreateIssueDialog=function(Q,T,A,t,d,a,s,z){try{if(typeof M.Forms!=="object"||typeof M.Forms.Container!=="function"||typeof M.Forms.CreateIssueModel!=="function"||typeof M.Forms.UnconfigurableCreateIssueForm!=="function"||typeof M.Forms.ConfigurableCreateIssueForm!=="function")throw "Unsupported JIRA API found";C(Q,T,A,t,d,a,s,z)}catch(I){e.warn(
"Failed to open JIRA Create Issue Dialog: "+I);h.openCreateIssueDialog=null;if(s){s.inline&&s.inline(A,t);s.openFailed&&s.openFailed()}}};h.installCreateIssueHandler=function(Q){q.$("a.create-issue").prepend("+&nbsp;").on("simpleClick",function(T){if(!Q)return true;var A=Q.aw.getFocusedPanel();if(!A)return true;A=A.bD();if(!A)return true;A.fireEvent(k.ACTION,"createSiblingBelowWithDialog",T);if(T.consumed){T.stopImmediatePropagation();return false}return true})}}else{h.openCreateIssueDialog=null;h.installCreateIssueHandler=null}})();(function(U,C){function h(f){this.value=f;this.visible=f===3}function k(){return qa.issueId.value()}function e(){x.eachOwn(qa,function(f){qa[f].debug(Z?f:null)})}function B(){function f(){var o=Y.Meta&&Y.Meta.get("viewissue-max-cache-size")||ka.IssueViewerMaxCacheSize;aa.viewIssueData=new S.Issues.ViewIssueData({maxCacheSize:o});aa.saveInProgressManager=new S.Issues.SaveInProgressManager;aa.issueModule=new S.Issues.IssueModule({container:O,saveInProgressManager:aa.saveInProgressManager,viewIssueData:aa.viewIssueData});aa.viewIssueController=aa.issueModule.viewIssueController;aa.getEditIssueController=function(){
return aa.viewIssueController.getSelectedEditIssueController()};aa.issueModuleShowsError=function(L){return aa.viewIssueController._shouldReplaySaveError(L)};aa.getIssueId=function(){return aa.viewIssueController.getSelectedIssue().getId()};aa.getIssueEntity=function(){var L=aa.viewIssueController.getViewIssueModel();return L&&L.getEntity()}}function v(){Y.Meta&& !Y.Meta.get("viewissue-max-cache-size")&&Y.Meta.set("viewissue-max-cache-size",ka.IssueViewerMaxCacheSize);S.Issues.Application.start();aa.application=S.Issues.Application;aa.issueModule=S.Issues.Application.request("issueEditor");aa.viewIssueData=aa.issueModule.viewIssueData;aa.saveInProgressManager=aa.issueModule.saveInProgressManager;aa.getEditIssueController=x.returnConst(aa.issueModule);aa.issueModuleShowsError=function(o){var L=aa.issueModule.deferredErrorController;return L?L.view&&L.issueEntity.id===o:false};aa.getIssueId=function(){return aa.issueModule.model&&aa.issueModule.model.getId()};aa.getIssueEntity=function(){return aa.issueModule.model&&aa.issueModule.model.getEntity()}}function E(){S.Issues.Application.on("issueEditor:saveSuccess",function(o){S.trigger(S.Events.ISSUE_REFRESHED,[o.issueId])});
S.Issues.Application.on("issueEditor:saveError",function(o){o.deferred||S.trigger(S.Events.ISSUE_REFRESHED,[o.issueId])});S.Issues.FocusShifter.init();aa.issueModule.setContainer(O)}if(S.Issues.IssueModule)f();else if(S.Issues.Application){v();E()}else throw "Cannot initialize issue viewer: JIRA Javascript objects not found. Perhaps this version of JIRA is not supported.";}function q(){var f={getSelectedIssue:function(){var v=qa.selectedIssue.value();return new S.Issues.SimpleIssue({id:v&&v.id,key:v&&v.key})},getSelectedIssueId:k,getSelectedIssueKey:x.withThis(qa.issueKey,qa.issueKey.value),hasSavesInProgress:function(){return aa.saveInProgressManager.hasSavesInProgress()},isCurrentlyLoadingIssue:function(){return aa.issueModule.isCurrentlyLoading()||H.oH.shouldBlockActions()},isSelectedIssueAccessible:function(){var v=qa.enabled.value(),E=qa.selectedIssue.value();return! !(v&&E&&E.key)},issueIsVisible:function(){return qa.visibility.value().visible},nextIssue:x.noop,prevIssue:x.noop,openFocusShifter:function(){qa.visibility.value().visible&&S.Issues.FocusShifter.show()},getFieldsOnSelectedIssue:function(){var v=aa.getEditIssueController();return(v=v&&v.getFields())&&v.length?v:
void undefined},editFieldOnSelectedIssue:function(v){var E=f.getFieldsOnSelectedIssue();(E=(v=E&&E.get(v))&&v.isEditable())&&aa.issueModule.editField(v);return E},refreshSelectedIssue:function(v){return qa.visibility.value().visible?aa.issueModule.refreshIssue(v):Y.$.Deferred().resolve().promise()},returnToSearch:x.noop,showInlineIssueLoadError:function(){var v=namespace("JIRA.Templates.ViewIssue.Body").errorsLoading({});namespace("JIRA.Messages").showErrorMsg(v,{closeable:true})},switchLayouts:x.noop,isQueryValid:x.returnTrue,isFullScreenIssueVisible:x.returnTrue,viewSelectedIssue:x.noop,toggleFilterPanel:x.noop,updateIssue:x.noop,waitForSavesToComplete:function(){var v=Y.$.Deferred();U.setTimeout(function(){S.Issues.Api.hasSavesInProgress()?S.bind(S.Events.INLINE_EDIT_SAVE_COMPLETE,function(){S.Issues.Api.hasSavesInProgress()||v.resolve()}):v.resolve()},10);return v},focusSearch:function(){X.widget.bF.visibleCell.value()&&X.widget.bF.focusSearch()}};x.extendOwn(namespace("Issues.Api",S),f);if(!S.Issues.LayoutPreferenceManager)S.Issues.LayoutPreferenceManager={getPreferredLayoutKey:x.returnConst("split-view"),setPreferredLayoutKey:x.noop}}function M(){if(typeof la==="undefined"){
var f=N("body").attr("data-version");if(f){var v=f.indexOf(".");f=x.toIntSafe(f.substring(0,v),0);la= !f||f>=7}else la=true}return la}function u(f){function v(){var o;try{o=U.require("dndattachment/dropzones/AttachmentsDropZone")}catch(L){}if(o){var ga=o.prototype&&o.prototype.connectContainer;if(ga)o.prototype.connectContainer=function(){if(this){ga.apply(this,arguments);try{var ma=this.$windowMask;ma.detach();Y.$(da[0]).append(ma);ma.addClass("s-show-on-dnd")}catch(va){x.warn("problem relocating drag-and-drop window mask",va)}}}}}function E(o){try{S.Issues.Application.on("issueEditor:linkToIssue",function(ga){ga=ga&&ga.issueKey;try{var ma=K.issueURL(ga);if(ma){ha.jJ(o,ga);U.location.href=ma}}catch(va){x.warn("could not navigate to "+ga,va)}})}catch(L){x.warn("cannot set up navigation workaround",L)}}(function(){S.Issues.overrideIssueDialogs({getIssueId:k,isNavigator:true,updateIssue:function(o){var L=qa.enabled.value()&&k();return(L?T(L,o):Y.$.Deferred().reject()).promise()}})})();S.Dialogs.BeforeShowIssueDialogHandler&&S.Dialogs.BeforeShowIssueDialogHandler.add(S.Issues.Api.waitForSavesToComplete);(function(){Y.KeyboardShortcut&&Y.KeyboardShortcut.addIgnoreCondition(function(o,
L,ga){return ga==="issueaction"&&S.Issues.Api.isCurrentlyLoadingIssue()})})();(function(){var o=N(C).find("fieldset.hidden input[title=baseURL]");o=o.length?o.attr("value"):null;var L=namespace("AJS.Meta",false);x.debug("baseUrl="+o);o&&L&&(new x.Cell(qa.selectedIssue,qa.enabled,function(ga,ma){return ma?ga:null})).pipeChanges(function(ga){L.set("viewissue-permlink",o+"/browse/"+(ga&&ga.key||""))})})();if(!S.Issues.IntroDialog)S.Issues.IntroDialog={};if(!S.Issues.IntroDialog.dialogs)S.Issues.IntroDialog.dialogs=[];(function(){O.on("focus","#addcomment textarea",function(){W.scrollTop(W.prop("scrollHeight"))})})();(function(){function o(ma,va,Ba){var Ga=aa.viewIssueController.unhandledSaveError;if(!(!Ga||Ga.getId()!==ma)){ea.unhandledSaveErrors[ma]=Ba;if(Ba=Ga&&Ga.$el){Ba.unbind("click");Ba.on("click",".fix, .issue-key",function(){L(ma,va);return false});Ba.on("click",".ignore",function(){Ga.hide();ga(ma)});Ba.find(".icon-close").click(function(){ga(ma)})}}};function L(ma,va){qa.enabled.setValue(true);k()!==ma?X.master.ao().jZ(ma):P({id:ma,key:va})}function ga(ma){delete ea.unhandledSaveErrors[ma]}p(aa.saveInProgressManager,"saveError",function(ma,va,Ba,Ga){Ba={fields:Ba,response:
Ga};if(aa.viewIssueController)o(ma,va,Ba);else if(aa.issueModule.deferredErrorController){Ga=aa.issueModule.deferredErrorController;if(!(!Ga.issueEntity||Ga.issueEntity.id!==ma|| !Ga.view)){ea.unhandledSaveErrors[ma]=Ba;Ga.stopListening(Ga.view,"fixError");p(Ga.view,"fixError",x.curry(L,ma,va));p(Ga.view,"close",x.curry(ga,ma));Ga.view.$el.click(x.returnFalse)}}else ea.unhandledSaveErrors[ma]=Ba});(function(){if(aa.issueModule._showSaveError)aa.issueModule._showSaveError=function(ma){var va=(new S.Components.IssueEditor.Views.SaveError(ma)).render();aa.issueModule.listenTo(va,{issueLinkClick:function(Ba){L(Ba.id,Ba.key)},close:function(){aa.issueModule.stopListening(va)}})}})();p(aa.saveInProgressManager,"saveSuccess",ga);g(S,"inlineEditCancelled",function(){var ma=aa.getIssueId();ma&&ga(ma)})})();(function(){qa.enabled.pipe(function(o){if(!o)if(aa.viewIssueController)(o=aa.viewIssueController.getSelectedIssue())&&o.set({id:null,key:null});else aa.issueModule.model&&aa.issueModule.model.resetToDefault&&aa.issueModule.model.resetToDefault()})})();(function(){if(aa.viewIssueController){var o=aa.viewIssueController._initIssueObjects;if(N.isFunction(o))
aa.viewIssueController._initIssueObjects=x.withThis(aa.viewIssueController,function(){var ma=o.apply(this,arguments),va=this.issueView&&this.issueView.header;if(va&&N.isFunction(va.updateWindowTitle))va.updateWindowTitle=x.noop;return ma})}else if(aa.issueModule.issueController){var L=aa.issueModule.issueController,ga=L._createViews;if(N.isFunction(ga))L._createViews=x.withThis(L,function(){var ma=ga.apply(this,arguments);if(this.headerView&&N.isFunction(this.headerView._updateWindowTitle))this.headerView._updateWindowTitle=x.noop;return ma})}})();(function(){function o(){var va=aa.viewIssueController.showLoadingIndicator;if(va&&N.isFunction(va))aa.viewIssueController.showLoadingIndicator=x.noop}function L(va,Ba){function Ga(){if(oa){U.clearTimeout(oa);oa=null}}var oa=null;this.schedule=function(){Ga();oa=U.setTimeout(Ba,va)};this.cancel=Ga}aa.viewIssueController&&o();var ga=new L(1E3,x.curryThis(da,da.addClass,ba.loading));(new x.Cell(qa.visibility,function(va){return!va.is(h.ISSUE_LOADED)})).pipe(function(va){da.removeClass(ba.loading);ga.cancel();va&&ga.schedule()});var ma=new L(500,x.curryThis(da,da.addClass,ba.opaque));(new x.Cell(qa.visibility,function(va){return!va.is(
h.ISSUE_LOADED)||va.is(h.DISABLED)||va.is(h.ou)})).pipe(function(va){da.toggleClass(ba.disable,va);if(va)if(qa.visibility.value().is(h.ou)){da.removeClass(ba.opaque);ma.schedule()}else{da.addClass(ba.opaque);ma.cancel()}else{da.removeClass(ba.opaque);ma.cancel()}});qa.visibility.pipe(function(va){da.toggleClass(ba.noSelection,va.is(h.oI))})})();if(M()){v();E(f)}}function P(f){var v=ea.unhandledSaveErrors[f.id];(aa.issueModuleShowsError(f.id)||v?ca:G)(f,v)}function G(f,v){qa.visibility.applyUpdate(pa.remove,h.ISSUE_LOADED|h.ou);ea.pb.cycle();Q(f,v).pipe(function(){var E=Y.$.Deferred();ea.pb.life().addDetach(x.withThis(E,E.reject));var o=ea.nU[f.id];if(o){E.always(function(){o.state.applyUpdate(na.remove,ra.WAITING_FOR_ISSUE_MODULE)});return d(E)}else return E.resolve()}).always(function(){qa.visibility.applyUpdate(pa.add,h.ISSUE_LOADED)})};function Q(f,v){var E,o;if(aa.viewIssueController){o=aa.viewIssueController.load({id:f.id,key:f.key,splitViewMode:true},v&&v.response);E=a(o,aa.issueModule.getLoading()._getPending())}else{o=aa.issueModule.loadIssue(f);if(v&&aa.issueModule.fieldsLoader){E=Y.$.Deferred();aa.issueModule.fieldsLoader.once("fieldsLoaded",function(L){if(L.fields&&
L.fields.length)if(L=aa.issueModule.deferredErrorController)L.trigger("replaySaveError",f,v.fields,v.response);else aa.issueModule.eventBus?aa.issueModule.eventBus.trigger("saveError",f.id,v.fields,v.response):x.warn("Cannot display stored unhandled save error");E.resolve()})}else E=o}return E}function T(f,v){var E=Y.$.Deferred(),o=S.Issues.Utils.getUpdateCommandForDialog(v);o.key=o.key||qa.issueKey.value();o.id=o.id||f;f=o.id;E.always(function(){o.message&&S.Issues.showNotification(o.message,o.key)});A(f,E,true);t(f,o);X.eventBus.fireEvent(y.ISSUE_DETAILS_EDIT_STOPPED);X.eventBus.fireEvent(y.kD);return E}function A(f,v,E){var o=ea.nU[f];if(!o|| !o.state.value()){ea.nU[f]=o={future:v,state:(new x.Cell(ra.WAITING_FOR_ISSUE_MODULE|ra.WAITING_FOR_STRUCTURE)).pipeChanges(function(L){if(!L){o.future&&o.future.resolve();o===ea.nU[f]&&delete ea.nU[f]}}).debug(Z&&"pendingUpdate#"+f)};Z&&x.debug("Added pendingUpdate#"+f)}else{E&&x.warn("IssueDetails: new update for issue",f,"expunging old update");if(o.future)s(v,o.future);else o.future=v}}function t(f,v){var E=X.az.getIssueKey(f);if(E){v=v||{action:S.Issues.Actions&&S.Issues.Actions.UPDATE||"update",id:f};var o=
aa.viewIssueData.pendings[E];if(o&&o.state()==="pending")o.always(x.curry(t,f,v));else{o=v;var L=ea.nU[f],ga,ma=aa.getIssueEntity();if(!aa.issueModule.isCurrentlyLoading()&&ma&&ma.id===f){aa.issueModule.refreshIssue(o);ga=d(N.Deferred())}else if(ma)ga=aa.viewIssueData.get(E,true,x.extend(o,{issueEntity:ma,reason:o.action,detailView:true}));L&&ga.done(x.curryThis(L.state,L.state.applyUpdate,na.remove,ra.WAITING_FOR_ISSUE_MODULE))}}}function d(f){if(aa.issueModule.getUpdating)return a(f,aa.issueModule.getUpdating()._getPending());else if(aa.issueModule.issueLoader){var v=aa.issueModule.issueLoader._updatingPromise;return s(f,v&&v._getPending())}else return f}function a(f,v){var E=v&&v.original;E&&s(f,E);return f}function s(f,v){return v.done(f.resolve&&x.withThis(f,f.resolve)).fail(f.reject&&x.withThis(f,f.reject))}function z(){function f(ga,ma){Z&&x.debug("onFocusedIssueUpdated","focusedId","=",ga,"oldFocusedId","=",ma);if(!X.widget.dJ.isDragging()){ga=v(ga,ma);E(ma)&&o(ga)}};function v(ga,ma){ea.ov.cycle();if(ga&& !I(ga)){var va=ga;ga=null;X.eventBus.addListener(ea.ov,y.aX,function(Ba){x.contains(Ba,va)&&f(va,ma)})}return ga}function E(ga){if(ga&&ga===k())if(!
aa.issueModule.canDismissComment()){U.setTimeout(function(){X.master.ao().jZ(ga);S.Issue.CommentForm&&S.Issue.CommentForm.focus()},100);return false}return true}function o(ga){ea.oB.cycle();if(ga>0){var ma=X.az.getIssueKey(ga),va={id:ga,key:ma};if(ma)x.deepEquals(qa.selectedIssue.value(),va)||L(null);else{X.eventBus.addListener(ea.oB,y.aX,function(Ga){x.contains(Ga,ga)&&f(ga)});var Ba=U.setTimeout(x.curry(L,"noKey"),1E3);ea.oB.life().addDetach(function(){U.clearTimeout(Ba)});L(null,true)}qa.selectedIssue.setValue(va)}else{L(ga<0?"newIssue":"noFocused");qa.selectedIssue.setValue(null)}}function L(ga,ma){ia.empty();ga&&Y.messages.info("#st-issue-details .st-issue-details-stub",{title:x.text("s.issueDetails.stub.title.+"+ga+"+"),body:x.text("s.issueDetails.stub.body.+"+ga+"+"),closeable:false});if(ma)qa.visibility.setValue(qa.visibility.value().add(h.oI).remove(h.ISSUE_LOADED));else ga?qa.visibility.applyUpdate(pa.add,h.oI|h.ISSUE_LOADED):qa.visibility.setValue(qa.visibility.value().remove(h.oI).add(h.ou))}return f}function I(f){return! !(f&&X.az.cI(f))}function R(){function f(L,ga){if(L&&ga){aa.issueModule.abortPending();Y.InlineDialog.current&&Y.InlineDialog.current.hide();v();if(
ga.key){P(ga);E(ga.id)}}else if(!L){Y.$(function(){try{aa.issueModule.beforeHide()}catch(ma){var va=x.getStackTrace(ma).join("\n");if(!va&&ma&&ma.stack)va=""+ma.stack;x.warn("Caught a JS error while hiding issue details:",ma,"\n",va)}Y.InlineDialog.current&&Y.InlineDialog.current.hide()});qa.visibility.applyUpdate(pa.remove,h.oA)}}function v(){var L=aa.getEditIssueController();(L=L&&L.getFields())&&L.each(function(ga){ga.blurEdit()})};function E(L){if(L){var ga=X.master.ae();L=ga.indexOf(L);L>0&&o(ga.rowId(L-1));L<ga.size()-1&&o(ga.rowId(L+1))}}function o(L){(L=X.az.getIssueKey(L))&&aa.viewIssueData.get(L,false,{prefetch:true})}qa.selectedIssue.pipeDebounced({wait:500,waitRebound:500,waitInit:0,fireAlways:true,immediateCall:false},function(L){f(qa.enabled.value(),L)});qa.enabled.pipe(true,function(L){f(L,qa.selectedIssue.value())})}function b(){function f(v,E){if(v&&E)if(E.fieldsSaved&& !X.master.cJ().cu()){ea.pi[v]=E.fieldsSaved;return true}else if(ea.pi[v]){E.fieldsSaved=ea.pi[v];delete ea.pi[v]}return false}(function(){X.eventBus.addListener(ja,y.aX,function(v,E){var o=qa.enabled.value()&&qa.selectedIssue.value();if((o=o&&o.key&&o.id)&&x.contains(v,o)&&E.dY()>ea.lastDataVersion)
{ea.lastDataVersion=E.dY();t(o)}x.eachOwn(ea.nU,function(L){L=x.toIntSafe(L,0);x.contains(v,L)&&ea.nU[L].state.applyUpdate(na.remove,ra.WAITING_FOR_STRUCTURE)})})})();g(S,"Dialog.show inlineEditStarted",x.curryThis(X.eventBus,X.eventBus.fireEvent,y.ISSUE_DETAILS_EDIT_STARTED));g(S,"Dialog.hide inlineEditCancelled",x.curryThis(X.eventBus,X.eventBus.fireEvent,y.ISSUE_DETAILS_EDIT_STOPPED));(function(){var v=new x.Lifecycle;X.eventBus.addListener(ja,y.ISSUE_DETAILS_EDIT_STOPPED,function(){v.cycle();var E=2,o=k(),L=ea.nU[o];if(L){L.state.pipe(v,function(ga){ga||v.cycleEnd()});X.eventBus.addListener(v,y.POLL_FINISHED,function(){E-=1;E||L.state.applyUpdate(na.remove,ra.WAITING_FOR_STRUCTURE)})}})})();(function(){g(S,"Dialog.beforeHide",function(v,E,o,L){var ga=S.Dialog.current;if(!(o==="cancel"||o==="esc"|| !ga||L!=="clone-issue-dialog")){v=qa.enabled.value()&&k();E=ea.nU[v];if(v&& !E){T(v,ga).always(function(){ga.hide()});return false}}})})();(function(){var v=aa.viewIssueController&&aa.viewIssueController._handleLoadSuccess;if(v){aa.viewIssueController._handleLoadSuccess=x.withThis(aa.viewIssueController,function(E,o){if(!f(E&&E.issueId,E)){var L=this.getSelectedEditIssueController();
if(L&&E&& !E.fieldsInProgress)E.fieldsInProgress=L.getEditsInProgress();if(L=o){L=x.clone(L);L.fields=x.convertArray(L.fields,x.clone)}v.call(this,E,L)}});g(S,"inlineEditCancelled",x.delayed(10,function(E,o){var L=aa.viewIssueController.getSelectedEditIssueController();if((L=(L=L&&L.getFields())&&L.get(o))&& !L.getEditing()){L.unset("error");t(k())}}))}})();(function(){function v(E){var o=E.update;if(o)E.update=function(L,ga){f(L&&(L.issueId||L.issue&&L.issue.id),ga)||o.call(E,L,ga)}}if(aa.issueModule.model&&aa.issueModule.editIssueController){v(aa.issueModule.model);v(aa.issueModule.editIssueController)}})()}function i(){(function(){function f(){E.po(o).pipe(L.cycle(),v)}function v(ga){switch(ga){case null:qa.visibility.applyUpdate(pa.remove,h.DISABLED);break;case H.IssueEditStates.EDITING:qa.visibility.applyUpdate(pa.add,h.DISABLED);break;case H.IssueEditStates.SUCCESS:if(o){qa.visibility.applyUpdate(pa.remove,h.ISSUE_LOADED);A(o,N.Deferred().always(function(){qa.enabled.value()&&k()===o&&qa.visibility.applyUpdate(pa.add,h.ISSUE_LOADED)}))}case H.IssueEditStates.CANCEL:qa.visibility.applyUpdate(pa.remove,h.DISABLED);break;default:x.warn("Unknown issue edit state",ga)}}var E=
X.master.cJ(),o,L=new x.Lifecycle;qa.visibility.pipeChanges(function(ga,ma){if(ga.is(h.ISSUE_LOADED)&&ma&& !ma.is(h.ISSUE_LOADED)){o=k();f()}});X.master.bD().addListener(ja,y.dz,function(ga,ma){ma===o&&f()})})();(function(){g(S,"beforeShow",function(f,v){v!=="create-issue-dialog"&&H.oH.shouldBlockActions()&&f.preventDefault()})})();(function(){p(aa.saveInProgressManager,"savingStarted",function(f){X.az.oS(f,true);X.master.aQ().hF(f,true)});p(aa.saveInProgressManager,"saveSuccess saveError",function(f){X.eventBus.fireEvent(y.ISSUE_DETAILS_EDIT_STOPPED);X.eventBus.fireEvent(y.kD);X.az.oS(f,false);X.master.aQ().hF(f,true)})})()}function r(){qa.enabled.pipeChanges(function(f){H.modes.ISSUE_DETAILS=f?true:null;X.eventBus.fireEvent(y.STRUCTURE_PAGE_CHANGED)})}function l(f){function v(E){return function(o){!o.ctrlKey&& !o.metaKey&& !o.shiftKey&&E.call(this,o)&&o.preventDefault()}}(function(){var E=["up","down","left","right","pageup","pagedown","home","end","space"];x.addAll(E,N.map(E,function(o){return "ctrl+"+o}));E.push("shift+space");E=N.map(E,x.keyboardCodeFromString);f.keyboardManager.setCustomController({accept:function(o,L){if(L===da[0]||N.contains(da[0],L))return!x.contains(E,
x.keyboardCodeFromEvent(o));else if(qa.menuOpened.value())return!o.isDefaultPrevented()}})})();(function(){var E=Y.$("#s-issueDetails-menu");(function(){var o=new x.AjsDropdown2RadioPresenter(qa.enabled.subCell(function(L){return L?"show":"hide"},function(L){return L==="show"}),E,"issueDetails",false);o.updateCell=x.delayed(50,o.updateCell,o)})();(function(){new x.AjsDropdown2RadioPresenter(qa.issueLinkAction,E,"issueLinkAction",true);var o=H.ajax.RESOURCES.CONFIG_WIDGET+"/issueLinkAction",L=new H.ajax.AJAX;qa.issueLinkAction.pipeChanges(ja,function(ga){var ma=new L.Task(o,H.ajax.UPLOAD,function(){x.debug("successfully set issueLinkAction to "+ga)},function(va,Ba,Ga){x.warn("Could not set preferred issue link action:",Ba,Ga)});ma.type="POST";ma.data=ga;ma.contentType="text/plain; charset=UTF-8";L.addTask(ma)})})();(function(){var o=N("#s-issueDetails-menu-trigger"),L=new x.Cell(qa.enabled,qa.issueKey,function(ga,ma){return!ga&& !ma});new x.ElementAttributeSetter(L,o,"aria-disabled",function(ga){return ga?"true":null},true);new x.ElementClassToggler(L,ba.disable,o)})();E.on({"aui-dropdown2-show":x.curryThis(qa.menuOpened,qa.menuOpened.setValue,true),"aui-dropdown2-hide":x.curryThis(
qa.menuOpened,qa.menuOpened.setValue,false)})})();(function(){X.eventBus.addListener(ja,y.BEFORE_CLICK,function(E){var o=E.link$.closest("a[href]");if(o.hasClass("issue-link")&&o.closest(".st-master").length)if(qa.enabled.value())E.prevent=true;else{o=qa.issueLinkAction.value();o==="showDetails"&&qa.enabled.setValue(true);if(o!=="openIssuePage")E.prevent=true}})})();(function(){function E(Ba){var Ga=Ba.type||Ba,oa=m();if(Ga==="focusout"){oa=Ba.target===da[0]||Ba.target===O[0];if(!(Ba.relatedTarget!==C&&Y.$(Ba.relatedTarget).is("input#shifter-dialog-field"))|| !oa)return;oa=true}if(oa||ga)ga|=ma[Ga];va.cycleEnd();Z&&x.debug(Ga,"focusedBefore =",ga,"|",x.debugElem(C.activeElement))}function o(Ba){var Ga=false,oa=(Ba.type||Ba)+(Ba.namespace?"."+Ba.namespace:"");if(oa==="focusout"&&Ba.target!==C)if(Y.$(Ba.target).is("input#shifter-dialog-field"))Ga=Ba.relatedTarget!==C&&Y.$(Ba.relatedTarget).is(":input");else return;Ba=ga& ~ma[oa];Z&&x.debug(oa,"focusedBefore =",ga,"newFocusedBefore =",Ba,"fromFocusShifterToInput = ",Ga);ga&& !Ba&& !Ga&&qa.visibility.pipeOnce(va.cycle(),function(ta){return ta.visible},ua);ga=Ba}var L=O.add(da);L.focusin(function(){da.addClass(ba.focused)});L.focusout(
function(){da.removeClass(ba.focused)});aa.issueModule.bind("fieldSubmitted",ua);aa.issueModule.bind("replacedFocusedPanel",ua);g(S,"inlineEditBlurred inlineEditCancelled",ua);var ga=false,ma={beforeShow:1,"Dialog.beforeHide":1,showLayer:2,hideLayer:2,focusout:4,structureEdit:8};g(S,"beforeShow showLayer focusout",E);g(S,"Dialog.beforeHide hideLayer focusout",o);var va=new x.Lifecycle;X.master.cJ().hE().pipeChanges(function(Ba,Ga){if(Ba&& !Ga)E("structureEdit");else!Ba&&Ga&&o("structureEdit")})})();(function(){(function(){Y.$(C).on("click","#attachment-sorting-options a,#attachment-sorting-order-options a,#subtasks-show-all,#subtasks-show-open",v(function(E){if(!this.href|| !U.parseUri)return false;var o=U.parseUri(this.href);if(o.queryKey){aa.issueModule.updateIssueWithQuery(o.queryKey);Y.$(this).parents("ul").find("a.aui-checked").removeClass("aui-checked");Y.$(this).addClass("aui-checked")}E.stopPropagation();return true}))})();(function(){Y.$(C).on("click",".subtask-reorder a",v(function(E){if(!this.href)return false;Y.$.ajax({type:"GET",data:{disableRedirect:true},url:this.href}).done(function(){S.Issues.Api.refreshSelectedIssue({reason:S.Issues.Actions.UPDATE})}).fail(
function(o){S.Messages.showErrorMsg(S.SmartAjax.buildSimpleErrorContent(o),{closeable:true})});E.stopPropagation();return true}))})()})();f.globalActions.register("toggleIssueDetailsNoFocus",H.oH.toggleEnabled)}function j(){n(function(){if(H.IssuePageTimeTrackingController){X.issuePageTT=new H.IssuePageTimeTrackingController(new x.Cell(true),function(){return{issue:k()||0,structure:X.widget.getStructureId()}});X.issuePageTT.trackTimetrackingUpdates();X.issuePageTT.trackStructureUpdates(X.eventBus);X.issuePageTT.loadTimeTracking()}})}function w(){function f(E){X.eventBus.fireEvent(y.gS,E)}function v(){return ".details"+(qa.enabled.value()?"On":"Off")}(function(){X.master.bD().addListener(ja,y.eu,function(){f("focusedIssueChanged"+v())})})();(function(){g(S,"inlineEditStarted",x.curry(f,"inlineEdit.issueViewer"));X.master.bD().addListener(ja,y.dz,function(){f("inlineEdit.structureBoard"+v())})})();f("issueDetails.issueLinkAction."+qa.issueLinkAction.value())}function D(){x.eachValue(qa,function(f){ja.addDetach(x.withThis(f,f.dispose))});ja.addDetach(function(){aa.viewIssueData.reset();aa.issueModule.dismiss()})}function J(f){if(f.config.lE)qa.enabled.setValue(H.oh(
f.config.perspectiveSpec)==="structure-with-details");else{qa.enabled.setValue(H.getStored("issueDetails.enabled")==="true");qa.enabled.pipeChanges(function(v){H.setStored("issueDetails.enabled",v?"true":"false")})}}function c(){function f(){function v(){var ma=new Y.HelpTip({id:"s.issueDetails.viewIntro",url:"http://almworks.com/structure/help/issue-details",title:x.text("s.issueDetails.viewIntro.title"),bodyHtml:x.text("s.issueDetails.viewIntro.body"),anchor:"#s-board-views button",isSequence:true,weight:10});E.showSequences();X.master.jY().kY().pipeOnce(L,x.truthy,function(){ma.dismiss()})};var E=Y.HelpTip.Manager,o=new Y.HelpTip({id:"s.issueDetails.intro",url:"http://almworks.com/structure/help/issue-details",title:x.text("s.issueDetails.intro.title"),bodyHtml:x.text("s.issueDetails.intro.body"),anchor:"#s-issueDetails-menu-trigger",isSequence:true,weight:1,inlineDialogOpts:{width:400}}),L=new x.Lifecycle;qa.enabled.value()?v():n(v);E.showSequences();qa.enabled.pipeOnce(function(ma){if(!o.isDismissed()){o.dismiss();if(!ma){E.clearSequences();L.cycle();n(v)}}});var ga=Y.$("#s-issueDetails-menu");ga.one("aui-dropdown2-show",function(){if(!o.isDismissed()){o.dismiss();if(
qa.enabled.value())ga.one("aui-dropdown2-hide",x.delayed(1E3,function(){E.clearSequences();L.cycle();n(v)}))}});ja.addDetach(x.withThis(L,L.dispose))}Y.HelpTip&&Y.HelpTip.Manager&&qa.issueKey.pipeOnce(x.truthy,x.delayed(1500,f))}function p(f,v,E){f.bind(v,E,ea);ja.addDetach(x.curryThis(f,f.unbind,v,E,ea))}function g(f,v,E){f.bind(v,E);ja.addDetach(x.curryThis(f,f.unbind,v,E))}function n(f){qa.visibility.pipeOnce(ja,function(v){return v.visible},f)}function m(){var f=da[0],v=C.activeElement;return f===v||N.contains(f,v)}function F(f){f?x.focus(O):x.focus(C.body)}var x=namespace("almworks.util",false),H=namespace("almworks.structure",false),ha=namespace("almworks.structure.apputil",false),y=namespace("almworks.structure.appevents",false),K=namespace("almworks.structure.ajsbridge",false),N=H.$,S=U.JIRA,Y=U.AJS,Z=false,la,da=x.generateDom("div",function(f){return f("#st-issue-details",{tabindex: -1})(f(".st-loading-layer"),f(".st-issue-details-stub"),f(".st-issue-details-focus-decoration")(f),f(".st-issue-details-viewport")(f(".st-issue-details-client")(f(".st-disable-layer"),f(".st-issue-container-parent split-view")(f(".issue-container")))))}),O=da.find(".issue-container"),W=da.find(
".st-issue-details-viewport"),ia=da.find(".st-issue-details-stub"),ja=new x.Life;x.extend(h,x.extend(h.prototype,{add:function(f){return new h(this.value|f)},remove:function(f){return new h(this.value& ~f)},is:function(f){return! !(this.value&f)},ISSUE_LOADED:1,oA:2,DISABLED:4,oI:8,ou:16}));var pa={add:function(f){return this.value().add(f)},remove:function(f){return this.value().remove(f)}},na={add:function(f){return this.value()|f},remove:function(f){return this.value()& ~f}},qa={enabled:new x.Cell(false),visibility:new x.Cell(new h(0)),selectedIssue:new x.Cell(null),issueKey:null,issueId:null,issueLinkAction:new x.Cell(null),menuOpened:new x.Cell(false)},aa={},X={widget:null,master:null,az:null,eventBus:null,aw:null,issuePageTT:null},ba={disable:"st-disable",opaque:"st-opaque",loading:"st-loading",noSelection:"st-no-selection",focused:"st-focused"},ea={initialized:false,oB:new x.Lifecycle,ov:new x.Lifecycle,nU:[],pb:new x.Lifecycle,unhandledSaveErrors:[],pi:[],lastDataVersion: -1},ra={WAITING_FOR_ISSUE_MODULE:1,WAITING_FOR_STRUCTURE:2},ka={IssueViewerMaxCacheSize:100};H.oH={initialize:function(f){f.div$.after(da);X.widget=f;X.master=f.master;X.az=f.az;X.eventBus=f.eventBus;X.aw=
f.aw;qa.issueKey=qa.selectedIssue.fieldSubCell("key");qa.issueId=qa.selectedIssue.fieldSubCell("id");e();try{B();q();u(f);f.master.bD().addListener(ja,y.eu,z());R();b();i();r();l(f);j();w();D();J(f);c();ea.initialized=true}catch(v){x.error(v)}},isInitialized:function(){return ea.initialized},toggleEnabled:function(){qa.enabled.setValue(!qa.enabled.value())},toggleEnabledAndFocus:function(){if(!qa.selectedIssue.value())return false;if(qa.enabled.value())qa.enabled.setValue(false);else{n(ua);qa.enabled.setValue(true)}return true},enabledCell:qa.enabled,visibleCell:qa.visibility.fieldSubCell("visible"),hk:function(){qa.visibility.applyUpdate(pa.add,h.oA)},onWidthChange:function(f){var v=M()?O:da;v.toggleClass("skinny",f<900);v.toggleClass("very-skinny",f<600)},panel$:da,issueContainer$:O,isFocused:m,setFocused:F,shouldBlockActions:function(){var f=qa.visibility.value();return f.is(h.oA)&& !f.visible},isValidFocusedIssueId:I,die:function(){ja.detach()},setDebug:function(f){Z=f;e()}};var ca=x.delayed(10,G),ua=x.curry(F,true)})(window,document); 
